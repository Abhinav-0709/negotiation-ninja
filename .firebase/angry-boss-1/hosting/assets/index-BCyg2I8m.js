(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function i(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(r){if(r.ep)return;r.ep=!0;const c=i(r);fetch(r.href,c)}})();var bh={exports:{}},Jr={};var u0;function q_(){if(u0)return Jr;u0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(a,r,c){var u=null;if(c!==void 0&&(u=""+c),r.key!==void 0&&(u=""+r.key),"key"in r){c={};for(var d in r)d!=="key"&&(c[d]=r[d])}else c=r;return r=c.ref,{$$typeof:n,type:a,key:u,ref:r!==void 0?r:null,props:c}}return Jr.Fragment=e,Jr.jsx=i,Jr.jsxs=i,Jr}var d0;function H_(){return d0||(d0=1,bh.exports=q_()),bh.exports}var Ce=H_(),Th={exports:{}},pe={};var h0;function G_(){if(h0)return pe;h0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),b=Symbol.iterator;function T(D){return D===null||typeof D!="object"?null:(D=b&&D[b]||D["@@iterator"],typeof D=="function"?D:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,x={};function w(D,K,ie){this.props=D,this.context=K,this.refs=x,this.updater=ie||C}w.prototype.isReactComponent={},w.prototype.setState=function(D,K){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,K,"setState")},w.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function V(){}V.prototype=w.prototype;function I(D,K,ie){this.props=D,this.context=K,this.refs=x,this.updater=ie||C}var A=I.prototype=new V;A.constructor=I,E(A,w.prototype),A.isPureReactComponent=!0;var R=Array.isArray;function B(){}var F={H:null,A:null,T:null,S:null},G=Object.prototype.hasOwnProperty;function $(D,K,ie){var oe=ie.ref;return{$$typeof:n,type:D,key:K,ref:oe!==void 0?oe:null,props:ie}}function Z(D,K){return $(D.type,K,D.props)}function ae(D){return typeof D=="object"&&D!==null&&D.$$typeof===n}function he(D){var K={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(ie){return K[ie]})}var Ye=/\/+/g;function rt(D,K){return typeof D=="object"&&D!==null&&D.key!=null?he(""+D.key):K.toString(36)}function ht(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(B,B):(D.status="pending",D.then(function(K){D.status==="pending"&&(D.status="fulfilled",D.value=K)},function(K){D.status==="pending"&&(D.status="rejected",D.reason=K)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function z(D,K,ie,oe,me){var ye=typeof D;(ye==="undefined"||ye==="boolean")&&(D=null);var Be=!1;if(D===null)Be=!0;else switch(ye){case"bigint":case"string":case"number":Be=!0;break;case"object":switch(D.$$typeof){case n:case e:Be=!0;break;case g:return Be=D._init,z(Be(D._payload),K,ie,oe,me)}}if(Be)return me=me(D),Be=oe===""?"."+rt(D,0):oe,R(me)?(ie="",Be!=null&&(ie=Be.replace(Ye,"$&/")+"/"),z(me,K,ie,"",function(ir){return ir})):me!=null&&(ae(me)&&(me=Z(me,ie+(me.key==null||D&&D.key===me.key?"":(""+me.key).replace(Ye,"$&/")+"/")+Be)),K.push(me)),1;Be=0;var It=oe===""?".":oe+":";if(R(D))for(var ot=0;ot<D.length;ot++)oe=D[ot],ye=It+rt(oe,ot),Be+=z(oe,K,ie,ye,me);else if(ot=T(D),typeof ot=="function")for(D=ot.call(D),ot=0;!(oe=D.next()).done;)oe=oe.value,ye=It+rt(oe,ot++),Be+=z(oe,K,ie,ye,me);else if(ye==="object"){if(typeof D.then=="function")return z(ht(D),K,ie,oe,me);throw K=String(D),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return Be}function W(D,K,ie){if(D==null)return D;var oe=[],me=0;return z(D,oe,"","",function(ye){return K.call(ie,ye,me++)}),oe}function se(D){if(D._status===-1){var K=D._result;K=K(),K.then(function(ie){(D._status===0||D._status===-1)&&(D._status=1,D._result=ie)},function(ie){(D._status===0||D._status===-1)&&(D._status=2,D._result=ie)}),D._status===-1&&(D._status=0,D._result=K)}if(D._status===1)return D._result.default;throw D._result}var Se=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)},ke={map:W,forEach:function(D,K,ie){W(D,function(){K.apply(this,arguments)},ie)},count:function(D){var K=0;return W(D,function(){K++}),K},toArray:function(D){return W(D,function(K){return K})||[]},only:function(D){if(!ae(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};return pe.Activity=v,pe.Children=ke,pe.Component=w,pe.Fragment=i,pe.Profiler=r,pe.PureComponent=I,pe.StrictMode=a,pe.Suspense=h,pe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,pe.__COMPILER_RUNTIME={__proto__:null,c:function(D){return F.H.useMemoCache(D)}},pe.cache=function(D){return function(){return D.apply(null,arguments)}},pe.cacheSignal=function(){return null},pe.cloneElement=function(D,K,ie){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var oe=E({},D.props),me=D.key;if(K!=null)for(ye in K.key!==void 0&&(me=""+K.key),K)!G.call(K,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&K.ref===void 0||(oe[ye]=K[ye]);var ye=arguments.length-2;if(ye===1)oe.children=ie;else if(1<ye){for(var Be=Array(ye),It=0;It<ye;It++)Be[It]=arguments[It+2];oe.children=Be}return $(D.type,me,oe)},pe.createContext=function(D){return D={$$typeof:u,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:c,_context:D},D},pe.createElement=function(D,K,ie){var oe,me={},ye=null;if(K!=null)for(oe in K.key!==void 0&&(ye=""+K.key),K)G.call(K,oe)&&oe!=="key"&&oe!=="__self"&&oe!=="__source"&&(me[oe]=K[oe]);var Be=arguments.length-2;if(Be===1)me.children=ie;else if(1<Be){for(var It=Array(Be),ot=0;ot<Be;ot++)It[ot]=arguments[ot+2];me.children=It}if(D&&D.defaultProps)for(oe in Be=D.defaultProps,Be)me[oe]===void 0&&(me[oe]=Be[oe]);return $(D,ye,me)},pe.createRef=function(){return{current:null}},pe.forwardRef=function(D){return{$$typeof:d,render:D}},pe.isValidElement=ae,pe.lazy=function(D){return{$$typeof:g,_payload:{_status:-1,_result:D},_init:se}},pe.memo=function(D,K){return{$$typeof:f,type:D,compare:K===void 0?null:K}},pe.startTransition=function(D){var K=F.T,ie={};F.T=ie;try{var oe=D(),me=F.S;me!==null&&me(ie,oe),typeof oe=="object"&&oe!==null&&typeof oe.then=="function"&&oe.then(B,Se)}catch(ye){Se(ye)}finally{K!==null&&ie.types!==null&&(K.types=ie.types),F.T=K}},pe.unstable_useCacheRefresh=function(){return F.H.useCacheRefresh()},pe.use=function(D){return F.H.use(D)},pe.useActionState=function(D,K,ie){return F.H.useActionState(D,K,ie)},pe.useCallback=function(D,K){return F.H.useCallback(D,K)},pe.useContext=function(D){return F.H.useContext(D)},pe.useDebugValue=function(){},pe.useDeferredValue=function(D,K){return F.H.useDeferredValue(D,K)},pe.useEffect=function(D,K){return F.H.useEffect(D,K)},pe.useEffectEvent=function(D){return F.H.useEffectEvent(D)},pe.useId=function(){return F.H.useId()},pe.useImperativeHandle=function(D,K,ie){return F.H.useImperativeHandle(D,K,ie)},pe.useInsertionEffect=function(D,K){return F.H.useInsertionEffect(D,K)},pe.useLayoutEffect=function(D,K){return F.H.useLayoutEffect(D,K)},pe.useMemo=function(D,K){return F.H.useMemo(D,K)},pe.useOptimistic=function(D,K){return F.H.useOptimistic(D,K)},pe.useReducer=function(D,K,ie){return F.H.useReducer(D,K,ie)},pe.useRef=function(D){return F.H.useRef(D)},pe.useState=function(D){return F.H.useState(D)},pe.useSyncExternalStore=function(D,K,ie){return F.H.useSyncExternalStore(D,K,ie)},pe.useTransition=function(){return F.H.useTransition()},pe.version="19.2.0",pe}var f0;function nm(){return f0||(f0=1,Th.exports=G_()),Th.exports}var le=nm(),Sh={exports:{}},Wr={},Ch={exports:{}},kh={};var m0;function K_(){return m0||(m0=1,(function(n){function e(z,W){var se=z.length;z.push(W);e:for(;0<se;){var Se=se-1>>>1,ke=z[Se];if(0<r(ke,W))z[Se]=W,z[se]=ke,se=Se;else break e}}function i(z){return z.length===0?null:z[0]}function a(z){if(z.length===0)return null;var W=z[0],se=z.pop();if(se!==W){z[0]=se;e:for(var Se=0,ke=z.length,D=ke>>>1;Se<D;){var K=2*(Se+1)-1,ie=z[K],oe=K+1,me=z[oe];if(0>r(ie,se))oe<ke&&0>r(me,ie)?(z[Se]=me,z[oe]=se,Se=oe):(z[Se]=ie,z[K]=se,Se=K);else if(oe<ke&&0>r(me,se))z[Se]=me,z[oe]=se,Se=oe;else break e}}return W}function r(z,W){var se=z.sortIndex-W.sortIndex;return se!==0?se:z.id-W.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var u=Date,d=u.now();n.unstable_now=function(){return u.now()-d}}var h=[],f=[],g=1,v=null,b=3,T=!1,C=!1,E=!1,x=!1,w=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function A(z){for(var W=i(f);W!==null;){if(W.callback===null)a(f);else if(W.startTime<=z)a(f),W.sortIndex=W.expirationTime,e(h,W);else break;W=i(f)}}function R(z){if(E=!1,A(z),!C)if(i(h)!==null)C=!0,B||(B=!0,he());else{var W=i(f);W!==null&&ht(R,W.startTime-z)}}var B=!1,F=-1,G=5,$=-1;function Z(){return x?!0:!(n.unstable_now()-$<G)}function ae(){if(x=!1,B){var z=n.unstable_now();$=z;var W=!0;try{e:{C=!1,E&&(E=!1,V(F),F=-1),T=!0;var se=b;try{t:{for(A(z),v=i(h);v!==null&&!(v.expirationTime>z&&Z());){var Se=v.callback;if(typeof Se=="function"){v.callback=null,b=v.priorityLevel;var ke=Se(v.expirationTime<=z);if(z=n.unstable_now(),typeof ke=="function"){v.callback=ke,A(z),W=!0;break t}v===i(h)&&a(h),A(z)}else a(h);v=i(h)}if(v!==null)W=!0;else{var D=i(f);D!==null&&ht(R,D.startTime-z),W=!1}}break e}finally{v=null,b=se,T=!1}W=void 0}}finally{W?he():B=!1}}}var he;if(typeof I=="function")he=function(){I(ae)};else if(typeof MessageChannel<"u"){var Ye=new MessageChannel,rt=Ye.port2;Ye.port1.onmessage=ae,he=function(){rt.postMessage(null)}}else he=function(){w(ae,0)};function ht(z,W){F=w(function(){z(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(z){switch(b){case 1:case 2:case 3:var W=3;break;default:W=b}var se=b;b=W;try{return z()}finally{b=se}},n.unstable_requestPaint=function(){x=!0},n.unstable_runWithPriority=function(z,W){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var se=b;b=z;try{return W()}finally{b=se}},n.unstable_scheduleCallback=function(z,W,se){var Se=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?Se+se:Se):se=Se,z){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=se+ke,z={id:g++,callback:W,priorityLevel:z,startTime:se,expirationTime:ke,sortIndex:-1},se>Se?(z.sortIndex=se,e(f,z),i(h)===null&&z===i(f)&&(E?(V(F),F=-1):E=!0,ht(R,se-Se))):(z.sortIndex=ke,e(h,z),C||T||(C=!0,B||(B=!0,he()))),z},n.unstable_shouldYield=Z,n.unstable_wrapCallback=function(z){var W=b;return function(){var se=b;b=W;try{return z.apply(this,arguments)}finally{b=se}}}})(kh)),kh}var p0;function Y_(){return p0||(p0=1,Ch.exports=K_()),Ch.exports}var Eh={exports:{}},Nt={};var g0;function X_(){if(g0)return Nt;g0=1;var n=nm();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(h,f,g){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:v==null?null:""+v,children:h,containerInfo:f,implementation:g}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Nt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Nt.createPortal=function(h,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return c(h,f,null,g)},Nt.flushSync=function(h){var f=u.T,g=a.p;try{if(u.T=null,a.p=2,h)return h()}finally{u.T=f,a.p=g,a.d.f()}},Nt.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,a.d.C(h,f))},Nt.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},Nt.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var g=f.as,v=d(g,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,T=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?a.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:v,integrity:b,fetchPriority:T}):g==="script"&&a.d.X(h,{crossOrigin:v,integrity:b,fetchPriority:T,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Nt.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=d(f.as,f.crossOrigin);a.d.M(h,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&a.d.M(h)},Nt.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,v=d(g,f.crossOrigin);a.d.L(h,g,{crossOrigin:v,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Nt.preloadModule=function(h,f){if(typeof h=="string")if(f){var g=d(f.as,f.crossOrigin);a.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else a.d.m(h)},Nt.requestFormReset=function(h){a.d.r(h)},Nt.unstable_batchedUpdates=function(h,f){return h(f)},Nt.useFormState=function(h,f,g){return u.H.useFormState(h,f,g)},Nt.useFormStatus=function(){return u.H.useHostTransitionStatus()},Nt.version="19.2.0",Nt}var v0;function Q_(){if(v0)return Eh.exports;v0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Eh.exports=X_(),Eh.exports}var y0;function J_(){if(y0)return Wr;y0=1;var n=Y_(),e=nm(),i=Q_();function a(t){var s="https://react.dev/errors/"+t;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var s=t,o=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,(s.flags&4098)!==0&&(o=s.return),t=s.return;while(t)}return s.tag===3?o:null}function u(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function d(t){if(t.tag===31){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function h(t){if(c(t)!==t)throw Error(a(188))}function f(t){var s=t.alternate;if(!s){if(s=c(t),s===null)throw Error(a(188));return s!==t?null:t}for(var o=t,l=s;;){var m=o.return;if(m===null)break;var p=m.alternate;if(p===null){if(l=m.return,l!==null){o=l;continue}break}if(m.child===p.child){for(p=m.child;p;){if(p===o)return h(m),t;if(p===l)return h(m),s;p=p.sibling}throw Error(a(188))}if(o.return!==l.return)o=m,l=p;else{for(var y=!1,S=m.child;S;){if(S===o){y=!0,o=m,l=p;break}if(S===l){y=!0,l=m,o=p;break}S=S.sibling}if(!y){for(S=p.child;S;){if(S===o){y=!0,o=p,l=m;break}if(S===l){y=!0,l=p,o=m;break}S=S.sibling}if(!y)throw Error(a(189))}}if(o.alternate!==l)throw Error(a(190))}if(o.tag!==3)throw Error(a(188));return o.stateNode.current===o?t:s}function g(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t;for(t=t.child;t!==null;){if(s=g(t),s!==null)return s;t=t.sibling}return null}var v=Object.assign,b=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),V=Symbol.for("react.consumer"),I=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),Z=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function he(t){return t===null||typeof t!="object"?null:(t=ae&&t[ae]||t["@@iterator"],typeof t=="function"?t:null)}var Ye=Symbol.for("react.client.reference");function rt(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Ye?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case E:return"Fragment";case w:return"Profiler";case x:return"StrictMode";case R:return"Suspense";case B:return"SuspenseList";case $:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case C:return"Portal";case I:return t.displayName||"Context";case V:return(t._context.displayName||"Context")+".Consumer";case A:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case F:return s=t.displayName||null,s!==null?s:rt(t.type)||"Memo";case G:s=t._payload,t=t._init;try{return rt(t(s))}catch{}}return null}var ht=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},Se=[],ke=-1;function D(t){return{current:t}}function K(t){0>ke||(t.current=Se[ke],Se[ke]=null,ke--)}function ie(t,s){ke++,Se[ke]=t.current,t.current=s}var oe=D(null),me=D(null),ye=D(null),Be=D(null);function It(t,s){switch(ie(ye,s),ie(me,t),ie(oe,null),s.nodeType){case 9:case 11:t=(t=s.documentElement)&&(t=t.namespaceURI)?Py(t):0;break;default:if(t=s.tagName,s=s.namespaceURI)s=Py(s),t=Ny(s,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}K(oe),ie(oe,t)}function ot(){K(oe),K(me),K(ye)}function ir(t){t.memoizedState!==null&&ie(Be,t);var s=oe.current,o=Ny(s,t.type);s!==o&&(ie(me,t),ie(oe,o))}function Uo(t){me.current===t&&(K(oe),K(me)),Be.current===t&&(K(Be),Kr._currentValue=se)}var tu,lp;function pa(t){if(tu===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);tu=s&&s[1]||"",lp=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tu+t+lp}var nu=!1;function iu(t,s){if(!t||nu)return"";nu=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(s){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(j){var U=j}Reflect.construct(t,[],Y)}else{try{Y.call()}catch(j){U=j}t.call(Y.prototype)}}else{try{throw Error()}catch(j){U=j}(Y=t())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(j){if(j&&U&&typeof j.stack=="string")return[j.stack,U.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=l.DetermineComponentFrameRoot(),y=p[0],S=p[1];if(y&&S){var _=y.split(`
`),N=S.split(`
`);for(m=l=0;l<_.length&&!_[l].includes("DetermineComponentFrameRoot");)l++;for(;m<N.length&&!N[m].includes("DetermineComponentFrameRoot");)m++;if(l===_.length||m===N.length)for(l=_.length-1,m=N.length-1;1<=l&&0<=m&&_[l]!==N[m];)m--;for(;1<=l&&0<=m;l--,m--)if(_[l]!==N[m]){if(l!==1||m!==1)do if(l--,m--,0>m||_[l]!==N[m]){var q=`
`+_[l].replace(" at new "," at ");return t.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",t.displayName)),q}while(1<=l&&0<=m);break}}}finally{nu=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?pa(o):""}function TE(t,s){switch(t.tag){case 26:case 27:case 5:return pa(t.type);case 16:return pa("Lazy");case 13:return t.child!==s&&s!==null?pa("Suspense Fallback"):pa("Suspense");case 19:return pa("SuspenseList");case 0:case 15:return iu(t.type,!1);case 11:return iu(t.type.render,!1);case 1:return iu(t.type,!0);case 31:return pa("Activity");default:return""}}function up(t){try{var s="",o=null;do s+=TE(t,o),o=t,t=t.return;while(t);return s}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var au=Object.prototype.hasOwnProperty,su=n.unstable_scheduleCallback,ru=n.unstable_cancelCallback,SE=n.unstable_shouldYield,CE=n.unstable_requestPaint,en=n.unstable_now,kE=n.unstable_getCurrentPriorityLevel,dp=n.unstable_ImmediatePriority,hp=n.unstable_UserBlockingPriority,Bo=n.unstable_NormalPriority,EE=n.unstable_LowPriority,fp=n.unstable_IdlePriority,_E=n.log,RE=n.unstable_setDisableYieldValue,ar=null,tn=null;function wi(t){if(typeof _E=="function"&&RE(t),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(ar,t)}catch{}}var nn=Math.clz32?Math.clz32:ME,AE=Math.log,wE=Math.LN2;function ME(t){return t>>>=0,t===0?32:31-(AE(t)/wE|0)|0}var jo=256,Vo=262144,Fo=4194304;function ga(t){var s=t&42;if(s!==0)return s;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function zo(t,s,o){var l=t.pendingLanes;if(l===0)return 0;var m=0,p=t.suspendedLanes,y=t.pingedLanes;t=t.warmLanes;var S=l&134217727;return S!==0?(l=S&~p,l!==0?m=ga(l):(y&=S,y!==0?m=ga(y):o||(o=S&~t,o!==0&&(m=ga(o))))):(S=l&~p,S!==0?m=ga(S):y!==0?m=ga(y):o||(o=l&~t,o!==0&&(m=ga(o)))),m===0?0:s!==0&&s!==m&&(s&p)===0&&(p=m&-m,o=s&-s,p>=o||p===32&&(o&4194048)!==0)?s:m}function sr(t,s){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&s)===0}function DE(t,s){switch(t){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mp(){var t=Fo;return Fo<<=1,(Fo&62914560)===0&&(Fo=4194304),t}function ou(t){for(var s=[],o=0;31>o;o++)s.push(t);return s}function rr(t,s){t.pendingLanes|=s,s!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function OE(t,s,o,l,m,p){var y=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var S=t.entanglements,_=t.expirationTimes,N=t.hiddenUpdates;for(o=y&~o;0<o;){var q=31-nn(o),Y=1<<q;S[q]=0,_[q]=-1;var U=N[q];if(U!==null)for(N[q]=null,q=0;q<U.length;q++){var j=U[q];j!==null&&(j.lane&=-536870913)}o&=~Y}l!==0&&pp(t,l,0),p!==0&&m===0&&t.tag!==0&&(t.suspendedLanes|=p&~(y&~s))}function pp(t,s,o){t.pendingLanes|=s,t.suspendedLanes&=~s;var l=31-nn(s);t.entangledLanes|=s,t.entanglements[l]=t.entanglements[l]|1073741824|o&261930}function gp(t,s){var o=t.entangledLanes|=s;for(t=t.entanglements;o;){var l=31-nn(o),m=1<<l;m&s|t[l]&s&&(t[l]|=s),o&=~m}}function vp(t,s){var o=s&-s;return o=(o&42)!==0?1:cu(o),(o&(t.suspendedLanes|s))!==0?0:o}function cu(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function lu(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function yp(){var t=W.p;return t!==0?t:(t=window.event,t===void 0?32:i0(t.type))}function bp(t,s){var o=W.p;try{return W.p=t,s()}finally{W.p=o}}var Mi=Math.random().toString(36).slice(2),Rt="__reactFiber$"+Mi,qt="__reactProps$"+Mi,Ya="__reactContainer$"+Mi,uu="__reactEvents$"+Mi,xE="__reactListeners$"+Mi,PE="__reactHandles$"+Mi,Tp="__reactResources$"+Mi,or="__reactMarker$"+Mi;function du(t){delete t[Rt],delete t[qt],delete t[uu],delete t[xE],delete t[PE]}function Xa(t){var s=t[Rt];if(s)return s;for(var o=t.parentNode;o;){if(s=o[Ya]||o[Rt]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(t=Fy(t);t!==null;){if(o=t[Rt])return o;t=Fy(t)}return s}t=o,o=t.parentNode}return null}function Qa(t){if(t=t[Rt]||t[Ya]){var s=t.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return t}return null}function cr(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t.stateNode;throw Error(a(33))}function Ja(t){var s=t[Tp];return s||(s=t[Tp]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ct(t){t[or]=!0}var Sp=new Set,Cp={};function va(t,s){Wa(t,s),Wa(t+"Capture",s)}function Wa(t,s){for(Cp[t]=s,t=0;t<s.length;t++)Sp.add(s[t])}var NE=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),kp={},Ep={};function LE(t){return au.call(Ep,t)?!0:au.call(kp,t)?!1:NE.test(t)?Ep[t]=!0:(kp[t]=!0,!1)}function qo(t,s,o){if(LE(s))if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(s);return;case"boolean":var l=s.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(s);return}}t.setAttribute(s,""+o)}}function Ho(t,s,o){if(o===null)t.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttribute(s,""+o)}}function Zn(t,s,o,l){if(l===null)t.removeAttribute(o);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(s,o,""+l)}}function hn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _p(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function IE(t,s,o){var l=Object.getOwnPropertyDescriptor(t.constructor.prototype,s);if(!t.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var m=l.get,p=l.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return m.call(this)},set:function(y){o=""+y,p.call(this,y)}}),Object.defineProperty(t,s,{enumerable:l.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function hu(t){if(!t._valueTracker){var s=_p(t)?"checked":"value";t._valueTracker=IE(t,s,""+t[s])}}function Rp(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var o=s.getValue(),l="";return t&&(l=_p(t)?t.checked?"true":"false":t.value),t=l,t!==o?(s.setValue(t),!0):!1}function Go(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var UE=/[\n"\\]/g;function fn(t){return t.replace(UE,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function fu(t,s,o,l,m,p,y,S){t.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?t.type=y:t.removeAttribute("type"),s!=null?y==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+hn(s)):t.value!==""+hn(s)&&(t.value=""+hn(s)):y!=="submit"&&y!=="reset"||t.removeAttribute("value"),s!=null?mu(t,y,hn(s)):o!=null?mu(t,y,hn(o)):l!=null&&t.removeAttribute("value"),m==null&&p!=null&&(t.defaultChecked=!!p),m!=null&&(t.checked=m&&typeof m!="function"&&typeof m!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?t.name=""+hn(S):t.removeAttribute("name")}function Ap(t,s,o,l,m,p,y,S){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.type=p),s!=null||o!=null){if(!(p!=="submit"&&p!=="reset"||s!=null)){hu(t);return}o=o!=null?""+hn(o):"",s=s!=null?""+hn(s):o,S||s===t.value||(t.value=s),t.defaultValue=s}l=l??m,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=S?t.checked:!!l,t.defaultChecked=!!l,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(t.name=y),hu(t)}function mu(t,s,o){s==="number"&&Go(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function Za(t,s,o,l){if(t=t.options,s){s={};for(var m=0;m<o.length;m++)s["$"+o[m]]=!0;for(o=0;o<t.length;o++)m=s.hasOwnProperty("$"+t[o].value),t[o].selected!==m&&(t[o].selected=m),m&&l&&(t[o].defaultSelected=!0)}else{for(o=""+hn(o),s=null,m=0;m<t.length;m++){if(t[m].value===o){t[m].selected=!0,l&&(t[m].defaultSelected=!0);return}s!==null||t[m].disabled||(s=t[m])}s!==null&&(s.selected=!0)}}function wp(t,s,o){if(s!=null&&(s=""+hn(s),s!==t.value&&(t.value=s),o==null)){t.defaultValue!==s&&(t.defaultValue=s);return}t.defaultValue=o!=null?""+hn(o):""}function Mp(t,s,o,l){if(s==null){if(l!=null){if(o!=null)throw Error(a(92));if(ht(l)){if(1<l.length)throw Error(a(93));l=l[0]}o=l}o==null&&(o=""),s=o}o=hn(s),t.defaultValue=o,l=t.textContent,l===o&&l!==""&&l!==null&&(t.value=l),hu(t)}function $a(t,s){if(s){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=s;return}}t.textContent=s}var BE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Dp(t,s,o){var l=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?l?t.setProperty(s,""):s==="float"?t.cssFloat="":t[s]="":l?t.setProperty(s,o):typeof o!="number"||o===0||BE.has(s)?s==="float"?t.cssFloat=o:t[s]=(""+o).trim():t[s]=o+"px"}function Op(t,s,o){if(s!=null&&typeof s!="object")throw Error(a(62));if(t=t.style,o!=null){for(var l in o)!o.hasOwnProperty(l)||s!=null&&s.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var m in s)l=s[m],s.hasOwnProperty(m)&&o[m]!==l&&Dp(t,m,l)}else for(var p in s)s.hasOwnProperty(p)&&Dp(t,p,s[p])}function pu(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jE=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),VE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ko(t){return VE.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function $n(){}var gu=null;function vu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var es=null,ts=null;function xp(t){var s=Qa(t);if(s&&(t=s.stateNode)){var o=t[qt]||null;e:switch(t=s.stateNode,s.type){case"input":if(fu(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+fn(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var l=o[s];if(l!==t&&l.form===t.form){var m=l[qt]||null;if(!m)throw Error(a(90));fu(l,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(s=0;s<o.length;s++)l=o[s],l.form===t.form&&Rp(l)}break e;case"textarea":wp(t,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&Za(t,!!o.multiple,s,!1)}}}var yu=!1;function Pp(t,s,o){if(yu)return t(s,o);yu=!0;try{var l=t(s);return l}finally{if(yu=!1,(es!==null||ts!==null)&&(Pc(),es&&(s=es,t=ts,ts=es=null,xp(s),t)))for(s=0;s<t.length;s++)xp(t[s])}}function lr(t,s){var o=t.stateNode;if(o===null)return null;var l=o[qt]||null;if(l===null)return null;o=l[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(a(231,s,typeof o));return o}var ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bu=!1;if(ei)try{var ur={};Object.defineProperty(ur,"passive",{get:function(){bu=!0}}),window.addEventListener("test",ur,ur),window.removeEventListener("test",ur,ur)}catch{bu=!1}var Di=null,Tu=null,Yo=null;function Np(){if(Yo)return Yo;var t,s=Tu,o=s.length,l,m="value"in Di?Di.value:Di.textContent,p=m.length;for(t=0;t<o&&s[t]===m[t];t++);var y=o-t;for(l=1;l<=y&&s[o-l]===m[p-l];l++);return Yo=m.slice(t,1<l?1-l:void 0)}function Xo(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Qo(){return!0}function Lp(){return!1}function Ht(t){function s(o,l,m,p,y){this._reactName=o,this._targetInst=m,this.type=l,this.nativeEvent=p,this.target=y,this.currentTarget=null;for(var S in t)t.hasOwnProperty(S)&&(o=t[S],this[S]=o?o(p):p[S]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Qo:Lp,this.isPropagationStopped=Lp,this}return v(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Qo)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Qo)},persist:function(){},isPersistent:Qo}),s}var ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jo=Ht(ya),dr=v({},ya,{view:0,detail:0}),FE=Ht(dr),Su,Cu,hr,Wo=v({},dr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eu,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==hr&&(hr&&t.type==="mousemove"?(Su=t.screenX-hr.screenX,Cu=t.screenY-hr.screenY):Cu=Su=0,hr=t),Su)},movementY:function(t){return"movementY"in t?t.movementY:Cu}}),Ip=Ht(Wo),zE=v({},Wo,{dataTransfer:0}),qE=Ht(zE),HE=v({},dr,{relatedTarget:0}),ku=Ht(HE),GE=v({},ya,{animationName:0,elapsedTime:0,pseudoElement:0}),KE=Ht(GE),YE=v({},ya,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),XE=Ht(YE),QE=v({},ya,{data:0}),Up=Ht(QE),JE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},WE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $E(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=ZE[t])?!!s[t]:!1}function Eu(){return $E}var e1=v({},dr,{key:function(t){if(t.key){var s=JE[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=Xo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?WE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eu,charCode:function(t){return t.type==="keypress"?Xo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),t1=Ht(e1),n1=v({},Wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bp=Ht(n1),i1=v({},dr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eu}),a1=Ht(i1),s1=v({},ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),r1=Ht(s1),o1=v({},Wo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),c1=Ht(o1),l1=v({},ya,{newState:0,oldState:0}),u1=Ht(l1),d1=[9,13,27,32],_u=ei&&"CompositionEvent"in window,fr=null;ei&&"documentMode"in document&&(fr=document.documentMode);var h1=ei&&"TextEvent"in window&&!fr,jp=ei&&(!_u||fr&&8<fr&&11>=fr),Vp=" ",Fp=!1;function zp(t,s){switch(t){case"keyup":return d1.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qp(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ns=!1;function f1(t,s){switch(t){case"compositionend":return qp(s);case"keypress":return s.which!==32?null:(Fp=!0,Vp);case"textInput":return t=s.data,t===Vp&&Fp?null:t;default:return null}}function m1(t,s){if(ns)return t==="compositionend"||!_u&&zp(t,s)?(t=Np(),Yo=Tu=Di=null,ns=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return jp&&s.locale!=="ko"?null:s.data;default:return null}}var p1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hp(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!p1[t.type]:s==="textarea"}function Gp(t,s,o,l){es?ts?ts.push(l):ts=[l]:es=l,s=Vc(s,"onChange"),0<s.length&&(o=new Jo("onChange","change",null,o,l),t.push({event:o,listeners:s}))}var mr=null,pr=null;function g1(t){Ay(t,0)}function Zo(t){var s=cr(t);if(Rp(s))return t}function Kp(t,s){if(t==="change")return s}var Yp=!1;if(ei){var Ru;if(ei){var Au="oninput"in document;if(!Au){var Xp=document.createElement("div");Xp.setAttribute("oninput","return;"),Au=typeof Xp.oninput=="function"}Ru=Au}else Ru=!1;Yp=Ru&&(!document.documentMode||9<document.documentMode)}function Qp(){mr&&(mr.detachEvent("onpropertychange",Jp),pr=mr=null)}function Jp(t){if(t.propertyName==="value"&&Zo(pr)){var s=[];Gp(s,pr,t,vu(t)),Pp(g1,s)}}function v1(t,s,o){t==="focusin"?(Qp(),mr=s,pr=o,mr.attachEvent("onpropertychange",Jp)):t==="focusout"&&Qp()}function y1(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Zo(pr)}function b1(t,s){if(t==="click")return Zo(s)}function T1(t,s){if(t==="input"||t==="change")return Zo(s)}function S1(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var an=typeof Object.is=="function"?Object.is:S1;function gr(t,s){if(an(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var o=Object.keys(t),l=Object.keys(s);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var m=o[l];if(!au.call(s,m)||!an(t[m],s[m]))return!1}return!0}function Wp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Zp(t,s){var o=Wp(t);t=0;for(var l;o;){if(o.nodeType===3){if(l=t+o.textContent.length,t<=s&&l>=s)return{node:o,offset:s-t};t=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Wp(o)}}function $p(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?$p(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function eg(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var s=Go(t.document);s instanceof t.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)t=s.contentWindow;else break;s=Go(t.document)}return s}function wu(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}var C1=ei&&"documentMode"in document&&11>=document.documentMode,is=null,Mu=null,vr=null,Du=!1;function tg(t,s,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Du||is==null||is!==Go(l)||(l=is,"selectionStart"in l&&wu(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),vr&&gr(vr,l)||(vr=l,l=Vc(Mu,"onSelect"),0<l.length&&(s=new Jo("onSelect","select",null,s,o),t.push({event:s,listeners:l}),s.target=is)))}function ba(t,s){var o={};return o[t.toLowerCase()]=s.toLowerCase(),o["Webkit"+t]="webkit"+s,o["Moz"+t]="moz"+s,o}var as={animationend:ba("Animation","AnimationEnd"),animationiteration:ba("Animation","AnimationIteration"),animationstart:ba("Animation","AnimationStart"),transitionrun:ba("Transition","TransitionRun"),transitionstart:ba("Transition","TransitionStart"),transitioncancel:ba("Transition","TransitionCancel"),transitionend:ba("Transition","TransitionEnd")},Ou={},ng={};ei&&(ng=document.createElement("div").style,"AnimationEvent"in window||(delete as.animationend.animation,delete as.animationiteration.animation,delete as.animationstart.animation),"TransitionEvent"in window||delete as.transitionend.transition);function Ta(t){if(Ou[t])return Ou[t];if(!as[t])return t;var s=as[t],o;for(o in s)if(s.hasOwnProperty(o)&&o in ng)return Ou[t]=s[o];return t}var ig=Ta("animationend"),ag=Ta("animationiteration"),sg=Ta("animationstart"),k1=Ta("transitionrun"),E1=Ta("transitionstart"),_1=Ta("transitioncancel"),rg=Ta("transitionend"),og=new Map,xu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xu.push("scrollEnd");function Mn(t,s){og.set(t,s),va(s,[t])}var $o=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},mn=[],ss=0,Pu=0;function ec(){for(var t=ss,s=Pu=ss=0;s<t;){var o=mn[s];mn[s++]=null;var l=mn[s];mn[s++]=null;var m=mn[s];mn[s++]=null;var p=mn[s];if(mn[s++]=null,l!==null&&m!==null){var y=l.pending;y===null?m.next=m:(m.next=y.next,y.next=m),l.pending=m}p!==0&&cg(o,m,p)}}function tc(t,s,o,l){mn[ss++]=t,mn[ss++]=s,mn[ss++]=o,mn[ss++]=l,Pu|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function Nu(t,s,o,l){return tc(t,s,o,l),nc(t)}function Sa(t,s){return tc(t,null,null,s),nc(t)}function cg(t,s,o){t.lanes|=o;var l=t.alternate;l!==null&&(l.lanes|=o);for(var m=!1,p=t.return;p!==null;)p.childLanes|=o,l=p.alternate,l!==null&&(l.childLanes|=o),p.tag===22&&(t=p.stateNode,t===null||t._visibility&1||(m=!0)),t=p,p=p.return;return t.tag===3?(p=t.stateNode,m&&s!==null&&(m=31-nn(o),t=p.hiddenUpdates,l=t[m],l===null?t[m]=[s]:l.push(s),s.lane=o|536870912),p):null}function nc(t){if(50<jr)throw jr=0,qd=null,Error(a(185));for(var s=t.return;s!==null;)t=s,s=t.return;return t.tag===3?t.stateNode:null}var rs={};function R1(t,s,o,l){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sn(t,s,o,l){return new R1(t,s,o,l)}function Lu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ti(t,s){var o=t.alternate;return o===null?(o=sn(t.tag,s,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=s,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,s=t.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function lg(t,s){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=s,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,s=o.dependencies,t.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t}function ic(t,s,o,l,m,p){var y=0;if(l=t,typeof t=="function")Lu(t)&&(y=1);else if(typeof t=="string")y=O_(t,o,oe.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case $:return t=sn(31,o,s,m),t.elementType=$,t.lanes=p,t;case E:return Ca(o.children,m,p,s);case x:y=8,m|=24;break;case w:return t=sn(12,o,s,m|2),t.elementType=w,t.lanes=p,t;case R:return t=sn(13,o,s,m),t.elementType=R,t.lanes=p,t;case B:return t=sn(19,o,s,m),t.elementType=B,t.lanes=p,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case I:y=10;break e;case V:y=9;break e;case A:y=11;break e;case F:y=14;break e;case G:y=16,l=null;break e}y=29,o=Error(a(130,t===null?"null":typeof t,"")),l=null}return s=sn(y,o,s,m),s.elementType=t,s.type=l,s.lanes=p,s}function Ca(t,s,o,l){return t=sn(7,t,l,s),t.lanes=o,t}function Iu(t,s,o){return t=sn(6,t,null,s),t.lanes=o,t}function ug(t){var s=sn(18,null,null,0);return s.stateNode=t,s}function Uu(t,s,o){return s=sn(4,t.children!==null?t.children:[],t.key,s),s.lanes=o,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}var dg=new WeakMap;function pn(t,s){if(typeof t=="object"&&t!==null){var o=dg.get(t);return o!==void 0?o:(s={value:t,source:s,stack:up(s)},dg.set(t,s),s)}return{value:t,source:s,stack:up(s)}}var os=[],cs=0,ac=null,yr=0,gn=[],vn=0,Oi=null,Vn=1,Fn="";function ni(t,s){os[cs++]=yr,os[cs++]=ac,ac=t,yr=s}function hg(t,s,o){gn[vn++]=Vn,gn[vn++]=Fn,gn[vn++]=Oi,Oi=t;var l=Vn;t=Fn;var m=32-nn(l)-1;l&=~(1<<m),o+=1;var p=32-nn(s)+m;if(30<p){var y=m-m%5;p=(l&(1<<y)-1).toString(32),l>>=y,m-=y,Vn=1<<32-nn(s)+m|o<<m|l,Fn=p+t}else Vn=1<<p|o<<m|l,Fn=t}function Bu(t){t.return!==null&&(ni(t,1),hg(t,1,0))}function ju(t){for(;t===ac;)ac=os[--cs],os[cs]=null,yr=os[--cs],os[cs]=null;for(;t===Oi;)Oi=gn[--vn],gn[vn]=null,Fn=gn[--vn],gn[vn]=null,Vn=gn[--vn],gn[vn]=null}function fg(t,s){gn[vn++]=Vn,gn[vn++]=Fn,gn[vn++]=Oi,Vn=s.id,Fn=s.overflow,Oi=t}var At=null,Xe=null,xe=!1,xi=null,yn=!1,Vu=Error(a(519));function Pi(t){var s=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw br(pn(s,t)),Vu}function mg(t){var s=t.stateNode,o=t.type,l=t.memoizedProps;switch(s[Rt]=t,s[qt]=l,o){case"dialog":_e("cancel",s),_e("close",s);break;case"iframe":case"object":case"embed":_e("load",s);break;case"video":case"audio":for(o=0;o<Fr.length;o++)_e(Fr[o],s);break;case"source":_e("error",s);break;case"img":case"image":case"link":_e("error",s),_e("load",s);break;case"details":_e("toggle",s);break;case"input":_e("invalid",s),Ap(s,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":_e("invalid",s);break;case"textarea":_e("invalid",s),Mp(s,l.value,l.defaultValue,l.children)}o=l.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||l.suppressHydrationWarning===!0||Oy(s.textContent,o)?(l.popover!=null&&(_e("beforetoggle",s),_e("toggle",s)),l.onScroll!=null&&_e("scroll",s),l.onScrollEnd!=null&&_e("scrollend",s),l.onClick!=null&&(s.onclick=$n),s=!0):s=!1,s||Pi(t,!0)}function pg(t){for(At=t.return;At;)switch(At.tag){case 5:case 31:case 13:yn=!1;return;case 27:case 3:yn=!0;return;default:At=At.return}}function ls(t){if(t!==At)return!1;if(!xe)return pg(t),xe=!0,!1;var s=t.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||ah(t.type,t.memoizedProps)),o=!o),o&&Xe&&Pi(t),pg(t),s===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));Xe=Vy(t)}else if(s===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));Xe=Vy(t)}else s===27?(s=Xe,Yi(t.type)?(t=lh,lh=null,Xe=t):Xe=s):Xe=At?Tn(t.stateNode.nextSibling):null;return!0}function ka(){Xe=At=null,xe=!1}function Fu(){var t=xi;return t!==null&&(Xt===null?Xt=t:Xt.push.apply(Xt,t),xi=null),t}function br(t){xi===null?xi=[t]:xi.push(t)}var zu=D(null),Ea=null,ii=null;function Ni(t,s,o){ie(zu,s._currentValue),s._currentValue=o}function ai(t){t._currentValue=zu.current,K(zu)}function qu(t,s,o){for(;t!==null;){var l=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,l!==null&&(l.childLanes|=s)):l!==null&&(l.childLanes&s)!==s&&(l.childLanes|=s),t===o)break;t=t.return}}function Hu(t,s,o,l){var m=t.child;for(m!==null&&(m.return=t);m!==null;){var p=m.dependencies;if(p!==null){var y=m.child;p=p.firstContext;e:for(;p!==null;){var S=p;p=m;for(var _=0;_<s.length;_++)if(S.context===s[_]){p.lanes|=o,S=p.alternate,S!==null&&(S.lanes|=o),qu(p.return,o,t),l||(y=null);break e}p=S.next}}else if(m.tag===18){if(y=m.return,y===null)throw Error(a(341));y.lanes|=o,p=y.alternate,p!==null&&(p.lanes|=o),qu(y,o,t),y=null}else y=m.child;if(y!==null)y.return=m;else for(y=m;y!==null;){if(y===t){y=null;break}if(m=y.sibling,m!==null){m.return=y.return,y=m;break}y=y.return}m=y}}function us(t,s,o,l){t=null;for(var m=s,p=!1;m!==null;){if(!p){if((m.flags&524288)!==0)p=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var y=m.alternate;if(y===null)throw Error(a(387));if(y=y.memoizedProps,y!==null){var S=m.type;an(m.pendingProps.value,y.value)||(t!==null?t.push(S):t=[S])}}else if(m===Be.current){if(y=m.alternate,y===null)throw Error(a(387));y.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(t!==null?t.push(Kr):t=[Kr])}m=m.return}t!==null&&Hu(s,t,o,l),s.flags|=262144}function sc(t){for(t=t.firstContext;t!==null;){if(!an(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function _a(t){Ea=t,ii=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function wt(t){return gg(Ea,t)}function rc(t,s){return Ea===null&&_a(t),gg(t,s)}function gg(t,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},ii===null){if(t===null)throw Error(a(308));ii=s,t.dependencies={lanes:0,firstContext:s},t.flags|=524288}else ii=ii.next=s;return o}var A1=typeof AbortController<"u"?AbortController:function(){var t=[],s=this.signal={aborted:!1,addEventListener:function(o,l){t.push(l)}};this.abort=function(){s.aborted=!0,t.forEach(function(o){return o()})}},w1=n.unstable_scheduleCallback,M1=n.unstable_NormalPriority,ft={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gu(){return{controller:new A1,data:new Map,refCount:0}}function Tr(t){t.refCount--,t.refCount===0&&w1(M1,function(){t.controller.abort()})}var Sr=null,Ku=0,ds=0,hs=null;function D1(t,s){if(Sr===null){var o=Sr=[];Ku=0,ds=Qd(),hs={status:"pending",value:void 0,then:function(l){o.push(l)}}}return Ku++,s.then(vg,vg),s}function vg(){if(--Ku===0&&Sr!==null){hs!==null&&(hs.status="fulfilled");var t=Sr;Sr=null,ds=0,hs=null;for(var s=0;s<t.length;s++)(0,t[s])()}}function O1(t,s){var o=[],l={status:"pending",value:null,reason:null,then:function(m){o.push(m)}};return t.then(function(){l.status="fulfilled",l.value=s;for(var m=0;m<o.length;m++)(0,o[m])(s)},function(m){for(l.status="rejected",l.reason=m,m=0;m<o.length;m++)(0,o[m])(void 0)}),l}var yg=z.S;z.S=function(t,s){ty=en(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&D1(t,s),yg!==null&&yg(t,s)};var Ra=D(null);function Yu(){var t=Ra.current;return t!==null?t:Ge.pooledCache}function oc(t,s){s===null?ie(Ra,Ra.current):ie(Ra,s.pool)}function bg(){var t=Yu();return t===null?null:{parent:ft._currentValue,pool:t}}var fs=Error(a(460)),Xu=Error(a(474)),cc=Error(a(542)),lc={then:function(){}};function Tg(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Sg(t,s,o){switch(o=t[o],o===void 0?t.push(s):o!==s&&(s.then($n,$n),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,kg(t),t;default:if(typeof s.status=="string")s.then($n,$n);else{if(t=Ge,t!==null&&100<t.shellSuspendCounter)throw Error(a(482));t=s,t.status="pending",t.then(function(l){if(s.status==="pending"){var m=s;m.status="fulfilled",m.value=l}},function(l){if(s.status==="pending"){var m=s;m.status="rejected",m.reason=l}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,kg(t),t}throw wa=s,fs}}function Aa(t){try{var s=t._init;return s(t._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(wa=o,fs):o}}var wa=null;function Cg(){if(wa===null)throw Error(a(459));var t=wa;return wa=null,t}function kg(t){if(t===fs||t===cc)throw Error(a(483))}var ms=null,Cr=0;function uc(t){var s=Cr;return Cr+=1,ms===null&&(ms=[]),Sg(ms,t,s)}function kr(t,s){s=s.props.ref,t.ref=s!==void 0?s:null}function dc(t,s){throw s.$$typeof===b?Error(a(525)):(t=Object.prototype.toString.call(s),Error(a(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t)))}function Eg(t){function s(O,M){if(t){var P=O.deletions;P===null?(O.deletions=[M],O.flags|=16):P.push(M)}}function o(O,M){if(!t)return null;for(;M!==null;)s(O,M),M=M.sibling;return null}function l(O){for(var M=new Map;O!==null;)O.key!==null?M.set(O.key,O):M.set(O.index,O),O=O.sibling;return M}function m(O,M){return O=ti(O,M),O.index=0,O.sibling=null,O}function p(O,M,P){return O.index=P,t?(P=O.alternate,P!==null?(P=P.index,P<M?(O.flags|=67108866,M):P):(O.flags|=67108866,M)):(O.flags|=1048576,M)}function y(O){return t&&O.alternate===null&&(O.flags|=67108866),O}function S(O,M,P,H){return M===null||M.tag!==6?(M=Iu(P,O.mode,H),M.return=O,M):(M=m(M,P),M.return=O,M)}function _(O,M,P,H){var ue=P.type;return ue===E?q(O,M,P.props.children,H,P.key):M!==null&&(M.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===G&&Aa(ue)===M.type)?(M=m(M,P.props),kr(M,P),M.return=O,M):(M=ic(P.type,P.key,P.props,null,O.mode,H),kr(M,P),M.return=O,M)}function N(O,M,P,H){return M===null||M.tag!==4||M.stateNode.containerInfo!==P.containerInfo||M.stateNode.implementation!==P.implementation?(M=Uu(P,O.mode,H),M.return=O,M):(M=m(M,P.children||[]),M.return=O,M)}function q(O,M,P,H,ue){return M===null||M.tag!==7?(M=Ca(P,O.mode,H,ue),M.return=O,M):(M=m(M,P),M.return=O,M)}function Y(O,M,P){if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return M=Iu(""+M,O.mode,P),M.return=O,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case T:return P=ic(M.type,M.key,M.props,null,O.mode,P),kr(P,M),P.return=O,P;case C:return M=Uu(M,O.mode,P),M.return=O,M;case G:return M=Aa(M),Y(O,M,P)}if(ht(M)||he(M))return M=Ca(M,O.mode,P,null),M.return=O,M;if(typeof M.then=="function")return Y(O,uc(M),P);if(M.$$typeof===I)return Y(O,rc(O,M),P);dc(O,M)}return null}function U(O,M,P,H){var ue=M!==null?M.key:null;if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return ue!==null?null:S(O,M,""+P,H);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case T:return P.key===ue?_(O,M,P,H):null;case C:return P.key===ue?N(O,M,P,H):null;case G:return P=Aa(P),U(O,M,P,H)}if(ht(P)||he(P))return ue!==null?null:q(O,M,P,H,null);if(typeof P.then=="function")return U(O,M,uc(P),H);if(P.$$typeof===I)return U(O,M,rc(O,P),H);dc(O,P)}return null}function j(O,M,P,H,ue){if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return O=O.get(P)||null,S(M,O,""+H,ue);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case T:return O=O.get(H.key===null?P:H.key)||null,_(M,O,H,ue);case C:return O=O.get(H.key===null?P:H.key)||null,N(M,O,H,ue);case G:return H=Aa(H),j(O,M,P,H,ue)}if(ht(H)||he(H))return O=O.get(P)||null,q(M,O,H,ue,null);if(typeof H.then=="function")return j(O,M,P,uc(H),ue);if(H.$$typeof===I)return j(O,M,P,rc(M,H),ue);dc(M,H)}return null}function re(O,M,P,H){for(var ue=null,Pe=null,ce=M,be=M=0,De=null;ce!==null&&be<P.length;be++){ce.index>be?(De=ce,ce=null):De=ce.sibling;var Ne=U(O,ce,P[be],H);if(Ne===null){ce===null&&(ce=De);break}t&&ce&&Ne.alternate===null&&s(O,ce),M=p(Ne,M,be),Pe===null?ue=Ne:Pe.sibling=Ne,Pe=Ne,ce=De}if(be===P.length)return o(O,ce),xe&&ni(O,be),ue;if(ce===null){for(;be<P.length;be++)ce=Y(O,P[be],H),ce!==null&&(M=p(ce,M,be),Pe===null?ue=ce:Pe.sibling=ce,Pe=ce);return xe&&ni(O,be),ue}for(ce=l(ce);be<P.length;be++)De=j(ce,O,be,P[be],H),De!==null&&(t&&De.alternate!==null&&ce.delete(De.key===null?be:De.key),M=p(De,M,be),Pe===null?ue=De:Pe.sibling=De,Pe=De);return t&&ce.forEach(function(Zi){return s(O,Zi)}),xe&&ni(O,be),ue}function de(O,M,P,H){if(P==null)throw Error(a(151));for(var ue=null,Pe=null,ce=M,be=M=0,De=null,Ne=P.next();ce!==null&&!Ne.done;be++,Ne=P.next()){ce.index>be?(De=ce,ce=null):De=ce.sibling;var Zi=U(O,ce,Ne.value,H);if(Zi===null){ce===null&&(ce=De);break}t&&ce&&Zi.alternate===null&&s(O,ce),M=p(Zi,M,be),Pe===null?ue=Zi:Pe.sibling=Zi,Pe=Zi,ce=De}if(Ne.done)return o(O,ce),xe&&ni(O,be),ue;if(ce===null){for(;!Ne.done;be++,Ne=P.next())Ne=Y(O,Ne.value,H),Ne!==null&&(M=p(Ne,M,be),Pe===null?ue=Ne:Pe.sibling=Ne,Pe=Ne);return xe&&ni(O,be),ue}for(ce=l(ce);!Ne.done;be++,Ne=P.next())Ne=j(ce,O,be,Ne.value,H),Ne!==null&&(t&&Ne.alternate!==null&&ce.delete(Ne.key===null?be:Ne.key),M=p(Ne,M,be),Pe===null?ue=Ne:Pe.sibling=Ne,Pe=Ne);return t&&ce.forEach(function(z_){return s(O,z_)}),xe&&ni(O,be),ue}function qe(O,M,P,H){if(typeof P=="object"&&P!==null&&P.type===E&&P.key===null&&(P=P.props.children),typeof P=="object"&&P!==null){switch(P.$$typeof){case T:e:{for(var ue=P.key;M!==null;){if(M.key===ue){if(ue=P.type,ue===E){if(M.tag===7){o(O,M.sibling),H=m(M,P.props.children),H.return=O,O=H;break e}}else if(M.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===G&&Aa(ue)===M.type){o(O,M.sibling),H=m(M,P.props),kr(H,P),H.return=O,O=H;break e}o(O,M);break}else s(O,M);M=M.sibling}P.type===E?(H=Ca(P.props.children,O.mode,H,P.key),H.return=O,O=H):(H=ic(P.type,P.key,P.props,null,O.mode,H),kr(H,P),H.return=O,O=H)}return y(O);case C:e:{for(ue=P.key;M!==null;){if(M.key===ue)if(M.tag===4&&M.stateNode.containerInfo===P.containerInfo&&M.stateNode.implementation===P.implementation){o(O,M.sibling),H=m(M,P.children||[]),H.return=O,O=H;break e}else{o(O,M);break}else s(O,M);M=M.sibling}H=Uu(P,O.mode,H),H.return=O,O=H}return y(O);case G:return P=Aa(P),qe(O,M,P,H)}if(ht(P))return re(O,M,P,H);if(he(P)){if(ue=he(P),typeof ue!="function")throw Error(a(150));return P=ue.call(P),de(O,M,P,H)}if(typeof P.then=="function")return qe(O,M,uc(P),H);if(P.$$typeof===I)return qe(O,M,rc(O,P),H);dc(O,P)}return typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint"?(P=""+P,M!==null&&M.tag===6?(o(O,M.sibling),H=m(M,P),H.return=O,O=H):(o(O,M),H=Iu(P,O.mode,H),H.return=O,O=H),y(O)):o(O,M)}return function(O,M,P,H){try{Cr=0;var ue=qe(O,M,P,H);return ms=null,ue}catch(ce){if(ce===fs||ce===cc)throw ce;var Pe=sn(29,ce,null,O.mode);return Pe.lanes=H,Pe.return=O,Pe}finally{}}}var Ma=Eg(!0),_g=Eg(!1),Li=!1;function Qu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ii(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ui(t,s,o){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(Ie&2)!==0){var m=l.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),l.pending=s,s=nc(t),cg(t,null,o),s}return tc(t,l,s,o),nc(t)}function Er(t,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,gp(t,o)}}function Wu(t,s){var o=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var m=null,p=null;if(o=o.firstBaseUpdate,o!==null){do{var y={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};p===null?m=p=y:p=p.next=y,o=o.next}while(o!==null);p===null?m=p=s:p=p.next=s}else m=p=s;o={baseState:l.baseState,firstBaseUpdate:m,lastBaseUpdate:p,shared:l.shared,callbacks:l.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=s:t.next=s,o.lastBaseUpdate=s}var Zu=!1;function _r(){if(Zu){var t=hs;if(t!==null)throw t}}function Rr(t,s,o,l){Zu=!1;var m=t.updateQueue;Li=!1;var p=m.firstBaseUpdate,y=m.lastBaseUpdate,S=m.shared.pending;if(S!==null){m.shared.pending=null;var _=S,N=_.next;_.next=null,y===null?p=N:y.next=N,y=_;var q=t.alternate;q!==null&&(q=q.updateQueue,S=q.lastBaseUpdate,S!==y&&(S===null?q.firstBaseUpdate=N:S.next=N,q.lastBaseUpdate=_))}if(p!==null){var Y=m.baseState;y=0,q=N=_=null,S=p;do{var U=S.lane&-536870913,j=U!==S.lane;if(j?(Me&U)===U:(l&U)===U){U!==0&&U===ds&&(Zu=!0),q!==null&&(q=q.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var re=t,de=S;U=s;var qe=o;switch(de.tag){case 1:if(re=de.payload,typeof re=="function"){Y=re.call(qe,Y,U);break e}Y=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=de.payload,U=typeof re=="function"?re.call(qe,Y,U):re,U==null)break e;Y=v({},Y,U);break e;case 2:Li=!0}}U=S.callback,U!==null&&(t.flags|=64,j&&(t.flags|=8192),j=m.callbacks,j===null?m.callbacks=[U]:j.push(U))}else j={lane:U,tag:S.tag,payload:S.payload,callback:S.callback,next:null},q===null?(N=q=j,_=Y):q=q.next=j,y|=U;if(S=S.next,S===null){if(S=m.shared.pending,S===null)break;j=S,S=j.next,j.next=null,m.lastBaseUpdate=j,m.shared.pending=null}}while(!0);q===null&&(_=Y),m.baseState=_,m.firstBaseUpdate=N,m.lastBaseUpdate=q,p===null&&(m.shared.lanes=0),zi|=y,t.lanes=y,t.memoizedState=Y}}function Rg(t,s){if(typeof t!="function")throw Error(a(191,t));t.call(s)}function Ag(t,s){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)Rg(o[t],s)}var ps=D(null),hc=D(0);function wg(t,s){t=fi,ie(hc,t),ie(ps,s),fi=t|s.baseLanes}function $u(){ie(hc,fi),ie(ps,ps.current)}function ed(){fi=hc.current,K(ps),K(hc)}var rn=D(null),bn=null;function Bi(t){var s=t.alternate;ie(ct,ct.current&1),ie(rn,t),bn===null&&(s===null||ps.current!==null||s.memoizedState!==null)&&(bn=t)}function td(t){ie(ct,ct.current),ie(rn,t),bn===null&&(bn=t)}function Mg(t){t.tag===22?(ie(ct,ct.current),ie(rn,t),bn===null&&(bn=t)):ji()}function ji(){ie(ct,ct.current),ie(rn,rn.current)}function on(t){K(rn),bn===t&&(bn=null),K(ct)}var ct=D(0);function fc(t){for(var s=t;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||oh(o)||ch(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var si=0,ve=null,Fe=null,mt=null,mc=!1,gs=!1,Da=!1,pc=0,Ar=0,vs=null,x1=0;function et(){throw Error(a(321))}function nd(t,s){if(s===null)return!1;for(var o=0;o<s.length&&o<t.length;o++)if(!an(t[o],s[o]))return!1;return!0}function id(t,s,o,l,m,p){return si=p,ve=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,z.H=t===null||t.memoizedState===null?hv:yd,Da=!1,p=o(l,m),Da=!1,gs&&(p=Og(s,o,l,m)),Dg(t),p}function Dg(t){z.H=Dr;var s=Fe!==null&&Fe.next!==null;if(si=0,mt=Fe=ve=null,mc=!1,Ar=0,vs=null,s)throw Error(a(300));t===null||pt||(t=t.dependencies,t!==null&&sc(t)&&(pt=!0))}function Og(t,s,o,l){ve=t;var m=0;do{if(gs&&(vs=null),Ar=0,gs=!1,25<=m)throw Error(a(301));if(m+=1,mt=Fe=null,t.updateQueue!=null){var p=t.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}z.H=fv,p=s(o,l)}while(gs);return p}function P1(){var t=z.H,s=t.useState()[0];return s=typeof s.then=="function"?wr(s):s,t=t.useState()[0],(Fe!==null?Fe.memoizedState:null)!==t&&(ve.flags|=1024),s}function ad(){var t=pc!==0;return pc=0,t}function sd(t,s,o){s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~o}function rd(t){if(mc){for(t=t.memoizedState;t!==null;){var s=t.queue;s!==null&&(s.pending=null),t=t.next}mc=!1}si=0,mt=Fe=ve=null,gs=!1,Ar=pc=0,vs=null}function Ut(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mt===null?ve.memoizedState=mt=t:mt=mt.next=t,mt}function lt(){if(Fe===null){var t=ve.alternate;t=t!==null?t.memoizedState:null}else t=Fe.next;var s=mt===null?ve.memoizedState:mt.next;if(s!==null)mt=s,Fe=t;else{if(t===null)throw ve.alternate===null?Error(a(467)):Error(a(310));Fe=t,t={memoizedState:Fe.memoizedState,baseState:Fe.baseState,baseQueue:Fe.baseQueue,queue:Fe.queue,next:null},mt===null?ve.memoizedState=mt=t:mt=mt.next=t}return mt}function gc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function wr(t){var s=Ar;return Ar+=1,vs===null&&(vs=[]),t=Sg(vs,t,s),s=ve,(mt===null?s.memoizedState:mt.next)===null&&(s=s.alternate,z.H=s===null||s.memoizedState===null?hv:yd),t}function vc(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return wr(t);if(t.$$typeof===I)return wt(t)}throw Error(a(438,String(t)))}function od(t){var s=null,o=ve.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var l=ve.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(s={data:l.data.map(function(m){return m.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=gc(),ve.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(t),l=0;l<t;l++)o[l]=Z;return s.index++,o}function ri(t,s){return typeof s=="function"?s(t):s}function yc(t){var s=lt();return cd(s,Fe,t)}function cd(t,s,o){var l=t.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=o;var m=t.baseQueue,p=l.pending;if(p!==null){if(m!==null){var y=m.next;m.next=p.next,p.next=y}s.baseQueue=m=p,l.pending=null}if(p=t.baseState,m===null)t.memoizedState=p;else{s=m.next;var S=y=null,_=null,N=s,q=!1;do{var Y=N.lane&-536870913;if(Y!==N.lane?(Me&Y)===Y:(si&Y)===Y){var U=N.revertLane;if(U===0)_!==null&&(_=_.next={lane:0,revertLane:0,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),Y===ds&&(q=!0);else if((si&U)===U){N=N.next,U===ds&&(q=!0);continue}else Y={lane:0,revertLane:N.revertLane,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},_===null?(S=_=Y,y=p):_=_.next=Y,ve.lanes|=U,zi|=U;Y=N.action,Da&&o(p,Y),p=N.hasEagerState?N.eagerState:o(p,Y)}else U={lane:Y,revertLane:N.revertLane,gesture:N.gesture,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},_===null?(S=_=U,y=p):_=_.next=U,ve.lanes|=Y,zi|=Y;N=N.next}while(N!==null&&N!==s);if(_===null?y=p:_.next=S,!an(p,t.memoizedState)&&(pt=!0,q&&(o=hs,o!==null)))throw o;t.memoizedState=p,t.baseState=y,t.baseQueue=_,l.lastRenderedState=p}return m===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function ld(t){var s=lt(),o=s.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=t;var l=o.dispatch,m=o.pending,p=s.memoizedState;if(m!==null){o.pending=null;var y=m=m.next;do p=t(p,y.action),y=y.next;while(y!==m);an(p,s.memoizedState)||(pt=!0),s.memoizedState=p,s.baseQueue===null&&(s.baseState=p),o.lastRenderedState=p}return[p,l]}function xg(t,s,o){var l=ve,m=lt(),p=xe;if(p){if(o===void 0)throw Error(a(407));o=o()}else o=s();var y=!an((Fe||m).memoizedState,o);if(y&&(m.memoizedState=o,pt=!0),m=m.queue,hd(Lg.bind(null,l,m,t),[t]),m.getSnapshot!==s||y||mt!==null&&mt.memoizedState.tag&1){if(l.flags|=2048,ys(9,{destroy:void 0},Ng.bind(null,l,m,o,s),null),Ge===null)throw Error(a(349));p||(si&127)!==0||Pg(l,s,o)}return o}function Pg(t,s,o){t.flags|=16384,t={getSnapshot:s,value:o},s=ve.updateQueue,s===null?(s=gc(),ve.updateQueue=s,s.stores=[t]):(o=s.stores,o===null?s.stores=[t]:o.push(t))}function Ng(t,s,o,l){s.value=o,s.getSnapshot=l,Ig(s)&&Ug(t)}function Lg(t,s,o){return o(function(){Ig(s)&&Ug(t)})}function Ig(t){var s=t.getSnapshot;t=t.value;try{var o=s();return!an(t,o)}catch{return!0}}function Ug(t){var s=Sa(t,2);s!==null&&Qt(s,t,2)}function ud(t){var s=Ut();if(typeof t=="function"){var o=t;if(t=o(),Da){wi(!0);try{o()}finally{wi(!1)}}}return s.memoizedState=s.baseState=t,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:t},s}function Bg(t,s,o,l){return t.baseState=o,cd(t,Fe,typeof l=="function"?l:ri)}function N1(t,s,o,l,m){if(Sc(t))throw Error(a(485));if(t=s.action,t!==null){var p={payload:m,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){p.listeners.push(y)}};z.T!==null?o(!0):p.isTransition=!1,l(p),o=s.pending,o===null?(p.next=s.pending=p,jg(s,p)):(p.next=o.next,s.pending=o.next=p)}}function jg(t,s){var o=s.action,l=s.payload,m=t.state;if(s.isTransition){var p=z.T,y={};z.T=y;try{var S=o(m,l),_=z.S;_!==null&&_(y,S),Vg(t,s,S)}catch(N){dd(t,s,N)}finally{p!==null&&y.types!==null&&(p.types=y.types),z.T=p}}else try{p=o(m,l),Vg(t,s,p)}catch(N){dd(t,s,N)}}function Vg(t,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(l){Fg(t,s,l)},function(l){return dd(t,s,l)}):Fg(t,s,o)}function Fg(t,s,o){s.status="fulfilled",s.value=o,zg(s),t.state=o,s=t.pending,s!==null&&(o=s.next,o===s?t.pending=null:(o=o.next,s.next=o,jg(t,o)))}function dd(t,s,o){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do s.status="rejected",s.reason=o,zg(s),s=s.next;while(s!==l)}t.action=null}function zg(t){t=t.listeners;for(var s=0;s<t.length;s++)(0,t[s])()}function qg(t,s){return s}function Hg(t,s){if(xe){var o=Ge.formState;if(o!==null){e:{var l=ve;if(xe){if(Xe){t:{for(var m=Xe,p=yn;m.nodeType!==8;){if(!p){m=null;break t}if(m=Tn(m.nextSibling),m===null){m=null;break t}}p=m.data,m=p==="F!"||p==="F"?m:null}if(m){Xe=Tn(m.nextSibling),l=m.data==="F!";break e}}Pi(l)}l=!1}l&&(s=o[0])}}return o=Ut(),o.memoizedState=o.baseState=s,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qg,lastRenderedState:s},o.queue=l,o=lv.bind(null,ve,l),l.dispatch=o,l=ud(!1),p=vd.bind(null,ve,!1,l.queue),l=Ut(),m={state:s,dispatch:null,action:t,pending:null},l.queue=m,o=N1.bind(null,ve,m,p,o),m.dispatch=o,l.memoizedState=t,[s,o,!1]}function Gg(t){var s=lt();return Kg(s,Fe,t)}function Kg(t,s,o){if(s=cd(t,s,qg)[0],t=yc(ri)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var l=wr(s)}catch(y){throw y===fs?cc:y}else l=s;s=lt();var m=s.queue,p=m.dispatch;return o!==s.memoizedState&&(ve.flags|=2048,ys(9,{destroy:void 0},L1.bind(null,m,o),null)),[l,p,t]}function L1(t,s){t.action=s}function Yg(t){var s=lt(),o=Fe;if(o!==null)return Kg(s,o,t);lt(),s=s.memoizedState,o=lt();var l=o.queue.dispatch;return o.memoizedState=t,[s,l,!1]}function ys(t,s,o,l){return t={tag:t,create:o,deps:l,inst:s,next:null},s=ve.updateQueue,s===null&&(s=gc(),ve.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=t.next=t:(l=o.next,o.next=t,t.next=l,s.lastEffect=t),t}function Xg(){return lt().memoizedState}function bc(t,s,o,l){var m=Ut();ve.flags|=t,m.memoizedState=ys(1|s,{destroy:void 0},o,l===void 0?null:l)}function Tc(t,s,o,l){var m=lt();l=l===void 0?null:l;var p=m.memoizedState.inst;Fe!==null&&l!==null&&nd(l,Fe.memoizedState.deps)?m.memoizedState=ys(s,p,o,l):(ve.flags|=t,m.memoizedState=ys(1|s,p,o,l))}function Qg(t,s){bc(8390656,8,t,s)}function hd(t,s){Tc(2048,8,t,s)}function I1(t){ve.flags|=4;var s=ve.updateQueue;if(s===null)s=gc(),ve.updateQueue=s,s.events=[t];else{var o=s.events;o===null?s.events=[t]:o.push(t)}}function Jg(t){var s=lt().memoizedState;return I1({ref:s,nextImpl:t}),function(){if((Ie&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}function Wg(t,s){return Tc(4,2,t,s)}function Zg(t,s){return Tc(4,4,t,s)}function $g(t,s){if(typeof s=="function"){t=t();var o=s(t);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function ev(t,s,o){o=o!=null?o.concat([t]):null,Tc(4,4,$g.bind(null,s,t),o)}function fd(){}function tv(t,s){var o=lt();s=s===void 0?null:s;var l=o.memoizedState;return s!==null&&nd(s,l[1])?l[0]:(o.memoizedState=[t,s],t)}function nv(t,s){var o=lt();s=s===void 0?null:s;var l=o.memoizedState;if(s!==null&&nd(s,l[1]))return l[0];if(l=t(),Da){wi(!0);try{t()}finally{wi(!1)}}return o.memoizedState=[l,s],l}function md(t,s,o){return o===void 0||(si&1073741824)!==0&&(Me&261930)===0?t.memoizedState=s:(t.memoizedState=o,t=iy(),ve.lanes|=t,zi|=t,o)}function iv(t,s,o,l){return an(o,s)?o:ps.current!==null?(t=md(t,o,l),an(t,s)||(pt=!0),t):(si&42)===0||(si&1073741824)!==0&&(Me&261930)===0?(pt=!0,t.memoizedState=o):(t=iy(),ve.lanes|=t,zi|=t,s)}function av(t,s,o,l,m){var p=W.p;W.p=p!==0&&8>p?p:8;var y=z.T,S={};z.T=S,vd(t,!1,s,o);try{var _=m(),N=z.S;if(N!==null&&N(S,_),_!==null&&typeof _=="object"&&typeof _.then=="function"){var q=O1(_,l);Mr(t,s,q,un(t))}else Mr(t,s,l,un(t))}catch(Y){Mr(t,s,{then:function(){},status:"rejected",reason:Y},un())}finally{W.p=p,y!==null&&S.types!==null&&(y.types=S.types),z.T=y}}function U1(){}function pd(t,s,o,l){if(t.tag!==5)throw Error(a(476));var m=sv(t).queue;av(t,m,s,se,o===null?U1:function(){return rv(t),o(l)})}function sv(t){var s=t.memoizedState;if(s!==null)return s;s={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:se},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:o},next:null},t.memoizedState=s,t=t.alternate,t!==null&&(t.memoizedState=s),s}function rv(t){var s=sv(t);s.next===null&&(s=t.alternate.memoizedState),Mr(t,s.next.queue,{},un())}function gd(){return wt(Kr)}function ov(){return lt().memoizedState}function cv(){return lt().memoizedState}function B1(t){for(var s=t.return;s!==null;){switch(s.tag){case 24:case 3:var o=un();t=Ii(o);var l=Ui(s,t,o);l!==null&&(Qt(l,s,o),Er(l,s,o)),s={cache:Gu()},t.payload=s;return}s=s.return}}function j1(t,s,o){var l=un();o={lane:l,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Sc(t)?uv(s,o):(o=Nu(t,s,o,l),o!==null&&(Qt(o,t,l),dv(o,s,l)))}function lv(t,s,o){var l=un();Mr(t,s,o,l)}function Mr(t,s,o,l){var m={lane:l,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Sc(t))uv(s,m);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=s.lastRenderedReducer,p!==null))try{var y=s.lastRenderedState,S=p(y,o);if(m.hasEagerState=!0,m.eagerState=S,an(S,y))return tc(t,s,m,0),Ge===null&&ec(),!1}catch{}finally{}if(o=Nu(t,s,m,l),o!==null)return Qt(o,t,l),dv(o,s,l),!0}return!1}function vd(t,s,o,l){if(l={lane:2,revertLane:Qd(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Sc(t)){if(s)throw Error(a(479))}else s=Nu(t,o,l,2),s!==null&&Qt(s,t,2)}function Sc(t){var s=t.alternate;return t===ve||s!==null&&s===ve}function uv(t,s){gs=mc=!0;var o=t.pending;o===null?s.next=s:(s.next=o.next,o.next=s),t.pending=s}function dv(t,s,o){if((o&4194048)!==0){var l=s.lanes;l&=t.pendingLanes,o|=l,s.lanes=o,gp(t,o)}}var Dr={readContext:wt,use:vc,useCallback:et,useContext:et,useEffect:et,useImperativeHandle:et,useLayoutEffect:et,useInsertionEffect:et,useMemo:et,useReducer:et,useRef:et,useState:et,useDebugValue:et,useDeferredValue:et,useTransition:et,useSyncExternalStore:et,useId:et,useHostTransitionStatus:et,useFormState:et,useActionState:et,useOptimistic:et,useMemoCache:et,useCacheRefresh:et};Dr.useEffectEvent=et;var hv={readContext:wt,use:vc,useCallback:function(t,s){return Ut().memoizedState=[t,s===void 0?null:s],t},useContext:wt,useEffect:Qg,useImperativeHandle:function(t,s,o){o=o!=null?o.concat([t]):null,bc(4194308,4,$g.bind(null,s,t),o)},useLayoutEffect:function(t,s){return bc(4194308,4,t,s)},useInsertionEffect:function(t,s){bc(4,2,t,s)},useMemo:function(t,s){var o=Ut();s=s===void 0?null:s;var l=t();if(Da){wi(!0);try{t()}finally{wi(!1)}}return o.memoizedState=[l,s],l},useReducer:function(t,s,o){var l=Ut();if(o!==void 0){var m=o(s);if(Da){wi(!0);try{o(s)}finally{wi(!1)}}}else m=s;return l.memoizedState=l.baseState=m,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:m},l.queue=t,t=t.dispatch=j1.bind(null,ve,t),[l.memoizedState,t]},useRef:function(t){var s=Ut();return t={current:t},s.memoizedState=t},useState:function(t){t=ud(t);var s=t.queue,o=lv.bind(null,ve,s);return s.dispatch=o,[t.memoizedState,o]},useDebugValue:fd,useDeferredValue:function(t,s){var o=Ut();return md(o,t,s)},useTransition:function(){var t=ud(!1);return t=av.bind(null,ve,t.queue,!0,!1),Ut().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,s,o){var l=ve,m=Ut();if(xe){if(o===void 0)throw Error(a(407));o=o()}else{if(o=s(),Ge===null)throw Error(a(349));(Me&127)!==0||Pg(l,s,o)}m.memoizedState=o;var p={value:o,getSnapshot:s};return m.queue=p,Qg(Lg.bind(null,l,p,t),[t]),l.flags|=2048,ys(9,{destroy:void 0},Ng.bind(null,l,p,o,s),null),o},useId:function(){var t=Ut(),s=Ge.identifierPrefix;if(xe){var o=Fn,l=Vn;o=(l&~(1<<32-nn(l)-1)).toString(32)+o,s="_"+s+"R_"+o,o=pc++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=x1++,s="_"+s+"r_"+o.toString(32)+"_";return t.memoizedState=s},useHostTransitionStatus:gd,useFormState:Hg,useActionState:Hg,useOptimistic:function(t){var s=Ut();s.memoizedState=s.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=vd.bind(null,ve,!0,o),o.dispatch=s,[t,s]},useMemoCache:od,useCacheRefresh:function(){return Ut().memoizedState=B1.bind(null,ve)},useEffectEvent:function(t){var s=Ut(),o={impl:t};return s.memoizedState=o,function(){if((Ie&2)!==0)throw Error(a(440));return o.impl.apply(void 0,arguments)}}},yd={readContext:wt,use:vc,useCallback:tv,useContext:wt,useEffect:hd,useImperativeHandle:ev,useInsertionEffect:Wg,useLayoutEffect:Zg,useMemo:nv,useReducer:yc,useRef:Xg,useState:function(){return yc(ri)},useDebugValue:fd,useDeferredValue:function(t,s){var o=lt();return iv(o,Fe.memoizedState,t,s)},useTransition:function(){var t=yc(ri)[0],s=lt().memoizedState;return[typeof t=="boolean"?t:wr(t),s]},useSyncExternalStore:xg,useId:ov,useHostTransitionStatus:gd,useFormState:Gg,useActionState:Gg,useOptimistic:function(t,s){var o=lt();return Bg(o,Fe,t,s)},useMemoCache:od,useCacheRefresh:cv};yd.useEffectEvent=Jg;var fv={readContext:wt,use:vc,useCallback:tv,useContext:wt,useEffect:hd,useImperativeHandle:ev,useInsertionEffect:Wg,useLayoutEffect:Zg,useMemo:nv,useReducer:ld,useRef:Xg,useState:function(){return ld(ri)},useDebugValue:fd,useDeferredValue:function(t,s){var o=lt();return Fe===null?md(o,t,s):iv(o,Fe.memoizedState,t,s)},useTransition:function(){var t=ld(ri)[0],s=lt().memoizedState;return[typeof t=="boolean"?t:wr(t),s]},useSyncExternalStore:xg,useId:ov,useHostTransitionStatus:gd,useFormState:Yg,useActionState:Yg,useOptimistic:function(t,s){var o=lt();return Fe!==null?Bg(o,Fe,t,s):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:od,useCacheRefresh:cv};fv.useEffectEvent=Jg;function bd(t,s,o,l){s=t.memoizedState,o=o(l,s),o=o==null?s:v({},s,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var Td={enqueueSetState:function(t,s,o){t=t._reactInternals;var l=un(),m=Ii(l);m.payload=s,o!=null&&(m.callback=o),s=Ui(t,m,l),s!==null&&(Qt(s,t,l),Er(s,t,l))},enqueueReplaceState:function(t,s,o){t=t._reactInternals;var l=un(),m=Ii(l);m.tag=1,m.payload=s,o!=null&&(m.callback=o),s=Ui(t,m,l),s!==null&&(Qt(s,t,l),Er(s,t,l))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var o=un(),l=Ii(o);l.tag=2,s!=null&&(l.callback=s),s=Ui(t,l,o),s!==null&&(Qt(s,t,o),Er(s,t,o))}};function mv(t,s,o,l,m,p,y){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,p,y):s.prototype&&s.prototype.isPureReactComponent?!gr(o,l)||!gr(m,p):!0}function pv(t,s,o,l){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,l),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,l),s.state!==t&&Td.enqueueReplaceState(s,s.state,null)}function Oa(t,s){var o=s;if("ref"in s){o={};for(var l in s)l!=="ref"&&(o[l]=s[l])}if(t=t.defaultProps){o===s&&(o=v({},o));for(var m in t)o[m]===void 0&&(o[m]=t[m])}return o}function gv(t){$o(t)}function vv(t){console.error(t)}function yv(t){$o(t)}function Cc(t,s){try{var o=t.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(l){setTimeout(function(){throw l})}}function bv(t,s,o){try{var l=t.onCaughtError;l(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Sd(t,s,o){return o=Ii(o),o.tag=3,o.payload={element:null},o.callback=function(){Cc(t,s)},o}function Tv(t){return t=Ii(t),t.tag=3,t}function Sv(t,s,o,l){var m=o.type.getDerivedStateFromError;if(typeof m=="function"){var p=l.value;t.payload=function(){return m(p)},t.callback=function(){bv(s,o,l)}}var y=o.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(t.callback=function(){bv(s,o,l),typeof m!="function"&&(qi===null?qi=new Set([this]):qi.add(this));var S=l.stack;this.componentDidCatch(l.value,{componentStack:S!==null?S:""})})}function V1(t,s,o,l,m){if(o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(s=o.alternate,s!==null&&us(s,o,m,!0),o=rn.current,o!==null){switch(o.tag){case 31:case 13:return bn===null?Nc():o.alternate===null&&tt===0&&(tt=3),o.flags&=-257,o.flags|=65536,o.lanes=m,l===lc?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([l]):s.add(l),Kd(t,l,m)),!1;case 22:return o.flags|=65536,l===lc?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([l])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([l]):o.add(l)),Kd(t,l,m)),!1}throw Error(a(435,o.tag))}return Kd(t,l,m),Nc(),!1}if(xe)return s=rn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=m,l!==Vu&&(t=Error(a(422),{cause:l}),br(pn(t,o)))):(l!==Vu&&(s=Error(a(423),{cause:l}),br(pn(s,o))),t=t.current.alternate,t.flags|=65536,m&=-m,t.lanes|=m,l=pn(l,o),m=Sd(t.stateNode,l,m),Wu(t,m),tt!==4&&(tt=2)),!1;var p=Error(a(520),{cause:l});if(p=pn(p,o),Br===null?Br=[p]:Br.push(p),tt!==4&&(tt=2),s===null)return!0;l=pn(l,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,t=m&-m,o.lanes|=t,t=Sd(o.stateNode,l,t),Wu(o,t),!1;case 1:if(s=o.type,p=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(qi===null||!qi.has(p))))return o.flags|=65536,m&=-m,o.lanes|=m,m=Tv(m),Sv(m,t,o,l),Wu(o,m),!1}o=o.return}while(o!==null);return!1}var Cd=Error(a(461)),pt=!1;function Mt(t,s,o,l){s.child=t===null?_g(s,null,o,l):Ma(s,t.child,o,l)}function Cv(t,s,o,l,m){o=o.render;var p=s.ref;if("ref"in l){var y={};for(var S in l)S!=="ref"&&(y[S]=l[S])}else y=l;return _a(s),l=id(t,s,o,y,p,m),S=ad(),t!==null&&!pt?(sd(t,s,m),oi(t,s,m)):(xe&&S&&Bu(s),s.flags|=1,Mt(t,s,l,m),s.child)}function kv(t,s,o,l,m){if(t===null){var p=o.type;return typeof p=="function"&&!Lu(p)&&p.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=p,Ev(t,s,p,l,m)):(t=ic(o.type,null,l,s,s.mode,m),t.ref=s.ref,t.return=s,s.child=t)}if(p=t.child,!Dd(t,m)){var y=p.memoizedProps;if(o=o.compare,o=o!==null?o:gr,o(y,l)&&t.ref===s.ref)return oi(t,s,m)}return s.flags|=1,t=ti(p,l),t.ref=s.ref,t.return=s,s.child=t}function Ev(t,s,o,l,m){if(t!==null){var p=t.memoizedProps;if(gr(p,l)&&t.ref===s.ref)if(pt=!1,s.pendingProps=l=p,Dd(t,m))(t.flags&131072)!==0&&(pt=!0);else return s.lanes=t.lanes,oi(t,s,m)}return kd(t,s,o,l,m)}function _v(t,s,o,l){var m=l.children,p=t!==null?t.memoizedState:null;if(t===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((s.flags&128)!==0){if(p=p!==null?p.baseLanes|o:o,t!==null){for(l=s.child=t.child,m=0;l!==null;)m=m|l.lanes|l.childLanes,l=l.sibling;l=m&~p}else l=0,s.child=null;return Rv(t,s,p,o,l)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},t!==null&&oc(s,p!==null?p.cachePool:null),p!==null?wg(s,p):$u(),Mg(s);else return l=s.lanes=536870912,Rv(t,s,p!==null?p.baseLanes|o:o,o,l)}else p!==null?(oc(s,p.cachePool),wg(s,p),ji(),s.memoizedState=null):(t!==null&&oc(s,null),$u(),ji());return Mt(t,s,m,o),s.child}function Or(t,s){return t!==null&&t.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Rv(t,s,o,l,m){var p=Yu();return p=p===null?null:{parent:ft._currentValue,pool:p},s.memoizedState={baseLanes:o,cachePool:p},t!==null&&oc(s,null),$u(),Mg(s),t!==null&&us(t,s,l,!0),s.childLanes=m,null}function kc(t,s){return s=_c({mode:s.mode,children:s.children},t.mode),s.ref=t.ref,t.child=s,s.return=t,s}function Av(t,s,o){return Ma(s,t.child,null,o),t=kc(s,s.pendingProps),t.flags|=2,on(s),s.memoizedState=null,t}function F1(t,s,o){var l=s.pendingProps,m=(s.flags&128)!==0;if(s.flags&=-129,t===null){if(xe){if(l.mode==="hidden")return t=kc(s,l),s.lanes=536870912,Or(null,t);if(td(s),(t=Xe)?(t=jy(t,yn),t=t!==null&&t.data==="&"?t:null,t!==null&&(s.memoizedState={dehydrated:t,treeContext:Oi!==null?{id:Vn,overflow:Fn}:null,retryLane:536870912,hydrationErrors:null},o=ug(t),o.return=s,s.child=o,At=s,Xe=null)):t=null,t===null)throw Pi(s);return s.lanes=536870912,null}return kc(s,l)}var p=t.memoizedState;if(p!==null){var y=p.dehydrated;if(td(s),m)if(s.flags&256)s.flags&=-257,s=Av(t,s,o);else if(s.memoizedState!==null)s.child=t.child,s.flags|=128,s=null;else throw Error(a(558));else if(pt||us(t,s,o,!1),m=(o&t.childLanes)!==0,pt||m){if(l=Ge,l!==null&&(y=vp(l,o),y!==0&&y!==p.retryLane))throw p.retryLane=y,Sa(t,y),Qt(l,t,y),Cd;Nc(),s=Av(t,s,o)}else t=p.treeContext,Xe=Tn(y.nextSibling),At=s,xe=!0,xi=null,yn=!1,t!==null&&fg(s,t),s=kc(s,l),s.flags|=4096;return s}return t=ti(t.child,{mode:l.mode,children:l.children}),t.ref=s.ref,s.child=t,t.return=s,t}function Ec(t,s){var o=s.ref;if(o===null)t!==null&&t.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(a(284));(t===null||t.ref!==o)&&(s.flags|=4194816)}}function kd(t,s,o,l,m){return _a(s),o=id(t,s,o,l,void 0,m),l=ad(),t!==null&&!pt?(sd(t,s,m),oi(t,s,m)):(xe&&l&&Bu(s),s.flags|=1,Mt(t,s,o,m),s.child)}function wv(t,s,o,l,m,p){return _a(s),s.updateQueue=null,o=Og(s,l,o,m),Dg(t),l=ad(),t!==null&&!pt?(sd(t,s,p),oi(t,s,p)):(xe&&l&&Bu(s),s.flags|=1,Mt(t,s,o,p),s.child)}function Mv(t,s,o,l,m){if(_a(s),s.stateNode===null){var p=rs,y=o.contextType;typeof y=="object"&&y!==null&&(p=wt(y)),p=new o(l,p),s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Td,s.stateNode=p,p._reactInternals=s,p=s.stateNode,p.props=l,p.state=s.memoizedState,p.refs={},Qu(s),y=o.contextType,p.context=typeof y=="object"&&y!==null?wt(y):rs,p.state=s.memoizedState,y=o.getDerivedStateFromProps,typeof y=="function"&&(bd(s,o,y,l),p.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(y=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),y!==p.state&&Td.enqueueReplaceState(p,p.state,null),Rr(s,l,p,m),_r(),p.state=s.memoizedState),typeof p.componentDidMount=="function"&&(s.flags|=4194308),l=!0}else if(t===null){p=s.stateNode;var S=s.memoizedProps,_=Oa(o,S);p.props=_;var N=p.context,q=o.contextType;y=rs,typeof q=="object"&&q!==null&&(y=wt(q));var Y=o.getDerivedStateFromProps;q=typeof Y=="function"||typeof p.getSnapshotBeforeUpdate=="function",S=s.pendingProps!==S,q||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S||N!==y)&&pv(s,p,l,y),Li=!1;var U=s.memoizedState;p.state=U,Rr(s,l,p,m),_r(),N=s.memoizedState,S||U!==N||Li?(typeof Y=="function"&&(bd(s,o,Y,l),N=s.memoizedState),(_=Li||mv(s,o,_,l,U,N,y))?(q||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(s.flags|=4194308)):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=l,s.memoizedState=N),p.props=l,p.state=N,p.context=y,l=_):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),l=!1)}else{p=s.stateNode,Ju(t,s),y=s.memoizedProps,q=Oa(o,y),p.props=q,Y=s.pendingProps,U=p.context,N=o.contextType,_=rs,typeof N=="object"&&N!==null&&(_=wt(N)),S=o.getDerivedStateFromProps,(N=typeof S=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(y!==Y||U!==_)&&pv(s,p,l,_),Li=!1,U=s.memoizedState,p.state=U,Rr(s,l,p,m),_r();var j=s.memoizedState;y!==Y||U!==j||Li||t!==null&&t.dependencies!==null&&sc(t.dependencies)?(typeof S=="function"&&(bd(s,o,S,l),j=s.memoizedState),(q=Li||mv(s,o,q,l,U,j,_)||t!==null&&t.dependencies!==null&&sc(t.dependencies))?(N||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(l,j,_),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(l,j,_)),typeof p.componentDidUpdate=="function"&&(s.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof p.componentDidUpdate!="function"||y===t.memoizedProps&&U===t.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||y===t.memoizedProps&&U===t.memoizedState||(s.flags|=1024),s.memoizedProps=l,s.memoizedState=j),p.props=l,p.state=j,p.context=_,l=q):(typeof p.componentDidUpdate!="function"||y===t.memoizedProps&&U===t.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||y===t.memoizedProps&&U===t.memoizedState||(s.flags|=1024),l=!1)}return p=l,Ec(t,s),l=(s.flags&128)!==0,p||l?(p=s.stateNode,o=l&&typeof o.getDerivedStateFromError!="function"?null:p.render(),s.flags|=1,t!==null&&l?(s.child=Ma(s,t.child,null,m),s.child=Ma(s,null,o,m)):Mt(t,s,o,m),s.memoizedState=p.state,t=s.child):t=oi(t,s,m),t}function Dv(t,s,o,l){return ka(),s.flags|=256,Mt(t,s,o,l),s.child}var Ed={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(t){return{baseLanes:t,cachePool:bg()}}function Rd(t,s,o){return t=t!==null?t.childLanes&~o:0,s&&(t|=ln),t}function Ov(t,s,o){var l=s.pendingProps,m=!1,p=(s.flags&128)!==0,y;if((y=p)||(y=t!==null&&t.memoizedState===null?!1:(ct.current&2)!==0),y&&(m=!0,s.flags&=-129),y=(s.flags&32)!==0,s.flags&=-33,t===null){if(xe){if(m?Bi(s):ji(),(t=Xe)?(t=jy(t,yn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(s.memoizedState={dehydrated:t,treeContext:Oi!==null?{id:Vn,overflow:Fn}:null,retryLane:536870912,hydrationErrors:null},o=ug(t),o.return=s,s.child=o,At=s,Xe=null)):t=null,t===null)throw Pi(s);return ch(t)?s.lanes=32:s.lanes=536870912,null}var S=l.children;return l=l.fallback,m?(ji(),m=s.mode,S=_c({mode:"hidden",children:S},m),l=Ca(l,m,o,null),S.return=s,l.return=s,S.sibling=l,s.child=S,l=s.child,l.memoizedState=_d(o),l.childLanes=Rd(t,y,o),s.memoizedState=Ed,Or(null,l)):(Bi(s),Ad(s,S))}var _=t.memoizedState;if(_!==null&&(S=_.dehydrated,S!==null)){if(p)s.flags&256?(Bi(s),s.flags&=-257,s=wd(t,s,o)):s.memoizedState!==null?(ji(),s.child=t.child,s.flags|=128,s=null):(ji(),S=l.fallback,m=s.mode,l=_c({mode:"visible",children:l.children},m),S=Ca(S,m,o,null),S.flags|=2,l.return=s,S.return=s,l.sibling=S,s.child=l,Ma(s,t.child,null,o),l=s.child,l.memoizedState=_d(o),l.childLanes=Rd(t,y,o),s.memoizedState=Ed,s=Or(null,l));else if(Bi(s),ch(S)){if(y=S.nextSibling&&S.nextSibling.dataset,y)var N=y.dgst;y=N,l=Error(a(419)),l.stack="",l.digest=y,br({value:l,source:null,stack:null}),s=wd(t,s,o)}else if(pt||us(t,s,o,!1),y=(o&t.childLanes)!==0,pt||y){if(y=Ge,y!==null&&(l=vp(y,o),l!==0&&l!==_.retryLane))throw _.retryLane=l,Sa(t,l),Qt(y,t,l),Cd;oh(S)||Nc(),s=wd(t,s,o)}else oh(S)?(s.flags|=192,s.child=t.child,s=null):(t=_.treeContext,Xe=Tn(S.nextSibling),At=s,xe=!0,xi=null,yn=!1,t!==null&&fg(s,t),s=Ad(s,l.children),s.flags|=4096);return s}return m?(ji(),S=l.fallback,m=s.mode,_=t.child,N=_.sibling,l=ti(_,{mode:"hidden",children:l.children}),l.subtreeFlags=_.subtreeFlags&65011712,N!==null?S=ti(N,S):(S=Ca(S,m,o,null),S.flags|=2),S.return=s,l.return=s,l.sibling=S,s.child=l,Or(null,l),l=s.child,S=t.child.memoizedState,S===null?S=_d(o):(m=S.cachePool,m!==null?(_=ft._currentValue,m=m.parent!==_?{parent:_,pool:_}:m):m=bg(),S={baseLanes:S.baseLanes|o,cachePool:m}),l.memoizedState=S,l.childLanes=Rd(t,y,o),s.memoizedState=Ed,Or(t.child,l)):(Bi(s),o=t.child,t=o.sibling,o=ti(o,{mode:"visible",children:l.children}),o.return=s,o.sibling=null,t!==null&&(y=s.deletions,y===null?(s.deletions=[t],s.flags|=16):y.push(t)),s.child=o,s.memoizedState=null,o)}function Ad(t,s){return s=_c({mode:"visible",children:s},t.mode),s.return=t,t.child=s}function _c(t,s){return t=sn(22,t,null,s),t.lanes=0,t}function wd(t,s,o){return Ma(s,t.child,null,o),t=Ad(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function xv(t,s,o){t.lanes|=s;var l=t.alternate;l!==null&&(l.lanes|=s),qu(t.return,s,o)}function Md(t,s,o,l,m,p){var y=t.memoizedState;y===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:m,treeForkCount:p}:(y.isBackwards=s,y.rendering=null,y.renderingStartTime=0,y.last=l,y.tail=o,y.tailMode=m,y.treeForkCount=p)}function Pv(t,s,o){var l=s.pendingProps,m=l.revealOrder,p=l.tail;l=l.children;var y=ct.current,S=(y&2)!==0;if(S?(y=y&1|2,s.flags|=128):y&=1,ie(ct,y),Mt(t,s,l,o),l=xe?yr:0,!S&&t!==null&&(t.flags&128)!==0)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&xv(t,o,s);else if(t.tag===19)xv(t,o,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(m){case"forwards":for(o=s.child,m=null;o!==null;)t=o.alternate,t!==null&&fc(t)===null&&(m=o),o=o.sibling;o=m,o===null?(m=s.child,s.child=null):(m=o.sibling,o.sibling=null),Md(s,!1,m,o,p,l);break;case"backwards":case"unstable_legacy-backwards":for(o=null,m=s.child,s.child=null;m!==null;){if(t=m.alternate,t!==null&&fc(t)===null){s.child=m;break}t=m.sibling,m.sibling=o,o=m,m=t}Md(s,!0,o,null,p,l);break;case"together":Md(s,!1,null,null,void 0,l);break;default:s.memoizedState=null}return s.child}function oi(t,s,o){if(t!==null&&(s.dependencies=t.dependencies),zi|=s.lanes,(o&s.childLanes)===0)if(t!==null){if(us(t,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(t!==null&&s.child!==t.child)throw Error(a(153));if(s.child!==null){for(t=s.child,o=ti(t,t.pendingProps),s.child=o,o.return=s;t.sibling!==null;)t=t.sibling,o=o.sibling=ti(t,t.pendingProps),o.return=s;o.sibling=null}return s.child}function Dd(t,s){return(t.lanes&s)!==0?!0:(t=t.dependencies,!!(t!==null&&sc(t)))}function z1(t,s,o){switch(s.tag){case 3:It(s,s.stateNode.containerInfo),Ni(s,ft,t.memoizedState.cache),ka();break;case 27:case 5:ir(s);break;case 4:It(s,s.stateNode.containerInfo);break;case 10:Ni(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,td(s),null;break;case 13:var l=s.memoizedState;if(l!==null)return l.dehydrated!==null?(Bi(s),s.flags|=128,null):(o&s.child.childLanes)!==0?Ov(t,s,o):(Bi(s),t=oi(t,s,o),t!==null?t.sibling:null);Bi(s);break;case 19:var m=(t.flags&128)!==0;if(l=(o&s.childLanes)!==0,l||(us(t,s,o,!1),l=(o&s.childLanes)!==0),m){if(l)return Pv(t,s,o);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ie(ct,ct.current),l)break;return null;case 22:return s.lanes=0,_v(t,s,o,s.pendingProps);case 24:Ni(s,ft,t.memoizedState.cache)}return oi(t,s,o)}function Nv(t,s,o){if(t!==null)if(t.memoizedProps!==s.pendingProps)pt=!0;else{if(!Dd(t,o)&&(s.flags&128)===0)return pt=!1,z1(t,s,o);pt=(t.flags&131072)!==0}else pt=!1,xe&&(s.flags&1048576)!==0&&hg(s,yr,s.index);switch(s.lanes=0,s.tag){case 16:e:{var l=s.pendingProps;if(t=Aa(s.elementType),s.type=t,typeof t=="function")Lu(t)?(l=Oa(t,l),s.tag=1,s=Mv(null,s,t,l,o)):(s.tag=0,s=kd(null,s,t,l,o));else{if(t!=null){var m=t.$$typeof;if(m===A){s.tag=11,s=Cv(null,s,t,l,o);break e}else if(m===F){s.tag=14,s=kv(null,s,t,l,o);break e}}throw s=rt(t)||t,Error(a(306,s,""))}}return s;case 0:return kd(t,s,s.type,s.pendingProps,o);case 1:return l=s.type,m=Oa(l,s.pendingProps),Mv(t,s,l,m,o);case 3:e:{if(It(s,s.stateNode.containerInfo),t===null)throw Error(a(387));l=s.pendingProps;var p=s.memoizedState;m=p.element,Ju(t,s),Rr(s,l,null,o);var y=s.memoizedState;if(l=y.cache,Ni(s,ft,l),l!==p.cache&&Hu(s,[ft],o,!0),_r(),l=y.element,p.isDehydrated)if(p={element:l,isDehydrated:!1,cache:y.cache},s.updateQueue.baseState=p,s.memoizedState=p,s.flags&256){s=Dv(t,s,l,o);break e}else if(l!==m){m=pn(Error(a(424)),s),br(m),s=Dv(t,s,l,o);break e}else{switch(t=s.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Xe=Tn(t.firstChild),At=s,xe=!0,xi=null,yn=!0,o=_g(s,null,l,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(ka(),l===m){s=oi(t,s,o);break e}Mt(t,s,l,o)}s=s.child}return s;case 26:return Ec(t,s),t===null?(o=Gy(s.type,null,s.pendingProps,null))?s.memoizedState=o:xe||(o=s.type,t=s.pendingProps,l=Fc(ye.current).createElement(o),l[Rt]=s,l[qt]=t,Dt(l,o,t),Ct(l),s.stateNode=l):s.memoizedState=Gy(s.type,t.memoizedProps,s.pendingProps,t.memoizedState),null;case 27:return ir(s),t===null&&xe&&(l=s.stateNode=zy(s.type,s.pendingProps,ye.current),At=s,yn=!0,m=Xe,Yi(s.type)?(lh=m,Xe=Tn(l.firstChild)):Xe=m),Mt(t,s,s.pendingProps.children,o),Ec(t,s),t===null&&(s.flags|=4194304),s.child;case 5:return t===null&&xe&&((m=l=Xe)&&(l=y_(l,s.type,s.pendingProps,yn),l!==null?(s.stateNode=l,At=s,Xe=Tn(l.firstChild),yn=!1,m=!0):m=!1),m||Pi(s)),ir(s),m=s.type,p=s.pendingProps,y=t!==null?t.memoizedProps:null,l=p.children,ah(m,p)?l=null:y!==null&&ah(m,y)&&(s.flags|=32),s.memoizedState!==null&&(m=id(t,s,P1,null,null,o),Kr._currentValue=m),Ec(t,s),Mt(t,s,l,o),s.child;case 6:return t===null&&xe&&((t=o=Xe)&&(o=b_(o,s.pendingProps,yn),o!==null?(s.stateNode=o,At=s,Xe=null,t=!0):t=!1),t||Pi(s)),null;case 13:return Ov(t,s,o);case 4:return It(s,s.stateNode.containerInfo),l=s.pendingProps,t===null?s.child=Ma(s,null,l,o):Mt(t,s,l,o),s.child;case 11:return Cv(t,s,s.type,s.pendingProps,o);case 7:return Mt(t,s,s.pendingProps,o),s.child;case 8:return Mt(t,s,s.pendingProps.children,o),s.child;case 12:return Mt(t,s,s.pendingProps.children,o),s.child;case 10:return l=s.pendingProps,Ni(s,s.type,l.value),Mt(t,s,l.children,o),s.child;case 9:return m=s.type._context,l=s.pendingProps.children,_a(s),m=wt(m),l=l(m),s.flags|=1,Mt(t,s,l,o),s.child;case 14:return kv(t,s,s.type,s.pendingProps,o);case 15:return Ev(t,s,s.type,s.pendingProps,o);case 19:return Pv(t,s,o);case 31:return F1(t,s,o);case 22:return _v(t,s,o,s.pendingProps);case 24:return _a(s),l=wt(ft),t===null?(m=Yu(),m===null&&(m=Ge,p=Gu(),m.pooledCache=p,p.refCount++,p!==null&&(m.pooledCacheLanes|=o),m=p),s.memoizedState={parent:l,cache:m},Qu(s),Ni(s,ft,m)):((t.lanes&o)!==0&&(Ju(t,s),Rr(s,null,null,o),_r()),m=t.memoizedState,p=s.memoizedState,m.parent!==l?(m={parent:l,cache:l},s.memoizedState=m,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=m),Ni(s,ft,l)):(l=p.cache,Ni(s,ft,l),l!==m.cache&&Hu(s,[ft],o,!0))),Mt(t,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(a(156,s.tag))}function ci(t){t.flags|=4}function Od(t,s,o,l,m){if((s=(t.mode&32)!==0)&&(s=!1),s){if(t.flags|=16777216,(m&335544128)===m)if(t.stateNode.complete)t.flags|=8192;else if(oy())t.flags|=8192;else throw wa=lc,Xu}else t.flags&=-16777217}function Lv(t,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Jy(s))if(oy())t.flags|=8192;else throw wa=lc,Xu}function Rc(t,s){s!==null&&(t.flags|=4),t.flags&16384&&(s=t.tag!==22?mp():536870912,t.lanes|=s,Cs|=s)}function xr(t,s){if(!xe)switch(t.tailMode){case"hidden":s=t.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function Qe(t){var s=t.alternate!==null&&t.alternate.child===t.child,o=0,l=0;if(s)for(var m=t.child;m!==null;)o|=m.lanes|m.childLanes,l|=m.subtreeFlags&65011712,l|=m.flags&65011712,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)o|=m.lanes|m.childLanes,l|=m.subtreeFlags,l|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=l,t.childLanes=o,s}function q1(t,s,o){var l=s.pendingProps;switch(ju(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qe(s),null;case 1:return Qe(s),null;case 3:return o=s.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),ai(ft),ot(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(ls(s)?ci(s):t===null||t.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Fu())),Qe(s),null;case 26:var m=s.type,p=s.memoizedState;return t===null?(ci(s),p!==null?(Qe(s),Lv(s,p)):(Qe(s),Od(s,m,null,l,o))):p?p!==t.memoizedState?(ci(s),Qe(s),Lv(s,p)):(Qe(s),s.flags&=-16777217):(t=t.memoizedProps,t!==l&&ci(s),Qe(s),Od(s,m,t,l,o)),null;case 27:if(Uo(s),o=ye.current,m=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==l&&ci(s);else{if(!l){if(s.stateNode===null)throw Error(a(166));return Qe(s),null}t=oe.current,ls(s)?mg(s):(t=zy(m,l,o),s.stateNode=t,ci(s))}return Qe(s),null;case 5:if(Uo(s),m=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==l&&ci(s);else{if(!l){if(s.stateNode===null)throw Error(a(166));return Qe(s),null}if(p=oe.current,ls(s))mg(s);else{var y=Fc(ye.current);switch(p){case 1:p=y.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:p=y.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":p=y.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":p=y.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":p=y.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof l.is=="string"?y.createElement("select",{is:l.is}):y.createElement("select"),l.multiple?p.multiple=!0:l.size&&(p.size=l.size);break;default:p=typeof l.is=="string"?y.createElement(m,{is:l.is}):y.createElement(m)}}p[Rt]=s,p[qt]=l;e:for(y=s.child;y!==null;){if(y.tag===5||y.tag===6)p.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===s)break e;for(;y.sibling===null;){if(y.return===null||y.return===s)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}s.stateNode=p;e:switch(Dt(p,m,l),m){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&ci(s)}}return Qe(s),Od(s,s.type,t===null?null:t.memoizedProps,s.pendingProps,o),null;case 6:if(t&&s.stateNode!=null)t.memoizedProps!==l&&ci(s);else{if(typeof l!="string"&&s.stateNode===null)throw Error(a(166));if(t=ye.current,ls(s)){if(t=s.stateNode,o=s.memoizedProps,l=null,m=At,m!==null)switch(m.tag){case 27:case 5:l=m.memoizedProps}t[Rt]=s,t=!!(t.nodeValue===o||l!==null&&l.suppressHydrationWarning===!0||Oy(t.nodeValue,o)),t||Pi(s,!0)}else t=Fc(t).createTextNode(l),t[Rt]=s,s.stateNode=t}return Qe(s),null;case 31:if(o=s.memoizedState,t===null||t.memoizedState!==null){if(l=ls(s),o!==null){if(t===null){if(!l)throw Error(a(318));if(t=s.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(557));t[Rt]=s}else ka(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Qe(s),t=!1}else o=Fu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),t=!0;if(!t)return s.flags&256?(on(s),s):(on(s),null);if((s.flags&128)!==0)throw Error(a(558))}return Qe(s),null;case 13:if(l=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(m=ls(s),l!==null&&l.dehydrated!==null){if(t===null){if(!m)throw Error(a(318));if(m=s.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(a(317));m[Rt]=s}else ka(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Qe(s),m=!1}else m=Fu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=m),m=!0;if(!m)return s.flags&256?(on(s),s):(on(s),null)}return on(s),(s.flags&128)!==0?(s.lanes=o,s):(o=l!==null,t=t!==null&&t.memoizedState!==null,o&&(l=s.child,m=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(m=l.alternate.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==m&&(l.flags|=2048)),o!==t&&o&&(s.child.flags|=8192),Rc(s,s.updateQueue),Qe(s),null);case 4:return ot(),t===null&&$d(s.stateNode.containerInfo),Qe(s),null;case 10:return ai(s.type),Qe(s),null;case 19:if(K(ct),l=s.memoizedState,l===null)return Qe(s),null;if(m=(s.flags&128)!==0,p=l.rendering,p===null)if(m)xr(l,!1);else{if(tt!==0||t!==null&&(t.flags&128)!==0)for(t=s.child;t!==null;){if(p=fc(t),p!==null){for(s.flags|=128,xr(l,!1),t=p.updateQueue,s.updateQueue=t,Rc(s,t),s.subtreeFlags=0,t=o,o=s.child;o!==null;)lg(o,t),o=o.sibling;return ie(ct,ct.current&1|2),xe&&ni(s,l.treeForkCount),s.child}t=t.sibling}l.tail!==null&&en()>Oc&&(s.flags|=128,m=!0,xr(l,!1),s.lanes=4194304)}else{if(!m)if(t=fc(p),t!==null){if(s.flags|=128,m=!0,t=t.updateQueue,s.updateQueue=t,Rc(s,t),xr(l,!0),l.tail===null&&l.tailMode==="hidden"&&!p.alternate&&!xe)return Qe(s),null}else 2*en()-l.renderingStartTime>Oc&&o!==536870912&&(s.flags|=128,m=!0,xr(l,!1),s.lanes=4194304);l.isBackwards?(p.sibling=s.child,s.child=p):(t=l.last,t!==null?t.sibling=p:s.child=p,l.last=p)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=en(),t.sibling=null,o=ct.current,ie(ct,m?o&1|2:o&1),xe&&ni(s,l.treeForkCount),t):(Qe(s),null);case 22:case 23:return on(s),ed(),l=s.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(s.flags|=8192):l&&(s.flags|=8192),l?(o&536870912)!==0&&(s.flags&128)===0&&(Qe(s),s.subtreeFlags&6&&(s.flags|=8192)):Qe(s),o=s.updateQueue,o!==null&&Rc(s,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),l=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(l=s.memoizedState.cachePool.pool),l!==o&&(s.flags|=2048),t!==null&&K(Ra),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),ai(ft),Qe(s),null;case 25:return null;case 30:return null}throw Error(a(156,s.tag))}function H1(t,s){switch(ju(s),s.tag){case 1:return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return ai(ft),ot(),t=s.flags,(t&65536)!==0&&(t&128)===0?(s.flags=t&-65537|128,s):null;case 26:case 27:case 5:return Uo(s),null;case 31:if(s.memoizedState!==null){if(on(s),s.alternate===null)throw Error(a(340));ka()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 13:if(on(s),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(a(340));ka()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return K(ct),null;case 4:return ot(),null;case 10:return ai(s.type),null;case 22:case 23:return on(s),ed(),t!==null&&K(Ra),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 24:return ai(ft),null;case 25:return null;default:return null}}function Iv(t,s){switch(ju(s),s.tag){case 3:ai(ft),ot();break;case 26:case 27:case 5:Uo(s);break;case 4:ot();break;case 31:s.memoizedState!==null&&on(s);break;case 13:on(s);break;case 19:K(ct);break;case 10:ai(s.type);break;case 22:case 23:on(s),ed(),t!==null&&K(Ra);break;case 24:ai(ft)}}function Pr(t,s){try{var o=s.updateQueue,l=o!==null?o.lastEffect:null;if(l!==null){var m=l.next;o=m;do{if((o.tag&t)===t){l=void 0;var p=o.create,y=o.inst;l=p(),y.destroy=l}o=o.next}while(o!==m)}}catch(S){Ve(s,s.return,S)}}function Vi(t,s,o){try{var l=s.updateQueue,m=l!==null?l.lastEffect:null;if(m!==null){var p=m.next;l=p;do{if((l.tag&t)===t){var y=l.inst,S=y.destroy;if(S!==void 0){y.destroy=void 0,m=s;var _=o,N=S;try{N()}catch(q){Ve(m,_,q)}}}l=l.next}while(l!==p)}}catch(q){Ve(s,s.return,q)}}function Uv(t){var s=t.updateQueue;if(s!==null){var o=t.stateNode;try{Ag(s,o)}catch(l){Ve(t,t.return,l)}}}function Bv(t,s,o){o.props=Oa(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(l){Ve(t,s,l)}}function Nr(t,s){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof o=="function"?t.refCleanup=o(l):o.current=l}}catch(m){Ve(t,s,m)}}function zn(t,s){var o=t.ref,l=t.refCleanup;if(o!==null)if(typeof l=="function")try{l()}catch(m){Ve(t,s,m)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(m){Ve(t,s,m)}else o.current=null}function jv(t){var s=t.type,o=t.memoizedProps,l=t.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&l.focus();break e;case"img":o.src?l.src=o.src:o.srcSet&&(l.srcset=o.srcSet)}}catch(m){Ve(t,t.return,m)}}function xd(t,s,o){try{var l=t.stateNode;h_(l,t.type,o,s),l[qt]=s}catch(m){Ve(t,t.return,m)}}function Vv(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Yi(t.type)||t.tag===4}function Pd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Vv(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Yi(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Nd(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(t),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=$n));else if(l!==4&&(l===27&&Yi(t.type)&&(o=t.stateNode,s=null),t=t.child,t!==null))for(Nd(t,s,o),t=t.sibling;t!==null;)Nd(t,s,o),t=t.sibling}function Ac(t,s,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,s?o.insertBefore(t,s):o.appendChild(t);else if(l!==4&&(l===27&&Yi(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(Ac(t,s,o),t=t.sibling;t!==null;)Ac(t,s,o),t=t.sibling}function Fv(t){var s=t.stateNode,o=t.memoizedProps;try{for(var l=t.type,m=s.attributes;m.length;)s.removeAttributeNode(m[0]);Dt(s,l,o),s[Rt]=t,s[qt]=o}catch(p){Ve(t,t.return,p)}}var li=!1,gt=!1,Ld=!1,zv=typeof WeakSet=="function"?WeakSet:Set,kt=null;function G1(t,s){if(t=t.containerInfo,nh=Xc,t=eg(t),wu(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var m=l.anchorOffset,p=l.focusNode;l=l.focusOffset;try{o.nodeType,p.nodeType}catch{o=null;break e}var y=0,S=-1,_=-1,N=0,q=0,Y=t,U=null;t:for(;;){for(var j;Y!==o||m!==0&&Y.nodeType!==3||(S=y+m),Y!==p||l!==0&&Y.nodeType!==3||(_=y+l),Y.nodeType===3&&(y+=Y.nodeValue.length),(j=Y.firstChild)!==null;)U=Y,Y=j;for(;;){if(Y===t)break t;if(U===o&&++N===m&&(S=y),U===p&&++q===l&&(_=y),(j=Y.nextSibling)!==null)break;Y=U,U=Y.parentNode}Y=j}o=S===-1||_===-1?null:{start:S,end:_}}else o=null}o=o||{start:0,end:0}}else o=null;for(ih={focusedElem:t,selectionRange:o},Xc=!1,kt=s;kt!==null;)if(s=kt,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,kt=t;else for(;kt!==null;){switch(s=kt,p=s.alternate,t=s.flags,s.tag){case 0:if((t&4)!==0&&(t=s.updateQueue,t=t!==null?t.events:null,t!==null))for(o=0;o<t.length;o++)m=t[o],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&p!==null){t=void 0,o=s,m=p.memoizedProps,p=p.memoizedState,l=o.stateNode;try{var re=Oa(o.type,m);t=l.getSnapshotBeforeUpdate(re,p),l.__reactInternalSnapshotBeforeUpdate=t}catch(de){Ve(o,o.return,de)}}break;case 3:if((t&1024)!==0){if(t=s.stateNode.containerInfo,o=t.nodeType,o===9)rh(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":rh(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(a(163))}if(t=s.sibling,t!==null){t.return=s.return,kt=t;break}kt=s.return}}function qv(t,s,o){var l=o.flags;switch(o.tag){case 0:case 11:case 15:di(t,o),l&4&&Pr(5,o);break;case 1:if(di(t,o),l&4)if(t=o.stateNode,s===null)try{t.componentDidMount()}catch(y){Ve(o,o.return,y)}else{var m=Oa(o.type,s.memoizedProps);s=s.memoizedState;try{t.componentDidUpdate(m,s,t.__reactInternalSnapshotBeforeUpdate)}catch(y){Ve(o,o.return,y)}}l&64&&Uv(o),l&512&&Nr(o,o.return);break;case 3:if(di(t,o),l&64&&(t=o.updateQueue,t!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{Ag(t,s)}catch(y){Ve(o,o.return,y)}}break;case 27:s===null&&l&4&&Fv(o);case 26:case 5:di(t,o),s===null&&l&4&&jv(o),l&512&&Nr(o,o.return);break;case 12:di(t,o);break;case 31:di(t,o),l&4&&Kv(t,o);break;case 13:di(t,o),l&4&&Yv(t,o),l&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=e_.bind(null,o),T_(t,o))));break;case 22:if(l=o.memoizedState!==null||li,!l){s=s!==null&&s.memoizedState!==null||gt,m=li;var p=gt;li=l,(gt=s)&&!p?hi(t,o,(o.subtreeFlags&8772)!==0):di(t,o),li=m,gt=p}break;case 30:break;default:di(t,o)}}function Hv(t){var s=t.alternate;s!==null&&(t.alternate=null,Hv(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&du(s)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Je=null,Gt=!1;function ui(t,s,o){for(o=o.child;o!==null;)Gv(t,s,o),o=o.sibling}function Gv(t,s,o){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(ar,o)}catch{}switch(o.tag){case 26:gt||zn(o,s),ui(t,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:gt||zn(o,s);var l=Je,m=Gt;Yi(o.type)&&(Je=o.stateNode,Gt=!1),ui(t,s,o),qr(o.stateNode),Je=l,Gt=m;break;case 5:gt||zn(o,s);case 6:if(l=Je,m=Gt,Je=null,ui(t,s,o),Je=l,Gt=m,Je!==null)if(Gt)try{(Je.nodeType===9?Je.body:Je.nodeName==="HTML"?Je.ownerDocument.body:Je).removeChild(o.stateNode)}catch(p){Ve(o,s,p)}else try{Je.removeChild(o.stateNode)}catch(p){Ve(o,s,p)}break;case 18:Je!==null&&(Gt?(t=Je,Uy(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),Ds(t)):Uy(Je,o.stateNode));break;case 4:l=Je,m=Gt,Je=o.stateNode.containerInfo,Gt=!0,ui(t,s,o),Je=l,Gt=m;break;case 0:case 11:case 14:case 15:Vi(2,o,s),gt||Vi(4,o,s),ui(t,s,o);break;case 1:gt||(zn(o,s),l=o.stateNode,typeof l.componentWillUnmount=="function"&&Bv(o,s,l)),ui(t,s,o);break;case 21:ui(t,s,o);break;case 22:gt=(l=gt)||o.memoizedState!==null,ui(t,s,o),gt=l;break;default:ui(t,s,o)}}function Kv(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Ds(t)}catch(o){Ve(s,s.return,o)}}}function Yv(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Ds(t)}catch(o){Ve(s,s.return,o)}}function K1(t){switch(t.tag){case 31:case 13:case 19:var s=t.stateNode;return s===null&&(s=t.stateNode=new zv),s;case 22:return t=t.stateNode,s=t._retryCache,s===null&&(s=t._retryCache=new zv),s;default:throw Error(a(435,t.tag))}}function wc(t,s){var o=K1(t);s.forEach(function(l){if(!o.has(l)){o.add(l);var m=t_.bind(null,t,l);l.then(m,m)}})}function Kt(t,s){var o=s.deletions;if(o!==null)for(var l=0;l<o.length;l++){var m=o[l],p=t,y=s,S=y;e:for(;S!==null;){switch(S.tag){case 27:if(Yi(S.type)){Je=S.stateNode,Gt=!1;break e}break;case 5:Je=S.stateNode,Gt=!1;break e;case 3:case 4:Je=S.stateNode.containerInfo,Gt=!0;break e}S=S.return}if(Je===null)throw Error(a(160));Gv(p,y,m),Je=null,Gt=!1,p=m.alternate,p!==null&&(p.return=null),m.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Xv(s,t),s=s.sibling}var Dn=null;function Xv(t,s){var o=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Kt(s,t),Yt(t),l&4&&(Vi(3,t,t.return),Pr(3,t),Vi(5,t,t.return));break;case 1:Kt(s,t),Yt(t),l&512&&(gt||o===null||zn(o,o.return)),l&64&&li&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?l:o.concat(l))));break;case 26:var m=Dn;if(Kt(s,t),Yt(t),l&512&&(gt||o===null||zn(o,o.return)),l&4){var p=o!==null?o.memoizedState:null;if(l=t.memoizedState,o===null)if(l===null)if(t.stateNode===null){e:{l=t.type,o=t.memoizedProps,m=m.ownerDocument||m;t:switch(l){case"title":p=m.getElementsByTagName("title")[0],(!p||p[or]||p[Rt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=m.createElement(l),m.head.insertBefore(p,m.querySelector("head > title"))),Dt(p,l,o),p[Rt]=t,Ct(p),l=p;break e;case"link":var y=Xy("link","href",m).get(l+(o.href||""));if(y){for(var S=0;S<y.length;S++)if(p=y[S],p.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&p.getAttribute("rel")===(o.rel==null?null:o.rel)&&p.getAttribute("title")===(o.title==null?null:o.title)&&p.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){y.splice(S,1);break t}}p=m.createElement(l),Dt(p,l,o),m.head.appendChild(p);break;case"meta":if(y=Xy("meta","content",m).get(l+(o.content||""))){for(S=0;S<y.length;S++)if(p=y[S],p.getAttribute("content")===(o.content==null?null:""+o.content)&&p.getAttribute("name")===(o.name==null?null:o.name)&&p.getAttribute("property")===(o.property==null?null:o.property)&&p.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&p.getAttribute("charset")===(o.charSet==null?null:o.charSet)){y.splice(S,1);break t}}p=m.createElement(l),Dt(p,l,o),m.head.appendChild(p);break;default:throw Error(a(468,l))}p[Rt]=t,Ct(p),l=p}t.stateNode=l}else Qy(m,t.type,t.stateNode);else t.stateNode=Yy(m,l,t.memoizedProps);else p!==l?(p===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):p.count--,l===null?Qy(m,t.type,t.stateNode):Yy(m,l,t.memoizedProps)):l===null&&t.stateNode!==null&&xd(t,t.memoizedProps,o.memoizedProps)}break;case 27:Kt(s,t),Yt(t),l&512&&(gt||o===null||zn(o,o.return)),o!==null&&l&4&&xd(t,t.memoizedProps,o.memoizedProps);break;case 5:if(Kt(s,t),Yt(t),l&512&&(gt||o===null||zn(o,o.return)),t.flags&32){m=t.stateNode;try{$a(m,"")}catch(re){Ve(t,t.return,re)}}l&4&&t.stateNode!=null&&(m=t.memoizedProps,xd(t,m,o!==null?o.memoizedProps:m)),l&1024&&(Ld=!0);break;case 6:if(Kt(s,t),Yt(t),l&4){if(t.stateNode===null)throw Error(a(162));l=t.memoizedProps,o=t.stateNode;try{o.nodeValue=l}catch(re){Ve(t,t.return,re)}}break;case 3:if(Hc=null,m=Dn,Dn=zc(s.containerInfo),Kt(s,t),Dn=m,Yt(t),l&4&&o!==null&&o.memoizedState.isDehydrated)try{Ds(s.containerInfo)}catch(re){Ve(t,t.return,re)}Ld&&(Ld=!1,Qv(t));break;case 4:l=Dn,Dn=zc(t.stateNode.containerInfo),Kt(s,t),Yt(t),Dn=l;break;case 12:Kt(s,t),Yt(t);break;case 31:Kt(s,t),Yt(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,wc(t,l)));break;case 13:Kt(s,t),Yt(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Dc=en()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,wc(t,l)));break;case 22:m=t.memoizedState!==null;var _=o!==null&&o.memoizedState!==null,N=li,q=gt;if(li=N||m,gt=q||_,Kt(s,t),gt=q,li=N,Yt(t),l&8192)e:for(s=t.stateNode,s._visibility=m?s._visibility&-2:s._visibility|1,m&&(o===null||_||li||gt||xa(t)),o=null,s=t;;){if(s.tag===5||s.tag===26){if(o===null){_=o=s;try{if(p=_.stateNode,m)y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{S=_.stateNode;var Y=_.memoizedProps.style,U=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;S.style.display=U==null||typeof U=="boolean"?"":(""+U).trim()}}catch(re){Ve(_,_.return,re)}}}else if(s.tag===6){if(o===null){_=s;try{_.stateNode.nodeValue=m?"":_.memoizedProps}catch(re){Ve(_,_.return,re)}}}else if(s.tag===18){if(o===null){_=s;try{var j=_.stateNode;m?By(j,!0):By(_.stateNode,!1)}catch(re){Ve(_,_.return,re)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===t)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;s.sibling===null;){if(s.return===null||s.return===t)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}l&4&&(l=t.updateQueue,l!==null&&(o=l.retryQueue,o!==null&&(l.retryQueue=null,wc(t,o))));break;case 19:Kt(s,t),Yt(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,wc(t,l)));break;case 30:break;case 21:break;default:Kt(s,t),Yt(t)}}function Yt(t){var s=t.flags;if(s&2){try{for(var o,l=t.return;l!==null;){if(Vv(l)){o=l;break}l=l.return}if(o==null)throw Error(a(160));switch(o.tag){case 27:var m=o.stateNode,p=Pd(t);Ac(t,p,m);break;case 5:var y=o.stateNode;o.flags&32&&($a(y,""),o.flags&=-33);var S=Pd(t);Ac(t,S,y);break;case 3:case 4:var _=o.stateNode.containerInfo,N=Pd(t);Nd(t,N,_);break;default:throw Error(a(161))}}catch(q){Ve(t,t.return,q)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function Qv(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var s=t;Qv(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),t=t.sibling}}function di(t,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)qv(t,s.alternate,s),s=s.sibling}function xa(t){for(t=t.child;t!==null;){var s=t;switch(s.tag){case 0:case 11:case 14:case 15:Vi(4,s,s.return),xa(s);break;case 1:zn(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&Bv(s,s.return,o),xa(s);break;case 27:qr(s.stateNode);case 26:case 5:zn(s,s.return),xa(s);break;case 22:s.memoizedState===null&&xa(s);break;case 30:xa(s);break;default:xa(s)}t=t.sibling}}function hi(t,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var l=s.alternate,m=t,p=s,y=p.flags;switch(p.tag){case 0:case 11:case 15:hi(m,p,o),Pr(4,p);break;case 1:if(hi(m,p,o),l=p,m=l.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(N){Ve(l,l.return,N)}if(l=p,m=l.updateQueue,m!==null){var S=l.stateNode;try{var _=m.shared.hiddenCallbacks;if(_!==null)for(m.shared.hiddenCallbacks=null,m=0;m<_.length;m++)Rg(_[m],S)}catch(N){Ve(l,l.return,N)}}o&&y&64&&Uv(p),Nr(p,p.return);break;case 27:Fv(p);case 26:case 5:hi(m,p,o),o&&l===null&&y&4&&jv(p),Nr(p,p.return);break;case 12:hi(m,p,o);break;case 31:hi(m,p,o),o&&y&4&&Kv(m,p);break;case 13:hi(m,p,o),o&&y&4&&Yv(m,p);break;case 22:p.memoizedState===null&&hi(m,p,o),Nr(p,p.return);break;case 30:break;default:hi(m,p,o)}s=s.sibling}}function Id(t,s){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&Tr(o))}function Ud(t,s){t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Tr(t))}function On(t,s,o,l){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Jv(t,s,o,l),s=s.sibling}function Jv(t,s,o,l){var m=s.flags;switch(s.tag){case 0:case 11:case 15:On(t,s,o,l),m&2048&&Pr(9,s);break;case 1:On(t,s,o,l);break;case 3:On(t,s,o,l),m&2048&&(t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Tr(t)));break;case 12:if(m&2048){On(t,s,o,l),t=s.stateNode;try{var p=s.memoizedProps,y=p.id,S=p.onPostCommit;typeof S=="function"&&S(y,s.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(_){Ve(s,s.return,_)}}else On(t,s,o,l);break;case 31:On(t,s,o,l);break;case 13:On(t,s,o,l);break;case 23:break;case 22:p=s.stateNode,y=s.alternate,s.memoizedState!==null?p._visibility&2?On(t,s,o,l):Lr(t,s):p._visibility&2?On(t,s,o,l):(p._visibility|=2,bs(t,s,o,l,(s.subtreeFlags&10256)!==0||!1)),m&2048&&Id(y,s);break;case 24:On(t,s,o,l),m&2048&&Ud(s.alternate,s);break;default:On(t,s,o,l)}}function bs(t,s,o,l,m){for(m=m&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var p=t,y=s,S=o,_=l,N=y.flags;switch(y.tag){case 0:case 11:case 15:bs(p,y,S,_,m),Pr(8,y);break;case 23:break;case 22:var q=y.stateNode;y.memoizedState!==null?q._visibility&2?bs(p,y,S,_,m):Lr(p,y):(q._visibility|=2,bs(p,y,S,_,m)),m&&N&2048&&Id(y.alternate,y);break;case 24:bs(p,y,S,_,m),m&&N&2048&&Ud(y.alternate,y);break;default:bs(p,y,S,_,m)}s=s.sibling}}function Lr(t,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=t,l=s,m=l.flags;switch(l.tag){case 22:Lr(o,l),m&2048&&Id(l.alternate,l);break;case 24:Lr(o,l),m&2048&&Ud(l.alternate,l);break;default:Lr(o,l)}s=s.sibling}}var Ir=8192;function Ts(t,s,o){if(t.subtreeFlags&Ir)for(t=t.child;t!==null;)Wv(t,s,o),t=t.sibling}function Wv(t,s,o){switch(t.tag){case 26:Ts(t,s,o),t.flags&Ir&&t.memoizedState!==null&&x_(o,Dn,t.memoizedState,t.memoizedProps);break;case 5:Ts(t,s,o);break;case 3:case 4:var l=Dn;Dn=zc(t.stateNode.containerInfo),Ts(t,s,o),Dn=l;break;case 22:t.memoizedState===null&&(l=t.alternate,l!==null&&l.memoizedState!==null?(l=Ir,Ir=16777216,Ts(t,s,o),Ir=l):Ts(t,s,o));break;default:Ts(t,s,o)}}function Zv(t){var s=t.alternate;if(s!==null&&(t=s.child,t!==null)){s.child=null;do s=t.sibling,t.sibling=null,t=s;while(t!==null)}}function Ur(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];kt=l,ey(l,t)}Zv(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)$v(t),t=t.sibling}function $v(t){switch(t.tag){case 0:case 11:case 15:Ur(t),t.flags&2048&&Vi(9,t,t.return);break;case 3:Ur(t);break;case 12:Ur(t);break;case 22:var s=t.stateNode;t.memoizedState!==null&&s._visibility&2&&(t.return===null||t.return.tag!==13)?(s._visibility&=-3,Mc(t)):Ur(t);break;default:Ur(t)}}function Mc(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var l=s[o];kt=l,ey(l,t)}Zv(t)}for(t=t.child;t!==null;){switch(s=t,s.tag){case 0:case 11:case 15:Vi(8,s,s.return),Mc(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,Mc(s));break;default:Mc(s)}t=t.sibling}}function ey(t,s){for(;kt!==null;){var o=kt;switch(o.tag){case 0:case 11:case 15:Vi(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var l=o.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Tr(o.memoizedState.cache)}if(l=o.child,l!==null)l.return=o,kt=l;else e:for(o=t;kt!==null;){l=kt;var m=l.sibling,p=l.return;if(Hv(l),l===o){kt=null;break e}if(m!==null){m.return=p,kt=m;break e}kt=p}}}var Y1={getCacheForType:function(t){var s=wt(ft),o=s.data.get(t);return o===void 0&&(o=t(),s.data.set(t,o)),o},cacheSignal:function(){return wt(ft).controller.signal}},X1=typeof WeakMap=="function"?WeakMap:Map,Ie=0,Ge=null,Ee=null,Me=0,je=0,cn=null,Fi=!1,Ss=!1,Bd=!1,fi=0,tt=0,zi=0,Pa=0,jd=0,ln=0,Cs=0,Br=null,Xt=null,Vd=!1,Dc=0,ty=0,Oc=1/0,xc=null,qi=null,bt=0,Hi=null,ks=null,mi=0,Fd=0,zd=null,ny=null,jr=0,qd=null;function un(){return(Ie&2)!==0&&Me!==0?Me&-Me:z.T!==null?Qd():yp()}function iy(){if(ln===0)if((Me&536870912)===0||xe){var t=Vo;Vo<<=1,(Vo&3932160)===0&&(Vo=262144),ln=t}else ln=536870912;return t=rn.current,t!==null&&(t.flags|=32),ln}function Qt(t,s,o){(t===Ge&&(je===2||je===9)||t.cancelPendingCommit!==null)&&(Es(t,0),Gi(t,Me,ln,!1)),rr(t,o),((Ie&2)===0||t!==Ge)&&(t===Ge&&((Ie&2)===0&&(Pa|=o),tt===4&&Gi(t,Me,ln,!1)),qn(t))}function ay(t,s,o){if((Ie&6)!==0)throw Error(a(327));var l=!o&&(s&127)===0&&(s&t.expiredLanes)===0||sr(t,s),m=l?W1(t,s):Gd(t,s,!0),p=l;do{if(m===0){Ss&&!l&&Gi(t,s,0,!1);break}else{if(o=t.current.alternate,p&&!Q1(o)){m=Gd(t,s,!1),p=!1;continue}if(m===2){if(p=s,t.errorRecoveryDisabledLanes&p)var y=0;else y=t.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){s=y;e:{var S=t;m=Br;var _=S.current.memoizedState.isDehydrated;if(_&&(Es(S,y).flags|=256),y=Gd(S,y,!1),y!==2){if(Bd&&!_){S.errorRecoveryDisabledLanes|=p,Pa|=p,m=4;break e}p=Xt,Xt=m,p!==null&&(Xt===null?Xt=p:Xt.push.apply(Xt,p))}m=y}if(p=!1,m!==2)continue}}if(m===1){Es(t,0),Gi(t,s,0,!0);break}e:{switch(l=t,p=m,p){case 0:case 1:throw Error(a(345));case 4:if((s&4194048)!==s)break;case 6:Gi(l,s,ln,!Fi);break e;case 2:Xt=null;break;case 3:case 5:break;default:throw Error(a(329))}if((s&62914560)===s&&(m=Dc+300-en(),10<m)){if(Gi(l,s,ln,!Fi),zo(l,0,!0)!==0)break e;mi=s,l.timeoutHandle=Ly(sy.bind(null,l,o,Xt,xc,Vd,s,ln,Pa,Cs,Fi,p,"Throttled",-0,0),m);break e}sy(l,o,Xt,xc,Vd,s,ln,Pa,Cs,Fi,p,null,-0,0)}}break}while(!0);qn(t)}function sy(t,s,o,l,m,p,y,S,_,N,q,Y,U,j){if(t.timeoutHandle=-1,Y=s.subtreeFlags,Y&8192||(Y&16785408)===16785408){Y={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:$n},Wv(s,p,Y);var re=(p&62914560)===p?Dc-en():(p&4194048)===p?ty-en():0;if(re=P_(Y,re),re!==null){mi=p,t.cancelPendingCommit=re(fy.bind(null,t,s,p,o,l,m,y,S,_,q,Y,null,U,j)),Gi(t,p,y,!N);return}}fy(t,s,p,o,l,m,y,S,_)}function Q1(t){for(var s=t;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var l=0;l<o.length;l++){var m=o[l],p=m.getSnapshot;m=m.value;try{if(!an(p(),m))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Gi(t,s,o,l){s&=~jd,s&=~Pa,t.suspendedLanes|=s,t.pingedLanes&=~s,l&&(t.warmLanes|=s),l=t.expirationTimes;for(var m=s;0<m;){var p=31-nn(m),y=1<<p;l[p]=-1,m&=~y}o!==0&&pp(t,o,s)}function Pc(){return(Ie&6)===0?(Vr(0),!1):!0}function Hd(){if(Ee!==null){if(je===0)var t=Ee.return;else t=Ee,ii=Ea=null,rd(t),ms=null,Cr=0,t=Ee;for(;t!==null;)Iv(t.alternate,t),t=t.return;Ee=null}}function Es(t,s){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,p_(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),mi=0,Hd(),Ge=t,Ee=o=ti(t.current,null),Me=s,je=0,cn=null,Fi=!1,Ss=sr(t,s),Bd=!1,Cs=ln=jd=Pa=zi=tt=0,Xt=Br=null,Vd=!1,(s&8)!==0&&(s|=s&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=s;0<l;){var m=31-nn(l),p=1<<m;s|=t[m],l&=~p}return fi=s,ec(),o}function ry(t,s){ve=null,z.H=Dr,s===fs||s===cc?(s=Cg(),je=3):s===Xu?(s=Cg(),je=4):je=s===Cd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,cn=s,Ee===null&&(tt=1,Cc(t,pn(s,t.current)))}function oy(){var t=rn.current;return t===null?!0:(Me&4194048)===Me?bn===null:(Me&62914560)===Me||(Me&536870912)!==0?t===bn:!1}function cy(){var t=z.H;return z.H=Dr,t===null?Dr:t}function ly(){var t=z.A;return z.A=Y1,t}function Nc(){tt=4,Fi||(Me&4194048)!==Me&&rn.current!==null||(Ss=!0),(zi&134217727)===0&&(Pa&134217727)===0||Ge===null||Gi(Ge,Me,ln,!1)}function Gd(t,s,o){var l=Ie;Ie|=2;var m=cy(),p=ly();(Ge!==t||Me!==s)&&(xc=null,Es(t,s)),s=!1;var y=tt;e:do try{if(je!==0&&Ee!==null){var S=Ee,_=cn;switch(je){case 8:Hd(),y=6;break e;case 3:case 2:case 9:case 6:rn.current===null&&(s=!0);var N=je;if(je=0,cn=null,_s(t,S,_,N),o&&Ss){y=0;break e}break;default:N=je,je=0,cn=null,_s(t,S,_,N)}}J1(),y=tt;break}catch(q){ry(t,q)}while(!0);return s&&t.shellSuspendCounter++,ii=Ea=null,Ie=l,z.H=m,z.A=p,Ee===null&&(Ge=null,Me=0,ec()),y}function J1(){for(;Ee!==null;)uy(Ee)}function W1(t,s){var o=Ie;Ie|=2;var l=cy(),m=ly();Ge!==t||Me!==s?(xc=null,Oc=en()+500,Es(t,s)):Ss=sr(t,s);e:do try{if(je!==0&&Ee!==null){s=Ee;var p=cn;t:switch(je){case 1:je=0,cn=null,_s(t,s,p,1);break;case 2:case 9:if(Tg(p)){je=0,cn=null,dy(s);break}s=function(){je!==2&&je!==9||Ge!==t||(je=7),qn(t)},p.then(s,s);break e;case 3:je=7;break e;case 4:je=5;break e;case 7:Tg(p)?(je=0,cn=null,dy(s)):(je=0,cn=null,_s(t,s,p,7));break;case 5:var y=null;switch(Ee.tag){case 26:y=Ee.memoizedState;case 5:case 27:var S=Ee;if(y?Jy(y):S.stateNode.complete){je=0,cn=null;var _=S.sibling;if(_!==null)Ee=_;else{var N=S.return;N!==null?(Ee=N,Lc(N)):Ee=null}break t}}je=0,cn=null,_s(t,s,p,5);break;case 6:je=0,cn=null,_s(t,s,p,6);break;case 8:Hd(),tt=6;break e;default:throw Error(a(462))}}Z1();break}catch(q){ry(t,q)}while(!0);return ii=Ea=null,z.H=l,z.A=m,Ie=o,Ee!==null?0:(Ge=null,Me=0,ec(),tt)}function Z1(){for(;Ee!==null&&!SE();)uy(Ee)}function uy(t){var s=Nv(t.alternate,t,fi);t.memoizedProps=t.pendingProps,s===null?Lc(t):Ee=s}function dy(t){var s=t,o=s.alternate;switch(s.tag){case 15:case 0:s=wv(o,s,s.pendingProps,s.type,void 0,Me);break;case 11:s=wv(o,s,s.pendingProps,s.type.render,s.ref,Me);break;case 5:rd(s);default:Iv(o,s),s=Ee=lg(s,fi),s=Nv(o,s,fi)}t.memoizedProps=t.pendingProps,s===null?Lc(t):Ee=s}function _s(t,s,o,l){ii=Ea=null,rd(s),ms=null,Cr=0;var m=s.return;try{if(V1(t,m,s,o,Me)){tt=1,Cc(t,pn(o,t.current)),Ee=null;return}}catch(p){if(m!==null)throw Ee=m,p;tt=1,Cc(t,pn(o,t.current)),Ee=null;return}s.flags&32768?(xe||l===1?t=!0:Ss||(Me&536870912)!==0?t=!1:(Fi=t=!0,(l===2||l===9||l===3||l===6)&&(l=rn.current,l!==null&&l.tag===13&&(l.flags|=16384))),hy(s,t)):Lc(s)}function Lc(t){var s=t;do{if((s.flags&32768)!==0){hy(s,Fi);return}t=s.return;var o=q1(s.alternate,s,fi);if(o!==null){Ee=o;return}if(s=s.sibling,s!==null){Ee=s;return}Ee=s=t}while(s!==null);tt===0&&(tt=5)}function hy(t,s){do{var o=H1(t.alternate,t);if(o!==null){o.flags&=32767,Ee=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(t=t.sibling,t!==null)){Ee=t;return}Ee=t=o}while(t!==null);tt=6,Ee=null}function fy(t,s,o,l,m,p,y,S,_){t.cancelPendingCommit=null;do Ic();while(bt!==0);if((Ie&6)!==0)throw Error(a(327));if(s!==null){if(s===t.current)throw Error(a(177));if(p=s.lanes|s.childLanes,p|=Pu,OE(t,o,p,y,S,_),t===Ge&&(Ee=Ge=null,Me=0),ks=s,Hi=t,mi=o,Fd=p,zd=m,ny=l,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,n_(Bo,function(){return yy(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||l){l=z.T,z.T=null,m=W.p,W.p=2,y=Ie,Ie|=4;try{G1(t,s,o)}finally{Ie=y,W.p=m,z.T=l}}bt=1,my(),py(),gy()}}function my(){if(bt===1){bt=0;var t=Hi,s=ks,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=z.T,z.T=null;var l=W.p;W.p=2;var m=Ie;Ie|=4;try{Xv(s,t);var p=ih,y=eg(t.containerInfo),S=p.focusedElem,_=p.selectionRange;if(y!==S&&S&&S.ownerDocument&&$p(S.ownerDocument.documentElement,S)){if(_!==null&&wu(S)){var N=_.start,q=_.end;if(q===void 0&&(q=N),"selectionStart"in S)S.selectionStart=N,S.selectionEnd=Math.min(q,S.value.length);else{var Y=S.ownerDocument||document,U=Y&&Y.defaultView||window;if(U.getSelection){var j=U.getSelection(),re=S.textContent.length,de=Math.min(_.start,re),qe=_.end===void 0?de:Math.min(_.end,re);!j.extend&&de>qe&&(y=qe,qe=de,de=y);var O=Zp(S,de),M=Zp(S,qe);if(O&&M&&(j.rangeCount!==1||j.anchorNode!==O.node||j.anchorOffset!==O.offset||j.focusNode!==M.node||j.focusOffset!==M.offset)){var P=Y.createRange();P.setStart(O.node,O.offset),j.removeAllRanges(),de>qe?(j.addRange(P),j.extend(M.node,M.offset)):(P.setEnd(M.node,M.offset),j.addRange(P))}}}}for(Y=[],j=S;j=j.parentNode;)j.nodeType===1&&Y.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<Y.length;S++){var H=Y[S];H.element.scrollLeft=H.left,H.element.scrollTop=H.top}}Xc=!!nh,ih=nh=null}finally{Ie=m,W.p=l,z.T=o}}t.current=s,bt=2}}function py(){if(bt===2){bt=0;var t=Hi,s=ks,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=z.T,z.T=null;var l=W.p;W.p=2;var m=Ie;Ie|=4;try{qv(t,s.alternate,s)}finally{Ie=m,W.p=l,z.T=o}}bt=3}}function gy(){if(bt===4||bt===3){bt=0,CE();var t=Hi,s=ks,o=mi,l=ny;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?bt=5:(bt=0,ks=Hi=null,vy(t,t.pendingLanes));var m=t.pendingLanes;if(m===0&&(qi=null),lu(o),s=s.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(ar,s,void 0,(s.current.flags&128)===128)}catch{}if(l!==null){s=z.T,m=W.p,W.p=2,z.T=null;try{for(var p=t.onRecoverableError,y=0;y<l.length;y++){var S=l[y];p(S.value,{componentStack:S.stack})}}finally{z.T=s,W.p=m}}(mi&3)!==0&&Ic(),qn(t),m=t.pendingLanes,(o&261930)!==0&&(m&42)!==0?t===qd?jr++:(jr=0,qd=t):jr=0,Vr(0)}}function vy(t,s){(t.pooledCacheLanes&=s)===0&&(s=t.pooledCache,s!=null&&(t.pooledCache=null,Tr(s)))}function Ic(){return my(),py(),gy(),yy()}function yy(){if(bt!==5)return!1;var t=Hi,s=Fd;Fd=0;var o=lu(mi),l=z.T,m=W.p;try{W.p=32>o?32:o,z.T=null,o=zd,zd=null;var p=Hi,y=mi;if(bt=0,ks=Hi=null,mi=0,(Ie&6)!==0)throw Error(a(331));var S=Ie;if(Ie|=4,$v(p.current),Jv(p,p.current,y,o),Ie=S,Vr(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(ar,p)}catch{}return!0}finally{W.p=m,z.T=l,vy(t,s)}}function by(t,s,o){s=pn(o,s),s=Sd(t.stateNode,s,2),t=Ui(t,s,2),t!==null&&(rr(t,2),qn(t))}function Ve(t,s,o){if(t.tag===3)by(t,t,o);else for(;s!==null;){if(s.tag===3){by(s,t,o);break}else if(s.tag===1){var l=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(qi===null||!qi.has(l))){t=pn(o,t),o=Tv(2),l=Ui(s,o,2),l!==null&&(Sv(o,l,s,t),rr(l,2),qn(l));break}}s=s.return}}function Kd(t,s,o){var l=t.pingCache;if(l===null){l=t.pingCache=new X1;var m=new Set;l.set(s,m)}else m=l.get(s),m===void 0&&(m=new Set,l.set(s,m));m.has(o)||(Bd=!0,m.add(o),t=$1.bind(null,t,s,o),s.then(t,t))}function $1(t,s,o){var l=t.pingCache;l!==null&&l.delete(s),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,Ge===t&&(Me&o)===o&&(tt===4||tt===3&&(Me&62914560)===Me&&300>en()-Dc?(Ie&2)===0&&Es(t,0):jd|=o,Cs===Me&&(Cs=0)),qn(t)}function Ty(t,s){s===0&&(s=mp()),t=Sa(t,s),t!==null&&(rr(t,s),qn(t))}function e_(t){var s=t.memoizedState,o=0;s!==null&&(o=s.retryLane),Ty(t,o)}function t_(t,s){var o=0;switch(t.tag){case 31:case 13:var l=t.stateNode,m=t.memoizedState;m!==null&&(o=m.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(a(314))}l!==null&&l.delete(s),Ty(t,o)}function n_(t,s){return su(t,s)}var Uc=null,Rs=null,Yd=!1,Bc=!1,Xd=!1,Ki=0;function qn(t){t!==Rs&&t.next===null&&(Rs===null?Uc=Rs=t:Rs=Rs.next=t),Bc=!0,Yd||(Yd=!0,a_())}function Vr(t,s){if(!Xd&&Bc){Xd=!0;do for(var o=!1,l=Uc;l!==null;){if(t!==0){var m=l.pendingLanes;if(m===0)var p=0;else{var y=l.suspendedLanes,S=l.pingedLanes;p=(1<<31-nn(42|t)+1)-1,p&=m&~(y&~S),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(o=!0,Ey(l,p))}else p=Me,p=zo(l,l===Ge?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(p&3)===0||sr(l,p)||(o=!0,Ey(l,p));l=l.next}while(o);Xd=!1}}function i_(){Sy()}function Sy(){Bc=Yd=!1;var t=0;Ki!==0&&m_()&&(t=Ki);for(var s=en(),o=null,l=Uc;l!==null;){var m=l.next,p=Cy(l,s);p===0?(l.next=null,o===null?Uc=m:o.next=m,m===null&&(Rs=o)):(o=l,(t!==0||(p&3)!==0)&&(Bc=!0)),l=m}bt!==0&&bt!==5||Vr(t),Ki!==0&&(Ki=0)}function Cy(t,s){for(var o=t.suspendedLanes,l=t.pingedLanes,m=t.expirationTimes,p=t.pendingLanes&-62914561;0<p;){var y=31-nn(p),S=1<<y,_=m[y];_===-1?((S&o)===0||(S&l)!==0)&&(m[y]=DE(S,s)):_<=s&&(t.expiredLanes|=S),p&=~S}if(s=Ge,o=Me,o=zo(t,t===s?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,o===0||t===s&&(je===2||je===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&ru(l),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||sr(t,o)){if(s=o&-o,s===t.callbackPriority)return s;switch(l!==null&&ru(l),lu(o)){case 2:case 8:o=hp;break;case 32:o=Bo;break;case 268435456:o=fp;break;default:o=Bo}return l=ky.bind(null,t),o=su(o,l),t.callbackPriority=s,t.callbackNode=o,s}return l!==null&&l!==null&&ru(l),t.callbackPriority=2,t.callbackNode=null,2}function ky(t,s){if(bt!==0&&bt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(Ic()&&t.callbackNode!==o)return null;var l=Me;return l=zo(t,t===Ge?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(ay(t,l,s),Cy(t,en()),t.callbackNode!=null&&t.callbackNode===o?ky.bind(null,t):null)}function Ey(t,s){if(Ic())return null;ay(t,s,!0)}function a_(){g_(function(){(Ie&6)!==0?su(dp,i_):Sy()})}function Qd(){if(Ki===0){var t=ds;t===0&&(t=jo,jo<<=1,(jo&261888)===0&&(jo=256)),Ki=t}return Ki}function _y(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Ko(""+t)}function Ry(t,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,t.id&&o.setAttribute("form",t.id),s.parentNode.insertBefore(o,s),t=new FormData(t),o.parentNode.removeChild(o),t}function s_(t,s,o,l,m){if(s==="submit"&&o&&o.stateNode===m){var p=_y((m[qt]||null).action),y=l.submitter;y&&(s=(s=y[qt]||null)?_y(s.formAction):y.getAttribute("formAction"),s!==null&&(p=s,y=null));var S=new Jo("action","action",null,l,m);t.push({event:S,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Ki!==0){var _=y?Ry(m,y):new FormData(m);pd(o,{pending:!0,data:_,method:m.method,action:p},null,_)}}else typeof p=="function"&&(S.preventDefault(),_=y?Ry(m,y):new FormData(m),pd(o,{pending:!0,data:_,method:m.method,action:p},p,_))},currentTarget:m}]})}}for(var Jd=0;Jd<xu.length;Jd++){var Wd=xu[Jd],r_=Wd.toLowerCase(),o_=Wd[0].toUpperCase()+Wd.slice(1);Mn(r_,"on"+o_)}Mn(ig,"onAnimationEnd"),Mn(ag,"onAnimationIteration"),Mn(sg,"onAnimationStart"),Mn("dblclick","onDoubleClick"),Mn("focusin","onFocus"),Mn("focusout","onBlur"),Mn(k1,"onTransitionRun"),Mn(E1,"onTransitionStart"),Mn(_1,"onTransitionCancel"),Mn(rg,"onTransitionEnd"),Wa("onMouseEnter",["mouseout","mouseover"]),Wa("onMouseLeave",["mouseout","mouseover"]),Wa("onPointerEnter",["pointerout","pointerover"]),Wa("onPointerLeave",["pointerout","pointerover"]),va("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),va("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),va("onBeforeInput",["compositionend","keypress","textInput","paste"]),va("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),va("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),c_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fr));function Ay(t,s){s=(s&4)!==0;for(var o=0;o<t.length;o++){var l=t[o],m=l.event;l=l.listeners;e:{var p=void 0;if(s)for(var y=l.length-1;0<=y;y--){var S=l[y],_=S.instance,N=S.currentTarget;if(S=S.listener,_!==p&&m.isPropagationStopped())break e;p=S,m.currentTarget=N;try{p(m)}catch(q){$o(q)}m.currentTarget=null,p=_}else for(y=0;y<l.length;y++){if(S=l[y],_=S.instance,N=S.currentTarget,S=S.listener,_!==p&&m.isPropagationStopped())break e;p=S,m.currentTarget=N;try{p(m)}catch(q){$o(q)}m.currentTarget=null,p=_}}}}function _e(t,s){var o=s[uu];o===void 0&&(o=s[uu]=new Set);var l=t+"__bubble";o.has(l)||(wy(s,t,2,!1),o.add(l))}function Zd(t,s,o){var l=0;s&&(l|=4),wy(o,t,l,s)}var jc="_reactListening"+Math.random().toString(36).slice(2);function $d(t){if(!t[jc]){t[jc]=!0,Sp.forEach(function(o){o!=="selectionchange"&&(c_.has(o)||Zd(o,!1,t),Zd(o,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[jc]||(s[jc]=!0,Zd("selectionchange",!1,s))}}function wy(t,s,o,l){switch(i0(s)){case 2:var m=I_;break;case 8:m=U_;break;default:m=mh}o=m.bind(null,s,o,t),m=void 0,!bu||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),l?m!==void 0?t.addEventListener(s,o,{capture:!0,passive:m}):t.addEventListener(s,o,!0):m!==void 0?t.addEventListener(s,o,{passive:m}):t.addEventListener(s,o,!1)}function eh(t,s,o,l,m){var p=l;if((s&1)===0&&(s&2)===0&&l!==null)e:for(;;){if(l===null)return;var y=l.tag;if(y===3||y===4){var S=l.stateNode.containerInfo;if(S===m)break;if(y===4)for(y=l.return;y!==null;){var _=y.tag;if((_===3||_===4)&&y.stateNode.containerInfo===m)return;y=y.return}for(;S!==null;){if(y=Xa(S),y===null)return;if(_=y.tag,_===5||_===6||_===26||_===27){l=p=y;continue e}S=S.parentNode}}l=l.return}Pp(function(){var N=p,q=vu(o),Y=[];e:{var U=og.get(t);if(U!==void 0){var j=Jo,re=t;switch(t){case"keypress":if(Xo(o)===0)break e;case"keydown":case"keyup":j=t1;break;case"focusin":re="focus",j=ku;break;case"focusout":re="blur",j=ku;break;case"beforeblur":case"afterblur":j=ku;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=Ip;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=qE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=a1;break;case ig:case ag:case sg:j=KE;break;case rg:j=r1;break;case"scroll":case"scrollend":j=FE;break;case"wheel":j=c1;break;case"copy":case"cut":case"paste":j=XE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=Bp;break;case"toggle":case"beforetoggle":j=u1}var de=(s&4)!==0,qe=!de&&(t==="scroll"||t==="scrollend"),O=de?U!==null?U+"Capture":null:U;de=[];for(var M=N,P;M!==null;){var H=M;if(P=H.stateNode,H=H.tag,H!==5&&H!==26&&H!==27||P===null||O===null||(H=lr(M,O),H!=null&&de.push(zr(M,H,P))),qe)break;M=M.return}0<de.length&&(U=new j(U,re,null,o,q),Y.push({event:U,listeners:de}))}}if((s&7)===0){e:{if(U=t==="mouseover"||t==="pointerover",j=t==="mouseout"||t==="pointerout",U&&o!==gu&&(re=o.relatedTarget||o.fromElement)&&(Xa(re)||re[Ya]))break e;if((j||U)&&(U=q.window===q?q:(U=q.ownerDocument)?U.defaultView||U.parentWindow:window,j?(re=o.relatedTarget||o.toElement,j=N,re=re?Xa(re):null,re!==null&&(qe=c(re),de=re.tag,re!==qe||de!==5&&de!==27&&de!==6)&&(re=null)):(j=null,re=N),j!==re)){if(de=Ip,H="onMouseLeave",O="onMouseEnter",M="mouse",(t==="pointerout"||t==="pointerover")&&(de=Bp,H="onPointerLeave",O="onPointerEnter",M="pointer"),qe=j==null?U:cr(j),P=re==null?U:cr(re),U=new de(H,M+"leave",j,o,q),U.target=qe,U.relatedTarget=P,H=null,Xa(q)===N&&(de=new de(O,M+"enter",re,o,q),de.target=P,de.relatedTarget=qe,H=de),qe=H,j&&re)t:{for(de=l_,O=j,M=re,P=0,H=O;H;H=de(H))P++;H=0;for(var ue=M;ue;ue=de(ue))H++;for(;0<P-H;)O=de(O),P--;for(;0<H-P;)M=de(M),H--;for(;P--;){if(O===M||M!==null&&O===M.alternate){de=O;break t}O=de(O),M=de(M)}de=null}else de=null;j!==null&&My(Y,U,j,de,!1),re!==null&&qe!==null&&My(Y,qe,re,de,!0)}}e:{if(U=N?cr(N):window,j=U.nodeName&&U.nodeName.toLowerCase(),j==="select"||j==="input"&&U.type==="file")var Pe=Kp;else if(Hp(U))if(Yp)Pe=T1;else{Pe=y1;var ce=v1}else j=U.nodeName,!j||j.toLowerCase()!=="input"||U.type!=="checkbox"&&U.type!=="radio"?N&&pu(N.elementType)&&(Pe=Kp):Pe=b1;if(Pe&&(Pe=Pe(t,N))){Gp(Y,Pe,o,q);break e}ce&&ce(t,U,N),t==="focusout"&&N&&U.type==="number"&&N.memoizedProps.value!=null&&mu(U,"number",U.value)}switch(ce=N?cr(N):window,t){case"focusin":(Hp(ce)||ce.contentEditable==="true")&&(is=ce,Mu=N,vr=null);break;case"focusout":vr=Mu=is=null;break;case"mousedown":Du=!0;break;case"contextmenu":case"mouseup":case"dragend":Du=!1,tg(Y,o,q);break;case"selectionchange":if(C1)break;case"keydown":case"keyup":tg(Y,o,q)}var be;if(_u)e:{switch(t){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else ns?zp(t,o)&&(De="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(De="onCompositionStart");De&&(jp&&o.locale!=="ko"&&(ns||De!=="onCompositionStart"?De==="onCompositionEnd"&&ns&&(be=Np()):(Di=q,Tu="value"in Di?Di.value:Di.textContent,ns=!0)),ce=Vc(N,De),0<ce.length&&(De=new Up(De,t,null,o,q),Y.push({event:De,listeners:ce}),be?De.data=be:(be=qp(o),be!==null&&(De.data=be)))),(be=h1?f1(t,o):m1(t,o))&&(De=Vc(N,"onBeforeInput"),0<De.length&&(ce=new Up("onBeforeInput","beforeinput",null,o,q),Y.push({event:ce,listeners:De}),ce.data=be)),s_(Y,t,N,o,q)}Ay(Y,s)})}function zr(t,s,o){return{instance:t,listener:s,currentTarget:o}}function Vc(t,s){for(var o=s+"Capture",l=[];t!==null;){var m=t,p=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||p===null||(m=lr(t,o),m!=null&&l.unshift(zr(t,m,p)),m=lr(t,s),m!=null&&l.push(zr(t,m,p))),t.tag===3)return l;t=t.return}return[]}function l_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function My(t,s,o,l,m){for(var p=s._reactName,y=[];o!==null&&o!==l;){var S=o,_=S.alternate,N=S.stateNode;if(S=S.tag,_!==null&&_===l)break;S!==5&&S!==26&&S!==27||N===null||(_=N,m?(N=lr(o,p),N!=null&&y.unshift(zr(o,N,_))):m||(N=lr(o,p),N!=null&&y.push(zr(o,N,_)))),o=o.return}y.length!==0&&t.push({event:s,listeners:y})}var u_=/\r\n?/g,d_=/\u0000|\uFFFD/g;function Dy(t){return(typeof t=="string"?t:""+t).replace(u_,`
`).replace(d_,"")}function Oy(t,s){return s=Dy(s),Dy(t)===s}function ze(t,s,o,l,m,p){switch(o){case"children":typeof l=="string"?s==="body"||s==="textarea"&&l===""||$a(t,l):(typeof l=="number"||typeof l=="bigint")&&s!=="body"&&$a(t,""+l);break;case"className":Ho(t,"class",l);break;case"tabIndex":Ho(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Ho(t,o,l);break;case"style":Op(t,l,p);break;case"data":if(s!=="object"){Ho(t,"data",l);break}case"src":case"href":if(l===""&&(s!=="a"||o!=="href")){t.removeAttribute(o);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Ko(""+l),t.setAttribute(o,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(o==="formAction"?(s!=="input"&&ze(t,s,"name",m.name,m,null),ze(t,s,"formEncType",m.formEncType,m,null),ze(t,s,"formMethod",m.formMethod,m,null),ze(t,s,"formTarget",m.formTarget,m,null)):(ze(t,s,"encType",m.encType,m,null),ze(t,s,"method",m.method,m,null),ze(t,s,"target",m.target,m,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Ko(""+l),t.setAttribute(o,l);break;case"onClick":l!=null&&(t.onclick=$n);break;case"onScroll":l!=null&&_e("scroll",t);break;case"onScrollEnd":l!=null&&_e("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(a(61));if(o=l.__html,o!=null){if(m.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}o=Ko(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""+l):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":l===!0?t.setAttribute(o,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,l):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(o,l):t.removeAttribute(o);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(o):t.setAttribute(o,l);break;case"popover":_e("beforetoggle",t),_e("toggle",t),qo(t,"popover",l);break;case"xlinkActuate":Zn(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":Zn(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":Zn(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":Zn(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":Zn(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":Zn(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":Zn(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":Zn(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":Zn(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":qo(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=jE.get(o)||o,qo(t,o,l))}}function th(t,s,o,l,m,p){switch(o){case"style":Op(t,l,p);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(a(61));if(o=l.__html,o!=null){if(m.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"children":typeof l=="string"?$a(t,l):(typeof l=="number"||typeof l=="bigint")&&$a(t,""+l);break;case"onScroll":l!=null&&_e("scroll",t);break;case"onScrollEnd":l!=null&&_e("scrollend",t);break;case"onClick":l!=null&&(t.onclick=$n);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Cp.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(m=o.endsWith("Capture"),s=o.slice(2,m?o.length-7:void 0),p=t[qt]||null,p=p!=null?p[o]:null,typeof p=="function"&&t.removeEventListener(s,p,m),typeof l=="function")){typeof p!="function"&&p!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(s,l,m);break e}o in t?t[o]=l:l===!0?t.setAttribute(o,""):qo(t,o,l)}}}function Dt(t,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_e("error",t),_e("load",t);var l=!1,m=!1,p;for(p in o)if(o.hasOwnProperty(p)){var y=o[p];if(y!=null)switch(p){case"src":l=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:ze(t,s,p,y,o,null)}}m&&ze(t,s,"srcSet",o.srcSet,o,null),l&&ze(t,s,"src",o.src,o,null);return;case"input":_e("invalid",t);var S=p=y=m=null,_=null,N=null;for(l in o)if(o.hasOwnProperty(l)){var q=o[l];if(q!=null)switch(l){case"name":m=q;break;case"type":y=q;break;case"checked":_=q;break;case"defaultChecked":N=q;break;case"value":p=q;break;case"defaultValue":S=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(a(137,s));break;default:ze(t,s,l,q,o,null)}}Ap(t,p,S,_,N,y,m,!1);return;case"select":_e("invalid",t),l=y=p=null;for(m in o)if(o.hasOwnProperty(m)&&(S=o[m],S!=null))switch(m){case"value":p=S;break;case"defaultValue":y=S;break;case"multiple":l=S;default:ze(t,s,m,S,o,null)}s=p,o=y,t.multiple=!!l,s!=null?Za(t,!!l,s,!1):o!=null&&Za(t,!!l,o,!0);return;case"textarea":_e("invalid",t),p=m=l=null;for(y in o)if(o.hasOwnProperty(y)&&(S=o[y],S!=null))switch(y){case"value":l=S;break;case"defaultValue":m=S;break;case"children":p=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(a(91));break;default:ze(t,s,y,S,o,null)}Mp(t,l,m,p);return;case"option":for(_ in o)if(o.hasOwnProperty(_)&&(l=o[_],l!=null))switch(_){case"selected":t.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:ze(t,s,_,l,o,null)}return;case"dialog":_e("beforetoggle",t),_e("toggle",t),_e("cancel",t),_e("close",t);break;case"iframe":case"object":_e("load",t);break;case"video":case"audio":for(l=0;l<Fr.length;l++)_e(Fr[l],t);break;case"image":_e("error",t),_e("load",t);break;case"details":_e("toggle",t);break;case"embed":case"source":case"link":_e("error",t),_e("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(N in o)if(o.hasOwnProperty(N)&&(l=o[N],l!=null))switch(N){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:ze(t,s,N,l,o,null)}return;default:if(pu(s)){for(q in o)o.hasOwnProperty(q)&&(l=o[q],l!==void 0&&th(t,s,q,l,o,void 0));return}}for(S in o)o.hasOwnProperty(S)&&(l=o[S],l!=null&&ze(t,s,S,l,o,null))}function h_(t,s,o,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,p=null,y=null,S=null,_=null,N=null,q=null;for(j in o){var Y=o[j];if(o.hasOwnProperty(j)&&Y!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":_=Y;default:l.hasOwnProperty(j)||ze(t,s,j,null,l,Y)}}for(var U in l){var j=l[U];if(Y=o[U],l.hasOwnProperty(U)&&(j!=null||Y!=null))switch(U){case"type":p=j;break;case"name":m=j;break;case"checked":N=j;break;case"defaultChecked":q=j;break;case"value":y=j;break;case"defaultValue":S=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(a(137,s));break;default:j!==Y&&ze(t,s,U,j,l,Y)}}fu(t,y,S,_,N,q,p,m);return;case"select":j=y=S=U=null;for(p in o)if(_=o[p],o.hasOwnProperty(p)&&_!=null)switch(p){case"value":break;case"multiple":j=_;default:l.hasOwnProperty(p)||ze(t,s,p,null,l,_)}for(m in l)if(p=l[m],_=o[m],l.hasOwnProperty(m)&&(p!=null||_!=null))switch(m){case"value":U=p;break;case"defaultValue":S=p;break;case"multiple":y=p;default:p!==_&&ze(t,s,m,p,l,_)}s=S,o=y,l=j,U!=null?Za(t,!!o,U,!1):!!l!=!!o&&(s!=null?Za(t,!!o,s,!0):Za(t,!!o,o?[]:"",!1));return;case"textarea":j=U=null;for(S in o)if(m=o[S],o.hasOwnProperty(S)&&m!=null&&!l.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:ze(t,s,S,null,l,m)}for(y in l)if(m=l[y],p=o[y],l.hasOwnProperty(y)&&(m!=null||p!=null))switch(y){case"value":U=m;break;case"defaultValue":j=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(a(91));break;default:m!==p&&ze(t,s,y,m,l,p)}wp(t,U,j);return;case"option":for(var re in o)if(U=o[re],o.hasOwnProperty(re)&&U!=null&&!l.hasOwnProperty(re))switch(re){case"selected":t.selected=!1;break;default:ze(t,s,re,null,l,U)}for(_ in l)if(U=l[_],j=o[_],l.hasOwnProperty(_)&&U!==j&&(U!=null||j!=null))switch(_){case"selected":t.selected=U&&typeof U!="function"&&typeof U!="symbol";break;default:ze(t,s,_,U,l,j)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var de in o)U=o[de],o.hasOwnProperty(de)&&U!=null&&!l.hasOwnProperty(de)&&ze(t,s,de,null,l,U);for(N in l)if(U=l[N],j=o[N],l.hasOwnProperty(N)&&U!==j&&(U!=null||j!=null))switch(N){case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(a(137,s));break;default:ze(t,s,N,U,l,j)}return;default:if(pu(s)){for(var qe in o)U=o[qe],o.hasOwnProperty(qe)&&U!==void 0&&!l.hasOwnProperty(qe)&&th(t,s,qe,void 0,l,U);for(q in l)U=l[q],j=o[q],!l.hasOwnProperty(q)||U===j||U===void 0&&j===void 0||th(t,s,q,U,l,j);return}}for(var O in o)U=o[O],o.hasOwnProperty(O)&&U!=null&&!l.hasOwnProperty(O)&&ze(t,s,O,null,l,U);for(Y in l)U=l[Y],j=o[Y],!l.hasOwnProperty(Y)||U===j||U==null&&j==null||ze(t,s,Y,U,l,j)}function xy(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function f_(){if(typeof performance.getEntriesByType=="function"){for(var t=0,s=0,o=performance.getEntriesByType("resource"),l=0;l<o.length;l++){var m=o[l],p=m.transferSize,y=m.initiatorType,S=m.duration;if(p&&S&&xy(y)){for(y=0,S=m.responseEnd,l+=1;l<o.length;l++){var _=o[l],N=_.startTime;if(N>S)break;var q=_.transferSize,Y=_.initiatorType;q&&xy(Y)&&(_=_.responseEnd,y+=q*(_<S?1:(S-N)/(_-N)))}if(--l,s+=8*(p+y)/(m.duration/1e3),t++,10<t)break}}if(0<t)return s/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var nh=null,ih=null;function Fc(t){return t.nodeType===9?t:t.ownerDocument}function Py(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ny(t,s){if(t===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&s==="foreignObject"?0:t}function ah(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var sh=null;function m_(){var t=window.event;return t&&t.type==="popstate"?t===sh?!1:(sh=t,!0):(sh=null,!1)}var Ly=typeof setTimeout=="function"?setTimeout:void 0,p_=typeof clearTimeout=="function"?clearTimeout:void 0,Iy=typeof Promise=="function"?Promise:void 0,g_=typeof queueMicrotask=="function"?queueMicrotask:typeof Iy<"u"?function(t){return Iy.resolve(null).then(t).catch(v_)}:Ly;function v_(t){setTimeout(function(){throw t})}function Yi(t){return t==="head"}function Uy(t,s){var o=s,l=0;do{var m=o.nextSibling;if(t.removeChild(o),m&&m.nodeType===8)if(o=m.data,o==="/$"||o==="/&"){if(l===0){t.removeChild(m),Ds(s);return}l--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")l++;else if(o==="html")qr(t.ownerDocument.documentElement);else if(o==="head"){o=t.ownerDocument.head,qr(o);for(var p=o.firstChild;p;){var y=p.nextSibling,S=p.nodeName;p[or]||S==="SCRIPT"||S==="STYLE"||S==="LINK"&&p.rel.toLowerCase()==="stylesheet"||o.removeChild(p),p=y}}else o==="body"&&qr(t.ownerDocument.body);o=m}while(o);Ds(s)}function By(t,s){var o=t;t=0;do{var l=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),l&&l.nodeType===8)if(o=l.data,o==="/$"){if(t===0)break;t--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||t++;o=l}while(o)}function rh(t){var s=t.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":rh(o),du(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function y_(t,s,o,l){for(;t.nodeType===1;){var m=o;if(t.nodeName.toLowerCase()!==s.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[or])switch(s){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(p=t.getAttribute("rel"),p==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(p!==m.rel||t.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||t.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||t.getAttribute("title")!==(m.title==null?null:m.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(p=t.getAttribute("src"),(p!==(m.src==null?null:m.src)||t.getAttribute("type")!==(m.type==null?null:m.type)||t.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&p&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(s==="input"&&t.type==="hidden"){var p=m.name==null?null:""+m.name;if(m.type==="hidden"&&t.getAttribute("name")===p)return t}else return t;if(t=Tn(t.nextSibling),t===null)break}return null}function b_(t,s,o){if(s==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=Tn(t.nextSibling),t===null))return null;return t}function jy(t,s){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Tn(t.nextSibling),t===null))return null;return t}function oh(t){return t.data==="$?"||t.data==="$~"}function ch(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function T_(t,s){var o=t.ownerDocument;if(t.data==="$~")t._reactRetry=s;else if(t.data!=="$?"||o.readyState!=="loading")s();else{var l=function(){s(),o.removeEventListener("DOMContentLoaded",l)};o.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function Tn(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return t}var lh=null;function Vy(t){t=t.nextSibling;for(var s=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"||o==="/&"){if(s===0)return Tn(t.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}t=t.nextSibling}return null}function Fy(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return t;s--}else o!=="/$"&&o!=="/&"||s++}t=t.previousSibling}return null}function zy(t,s,o){switch(s=Fc(o),t){case"html":if(t=s.documentElement,!t)throw Error(a(452));return t;case"head":if(t=s.head,!t)throw Error(a(453));return t;case"body":if(t=s.body,!t)throw Error(a(454));return t;default:throw Error(a(451))}}function qr(t){for(var s=t.attributes;s.length;)t.removeAttributeNode(s[0]);du(t)}var Sn=new Map,qy=new Set;function zc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var pi=W.d;W.d={f:S_,r:C_,D:k_,C:E_,L:__,m:R_,X:w_,S:A_,M:M_};function S_(){var t=pi.f(),s=Pc();return t||s}function C_(t){var s=Qa(t);s!==null&&s.tag===5&&s.type==="form"?rv(s):pi.r(t)}var As=typeof document>"u"?null:document;function Hy(t,s,o){var l=As;if(l&&typeof s=="string"&&s){var m=fn(s);m='link[rel="'+t+'"][href="'+m+'"]',typeof o=="string"&&(m+='[crossorigin="'+o+'"]'),qy.has(m)||(qy.add(m),t={rel:t,crossOrigin:o,href:s},l.querySelector(m)===null&&(s=l.createElement("link"),Dt(s,"link",t),Ct(s),l.head.appendChild(s)))}}function k_(t){pi.D(t),Hy("dns-prefetch",t,null)}function E_(t,s){pi.C(t,s),Hy("preconnect",t,s)}function __(t,s,o){pi.L(t,s,o);var l=As;if(l&&t&&s){var m='link[rel="preload"][as="'+fn(s)+'"]';s==="image"&&o&&o.imageSrcSet?(m+='[imagesrcset="'+fn(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(m+='[imagesizes="'+fn(o.imageSizes)+'"]')):m+='[href="'+fn(t)+'"]';var p=m;switch(s){case"style":p=ws(t);break;case"script":p=Ms(t)}Sn.has(p)||(t=v({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:t,as:s},o),Sn.set(p,t),l.querySelector(m)!==null||s==="style"&&l.querySelector(Hr(p))||s==="script"&&l.querySelector(Gr(p))||(s=l.createElement("link"),Dt(s,"link",t),Ct(s),l.head.appendChild(s)))}}function R_(t,s){pi.m(t,s);var o=As;if(o&&t){var l=s&&typeof s.as=="string"?s.as:"script",m='link[rel="modulepreload"][as="'+fn(l)+'"][href="'+fn(t)+'"]',p=m;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Ms(t)}if(!Sn.has(p)&&(t=v({rel:"modulepreload",href:t},s),Sn.set(p,t),o.querySelector(m)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(Gr(p)))return}l=o.createElement("link"),Dt(l,"link",t),Ct(l),o.head.appendChild(l)}}}function A_(t,s,o){pi.S(t,s,o);var l=As;if(l&&t){var m=Ja(l).hoistableStyles,p=ws(t);s=s||"default";var y=m.get(p);if(!y){var S={loading:0,preload:null};if(y=l.querySelector(Hr(p)))S.loading=5;else{t=v({rel:"stylesheet",href:t,"data-precedence":s},o),(o=Sn.get(p))&&uh(t,o);var _=y=l.createElement("link");Ct(_),Dt(_,"link",t),_._p=new Promise(function(N,q){_.onload=N,_.onerror=q}),_.addEventListener("load",function(){S.loading|=1}),_.addEventListener("error",function(){S.loading|=2}),S.loading|=4,qc(y,s,l)}y={type:"stylesheet",instance:y,count:1,state:S},m.set(p,y)}}}function w_(t,s){pi.X(t,s);var o=As;if(o&&t){var l=Ja(o).hoistableScripts,m=Ms(t),p=l.get(m);p||(p=o.querySelector(Gr(m)),p||(t=v({src:t,async:!0},s),(s=Sn.get(m))&&dh(t,s),p=o.createElement("script"),Ct(p),Dt(p,"link",t),o.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(m,p))}}function M_(t,s){pi.M(t,s);var o=As;if(o&&t){var l=Ja(o).hoistableScripts,m=Ms(t),p=l.get(m);p||(p=o.querySelector(Gr(m)),p||(t=v({src:t,async:!0,type:"module"},s),(s=Sn.get(m))&&dh(t,s),p=o.createElement("script"),Ct(p),Dt(p,"link",t),o.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(m,p))}}function Gy(t,s,o,l){var m=(m=ye.current)?zc(m):null;if(!m)throw Error(a(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=ws(o.href),o=Ja(m).hoistableStyles,l=o.get(s),l||(l={type:"style",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=ws(o.href);var p=Ja(m).hoistableStyles,y=p.get(t);if(y||(m=m.ownerDocument||m,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(t,y),(p=m.querySelector(Hr(t)))&&!p._p&&(y.instance=p,y.state.loading=5),Sn.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Sn.set(t,o),p||D_(m,t,o,y.state))),s&&l===null)throw Error(a(528,""));return y}if(s&&l!==null)throw Error(a(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Ms(o),o=Ja(m).hoistableScripts,l=o.get(s),l||(l={type:"script",instance:null,count:0,state:null},o.set(s,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,t))}}function ws(t){return'href="'+fn(t)+'"'}function Hr(t){return'link[rel="stylesheet"]['+t+"]"}function Ky(t){return v({},t,{"data-precedence":t.precedence,precedence:null})}function D_(t,s,o,l){t.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=t.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),Dt(s,"link",o),Ct(s),t.head.appendChild(s))}function Ms(t){return'[src="'+fn(t)+'"]'}function Gr(t){return"script[async]"+t}function Yy(t,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var l=t.querySelector('style[data-href~="'+fn(o.href)+'"]');if(l)return s.instance=l,Ct(l),l;var m=v({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),Ct(l),Dt(l,"style",m),qc(l,o.precedence,t),s.instance=l;case"stylesheet":m=ws(o.href);var p=t.querySelector(Hr(m));if(p)return s.state.loading|=4,s.instance=p,Ct(p),p;l=Ky(o),(m=Sn.get(m))&&uh(l,m),p=(t.ownerDocument||t).createElement("link"),Ct(p);var y=p;return y._p=new Promise(function(S,_){y.onload=S,y.onerror=_}),Dt(p,"link",l),s.state.loading|=4,qc(p,o.precedence,t),s.instance=p;case"script":return p=Ms(o.src),(m=t.querySelector(Gr(p)))?(s.instance=m,Ct(m),m):(l=o,(m=Sn.get(p))&&(l=v({},o),dh(l,m)),t=t.ownerDocument||t,m=t.createElement("script"),Ct(m),Dt(m,"link",l),t.head.appendChild(m),s.instance=m);case"void":return null;default:throw Error(a(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(l=s.instance,s.state.loading|=4,qc(l,o.precedence,t));return s.instance}function qc(t,s,o){for(var l=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=l.length?l[l.length-1]:null,p=m,y=0;y<l.length;y++){var S=l[y];if(S.dataset.precedence===s)p=S;else if(p!==m)break}p?p.parentNode.insertBefore(t,p.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(t,s.firstChild))}function uh(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.title==null&&(t.title=s.title)}function dh(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.integrity==null&&(t.integrity=s.integrity)}var Hc=null;function Xy(t,s,o){if(Hc===null){var l=new Map,m=Hc=new Map;m.set(o,l)}else m=Hc,l=m.get(o),l||(l=new Map,m.set(o,l));if(l.has(t))return l;for(l.set(t,null),o=o.getElementsByTagName(t),m=0;m<o.length;m++){var p=o[m];if(!(p[or]||p[Rt]||t==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var y=p.getAttribute(s)||"";y=t+y;var S=l.get(y);S?S.push(p):l.set(y,[p])}}return l}function Qy(t,s,o){t=t.ownerDocument||t,t.head.insertBefore(o,s==="title"?t.querySelector("head > title"):null)}function O_(t,s,o){if(o===1||s.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return t=s.disabled,typeof s.precedence=="string"&&t==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Jy(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function x_(t,s,o,l){if(o.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var m=ws(l.href),p=s.querySelector(Hr(m));if(p){s=p._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(t.count++,t=Gc.bind(t),s.then(t,t)),o.state.loading|=4,o.instance=p,Ct(p);return}p=s.ownerDocument||s,l=Ky(l),(m=Sn.get(m))&&uh(l,m),p=p.createElement("link"),Ct(p);var y=p;y._p=new Promise(function(S,_){y.onload=S,y.onerror=_}),Dt(p,"link",l),o.instance=p}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(t.count++,o=Gc.bind(t),s.addEventListener("load",o),s.addEventListener("error",o))}}var hh=0;function P_(t,s){return t.stylesheets&&t.count===0&&Yc(t,t.stylesheets),0<t.count||0<t.imgCount?function(o){var l=setTimeout(function(){if(t.stylesheets&&Yc(t,t.stylesheets),t.unsuspend){var p=t.unsuspend;t.unsuspend=null,p()}},6e4+s);0<t.imgBytes&&hh===0&&(hh=62500*f_());var m=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Yc(t,t.stylesheets),t.unsuspend)){var p=t.unsuspend;t.unsuspend=null,p()}},(t.imgBytes>hh?50:800)+s);return t.unsuspend=o,function(){t.unsuspend=null,clearTimeout(l),clearTimeout(m)}}:null}function Gc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yc(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Kc=null;function Yc(t,s){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Kc=new Map,s.forEach(N_,t),Kc=null,Gc.call(t))}function N_(t,s){if(!(s.state.loading&4)){var o=Kc.get(t);if(o)var l=o.get(null);else{o=new Map,Kc.set(t,o);for(var m=t.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<m.length;p++){var y=m[p];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(o.set(y.dataset.precedence,y),l=y)}l&&o.set(null,l)}m=s.instance,y=m.getAttribute("data-precedence"),p=o.get(y)||l,p===l&&o.set(null,m),o.set(y,m),this.count++,l=Gc.bind(this),m.addEventListener("load",l),m.addEventListener("error",l),p?p.parentNode.insertBefore(m,p.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(m,t.firstChild)),s.state.loading|=4}}var Kr={$$typeof:I,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function L_(t,s,o,l,m,p,y,S,_){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ou(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ou(0),this.hiddenUpdates=ou(null),this.identifierPrefix=l,this.onUncaughtError=m,this.onCaughtError=p,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=_,this.incompleteTransitions=new Map}function Wy(t,s,o,l,m,p,y,S,_,N,q,Y){return t=new L_(t,s,o,y,_,N,q,Y,S),s=1,p===!0&&(s|=24),p=sn(3,null,null,s),t.current=p,p.stateNode=t,s=Gu(),s.refCount++,t.pooledCache=s,s.refCount++,p.memoizedState={element:l,isDehydrated:o,cache:s},Qu(p),t}function Zy(t){return t?(t=rs,t):rs}function $y(t,s,o,l,m,p){m=Zy(m),l.context===null?l.context=m:l.pendingContext=m,l=Ii(s),l.payload={element:o},p=p===void 0?null:p,p!==null&&(l.callback=p),o=Ui(t,l,s),o!==null&&(Qt(o,t,s),Er(o,t,s))}function e0(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<s?o:s}}function fh(t,s){e0(t,s),(t=t.alternate)&&e0(t,s)}function t0(t){if(t.tag===13||t.tag===31){var s=Sa(t,67108864);s!==null&&Qt(s,t,67108864),fh(t,67108864)}}function n0(t){if(t.tag===13||t.tag===31){var s=un();s=cu(s);var o=Sa(t,s);o!==null&&Qt(o,t,s),fh(t,s)}}var Xc=!0;function I_(t,s,o,l){var m=z.T;z.T=null;var p=W.p;try{W.p=2,mh(t,s,o,l)}finally{W.p=p,z.T=m}}function U_(t,s,o,l){var m=z.T;z.T=null;var p=W.p;try{W.p=8,mh(t,s,o,l)}finally{W.p=p,z.T=m}}function mh(t,s,o,l){if(Xc){var m=ph(l);if(m===null)eh(t,s,l,Qc,o),a0(t,l);else if(j_(m,t,s,o,l))l.stopPropagation();else if(a0(t,l),s&4&&-1<B_.indexOf(t)){for(;m!==null;){var p=Qa(m);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var y=ga(p.pendingLanes);if(y!==0){var S=p;for(S.pendingLanes|=2,S.entangledLanes|=2;y;){var _=1<<31-nn(y);S.entanglements[1]|=_,y&=~_}qn(p),(Ie&6)===0&&(Oc=en()+500,Vr(0))}}break;case 31:case 13:S=Sa(p,2),S!==null&&Qt(S,p,2),Pc(),fh(p,2)}if(p=ph(l),p===null&&eh(t,s,l,Qc,o),p===m)break;m=p}m!==null&&l.stopPropagation()}else eh(t,s,l,null,o)}}function ph(t){return t=vu(t),gh(t)}var Qc=null;function gh(t){if(Qc=null,t=Xa(t),t!==null){var s=c(t);if(s===null)t=null;else{var o=s.tag;if(o===13){if(t=u(s),t!==null)return t;t=null}else if(o===31){if(t=d(s),t!==null)return t;t=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null)}}return Qc=t,null}function i0(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kE()){case dp:return 2;case hp:return 8;case Bo:case EE:return 32;case fp:return 268435456;default:return 32}default:return 32}}var vh=!1,Xi=null,Qi=null,Ji=null,Yr=new Map,Xr=new Map,Wi=[],B_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function a0(t,s){switch(t){case"focusin":case"focusout":Xi=null;break;case"dragenter":case"dragleave":Qi=null;break;case"mouseover":case"mouseout":Ji=null;break;case"pointerover":case"pointerout":Yr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xr.delete(s.pointerId)}}function Qr(t,s,o,l,m,p){return t===null||t.nativeEvent!==p?(t={blockedOn:s,domEventName:o,eventSystemFlags:l,nativeEvent:p,targetContainers:[m]},s!==null&&(s=Qa(s),s!==null&&t0(s)),t):(t.eventSystemFlags|=l,s=t.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),t)}function j_(t,s,o,l,m){switch(s){case"focusin":return Xi=Qr(Xi,t,s,o,l,m),!0;case"dragenter":return Qi=Qr(Qi,t,s,o,l,m),!0;case"mouseover":return Ji=Qr(Ji,t,s,o,l,m),!0;case"pointerover":var p=m.pointerId;return Yr.set(p,Qr(Yr.get(p)||null,t,s,o,l,m)),!0;case"gotpointercapture":return p=m.pointerId,Xr.set(p,Qr(Xr.get(p)||null,t,s,o,l,m)),!0}return!1}function s0(t){var s=Xa(t.target);if(s!==null){var o=c(s);if(o!==null){if(s=o.tag,s===13){if(s=u(o),s!==null){t.blockedOn=s,bp(t.priority,function(){n0(o)});return}}else if(s===31){if(s=d(o),s!==null){t.blockedOn=s,bp(t.priority,function(){n0(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Jc(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var o=ph(t.nativeEvent);if(o===null){o=t.nativeEvent;var l=new o.constructor(o.type,o);gu=l,o.target.dispatchEvent(l),gu=null}else return s=Qa(o),s!==null&&t0(s),t.blockedOn=o,!1;s.shift()}return!0}function r0(t,s,o){Jc(t)&&o.delete(s)}function V_(){vh=!1,Xi!==null&&Jc(Xi)&&(Xi=null),Qi!==null&&Jc(Qi)&&(Qi=null),Ji!==null&&Jc(Ji)&&(Ji=null),Yr.forEach(r0),Xr.forEach(r0)}function Wc(t,s){t.blockedOn===s&&(t.blockedOn=null,vh||(vh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,V_)))}var Zc=null;function o0(t){Zc!==t&&(Zc=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Zc===t&&(Zc=null);for(var s=0;s<t.length;s+=3){var o=t[s],l=t[s+1],m=t[s+2];if(typeof l!="function"){if(gh(l||o)===null)continue;break}var p=Qa(o);p!==null&&(t.splice(s,3),s-=3,pd(p,{pending:!0,data:m,method:o.method,action:l},l,m))}}))}function Ds(t){function s(_){return Wc(_,t)}Xi!==null&&Wc(Xi,t),Qi!==null&&Wc(Qi,t),Ji!==null&&Wc(Ji,t),Yr.forEach(s),Xr.forEach(s);for(var o=0;o<Wi.length;o++){var l=Wi[o];l.blockedOn===t&&(l.blockedOn=null)}for(;0<Wi.length&&(o=Wi[0],o.blockedOn===null);)s0(o),o.blockedOn===null&&Wi.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(l=0;l<o.length;l+=3){var m=o[l],p=o[l+1],y=m[qt]||null;if(typeof p=="function")y||o0(o);else if(y){var S=null;if(p&&p.hasAttribute("formAction")){if(m=p,y=p[qt]||null)S=y.formAction;else if(gh(m)!==null)continue}else S=y.action;typeof S=="function"?o[l+1]=S:(o.splice(l,3),l-=3),o0(o)}}}function c0(){function t(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(y){return m=y})},focusReset:"manual",scroll:"manual"})}function s(){m!==null&&(m(),m=null),l||setTimeout(o,20)}function o(){if(!l&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,m=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){l=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),m!==null&&(m(),m=null)}}}function yh(t){this._internalRoot=t}$c.prototype.render=yh.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(a(409));var o=s.current,l=un();$y(o,l,t,s,null,null)},$c.prototype.unmount=yh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;$y(t.current,2,null,t,null,null),Pc(),s[Ya]=null}};function $c(t){this._internalRoot=t}$c.prototype.unstable_scheduleHydration=function(t){if(t){var s=yp();t={blockedOn:null,target:t,priority:s};for(var o=0;o<Wi.length&&s!==0&&s<Wi[o].priority;o++);Wi.splice(o,0,t),o===0&&s0(t)}};var l0=e.version;if(l0!=="19.2.0")throw Error(a(527,l0,"19.2.0"));W.findDOMNode=function(t){var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(a(188)):(t=Object.keys(t).join(","),Error(a(268,t)));return t=f(s),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var F_={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var el=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!el.isDisabled&&el.supportsFiber)try{ar=el.inject(F_),tn=el}catch{}}return Wr.createRoot=function(t,s){if(!r(t))throw Error(a(299));var o=!1,l="",m=gv,p=vv,y=yv;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(l=s.identifierPrefix),s.onUncaughtError!==void 0&&(m=s.onUncaughtError),s.onCaughtError!==void 0&&(p=s.onCaughtError),s.onRecoverableError!==void 0&&(y=s.onRecoverableError)),s=Wy(t,1,!1,null,null,o,l,null,m,p,y,c0),t[Ya]=s.current,$d(t),new yh(s)},Wr.hydrateRoot=function(t,s,o){if(!r(t))throw Error(a(299));var l=!1,m="",p=gv,y=vv,S=yv,_=null;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(p=o.onUncaughtError),o.onCaughtError!==void 0&&(y=o.onCaughtError),o.onRecoverableError!==void 0&&(S=o.onRecoverableError),o.formState!==void 0&&(_=o.formState)),s=Wy(t,1,!0,s,o??null,l,m,_,p,y,S,c0),s.context=Zy(null),o=s.current,l=un(),l=cu(l),m=Ii(l),m.callback=null,Ui(o,m,l),o=l,s.current.lanes=o,rr(s,o),qn(s),t[Ya]=s.current,$d(t),new $c(s)},Wr.version="19.2.0",Wr}var b0;function W_(){if(b0)return Sh.exports;b0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Sh.exports=J_(),Sh.exports}var Z_=W_(),T0={};function $_(n,e){return e.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(a){if(a!=="default"&&!(a in n)){var r=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(n,a,r.get?r:{enumerable:!0,get:function(){return i[a]}})}})}),Object.freeze(n)}var eR=Object.defineProperty,tR=(n,e,i)=>e in n?eR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,S0=(n,e,i)=>tR(n,typeof e!="symbol"?e+"":e,i);let Ft=class{constructor(){S0(this,"_locking"),S0(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const i=new Promise(r=>e=()=>{this._locks-=1,r()}),a=this._locking.then(()=>e);return this._locking=this._locking.then(()=>i),a}};function at(n,e){if(!n)throw new Error(e)}const nR=34028234663852886e22,iR=-34028234663852886e22,aR=4294967295,sR=2147483647,rR=-2147483648;function ol(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>sR||n<rR)throw new Error("invalid int 32: "+n)}function of(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>aR||n<0)throw new Error("invalid uint 32: "+n)}function qT(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>nR||n<iR))throw new Error("invalid float 32: "+n)}const HT=Symbol("@bufbuild/protobuf/enum-type");function oR(n){const e=n[HT];return at(e,"missing enum type on enum object"),e}function GT(n,e,i,a){n[HT]=KT(e,i.map(r=>({no:r.no,name:r.name,localName:n[r.no]})))}function KT(n,e,i){const a=Object.create(null),r=Object.create(null),c=[];for(const u of e){const d=YT(u);c.push(d),a[u.name]=d,r[u.no]=d}return{typeName:n,values:c,findName(u){return a[u]},findNumber(u){return r[u]}}}function cR(n,e,i){const a={};for(const r of e){const c=YT(r);a[c.localName]=c.no,a[c.no]=c.localName}return GT(a,n,e),a}function YT(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class im{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,i){const a=this.getType(),r=a.runtime.bin,c=r.makeReadOptions(i);return r.readMessage(this,c.readerFactory(e),e.byteLength,c),this}fromJson(e,i){const a=this.getType(),r=a.runtime.json,c=r.makeReadOptions(i);return r.readMessage(a,e,c,this),this}fromJsonString(e,i){let a;try{a=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(a,i)}toBinary(e){const i=this.getType(),a=i.runtime.bin,r=a.makeWriteOptions(e),c=r.writerFactory();return a.writeMessage(this,c,r),c.finish()}toJson(e){const i=this.getType(),a=i.runtime.json,r=a.makeWriteOptions(e);return a.writeMessage(this,r)}toJsonString(e){var i;const a=this.toJson(e);return JSON.stringify(a,null,(i=e?.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function lR(n,e,i,a){var r;const c=(r=a?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),u={[c]:function(d){n.util.initFields(this),n.util.initPartial(d,this)}}[c];return Object.setPrototypeOf(u.prototype,new im),Object.assign(u,{runtime:n,typeName:e,fields:n.util.newFieldList(i),fromBinary(d,h){return new u().fromBinary(d,h)},fromJson(d,h){return new u().fromJson(d,h)},fromJsonString(d,h){return new u().fromJsonString(d,h)},equals(d,h){return n.util.equals(u,d,h)}}),u}function uR(){let n=0,e=0;for(let a=0;a<28;a+=7){let r=this.buf[this.pos++];if(n|=(r&127)<<a,(r&128)==0)return this.assertBounds(),[n,e]}let i=this.buf[this.pos++];if(n|=(i&15)<<28,e=(i&112)>>4,(i&128)==0)return this.assertBounds(),[n,e];for(let a=3;a<=31;a+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<a,(r&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function _h(n,e,i){for(let c=0;c<28;c=c+7){const u=n>>>c,d=!(!(u>>>7)&&e==0),h=(d?u|128:u)&255;if(i.push(h),!d)return}const a=n>>>28&15|(e&7)<<4,r=e>>3!=0;if(i.push((r?a|128:a)&255),!!r){for(let c=3;c<31;c=c+7){const u=e>>>c,d=!!(u>>>7),h=(d?u|128:u)&255;if(i.push(h),!d)return}i.push(e>>>31&1)}}const cl=4294967296;function C0(n){const e=n[0]==="-";e&&(n=n.slice(1));const i=1e6;let a=0,r=0;function c(u,d){const h=Number(n.slice(u,d));r*=i,a=a*i+h,a>=cl&&(r=r+(a/cl|0),a=a%cl)}return c(-24,-18),c(-18,-12),c(-12,-6),c(-6),e?QT(a,r):am(a,r)}function dR(n,e){let i=am(n,e);const a=i.hi&2147483648;a&&(i=QT(i.lo,i.hi));const r=XT(i.lo,i.hi);return a?"-"+r:r}function XT(n,e){if({lo:n,hi:e}=hR(n,e),e<=2097151)return String(cl*e+n);const i=n&16777215,a=(n>>>24|e<<8)&16777215,r=e>>16&65535;let c=i+a*6777216+r*6710656,u=a+r*8147497,d=r*2;const h=1e7;return c>=h&&(u+=Math.floor(c/h),c%=h),u>=h&&(d+=Math.floor(u/h),u%=h),d.toString()+k0(u)+k0(c)}function hR(n,e){return{lo:n>>>0,hi:e>>>0}}function am(n,e){return{lo:n|0,hi:e|0}}function QT(n,e){return e=~e,n?n=~n+1:e+=1,am(n,e)}const k0=n=>{const e=String(n);return"0000000".slice(e.length)+e};function E0(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let i=0;i<9;i++)e.push(n&127|128),n=n>>7;e.push(1)}}function fR(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let i=5;(n&128)!==0&&i<10;i++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function mR(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof T0!="object"||T0.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),c=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>c||f<r)throw new Error("int64 invalid: ".concat(h));return f},uParse(h){const f=typeof h=="bigint"?h:BigInt(h);if(f>d||f<u)throw new Error("uint64 invalid: ".concat(h));return f},enc(h){return n.setBigInt64(0,this.parse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(h){return n.setBigInt64(0,this.uParse(h),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigInt64(0,!0)},uDec(h,f){return n.setInt32(0,h,!0),n.setInt32(4,f,!0),n.getBigUint64(0,!0)}}}const i=r=>at(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),a=r=>at(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),a(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),i(r),C0(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),a(r),C0(r)},dec(r,c){return dR(r,c)},uDec(r,c){return XT(r,c)}}}const We=mR();var Q;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(Q||(Q={}));var ca;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(ca||(ca={}));function $i(n,e,i){if(e===i)return!0;if(n==Q.BYTES){if(!(e instanceof Uint8Array)||!(i instanceof Uint8Array)||e.length!==i.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==i[a])return!1;return!0}switch(n){case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return e==i}return!1}function Js(n,e){switch(n){case Q.BOOL:return!1;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return e==0?We.zero:"0";case Q.DOUBLE:case Q.FLOAT:return 0;case Q.BYTES:return new Uint8Array(0);case Q.STRING:return"";default:return 0}}function JT(n,e){switch(n){case Q.BOOL:return e===!1;case Q.STRING:return e==="";case Q.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var dt;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(dt||(dt={}));class pR{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let i=new Uint8Array(e),a=0;for(let r=0;r<this.chunks.length;r++)i.set(this.chunks[r],a),a+=this.chunks[r].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,i){return this.uint32((e<<3|i)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(of(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ol(e),E0(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let i=this.textEncoder.encode(e);return this.uint32(i.byteLength),this.raw(i)}float(e){qT(e);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,e,!0),this.raw(i)}double(e){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,e,!0),this.raw(i)}fixed32(e){of(e);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,e,!0),this.raw(i)}sfixed32(e){ol(e);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,e,!0),this.raw(i)}sint32(e){return ol(e),e=(e<<1^e>>31)>>>0,E0(e,this.buf),this}sfixed64(e){let i=new Uint8Array(8),a=new DataView(i.buffer),r=We.enc(e);return a.setInt32(0,r.lo,!0),a.setInt32(4,r.hi,!0),this.raw(i)}fixed64(e){let i=new Uint8Array(8),a=new DataView(i.buffer),r=We.uEnc(e);return a.setInt32(0,r.lo,!0),a.setInt32(4,r.hi,!0),this.raw(i)}int64(e){let i=We.enc(e);return _h(i.lo,i.hi,this.buf),this}sint64(e){let i=We.enc(e),a=i.hi>>31,r=i.lo<<1^a,c=(i.hi<<1|i.lo>>>31)^a;return _h(r,c,this.buf),this}uint64(e){let i=We.uEnc(e);return _h(i.lo,i.hi,this.buf),this}}class gR{constructor(e,i){this.varint64=uR,this.uint32=fR,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=i??new TextDecoder}tag(){let e=this.uint32(),i=e>>>3,a=e&7;if(i<=0||a<0||a>5)throw new Error("illegal tag: field no "+i+" wire type "+a);return[i,a]}skip(e,i){let a=this.pos;switch(e){case dt.Varint:for(;this.buf[this.pos++]&128;);break;case dt.Bit64:this.pos+=4;case dt.Bit32:this.pos+=4;break;case dt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case dt.StartGroup:for(;;){const[c,u]=this.tag();if(u===dt.EndGroup){if(i!==void 0&&c!==i)throw new Error("invalid end group tag");break}this.skip(u,c)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(a,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return We.dec(...this.varint64())}uint64(){return We.uDec(...this.varint64())}sint64(){let[e,i]=this.varint64(),a=-(e&1);return e=(e>>>1|(i&1)<<31)^a,i=i>>>1^a,We.dec(e,i)}bool(){let[e,i]=this.varint64();return e!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return We.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return We.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),i=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(i,i+e)}string(){return this.textDecoder.decode(this.bytes())}}function vR(n,e,i,a){let r;return{typeName:e,extendee:i,get field(){if(!r){const c=typeof a=="function"?a():a;c.name=e.split(".").pop(),c.jsonName="[".concat(e,"]"),r=n.util.newFieldList([c]).list()[0]}return r},runtime:n}}function WT(n){const e=n.field.localName,i=Object.create(null);return i[e]=yR(n),[i,()=>i[e]]}function yR(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Js(e.T,e.L);case"message":const i=e.T,a=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(a):a;case"map":throw"map fields are not allowed to be extensions"}}function bR(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let i=n.length-1;i>=0;--i)if(n[i].no==e.no)return[n[i]];return[]}return n.filter(i=>i.no===e.no)}let bi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ql=[];for(let n=0;n<bi.length;n++)ql[bi[n].charCodeAt(0)]=n;ql[45]=bi.indexOf("+");ql[95]=bi.indexOf("/");const ZT={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let i=new Uint8Array(e),a=0,r=0,c,u=0;for(let d=0;d<n.length;d++){if(c=ql[n.charCodeAt(d)],c===void 0)switch(n[d]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:u=c,r=1;break;case 1:i[a++]=u<<2|(c&48)>>4,u=c,r=2;break;case 2:i[a++]=(u&15)<<4|(c&60)>>2,u=c,r=3;break;case 3:i[a++]=(u&3)<<6|c,r=0;break}}if(r==1)throw Error("invalid base64 string.");return i.subarray(0,a)},enc(n){let e="",i=0,a,r=0;for(let c=0;c<n.length;c++)switch(a=n[c],i){case 0:e+=bi[a>>2],r=(a&3)<<4,i=1;break;case 1:e+=bi[r|a>>4],r=(a&15)<<2,i=2;break;case 2:e+=bi[r|a>>6],e+=bi[a&63],i=0;break}return i&&(e+=bi[r],e+="=",i==1&&(e+="=")),e}};function TR(n,e,i){eS(e,n);const a=e.runtime.bin.makeReadOptions(i),r=bR(n.getType().runtime.bin.listUnknownFields(n),e.field),[c,u]=WT(e);for(const d of r)e.runtime.bin.readField(c,a.readerFactory(d.data),e.field,d.wireType,a);return u()}function SR(n,e,i,a){eS(e,n);const r=e.runtime.bin.makeReadOptions(a),c=e.runtime.bin.makeWriteOptions(a);if($T(n,e)){const f=n.getType().runtime.bin.listUnknownFields(n).filter(g=>g.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const g of f)n.getType().runtime.bin.onUnknownField(n,g.no,g.wireType,g.data)}const u=c.writerFactory();let d=e.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(d,i,u,c);const h=r.readerFactory(u.finish());for(;h.pos<h.len;){const[f,g]=h.tag(),v=h.skip(g,f);n.getType().runtime.bin.onUnknownField(n,f,g,v)}}function $T(n,e){const i=n.getType();return e.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(n).find(a=>a.no==e.field.no)}function eS(n,e){at(n.extendee.typeName==e.getType().typeName,"extension ".concat(n.typeName," can only be applied to message ").concat(n.extendee.typeName))}function tS(n,e){const i=n.localName;if(n.repeated)return e[i].length>0;if(n.oneof)return e[n.oneof.localName].case===i;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[i]!==void 0:n.kind=="enum"?e[i]!==n.T.values[0].no:!JT(n.T,e[i]);case"message":return e[i]!==void 0;case"map":return Object.keys(e[i]).length>0}}function _0(n,e){const i=n.localName,a=!n.opt&&!n.req;if(n.repeated)e[i]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[i]={};break;case"enum":e[i]=a?n.T.values[0].no:void 0;break;case"scalar":e[i]=a?Js(n.T,n.L):void 0;break;case"message":e[i]=void 0;break}}function Ti(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(im.prototype).every(a=>a in n&&typeof n[a]=="function"))return!1;const i=n.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:e===void 0?!0:i.typeName==e.typeName}function nS(n,e){return Ti(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}Q.DOUBLE,Q.FLOAT,Q.INT64,Q.UINT64,Q.INT32,Q.UINT32,Q.BOOL,Q.STRING,Q.BYTES;const R0={ignoreUnknownFields:!1},A0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function CR(n){return n?Object.assign(Object.assign({},R0),n):R0}function kR(n){return n?Object.assign(Object.assign({},A0),n):A0}const El=Symbol(),ll=Symbol();function ER(){return{makeReadOptions:CR,makeWriteOptions:kR,readMessage(n,e,i,a){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(n.typeName," from JSON: ").concat(Gn(e)));a=a??new n;const r=new Map,c=i.typeRegistry;for(const[u,d]of Object.entries(e)){const h=n.fields.findJsonName(u);if(h){if(h.oneof){if(d===null&&h.kind=="scalar")continue;const f=r.get(h.oneof);if(f!==void 0)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: multiple keys for oneof "').concat(h.oneof.name,'" present: "').concat(f,'", "').concat(u,'"'));r.set(h.oneof,u)}w0(a,d,h,i,n)}else{let f=!1;if(c?.findExtension&&u.startsWith("[")&&u.endsWith("]")){const g=c.findExtension(u.substring(1,u.length-1));if(g&&g.extendee.typeName==n.typeName){f=!0;const[v,b]=WT(g);w0(v,d,g.field,i,g),SR(a,g,b(),i)}}if(!f&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(n.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return a},writeMessage(n,e){const i=n.getType(),a={};let r;try{for(r of i.fields.byNumber()){if(!tS(r,n)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!RR(r))continue}const u=r.oneof?n[r.oneof.localName].value:n[r.localName],d=M0(r,u,e);d!==void 0&&(a[e.useProtoFieldName?r.name:r.jsonName]=d)}const c=e.typeRegistry;if(c?.findExtensionFor)for(const u of i.runtime.bin.listUnknownFields(n)){const d=c.findExtensionFor(i.typeName,u.no);if(d&&$T(n,d)){const h=TR(n,d,e),f=M0(d.field,h,e);f!==void 0&&(a[d.field.jsonName]=f)}}}catch(c){const u=r?"cannot encode field ".concat(i.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),d=c instanceof Error?c.message:String(c);throw new Error(u+(d.length>0?": ".concat(d):""))}return a},readScalar(n,e,i){return co(n,e,i??ca.BIGINT,!0)},writeScalar(n,e,i){if(e!==void 0&&(i||JT(n,e)))return ul(n,e)},debug:Gn}}function Gn(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":'"'.concat(n.split('"').join('\\"'),'"');default:return String(n)}}function w0(n,e,i,a,r){let c=i.localName;if(i.repeated){if(at(i.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(e)));const u=n[c];for(const d of e){if(d===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(d)));switch(i.kind){case"message":u.push(i.T.fromJson(d,a));break;case"enum":const h=Rh(i.T,d,a.ignoreUnknownFields,!0);h!==ll&&u.push(h);break;case"scalar":try{u.push(co(i.T,d,i.L,!0))}catch(f){let g="cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(d));throw f instanceof Error&&f.message.length>0&&(g+=": ".concat(f.message)),new Error(g)}break}}}else if(i.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(e)));const u=n[c];for(const[d,h]of Object.entries(e)){if(h===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: map value null"));let f;try{f=_R(i.K,d)}catch(g){let v="cannot decode map key for field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(e));throw g instanceof Error&&g.message.length>0&&(v+=": ".concat(g.message)),new Error(v)}switch(i.V.kind){case"message":u[f]=i.V.T.fromJson(h,a);break;case"enum":const g=Rh(i.V.T,h,a.ignoreUnknownFields,!0);g!==ll&&(u[f]=g);break;case"scalar":try{u[f]=co(i.V.T,h,ca.BIGINT,!0)}catch(v){let b="cannot decode map value for field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(e));throw v instanceof Error&&v.message.length>0&&(b+=": ".concat(v.message)),new Error(b)}break}}}else switch(i.oneof&&(n=n[i.oneof.localName]={case:c},c="value"),i.kind){case"message":const u=i.T;if(e===null&&u.typeName!="google.protobuf.Value")return;let d=n[c];Ti(d)?d.fromJson(e,a):(n[c]=d=u.fromJson(e,a),u.fieldWrapper&&!i.oneof&&(n[c]=u.fieldWrapper.unwrapField(d)));break;case"enum":const h=Rh(i.T,e,a.ignoreUnknownFields,!1);switch(h){case El:_0(i,n);break;case ll:break;default:n[c]=h;break}break;case"scalar":try{const f=co(i.T,e,i.L,!1);switch(f){case El:_0(i,n);break;default:n[c]=f;break}}catch(f){let g="cannot decode field ".concat(r.typeName,".").concat(i.name," from JSON: ").concat(Gn(e));throw f instanceof Error&&f.message.length>0&&(g+=": ".concat(f.message)),new Error(g)}break}}function _R(n,e){if(n===Q.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return co(n,e,ca.BIGINT,!0).toString()}function co(n,e,i,a){if(e===null)return a?Js(n,i):El;switch(n){case Q.DOUBLE:case Q.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==Q.FLOAT&&qT(r),r;case Q.INT32:case Q.FIXED32:case Q.SFIXED32:case Q.SINT32:case Q.UINT32:let c;if(typeof e=="number"?c=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(c=Number(e)),c===void 0)break;return n==Q.UINT32||n==Q.FIXED32?of(c):ol(c),c;case Q.INT64:case Q.SFIXED64:case Q.SINT64:if(typeof e!="number"&&typeof e!="string")break;const u=We.parse(e);return i?u.toString():u;case Q.FIXED64:case Q.UINT64:if(typeof e!="number"&&typeof e!="string")break;const d=We.uParse(e);return i?d.toString():d;case Q.BOOL:if(typeof e!="boolean")break;return e;case Q.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Q.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return ZT.dec(e)}throw new Error}function Rh(n,e,i,a){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:a?n.values[0].no:El;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r!==void 0)return r.no;if(i)return ll;break}throw new Error("cannot decode enum ".concat(n.typeName," from JSON: ").concat(Gn(e)))}function RR(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function M0(n,e,i){if(n.kind=="map"){at(typeof e=="object"&&e!=null);const a={},r=Object.entries(e);switch(n.V.kind){case"scalar":for(const[u,d]of r)a[u.toString()]=ul(n.V.T,d);break;case"message":for(const[u,d]of r)a[u.toString()]=d.toJson(i);break;case"enum":const c=n.V.T;for(const[u,d]of r)a[u.toString()]=Ah(c,d,i.enumAsInteger);break}return i.emitDefaultValues||r.length>0?a:void 0}if(n.repeated){at(Array.isArray(e));const a=[];switch(n.kind){case"scalar":for(let r=0;r<e.length;r++)a.push(ul(n.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)a.push(Ah(n.T,e[r],i.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)a.push(e[r].toJson(i));break}return i.emitDefaultValues||a.length>0?a:void 0}switch(n.kind){case"scalar":return ul(n.T,e);case"enum":return Ah(n.T,e,i.enumAsInteger);case"message":return nS(n.T,e).toJson(i)}}function Ah(n,e,i){var a;if(at(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(i)return e;const r=n.findNumber(e);return(a=r?.name)!==null&&a!==void 0?a:e}function ul(n,e){switch(n){case Q.INT32:case Q.SFIXED32:case Q.SINT32:case Q.FIXED32:case Q.UINT32:return at(typeof e=="number"),e;case Q.FLOAT:case Q.DOUBLE:return at(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Q.STRING:return at(typeof e=="string"),e;case Q.BOOL:return at(typeof e=="boolean"),e;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return at(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Q.BYTES:return at(e instanceof Uint8Array),ZT.enc(e)}}const Os=Symbol("@bufbuild/protobuf/unknown-fields"),D0={readUnknownFields:!0,readerFactory:n=>new gR(n)},O0={writeUnknownFields:!0,writerFactory:()=>new pR};function AR(n){return n?Object.assign(Object.assign({},D0),n):D0}function wR(n){return n?Object.assign(Object.assign({},O0),n):O0}function MR(){return{makeReadOptions:AR,makeWriteOptions:wR,listUnknownFields(n){var e;return(e=n[Os])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Os]},writeUnknownFields(n,e){const a=n[Os];if(a)for(const r of a)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(n,e,i,a){const r=n;Array.isArray(r[Os])||(r[Os]=[]),r[Os].push({no:e,wireType:i,data:a})},readMessage(n,e,i,a,r){const c=n.getType(),u=r?e.len:e.pos+i;let d,h;for(;e.pos<u&&([d,h]=e.tag(),!(r===!0&&h==dt.EndGroup));){const f=c.fields.find(d);if(!f){const g=e.skip(h,d);a.readUnknownFields&&this.onUnknownField(n,d,h,g);continue}x0(n,e,f,h,a)}if(r&&(h!=dt.EndGroup||d!==i))throw new Error("invalid end group tag")},readField:x0,writeMessage(n,e,i){const a=n.getType();for(const r of a.fields.byNumber()){if(!tS(r,n)){if(r.req)throw new Error("cannot encode field ".concat(a.typeName,".").concat(r.name," to binary: required field not set"));continue}const c=r.oneof?n[r.oneof.localName].value:n[r.localName];P0(r,c,e,i)}return i.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,i,a){e!==void 0&&P0(n,e,i,a)}}}function x0(n,e,i,a,r){let{repeated:c,localName:u}=i;switch(i.oneof&&(n=n[i.oneof.localName],n.case!=u&&delete n.value,n.case=u,u="value"),i.kind){case"scalar":case"enum":const d=i.kind=="enum"?Q.INT32:i.T;let h=_l;if(i.kind=="scalar"&&i.L>0&&(h=OR),c){let b=n[u];if(a==dt.LengthDelimited&&d!=Q.STRING&&d!=Q.BYTES){let C=e.uint32()+e.pos;for(;e.pos<C;)b.push(h(e,d))}else b.push(h(e,d))}else n[u]=h(e,d);break;case"message":const f=i.T;c?n[u].push(dl(e,new f,r,i)):Ti(n[u])?dl(e,n[u],r,i):(n[u]=dl(e,new f,r,i),f.fieldWrapper&&!i.oneof&&!i.repeated&&(n[u]=f.fieldWrapper.unwrapField(n[u])));break;case"map":let[g,v]=DR(i,e,r);n[u][g]=v;break}}function dl(n,e,i,a){const r=e.getType().runtime.bin,c=a?.delimited;return r.readMessage(e,n,c?a.no:n.uint32(),i,c),e}function DR(n,e,i){const a=e.uint32(),r=e.pos+a;let c,u;for(;e.pos<r;){const[d]=e.tag();switch(d){case 1:c=_l(e,n.K);break;case 2:switch(n.V.kind){case"scalar":u=_l(e,n.V.T);break;case"enum":u=e.int32();break;case"message":u=dl(e,new n.V.T,i,void 0);break}break}}if(c===void 0&&(c=Js(n.K,ca.BIGINT)),typeof c!="string"&&typeof c!="number"&&(c=c.toString()),u===void 0)switch(n.V.kind){case"scalar":u=Js(n.V.T,ca.BIGINT);break;case"enum":u=n.V.T.values[0].no;break;case"message":u=new n.V.T;break}return[c,u]}function OR(n,e){const i=_l(n,e);return typeof i=="bigint"?i.toString():i}function _l(n,e){switch(e){case Q.STRING:return n.string();case Q.BOOL:return n.bool();case Q.DOUBLE:return n.double();case Q.FLOAT:return n.float();case Q.INT32:return n.int32();case Q.INT64:return n.int64();case Q.UINT64:return n.uint64();case Q.FIXED64:return n.fixed64();case Q.BYTES:return n.bytes();case Q.FIXED32:return n.fixed32();case Q.SFIXED32:return n.sfixed32();case Q.SFIXED64:return n.sfixed64();case Q.SINT64:return n.sint64();case Q.UINT32:return n.uint32();case Q.SINT32:return n.sint32()}}function P0(n,e,i,a){at(e!==void 0);const r=n.repeated;switch(n.kind){case"scalar":case"enum":let c=n.kind=="enum"?Q.INT32:n.T;if(r)if(at(Array.isArray(e)),n.packed)PR(i,c,n.no,e);else for(const u of e)lo(i,c,n.no,u);else lo(i,c,n.no,e);break;case"message":if(r){at(Array.isArray(e));for(const u of e)N0(i,a,n,u)}else N0(i,a,n,e);break;case"map":at(typeof e=="object"&&e!=null);for(const[u,d]of Object.entries(e))xR(i,a,n,u,d);break}}function xR(n,e,i,a,r){n.tag(i.no,dt.LengthDelimited),n.fork();let c=a;switch(i.K){case Q.INT32:case Q.FIXED32:case Q.UINT32:case Q.SFIXED32:case Q.SINT32:c=Number.parseInt(a);break;case Q.BOOL:at(a=="true"||a=="false"),c=a=="true";break}switch(lo(n,i.K,1,c),i.V.kind){case"scalar":lo(n,i.V.T,2,r);break;case"enum":lo(n,Q.INT32,2,r);break;case"message":at(r!==void 0),n.tag(2,dt.LengthDelimited).bytes(r.toBinary(e));break}n.join()}function N0(n,e,i,a){const r=nS(i.T,a);i.delimited?n.tag(i.no,dt.StartGroup).raw(r.toBinary(e)).tag(i.no,dt.EndGroup):n.tag(i.no,dt.LengthDelimited).bytes(r.toBinary(e))}function lo(n,e,i,a){at(a!==void 0);let[r,c]=iS(e);n.tag(i,r)[c](a)}function PR(n,e,i,a){if(!a.length)return;n.tag(i,dt.LengthDelimited).fork();let[,r]=iS(e);for(let c=0;c<a.length;c++)n[r](a[c]);n.join()}function iS(n){let e=dt.Varint;switch(n){case Q.BYTES:case Q.STRING:e=dt.LengthDelimited;break;case Q.DOUBLE:case Q.FIXED64:case Q.SFIXED64:e=dt.Bit64;break;case Q.FIXED32:case Q.SFIXED32:case Q.FLOAT:e=dt.Bit32;break}const i=Q[n].toLowerCase();return[e,i]}function NR(){return{setEnumType:GT,initPartial(n,e){if(n===void 0)return;const i=e.getType();for(const a of i.fields.byMember()){const r=a.localName,c=e,u=n;if(u[r]!=null)switch(a.kind){case"oneof":const d=u[r].case;if(d===void 0)continue;const h=a.findField(d);let f=u[r].value;h&&h.kind=="message"&&!Ti(f,h.T)?f=new h.T(f):h&&h.kind==="scalar"&&h.T===Q.BYTES&&(f=Zr(f)),c[r]={case:d,value:f};break;case"scalar":case"enum":let g=u[r];a.T===Q.BYTES&&(g=a.repeated?g.map(Zr):Zr(g)),c[r]=g;break;case"map":switch(a.V.kind){case"scalar":case"enum":if(a.V.T===Q.BYTES)for(const[T,C]of Object.entries(u[r]))c[r][T]=Zr(C);else Object.assign(c[r],u[r]);break;case"message":const b=a.V.T;for(const T of Object.keys(u[r])){let C=u[r][T];b.fieldWrapper||(C=new b(C)),c[r][T]=C}break}break;case"message":const v=a.T;if(a.repeated)c[r]=u[r].map(b=>Ti(b,v)?b:new v(b));else{const b=u[r];v.fieldWrapper?v.typeName==="google.protobuf.BytesValue"?c[r]=Zr(b):c[r]=b:c[r]=Ti(b,v)?b:new v(b)}break}}},equals(n,e,i){return e===i?!0:!e||!i?!1:n.fields.byMember().every(a=>{const r=e[a.localName],c=i[a.localName];if(a.repeated){if(r.length!==c.length)return!1;switch(a.kind){case"message":return r.every((u,d)=>a.T.equals(u,c[d]));case"scalar":return r.every((u,d)=>$i(a.T,u,c[d]));case"enum":return r.every((u,d)=>$i(Q.INT32,u,c[d]))}throw new Error("repeated cannot contain ".concat(a.kind))}switch(a.kind){case"message":let u=r,d=c;return a.T.fieldWrapper&&(u!==void 0&&!Ti(u)&&(u=a.T.fieldWrapper.wrapField(u)),d!==void 0&&!Ti(d)&&(d=a.T.fieldWrapper.wrapField(d))),a.T.equals(u,d);case"enum":return $i(Q.INT32,r,c);case"scalar":return $i(a.T,r,c);case"oneof":if(r.case!==c.case)return!1;const h=a.findField(r.case);if(h===void 0)return!0;switch(h.kind){case"message":return h.T.equals(r.value,c.value);case"enum":return $i(Q.INT32,r.value,c.value);case"scalar":return $i(h.T,r.value,c.value)}throw new Error("oneof cannot contain ".concat(h.kind));case"map":const f=Object.keys(r).concat(Object.keys(c));switch(a.V.kind){case"message":const g=a.V.T;return f.every(b=>g.equals(r[b],c[b]));case"enum":return f.every(b=>$i(Q.INT32,r[b],c[b]));case"scalar":const v=a.V.T;return f.every(b=>$i(v,r[b],c[b]))}break}})},clone(n){const e=n.getType(),i=new e,a=i;for(const r of e.fields.byMember()){const c=n[r.localName];let u;if(r.repeated)u=c.map(tl);else if(r.kind=="map"){u=a[r.localName];for(const[d,h]of Object.entries(c))u[d]=tl(h)}else r.kind=="oneof"?u=r.findField(c.case)?{case:c.case,value:tl(c.value)}:{case:void 0}:u=tl(c);a[r.localName]=u}for(const r of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(a,r.no,r.wireType,r.data);return i}}}function tl(n){if(n===void 0)return n;if(Ti(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function Zr(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function LR(n,e,i){return{syntax:n,json:ER(),bin:MR(),util:Object.assign(Object.assign({},NR()),{newFieldList:e,initFields:i}),makeMessageType(a,r,c){return lR(this,a,r,c)},makeEnum:cR,makeEnumType:KT,getEnumType:oR,makeExtension(a,r,c){return vR(this,a,r,c)}}}class IR{constructor(e,i){this._fields=e,this._normalizer=i}findJsonName(e){if(!this.jsonNames){const i={};for(const a of this.list())i[a.jsonName]=i[a.name]=a;this.jsonNames=i}return this.jsonNames[e]}find(e){if(!this.numbers){const i={};for(const a of this.list())i[a.no]=a;this.numbers=i}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,i)=>e.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let i;for(const a of this.list())a.oneof?a.oneof!==i&&(i=a.oneof,e.push(i)):e.push(a)}return this.members}}function aS(n,e){const i=sS(n);return e?i:zR(FR(i))}function UR(n){return aS(n,!1)}const BR=sS;function sS(n){let e=!1;const i=[];for(let a=0;a<n.length;a++){let r=n.charAt(a);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),i.push(r);break}}return i.join("")}const jR=new Set(["constructor","toString","toJSON","valueOf"]),VR=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),rS=n=>"".concat(n,"$"),FR=n=>VR.has(n)?rS(n):n,zR=n=>jR.has(n)?rS(n):n;class qR{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=UR(e)}addField(e){at(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[e]}}function HR(n,e){var i,a,r,c,u,d;const h=[];let f;for(const g of typeof n=="function"?n():n){const v=g;if(v.localName=aS(g.name,g.oneof!==void 0),v.jsonName=(i=g.jsonName)!==null&&i!==void 0?i:BR(g.name),v.repeated=(a=g.repeated)!==null&&a!==void 0?a:!1,g.kind=="scalar"&&(v.L=(r=g.L)!==null&&r!==void 0?r:ca.BIGINT),v.delimited=(c=g.delimited)!==null&&c!==void 0?c:!1,v.req=(u=g.req)!==null&&u!==void 0?u:!1,v.opt=(d=g.opt)!==null&&d!==void 0?d:!1,g.packed===void 0&&(v.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=Q.BYTES&&g.T!=Q.STRING),g.oneof!==void 0){const b=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!f||f.name!=b)&&(f=new qR(b)),v.oneof=f,f.addField(v)}h.push(v)}return h}const L=LR("proto3",n=>new IR(n,e=>HR(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const i=e.localName,a=n;if(e.repeated){a[i]=[];continue}switch(e.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=Js(e.T,e.L);break}}});class Jt extends im{constructor(e){super(),this.seconds=We.zero,this.nanos=0,L.util.initPartial(e,this)}fromJson(e,i){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(L.json.debug(e)));const a=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=We.parse(r/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}toJson(e){const i=Number(this.seconds)*1e3;if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let a="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?a="."+r.substring(0,3)+"Z":r.substring(6)==="000"?a="."+r.substring(0,6)+"Z":a="."+r+"Z"}return new Date(i).toISOString().replace(".000Z",a)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Jt.fromDate(new Date)}static fromDate(e){const i=e.getTime();return new Jt({seconds:We.parse(Math.floor(i/1e3)),nanos:i%1e3*1e6})}static fromBinary(e,i){return new Jt().fromBinary(e,i)}static fromJson(e,i){return new Jt().fromJson(e,i)}static fromJsonString(e,i){return new Jt().fromJsonString(e,i)}static equals(e,i){return L.util.equals(Jt,e,i)}}Jt.runtime=L;Jt.typeName="google.protobuf.Timestamp";Jt.fields=L.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const GR=L.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Jt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:KR,repeated:!0},{no:5,name:"events",kind:"message",T:XR,repeated:!0}]),KR=L.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:YR,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),YR=L.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Jt},{no:3,name:"value",kind:"scalar",T:2}]),XR=L.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Jt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Jt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),oS=L.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ln=L.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),yt=L.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),sm=L.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),so=L.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),bo=L.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Bn=L.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),La=L.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),QR=L.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Et=L.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Hl=L.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Rl,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:TS}]),Rl=L.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),JR=L.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:L.getEnumType(yt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),qa=L.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:L.getEnumType(Fs)},{no:4,name:"tracks",kind:"message",T:Ps,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:JR},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:L.getEnumType(To)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:L.getEnumType(Bn)},{no:18,name:"kind_details",kind:"enum",T:L.getEnumType(WR),repeated:!0}]),Fs=L.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),To=L.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),WR=L.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),St=L.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),ZR=L.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:sa,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:L.getEnumType(cS)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ps=L.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:L.getEnumType(Ln)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:L.getEnumType(yt)},{no:10,name:"layers",kind:"message",T:sa,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:ZR,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:L.getEnumType(St)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:TS},{no:19,name:"audio_features",kind:"enum",T:L.getEnumType(Et),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:L.getEnumType(oS)}]),sa=L.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:L.getEnumType(sm)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),cS=L.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),jt=L.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:L.getEnumType(Ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:rm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:$R,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:hS,oneof:"value"},{no:7,name:"transcription",kind:"message",T:eA,oneof:"value"},{no:8,name:"metrics",kind:"message",T:GR,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Al,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:om,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:cm,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:lm,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:wl,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Ml,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Dl,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:lS,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ae=L.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),lS=L.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:L.getEnumType(St)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),uS=L.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:rm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Al,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:om,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:cm,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:lm,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:wl,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Ml,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Dl,oneof:"value"}]),$R=L.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:dS,repeated:!0}]),dS=L.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),rm=L.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),hS=L.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),eA=L.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:tA,repeated:!0}]),tA=L.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Al=L.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),om=L.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),cm=L.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),lm=L.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:fS,oneof:"value"}]),fS=L.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),mS=L.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),pS=L.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:L.getEnumType(gS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),gS=L.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),vS=L.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:L.getEnumType(yS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),yS=L.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),bS=L.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:L0},{no:2,name:"screen",kind:"message",T:L0},{no:3,name:"resume_connection",kind:"enum",T:L.getEnumType(bo)},{no:4,name:"disabled_codecs",kind:"message",T:nA},{no:5,name:"force_relay",kind:"enum",T:L.getEnumType(bo)}]),L0=L.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:L.getEnumType(bo)}]),nA=L.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Rl,repeated:!0},{no:2,name:"publish",kind:"message",T:Rl,repeated:!0}]),TS=L.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),cf=L.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),SS=L.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:L.getEnumType(cf)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),CS=L.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),wl=L.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:L.getEnumType(St)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:SS,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:CS,oneof:"content_header"}],{localName:"DataStream_Header"}),Ml=L.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Dl=L.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),iA=L.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),In=L.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),lf=L.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),aA=L.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),sA=L.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:la,oneof:"message"},{no:2,name:"answer",kind:"message",T:la,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Gl,oneof:"message"},{no:4,name:"add_track",kind:"message",T:So,oneof:"message"},{no:5,name:"mute",kind:"message",T:Kl,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Yl,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:kS,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xl,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:_S,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:wS,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:mm,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Hn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:hm,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:OS,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:dm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:ES,oneof:"message"}]),I0=L.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:rA,oneof:"message"},{no:2,name:"answer",kind:"message",T:la,oneof:"message"},{no:3,name:"offer",kind:"message",T:la,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Gl,oneof:"message"},{no:5,name:"update",kind:"message",T:lA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:um,oneof:"message"},{no:8,name:"leave",kind:"message",T:Xl,oneof:"message"},{no:9,name:"mute",kind:"message",T:Kl,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:uA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:dA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:fA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:pA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:vA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:bA,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:cA,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:oA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:SA,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:EA,oneof:"message"},{no:22,name:"request_response",kind:"message",T:_A,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:RA,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:TA,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:DA,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:yA,oneof:"message"}]),uf=L.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:sa,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:L.getEnumType(cS)}]),So=L.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:L.getEnumType(Ln)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:L.getEnumType(yt)},{no:9,name:"layers",kind:"message",T:sa,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:uf,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:L.getEnumType(St)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:L.getEnumType(oS)},{no:17,name:"audio_features",kind:"enum",T:L.getEnumType(Et),repeated:!0}]),Gl=L.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:L.getEnumType(In)},{no:3,name:"final",kind:"scalar",T:8}]),Kl=L.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),rA=L.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Hl},{no:2,name:"participant",kind:"message",T:qa},{no:3,name:"other_participants",kind:"message",T:qa,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:RS,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:bS},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:pS},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Rl,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),oA=L.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:RS,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:bS},{no:3,name:"server_info",kind:"message",T:pS},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),um=L.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ps}]),cA=L.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),la=L.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),lA=L.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:qa,repeated:!0}]),Yl=L.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:mS,repeated:!0}]),kS=L.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:L.getEnumType(sm)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),dm=L.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:L.getEnumType(Et),repeated:!0}]),ES=L.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Xl=L.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:L.getEnumType(Bn)},{no:3,name:"action",kind:"enum",T:L.getEnumType(zs)},{no:4,name:"regions",kind:"message",T:CA}]),zs=L.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),_S=L.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:sa,repeated:!0}]),hm=L.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),RS=L.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),uA=L.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:dS,repeated:!0}]),dA=L.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Hl}]),hA=L.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:L.getEnumType(so)},{no:3,name:"score",kind:"scalar",T:2}]),fA=L.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:hA,repeated:!0}]),mA=L.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:L.getEnumType(lf)}]),pA=L.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:mA,repeated:!0}]),fm=L.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:L.getEnumType(sm)},{no:2,name:"enabled",kind:"scalar",T:8}]),gA=L.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:fm,repeated:!0}]),vA=L.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:fm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:gA,repeated:!0}]),yA=L.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:iA,repeated:!0}]),AS=L.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),wS=L.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:AS,repeated:!0}]),bA=L.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),TA=L.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Hl},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:qa},{no:4,name:"other_participants",kind:"message",T:qa,repeated:!0}]),mm=L.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:la},{no:2,name:"subscription",kind:"message",T:Yl},{no:3,name:"publish_tracks",kind:"message",T:um,repeated:!0},{no:4,name:"data_channels",kind:"message",T:DS,repeated:!0},{no:5,name:"offer",kind:"message",T:la},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:MS,repeated:!0}]),MS=L.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),DS=L.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:L.getEnumType(In)}]),Hn=L.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:L.getEnumType(aA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),OS=L.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),SA=L.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),CA=L.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:kA,repeated:!0}]),kA=L.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),EA=L.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:L.getEnumType(QR)}]),_A=L.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:L.getEnumType(pm)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Gl,oneof:"request"},{no:5,name:"add_track",kind:"message",T:So,oneof:"request"},{no:6,name:"mute",kind:"message",T:Kl,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:hm,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:dm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:ES,oneof:"request"}]),pm=L.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),RA=L.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),xS=L.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),AA=L.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:vS},{no:2,name:"connection_settings",kind:"message",T:xS},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:So,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:la},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:L.getEnumType(La)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:mm}]),wA=L.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:L.getEnumType(MA)},{no:2,name:"join_request",kind:"scalar",T:12}]),MA=L.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),DA=L.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function OA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hl={exports:{}},xA=hl.exports,U0;function PA(){return U0||(U0=1,(function(n){(function(e,i){n.exports?n.exports=i():e.log=i()})(xA,function(){var e=function(){},i="undefined",a=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],c={},u=null;function d(E,x){var w=E[x];if(typeof w.bind=="function")return w.bind(E);try{return Function.prototype.bind.call(w,E)}catch{return function(){return Function.prototype.apply.apply(w,[E,arguments])}}}function h(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function f(E){return E==="debug"&&(E="log"),typeof console===i?!1:E==="trace"&&a?h:console[E]!==void 0?d(console,E):console.log!==void 0?d(console,"log"):e}function g(){for(var E=this.getLevel(),x=0;x<r.length;x++){var w=r[x];this[w]=x<E?e:this.methodFactory(w,E,this.name)}if(this.log=this.debug,typeof console===i&&E<this.levels.SILENT)return"No console available for logging"}function v(E){return function(){typeof console!==i&&(g.call(this),this[E].apply(this,arguments))}}function b(E,x,w){return f(E)||v.apply(this,arguments)}function T(E,x){var w=this,V,I,A,R="loglevel";typeof E=="string"?R+=":"+E:typeof E=="symbol"&&(R=void 0);function B(ae){var he=(r[ae]||"silent").toUpperCase();if(!(typeof window===i||!R)){try{window.localStorage[R]=he;return}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+he+";"}catch{}}}function F(){var ae;if(!(typeof window===i||!R)){try{ae=window.localStorage[R]}catch{}if(typeof ae===i)try{var he=window.document.cookie,Ye=encodeURIComponent(R),rt=he.indexOf(Ye+"=");rt!==-1&&(ae=/^([^;]+)/.exec(he.slice(rt+Ye.length+1))[1])}catch{}return w.levels[ae]===void 0&&(ae=void 0),ae}}function G(){if(!(typeof window===i||!R)){try{window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function $(ae){var he=ae;if(typeof he=="string"&&w.levels[he.toUpperCase()]!==void 0&&(he=w.levels[he.toUpperCase()]),typeof he=="number"&&he>=0&&he<=w.levels.SILENT)return he;throw new TypeError("log.setLevel() called with invalid level: "+ae)}w.name=E,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=x||b,w.getLevel=function(){return A??I??V},w.setLevel=function(ae,he){return A=$(ae),he!==!1&&B(A),g.call(w)},w.setDefaultLevel=function(ae){I=$(ae),F()||w.setLevel(ae,!1)},w.resetLevel=function(){A=null,G(),g.call(w)},w.enableAll=function(ae){w.setLevel(w.levels.TRACE,ae)},w.disableAll=function(ae){w.setLevel(w.levels.SILENT,ae)},w.rebuild=function(){if(u!==w&&(V=$(u.getLevel())),g.call(w),u===w)for(var ae in c)c[ae].rebuild()},V=$(u?u.getLevel():"WARN");var Z=F();Z!=null&&(A=$(Z)),g.call(w)}u=new T,u.getLogger=function(x){if(typeof x!="symbol"&&typeof x!="string"||x==="")throw new TypeError("You must supply a name when creating a logger.");var w=c[x];return w||(w=c[x]=new T(x,u.methodFactory)),w};var C=typeof window!==i?window.log:void 0;return u.noConflict=function(){return typeof window!==i&&window.log===u&&(window.log=C),u},u.getLoggers=function(){return c},u.default=u,u})})(hl)),hl.exports}var Ql=PA(),df;(function(n){n[n.trace=0]="trace",n[n.debug=1]="debug",n[n.info=2]="info",n[n.warn=3]="warn",n[n.error=4]="error",n[n.silent=5]="silent"})(df||(df={}));var jn;(function(n){n.Default="livekit",n.Room="livekit-room",n.TokenSource="livekit-token-source",n.Participant="livekit-participant",n.Track="livekit-track",n.Publication="livekit-track-publication",n.Engine="livekit-engine",n.Signal="livekit-signal",n.PCManager="livekit-pc-manager",n.PCTransport="livekit-pc-transport",n.E2EE="lk-e2ee"})(jn||(jn={}));let Te=Ql.getLogger("livekit");Object.values(jn).map(n=>Ql.getLogger(n));Te.setDefaultLevel(df.info);function Ei(n){const e=Ql.getLogger(n);return e.setDefaultLevel(Te.getLevel()),e}const NA=Ql.getLogger("lk-e2ee"),$r=7e3,LA=[0,300,4*300,9*300,16*300,$r,$r,$r,$r,$r];class IA{constructor(e){this._retryDelays=e!==void 0?[...e]:LA}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[e.retryCount];return e.retryCount<=1?i:i+Math.random()*1e3}}function UA(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,a=Object.getOwnPropertySymbols(n);r<a.length;r++)e.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(n,a[r])&&(i[a[r]]=n[a[r]]);return i}function k(n,e,i,a){function r(c){return c instanceof i?c:new i(function(u){u(c)})}return new(i||(i=Promise))(function(c,u){function d(g){try{f(a.next(g))}catch(v){u(v)}}function h(g){try{f(a.throw(g))}catch(v){u(v)}}function f(g){g.done?c(g.value):r(g.value).then(d,h)}f((a=a.apply(n,e||[])).next())})}function B0(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],a=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Si(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],i;return e?e.call(n):(n=typeof B0=="function"?B0(n):n[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(c){i[c]=n[c]&&function(u){return new Promise(function(d,h){u=n[c](u),r(d,h,u.done,u.value)})}}function r(c,u,d,h){Promise.resolve(h).then(function(f){c({value:f,done:d})},u)}}var nl={exports:{}},j0;function BA(){if(j0)return nl.exports;j0=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(R,B,F){return Function.prototype.apply.call(R,B,F)},i;n&&typeof n.ownKeys=="function"?i=n.ownKeys:Object.getOwnPropertySymbols?i=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:i=function(R){return Object.getOwnPropertyNames(R)};function a(A){console&&console.warn&&console.warn(A)}var r=Number.isNaN||function(R){return R!==R};function c(){c.init.call(this)}nl.exports=c,nl.exports.once=w,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function d(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(A){if(typeof A!="number"||A<0||r(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");u=A}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||r(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function h(A){return A._maxListeners===void 0?c.defaultMaxListeners:A._maxListeners}c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(R){for(var B=[],F=1;F<arguments.length;F++)B.push(arguments[F]);var G=R==="error",$=this._events;if($!==void 0)G=G&&$.error===void 0;else if(!G)return!1;if(G){var Z;if(B.length>0&&(Z=B[0]),Z instanceof Error)throw Z;var ae=new Error("Unhandled error."+(Z?" ("+Z.message+")":""));throw ae.context=Z,ae}var he=$[R];if(he===void 0)return!1;if(typeof he=="function")e(he,this,B);else for(var Ye=he.length,rt=C(he,Ye),F=0;F<Ye;++F)e(rt[F],this,B);return!0};function f(A,R,B,F){var G,$,Z;if(d(B),$=A._events,$===void 0?($=A._events=Object.create(null),A._eventsCount=0):($.newListener!==void 0&&(A.emit("newListener",R,B.listener?B.listener:B),$=A._events),Z=$[R]),Z===void 0)Z=$[R]=B,++A._eventsCount;else if(typeof Z=="function"?Z=$[R]=F?[B,Z]:[Z,B]:F?Z.unshift(B):Z.push(B),G=h(A),G>0&&Z.length>G&&!Z.warned){Z.warned=!0;var ae=new Error("Possible EventEmitter memory leak detected. "+Z.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");ae.name="MaxListenersExceededWarning",ae.emitter=A,ae.type=R,ae.count=Z.length,a(ae)}return A}c.prototype.addListener=function(R,B){return f(this,R,B,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(R,B){return f(this,R,B,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(A,R,B){var F={fired:!1,wrapFn:void 0,target:A,type:R,listener:B},G=g.bind(F);return G.listener=B,F.wrapFn=G,G}c.prototype.once=function(R,B){return d(B),this.on(R,v(this,R,B)),this},c.prototype.prependOnceListener=function(R,B){return d(B),this.prependListener(R,v(this,R,B)),this},c.prototype.removeListener=function(R,B){var F,G,$,Z,ae;if(d(B),G=this._events,G===void 0)return this;if(F=G[R],F===void 0)return this;if(F===B||F.listener===B)--this._eventsCount===0?this._events=Object.create(null):(delete G[R],G.removeListener&&this.emit("removeListener",R,F.listener||B));else if(typeof F!="function"){for($=-1,Z=F.length-1;Z>=0;Z--)if(F[Z]===B||F[Z].listener===B){ae=F[Z].listener,$=Z;break}if($<0)return this;$===0?F.shift():E(F,$),F.length===1&&(G[R]=F[0]),G.removeListener!==void 0&&this.emit("removeListener",R,ae||B)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(R){var B,F,G;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete F[R]),this;if(arguments.length===0){var $=Object.keys(F),Z;for(G=0;G<$.length;++G)Z=$[G],Z!=="removeListener"&&this.removeAllListeners(Z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(B=F[R],typeof B=="function")this.removeListener(R,B);else if(B!==void 0)for(G=B.length-1;G>=0;G--)this.removeListener(R,B[G]);return this};function b(A,R,B){var F=A._events;if(F===void 0)return[];var G=F[R];return G===void 0?[]:typeof G=="function"?B?[G.listener||G]:[G]:B?x(G):C(G,G.length)}c.prototype.listeners=function(R){return b(this,R,!0)},c.prototype.rawListeners=function(R){return b(this,R,!1)},c.listenerCount=function(A,R){return typeof A.listenerCount=="function"?A.listenerCount(R):T.call(A,R)},c.prototype.listenerCount=T;function T(A){var R=this._events;if(R!==void 0){var B=R[A];if(typeof B=="function")return 1;if(B!==void 0)return B.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function C(A,R){for(var B=new Array(R),F=0;F<R;++F)B[F]=A[F];return B}function E(A,R){for(;R+1<A.length;R++)A[R]=A[R+1];A.pop()}function x(A){for(var R=new Array(A.length),B=0;B<R.length;++B)R[B]=A[B].listener||A[B];return R}function w(A,R){return new Promise(function(B,F){function G(Z){A.removeListener(R,$),F(Z)}function $(){typeof A.removeListener=="function"&&A.removeListener("error",G),B([].slice.call(arguments))}I(A,R,$,{once:!0}),R!=="error"&&V(A,G,{once:!0})})}function V(A,R,B){typeof A.on=="function"&&I(A,"error",R,B)}function I(A,R,B,F){if(typeof A.on=="function")F.once?A.once(R,B):A.on(R,B);else if(typeof A.addEventListener=="function")A.addEventListener(R,function G($){F.once&&A.removeEventListener(R,G),B($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}return nl.exports}var Wn=BA();let PS=!0,NS=!0;function ro(n,e,i){const a=n.match(e);return a&&a.length>=i&&parseFloat(a[i],10)}function Ka(n,e,i){if(!n.RTCPeerConnection)return;const a=n.RTCPeerConnection.prototype,r=a.addEventListener;a.addEventListener=function(u,d){if(u!==e)return r.apply(this,arguments);const h=f=>{const g=i(f);g&&(d.handleEvent?d.handleEvent(g):d(g))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(d,h),r.apply(this,[u,h])};const c=a.removeEventListener;a.removeEventListener=function(u,d){if(u!==e||!this._eventMap||!this._eventMap[e])return c.apply(this,arguments);if(!this._eventMap[e].has(d))return c.apply(this,arguments);const h=this._eventMap[e].get(d);return this._eventMap[e].delete(d),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[u,h])},Object.defineProperty(a,"on"+e,{get(){return this["_on"+e]},set(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}function jA(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(PS=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function VA(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(NS=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function LS(){if(typeof window=="object"){if(PS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gm(n,e){NS&&console.warn(n+" is deprecated, please use "+e+" instead.")}function FA(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:i}=n;if(i.userAgentData&&i.userAgentData.brands){const a=i.userAgentData.brands.find(r=>r.brand==="Chromium");if(a)return{browser:"chrome",version:parseInt(a.version,10)}}if(i.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ro(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ro(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ro(i.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=ro(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function V0(n){return Object.prototype.toString.call(n)==="[object Object]"}function IS(n){return V0(n)?Object.keys(n).reduce(function(e,i){const a=V0(n[i]),r=a?IS(n[i]):n[i],c=a&&!Object.keys(r).length;return r===void 0||c?e:Object.assign(e,{[i]:r})},{}):n}function hf(n,e,i){!e||i.has(e.id)||(i.set(e.id,e),Object.keys(e).forEach(a=>{a.endsWith("Id")?hf(n,n.get(e[a]),i):a.endsWith("Ids")&&e[a].forEach(r=>{hf(n,n.get(r),i)})}))}function F0(n,e,i){const a=i?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const c=[];return n.forEach(u=>{u.type==="track"&&u.trackIdentifier===e.id&&c.push(u)}),c.forEach(u=>{n.forEach(d=>{d.type===a&&d.trackId===u.id&&hf(n,d,r)})}),r}const z0=LS;function US(n,e){const i=n&&n.navigator;if(!i.mediaDevices)return;const a=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(f=>{if(f==="require"||f==="advanced"||f==="mediaSource")return;const g=typeof d[f]=="object"?d[f]:{ideal:d[f]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const v=function(b,T){return b?b+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(g.ideal!==void 0){h.optional=h.optional||[];let b={};typeof g.ideal=="number"?(b[v("min",f)]=g.ideal,h.optional.push(b),b={},b[v("max",f)]=g.ideal,h.optional.push(b)):(b[v("",f)]=g.ideal,h.optional.push(b))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[v("",f)]=g.exact):["min","max"].forEach(b=>{g[b]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[v(b,f)]=g[b])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},r=function(d,h){if(e.version>=61)return h(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const f=function(g,v,b){v in g&&!(b in g)&&(g[b]=g[v],delete g[v])};d=JSON.parse(JSON.stringify(d)),f(d.audio,"autoGainControl","googAutoGainControl"),f(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=a(d.audio)}if(d&&typeof d.video=="object"){let f=d.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const g=e.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete d.video.facingMode;let v;if(f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:(f.exact==="user"||f.ideal==="user")&&(v=["front"]),v)return i.mediaDevices.enumerateDevices().then(b=>{b=b.filter(C=>C.kind==="videoinput");let T=b.find(C=>v.some(E=>C.label.toLowerCase().includes(E)));return!T&&b.length&&v.includes("back")&&(T=b[b.length-1]),T&&(d.video.deviceId=f.exact?{exact:T.deviceId}:{ideal:T.deviceId}),d.video=a(d.video),z0("chrome: "+JSON.stringify(d)),h(d)})}d.video=a(d.video)}return z0("chrome: "+JSON.stringify(d)),h(d)},c=function(d){return e.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,h,f){r(d,g=>{i.webkitGetUserMedia(g,h,v=>{f&&f(c(v))})})};if(i.getUserMedia=u.bind(i),i.mediaDevices.getUserMedia){const d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(h){return r(h,f=>d(f).then(g=>{if(f.audio&&!g.getAudioTracks().length||f.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(c(g))))}}}function BS(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function jS(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",r=>{let c;n.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(d=>d.track&&d.track.id===r.track.id):c={track:r.track};const u=new Event("track");u.track=r.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[a.stream],this.dispatchEvent(u)}),a.stream.getTracks().forEach(r=>{let c;n.RTCPeerConnection.prototype.getReceivers?c=this.getReceivers().find(d=>d.track&&d.track.id===r.id):c={track:r};const u=new Event("track");u.track=r,u.receiver=c,u.transceiver={receiver:c},u.streams=[a.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Ka(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function VS(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(r,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=r.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:r}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(d,h){let f=r.apply(this,arguments);return f||(f=e(this,d),this._senders.push(f)),f};const c=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(d){c.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(e(this,u))})};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(u=>{const d=this._senders.find(h=>h.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(r=>r._pc=this),a},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function FS(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const a=n.RTCPeerConnection.prototype.addTrack;a&&(n.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>F0(u,c.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(c=>c._pc=this),r}),Ka(n,"track",a=>(a.receiver._pc=a.srcElement,a)),n.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(c=>F0(c,r.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const a=arguments[0];let r,c,u;return this.getSenders().forEach(d=>{d.track===a&&(r?u=!0:r=d)}),this.getReceivers().forEach(d=>(d.track===a&&(c?u=!0:c=d),d.track===a)),u||r&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function zS(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=e.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(f=>{if(this.getSenders().find(v=>v.track===f))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();i.apply(this,arguments);const h=this.getSenders().filter(f=>d.indexOf(f)===-1);this._shimmedLocalStreams[u.id]=[u].concat(h)};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(u);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),r.apply(this,arguments)}}function qS(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return zS(n);const i=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const a=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(T=>T.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new n.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}a.apply(this,[g])};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},n.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(E=>E===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[v.id];if(C)C.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new n.MediaStream([g]);this._streams[v.id]=E,this._reverseStreams[E.id]=v,this.addStream(E)}return this.getSenders().find(E=>E.track===g)};function c(f,g){let v=g.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const T=f._reverseStreams[b],C=f._streams[T.id];v=v.replace(new RegExp(C.id,"g"),T.id)}),new RTCSessionDescription({type:g.type,sdp:v})}function u(f,g){let v=g.sdp;return Object.keys(f._reverseStreams||[]).forEach(b=>{const T=f._reverseStreams[b],C=f._streams[T.id];v=v.replace(new RegExp(T.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}["createOffer","createAnswer"].forEach(function(f){const g=n.RTCPeerConnection.prototype[f],v={[f](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[C=>{const E=c(this,C);b[0].apply(null,[E])},C=>{b[1]&&b[1].apply(null,C)},arguments[2]]):g.apply(this,arguments).then(C=>c(this,C))}};n.RTCPeerConnection.prototype[f]=v[f]});const d=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:c(this,f)}}),n.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let b;Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(E=>g.track===E)&&(b=this._streams[T])}),b&&(b.getTracks().length===1?this.removeStream(this._reverseStreams[b.id]):b.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ff(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=n.RTCPeerConnection.prototype[i],r={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=r[i]})}function HS(n,e){Ka(n,"negotiationneeded",i=>{const a=i.target;if(!((e.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")&&a.signalingState!=="stable"))return i})}var q0=Object.freeze({__proto__:null,fixNegotiationNeeded:HS,shimAddTrackRemoveTrack:qS,shimAddTrackRemoveTrackWithNative:zS,shimGetSendersWithDtmf:VS,shimGetUserMedia:US,shimMediaStream:BS,shimOnTrack:jS,shimPeerConnection:ff,shimSenderReceiverGetStats:FS});function GS(n,e){const i=n&&n.navigator,a=n&&n.MediaStreamTrack;if(i.getUserMedia=function(r,c,u){gm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(r).then(c,u)},!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const r=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])},c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),r(u.audio,"autoGainControl","mozAutoGainControl"),r(u.audio,"noiseSuppression","mozNoiseSuppression")),c(u)},a&&a.prototype.getSettings){const u=a.prototype.getSettings;a.prototype.getSettings=function(){const d=u.apply(this,arguments);return r(d,"mozAutoGainControl","autoGainControl"),r(d,"mozNoiseSuppression","noiseSuppression"),d}}if(a&&a.prototype.applyConstraints){const u=a.prototype.applyConstraints;a.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),r(d,"autoGainControl","mozAutoGainControl"),r(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function zA(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(a){if(!(a&&a.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return a.video===!0?a.video={mediaSource:e}:a.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(a)})}function KS(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mf(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const c=n.RTCPeerConnection.prototype[r],u={[r](){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};n.RTCPeerConnection.prototype[r]=u[r]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[c,u,d]=arguments;return a.apply(this,[c||null]).then(h=>{if(e.version<53&&!u)try{h.forEach(f=>{f.type=i[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;h.forEach((g,v)=>{h.set(v,Object.assign({},g,{type:i[g.type]||g.type}))})}return h}).then(u,d)}}function YS(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(c=>c._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function XS(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=e.apply(this,[]);return a.forEach(r=>r._pc=this),a}),Ka(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function QS(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(i){gm("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function JS(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function WS(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const r=a.length>0;r&&a.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=e.apply(this,arguments);if(r){const{sender:u}=c,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=a,u.sendEncodings=a,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function ZS(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const a=e.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function $S(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function eC(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var H0=Object.freeze({__proto__:null,shimAddTransceiver:WS,shimCreateAnswer:eC,shimCreateOffer:$S,shimGetDisplayMedia:zA,shimGetParameters:ZS,shimGetUserMedia:GS,shimOnTrack:KS,shimPeerConnection:mf,shimRTCDataChannel:JS,shimReceiverGetStats:XS,shimRemoveStream:QS,shimSenderGetStats:YS});function tC(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(r=>e.call(this,r,a)),a.getVideoTracks().forEach(r=>e.call(this,r,a))},n.RTCPeerConnection.prototype.addTrack=function(a){for(var r=arguments.length,c=new Array(r>1?r-1:0),u=1;u<r;u++)c[u-1]=arguments[u];return c&&c.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(i);if(a===-1)return;this._localStreams.splice(a,1);const r=i.getTracks();this.getSenders().forEach(c=>{r.includes(c.track)&&this.removeTrack(c)})})}}function nC(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(c=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(c)>=0)return;a._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,a.dispatchEvent(u)})}),e.apply(a,arguments)}}}function iC(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,i=e.createOffer,a=e.createAnswer,r=e.setLocalDescription,c=e.setRemoteDescription,u=e.addIceCandidate;e.createOffer=function(f,g){const v=arguments.length>=2?arguments[2]:arguments[0],b=i.apply(this,[v]);return g?(b.then(f,g),Promise.resolve()):b},e.createAnswer=function(f,g){const v=arguments.length>=2?arguments[2]:arguments[0],b=a.apply(this,[v]);return g?(b.then(f,g),Promise.resolve()):b};let d=function(h,f,g){const v=r.apply(this,[h]);return g?(v.then(f,g),Promise.resolve()):v};e.setLocalDescription=d,d=function(h,f,g){const v=c.apply(this,[h]);return g?(v.then(f,g),Promise.resolve()):v},e.setRemoteDescription=d,d=function(h,f,g){const v=u.apply(this,[h]);return g?(v.then(f,g),Promise.resolve()):v},e.addIceCandidate=d}function aC(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const i=e.mediaDevices,a=i.getUserMedia.bind(i);e.mediaDevices.getUserMedia=r=>a(sC(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(a,r,c){e.mediaDevices.getUserMedia(a).then(r,c)}).bind(e))}function sC(n){return n&&n.video!==void 0?Object.assign({},n,{video:IS(n.video)}):n}function rC(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(a,r){if(a&&a.iceServers){const c=[];for(let u=0;u<a.iceServers.length;u++){let d=a.iceServers[u];d.urls===void 0&&d.url?(gm("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,c.push(d)):c.push(a.iceServers[u])}a.iceServers=c}return new e(a,r)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function oC(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cC(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(a){if(a){typeof a.offerToReceiveAudio<"u"&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const r=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):a.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof a.offerToReceiveVideo<"u"&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):a.offerToReceiveVideo===!0&&!c&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function lC(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var G0=Object.freeze({__proto__:null,shimAudioContext:lC,shimCallbacksAPI:iC,shimConstraints:sC,shimCreateOfferLegacy:cC,shimGetUserMedia:aC,shimLocalStreamsAPI:tC,shimRTCIceServerUrls:rC,shimRemoteStreamsAPI:nC,shimTrackEventTransceiver:oC}),wh={exports:{}},K0;function qA(){return K0||(K0=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(i){return i.trim().split(`
`).map(a=>a.trim())},e.splitSections=function(i){return i.split(`
m=`).map((r,c)=>(c>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(i){const a=e.splitSections(i);return a&&a[0]},e.getMediaSections=function(i){const a=e.splitSections(i);return a.shift(),a},e.matchPrefix=function(i,a){return e.splitLines(i).filter(r=>r.indexOf(a)===0)},e.parseCandidate=function(i){let a;i.indexOf("a=candidate:")===0?a=i.substring(12).split(" "):a=i.substring(10).split(" ");const r={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let c=8;c<a.length;c+=2)switch(a[c]){case"raddr":r.relatedAddress=a[c+1];break;case"rport":r.relatedPort=parseInt(a[c+1],10);break;case"tcptype":r.tcpType=a[c+1];break;case"ufrag":r.ufrag=a[c+1],r.usernameFragment=a[c+1];break;default:r[a[c]]===void 0&&(r[a[c]]=a[c+1]);break}return r},e.writeCandidate=function(i){const a=[];a.push(i.foundation);const r=i.component;r==="rtp"?a.push(1):r==="rtcp"?a.push(2):a.push(r),a.push(i.protocol.toUpperCase()),a.push(i.priority),a.push(i.address||i.ip),a.push(i.port);const c=i.type;return a.push("typ"),a.push(c),c!=="host"&&i.relatedAddress&&i.relatedPort&&(a.push("raddr"),a.push(i.relatedAddress),a.push("rport"),a.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(a.push("ufrag"),a.push(i.usernameFragment||i.ufrag)),"candidate:"+a.join(" ")},e.parseIceOptions=function(i){return i.substring(14).split(" ")},e.parseRtpMap=function(i){let a=i.substring(9).split(" ");const r={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),r.name=a[0],r.clockRate=parseInt(a[1],10),r.channels=a.length===3?parseInt(a[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(i){let a=i.payloadType;i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType);const r=i.channels||i.numChannels||1;return"a=rtpmap:"+a+" "+i.name+"/"+i.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(i){const a=i.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},e.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},e.parseFmtp=function(i){const a={};let r;const c=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<c.length;u++)r=c[u].trim().split("="),a[r[0].trim()]=r[1];return a},e.writeFmtp=function(i){let a="",r=i.payloadType;if(i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const c=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?c.push(u+"="+i.parameters[u]):c.push(u)}),a+="a=fmtp:"+r+" "+c.join(";")+`\r
`}return a},e.parseRtcpFb=function(i){const a=i.substring(i.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},e.writeRtcpFb=function(i){let a="",r=i.payloadType;return i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(c=>{a+="a=rtcp-fb:"+r+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),a},e.parseSsrcMedia=function(i){const a=i.indexOf(" "),r={ssrc:parseInt(i.substring(7,a),10)},c=i.indexOf(":",a);return c>-1?(r.attribute=i.substring(a+1,c),r.value=i.substring(c+1)):r.attribute=i.substring(a+1),r},e.parseSsrcGroup=function(i){const a=i.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(r=>parseInt(r,10))}},e.getMid=function(i){const a=e.matchPrefix(i,"a=mid:")[0];if(a)return a.substring(6)},e.parseFingerprint=function(i){const a=i.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},e.getDtlsParameters=function(i,a){return{role:"auto",fingerprints:e.matchPrefix(i+a,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(i,a){let r="a=setup:"+a+`\r
`;return i.fingerprints.forEach(c=>{r+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),r},e.parseCryptoLine=function(i){const a=i.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},e.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?e.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const a=i.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},e.getCryptoParameters=function(i,a){return e.matchPrefix(i+a,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(i,a){const r=e.matchPrefix(i+a,"a=ice-ufrag:")[0],c=e.matchPrefix(i+a,"a=ice-pwd:")[0];return r&&c?{usernameFragment:r.substring(12),password:c.substring(10)}:null},e.writeIceParameters=function(i){let a="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(a+=`a=ice-lite\r
`),a},e.parseRtpParameters=function(i){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=e.splitLines(i)[0].split(" ");a.profile=c[2];for(let d=3;d<c.length;d++){const h=c[d],f=e.matchPrefix(i,"a=rtpmap:"+h+" ")[0];if(f){const g=e.parseRtpMap(f),v=e.matchPrefix(i,"a=fmtp:"+h+" ");switch(g.parameters=v.length?e.parseFmtp(v[0]):{},g.rtcpFeedback=e.matchPrefix(i,"a=rtcp-fb:"+h+" ").map(e.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase());break}}}e.matchPrefix(i,"a=extmap:").forEach(d=>{a.headerExtensions.push(e.parseExtmap(d))});const u=e.matchPrefix(i,"a=rtcp-fb:* ").map(e.parseRtcpFb);return a.codecs.forEach(d=>{u.forEach(h=>{d.rtcpFeedback.find(g=>g.type===h.type&&g.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),a},e.writeRtpDescription=function(i,a){let r="";r+="m="+i+" ",r+=a.codecs.length>0?"9":"0",r+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=a.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(u=>{r+=e.writeRtpMap(u),r+=e.writeFmtp(u),r+=e.writeRtcpFb(u)});let c=0;return a.codecs.forEach(u=>{u.maxptime>c&&(c=u.maxptime)}),c>0&&(r+="a=maxptime:"+c+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(u=>{r+=e.writeExtmap(u)}),r},e.parseRtpEncodingParameters=function(i){const a=[],r=e.parseRtpParameters(i),c=r.fecMechanisms.indexOf("RED")!==-1,u=r.fecMechanisms.indexOf("ULPFEC")!==-1,d=e.matchPrefix(i,"a=ssrc:").map(b=>e.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),h=d.length>0&&d[0].ssrc;let f;const g=e.matchPrefix(i,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));g.length>0&&g[0].length>1&&g[0][0]===h&&(f=g[0][1]),r.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let T={ssrc:h,codecPayloadType:parseInt(b.parameters.apt,10)};h&&f&&(T.rtx={ssrc:f}),a.push(T),c&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:h,mechanism:u?"red+ulpfec":"red"},a.push(T))}}),a.length===0&&h&&a.push({ssrc:h});let v=e.matchPrefix(i,"b=");return v.length&&(v[0].indexOf("b=TIAS:")===0?v=parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?v=parseInt(v[0].substring(5),10)*1e3*.95-2e3*8:v=void 0,a.forEach(b=>{b.maxBitrate=v})),a},e.parseRtcpParameters=function(i){const a={},r=e.matchPrefix(i,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];r&&(a.cname=r.value,a.ssrc=r.ssrc);const c=e.matchPrefix(i,"a=rtcp-rsize");a.reducedSize=c.length>0,a.compound=c.length===0;const u=e.matchPrefix(i,"a=rtcp-mux");return a.mux=u.length>0,a},e.writeRtcpParameters=function(i){let a="";return i.reducedSize&&(a+=`a=rtcp-rsize\r
`),i.mux&&(a+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(a+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),a},e.parseMsid=function(i){let a;const r=e.matchPrefix(i,"a=msid:");if(r.length===1)return a=r[0].substring(7).split(" "),{stream:a[0],track:a[1]};const c=e.matchPrefix(i,"a=ssrc:").map(u=>e.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(c.length>0)return a=c[0].value.split(" "),{stream:a[0],track:a[1]}},e.parseSctpDescription=function(i){const a=e.parseMLine(i),r=e.matchPrefix(i,"a=max-message-size:");let c;r.length>0&&(c=parseInt(r[0].substring(19),10)),isNaN(c)&&(c=65536);const u=e.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:a.fmt,maxMessageSize:c};const d=e.matchPrefix(i,"a=sctpmap:");if(d.length>0){const h=d[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},e.writeSctpDescription=function(i,a){let r=[];return i.protocol!=="DTLS/SCTP"?r=["m="+i.kind+" 9 "+i.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:r=["m="+i.kind+" 9 "+i.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&r.push("a=max-message-size:"+a.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(i,a,r){let c;const u=a!==void 0?a:2;return i?c=i:c=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+c+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(i,a){const r=e.splitLines(i);for(let c=0;c<r.length;c++)switch(r[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[c].substring(2)}return a?e.getDirection(a):"sendrecv"},e.getKind=function(i){return e.splitLines(i)[0].split(" ")[0].substring(2)},e.isRejected=function(i){return i.split(" ",2)[1]==="0"},e.parseMLine=function(i){const r=e.splitLines(i)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(i){const r=e.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const a=e.splitLines(i);for(let r=0;r<a.length;r++)if(a[r].length<2||a[r].charAt(1)!=="=")return!1;return!0},n.exports=e})(wh)),wh.exports}var uC=qA(),qs=OA(uC),HA=$_({__proto__:null,default:qs},[uC]);function fl(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const r=new e(a),c=qs.parseCandidate(a.candidate);for(const u in c)u in r||Object.defineProperty(r,u,{value:c[u]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(a)},n.RTCIceCandidate.prototype=e.prototype,Ka(n,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new n.RTCIceCandidate(i.candidate),writable:"false"}),i))}function pf(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Ka(n,"icecandidate",e=>{if(e.candidate){const i=qs.parseCandidate(e.candidate.candidate);i.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return e})}function ml(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(d){if(!d||!d.sdp)return!1;const h=qs.splitSections(d.sdp);return h.shift(),h.some(f=>{const g=qs.parseMLine(f);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},a=function(d){const h=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!==f?-1:f},r=function(d){let h=65536;return e.browser==="firefox"&&(e.version<57?d===-1?h=16384:h=2147483637:e.version<60?h=e.version===57?65535:65536:h=2147483637),h},c=function(d,h){let f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);const g=qs.matchPrefix(d.sdp,"a=max-message-size:");return g.length>0?f=parseInt(g[0].substring(19),10):e.browser==="firefox"&&h!==-1&&(f=2147483637),f},u=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const h=a(arguments[0]),f=r(h),g=c(arguments[0],h);let v;f===0&&g===0?v=Number.POSITIVE_INFINITY:f===0||g===0?v=Math.max(f,g):v=Math.min(f,g);const b={};Object.defineProperty(b,"maxMessageSize",{get(){return v}}),this._sctp=b}return u.apply(this,arguments)}}function pl(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(a,r){const c=a.send;a.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(a.readyState==="open"&&r.sctp&&h>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}const i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const r=i.apply(this,arguments);return e(r,this),r},Ka(n,"datachannel",a=>(e(a.channel,a.target),a))}function gf(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const a=e[i];e[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const c=r.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;const u=new Event("connectionstatechange",r);c.dispatchEvent(u)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function vf(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=r.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&r instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:r.type,sdp:c}):r.sdp=c}return i.apply(this,arguments)}}function gl(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const i=n.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function vl(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const i=n.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return i.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?i.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>i.apply(this,[u]))})}var GA=Object.freeze({__proto__:null,removeExtmapAllowMixed:vf,shimAddIceCandidateNullOrEmpty:gl,shimConnectionState:gf,shimMaxMessageSize:ml,shimParameterlessSetLocalDescription:vl,shimRTCIceCandidate:fl,shimRTCIceCandidateRelayProtocol:pf,shimSendThrowTypeError:pl});function KA(){let{window:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=LS,a=FA(n),r={browserDetails:a,commonShim:GA,extractVersion:ro,disableLog:jA,disableWarnings:VA,sdp:HA};switch(a.browser){case"chrome":if(!q0||!ff||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),r;if(a.version===null)return i("Chrome shim can not determine version, not shimming."),r;i("adapter.js shimming chrome."),r.browserShim=q0,gl(n,a),vl(n),US(n,a),BS(n),ff(n,a),jS(n),qS(n,a),VS(n),FS(n),HS(n,a),fl(n),pf(n),gf(n),ml(n,a),pl(n),vf(n,a);break;case"firefox":if(!H0||!mf||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),r;i("adapter.js shimming firefox."),r.browserShim=H0,gl(n,a),vl(n),GS(n,a),mf(n,a),KS(n),QS(n),YS(n),XS(n),JS(n),WS(n),ZS(n),$S(n),eC(n),fl(n),gf(n),ml(n,a),pl(n);break;case"safari":if(!G0||!e.shimSafari)return i("Safari shim is not included in this adapter release."),r;i("adapter.js shimming safari."),r.browserShim=G0,gl(n,a),vl(n),rC(n),cC(n),iC(n),tC(n),nC(n),oC(n),aC(n),lC(n),fl(n),pf(n),ml(n,a),pl(n),vf(n,a);break;default:i("Unsupported browser!");break}return r}KA({window:typeof window>"u"?void 0:window});const YA=10,eo="lk_e2ee",XA="LKFrameEncryptionKey",QA={sharedKey:!1,ratchetSalt:XA,ratchetWindowSize:8,failureTolerance:YA,keyringSize:16};var ra;(function(n){n.SetKey="setKey",n.RatchetRequest="ratchetRequest",n.KeyRatcheted="keyRatcheted"})(ra||(ra={}));var Y0;(function(n){n.KeyRatcheted="keyRatcheted"})(Y0||(Y0={}));var aa;(function(n){n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError"})(aa||(aa={}));var X0;(function(n){n.Error="cryptorError"})(X0||(X0={}));function JA(){return WA()||yf()}function yf(){return typeof window.RTCRtpScriptTransform<"u"}function WA(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function ZA(n){var e,i,a,r,c;if(((e=n.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((i=n.value)===null||i===void 0?void 0:i.case)!=="metrics"&&((a=n.value)===null||a===void 0?void 0:a.case)!=="speaker"&&((r=n.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((c=n.value)===null||c===void 0?void 0:c.case)!=="encryptedPacket")return new uS({value:n.value})}class gL extends Wn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,a,r)=>{Te.debug("key ratcheted event received",{ratchetResult:i,participantId:a,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},QA),e),this.on(ra.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,i,a){const r={key:e,participantIdentity:i,keyIndex:a};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(a??0),r),this.emit(ra.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,i){this.emit(ra.RatchetRequest,e,i)}}class Ai extends Error{constructor(e,i){super(i||"an error has occured"),this.name="LiveKitError",this.code=e}}var ge;(function(n){n[n.NotAllowed=0]="NotAllowed",n[n.ServerUnreachable=1]="ServerUnreachable",n[n.InternalError=2]="InternalError",n[n.Cancelled=3]="Cancelled",n[n.LeaveRequest=4]="LeaveRequest",n[n.Timeout=5]="Timeout"})(ge||(ge={}));class Oe extends Ai{constructor(e,i,a,r){super(1,e),this.name="ConnectionError",this.status=a,this.reason=i,this.context=r,this.reasonName=ge[i]}}class vm extends Ai{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ci extends Ai{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class $A extends Ai{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Tt extends Ai{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class bf extends Ai{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Q0 extends Ai{constructor(e,i){super(15,e),this.name="PublishTrackError",this.status=i}}class J0 extends Ai{constructor(e,i){super(15,e),this.reason=i,this.reasonName=typeof i=="string"?i:pm[i]}}var Bt;(function(n){n[n.AlreadyOpened=0]="AlreadyOpened",n[n.AbnormalEnd=1]="AbnormalEnd",n[n.DecodeFailed=2]="DecodeFailed",n[n.LengthExceeded=3]="LengthExceeded",n[n.Incomplete=4]="Incomplete",n[n.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",n[n.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Bt||(Bt={}));class _n extends Ai{constructor(e,i){super(16,e),this.name="DataStreamError",this.reason=i,this.reasonName=Bt[i]}}var Ol;(function(n){n.PermissionDenied="PermissionDenied",n.NotFound="NotFound",n.DeviceInUse="DeviceInUse",n.Other="Other"})(Ol||(Ol={}));(function(n){function e(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?n.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?n.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?n.DeviceInUse:n.Other}n.getFailure=e})(Ol||(Ol={}));var W0;(function(n){n[n.InvalidKey=0]="InvalidKey",n[n.MissingKey=1]="MissingKey",n[n.InternalError=2]="InternalError"})(W0||(W0={}));var J;(function(n){n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting",n.Reconnected="reconnected",n.Disconnected="disconnected",n.ConnectionStateChanged="connectionStateChanged",n.Moved="moved",n.MediaDevicesChanged="mediaDevicesChanged",n.ParticipantConnected="participantConnected",n.ParticipantDisconnected="participantDisconnected",n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalAudioSilenceDetected="localAudioSilenceDetected",n.ActiveSpeakersChanged="activeSpeakersChanged",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.ParticipantAttributesChanged="participantAttributesChanged",n.ParticipantActive="participantActive",n.RoomMetadataChanged="roomMetadataChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.AudioPlaybackStatusChanged="audioPlaybackChanged",n.VideoPlaybackStatusChanged="videoPlaybackChanged",n.MediaDevicesError="mediaDevicesError",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.SignalConnected="signalConnected",n.RecordingStatusChanged="recordingStatusChanged",n.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",n.EncryptionError="encryptionError",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ActiveDeviceChanged="activeDeviceChanged",n.ChatMessage="chatMessage",n.LocalTrackSubscribed="localTrackSubscribed",n.MetricsReceived="metricsReceived"})(J||(J={}));var ne;(function(n){n.TrackPublished="trackPublished",n.TrackSubscribed="trackSubscribed",n.TrackSubscriptionFailed="trackSubscriptionFailed",n.TrackUnpublished="trackUnpublished",n.TrackUnsubscribed="trackUnsubscribed",n.TrackMuted="trackMuted",n.TrackUnmuted="trackUnmuted",n.LocalTrackPublished="localTrackPublished",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackCpuConstrained="localTrackCpuConstrained",n.LocalSenderCreated="localSenderCreated",n.ParticipantMetadataChanged="participantMetadataChanged",n.ParticipantNameChanged="participantNameChanged",n.DataReceived="dataReceived",n.SipDTMFReceived="sipDTMFReceived",n.TranscriptionReceived="transcriptionReceived",n.IsSpeakingChanged="isSpeakingChanged",n.ConnectionQualityChanged="connectionQualityChanged",n.TrackStreamStateChanged="trackStreamStateChanged",n.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",n.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",n.TrackCpuConstrained="trackCpuConstrained",n.MediaDevicesError="mediaDevicesError",n.AudioStreamAcquired="audioStreamAcquired",n.ParticipantPermissionsChanged="participantPermissionsChanged",n.PCTrackAdded="pcTrackAdded",n.AttributesChanged="attributesChanged",n.LocalTrackSubscribed="localTrackSubscribed",n.ChatMessage="chatMessage",n.Active="active"})(ne||(ne={}));var te;(function(n){n.TransportsCreated="transportsCreated",n.Connected="connected",n.Disconnected="disconnected",n.Resuming="resuming",n.Resumed="resumed",n.Restarting="restarting",n.Restarted="restarted",n.SignalResumed="signalResumed",n.SignalRestarted="signalRestarted",n.Closing="closing",n.MediaTrackAdded="mediaTrackAdded",n.ActiveSpeakersUpdate="activeSpeakersUpdate",n.DataPacketReceived="dataPacketReceived",n.RTPVideoMapUpdate="rtpVideoMapUpdate",n.DCBufferStatusChanged="dcBufferStatusChanged",n.ParticipantUpdate="participantUpdate",n.RoomUpdate="roomUpdate",n.SpeakersChanged="speakersChanged",n.StreamStateChanged="streamStateChanged",n.ConnectionQualityUpdate="connectionQualityUpdate",n.SubscriptionError="subscriptionError",n.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",n.RemoteMute="remoteMute",n.SubscribedQualityUpdate="subscribedQualityUpdate",n.LocalTrackUnpublished="localTrackUnpublished",n.LocalTrackSubscribed="localTrackSubscribed",n.Offline="offline",n.SignalRequestResponse="signalRequestResponse",n.SignalConnected="signalConnected",n.RoomMoved="roomMoved"})(te||(te={}));var ee;(function(n){n.Message="message",n.Muted="muted",n.Unmuted="unmuted",n.Restarted="restarted",n.Ended="ended",n.Subscribed="subscribed",n.Unsubscribed="unsubscribed",n.CpuConstrained="cpuConstrained",n.UpdateSettings="updateSettings",n.UpdateSubscription="updateSubscription",n.AudioPlaybackStarted="audioPlaybackStarted",n.AudioPlaybackFailed="audioPlaybackFailed",n.AudioSilenceDetected="audioSilenceDetected",n.VisibilityChanged="visibilityChanged",n.VideoDimensionsChanged="videoDimensionsChanged",n.VideoPlaybackStarted="videoPlaybackStarted",n.VideoPlaybackFailed="videoPlaybackFailed",n.ElementAttached="elementAttached",n.ElementDetached="elementDetached",n.UpstreamPaused="upstreamPaused",n.UpstreamResumed="upstreamResumed",n.SubscriptionPermissionChanged="subscriptionPermissionChanged",n.SubscriptionStatusChanged="subscriptionStatusChanged",n.SubscriptionFailed="subscriptionFailed",n.TrackProcessorUpdate="trackProcessorUpdate",n.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",n.TranscriptionReceived="transcriptionReceived",n.TimeSyncUpdate="timeSyncUpdate",n.PreConnectBufferFlushed="preConnectBufferFlushed"})(ee||(ee={}));function ew(n){return typeof n>"u"?n:typeof structuredClone=="function"?typeof n=="object"&&n!==null?structuredClone(Object.assign({},n)):structuredClone(n):JSON.parse(JSON.stringify(n))}const tw=/version\/(\d+(\.?_?\d+)+)/i;let Mh;function $t(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const i=navigator.userAgent.toLowerCase();if(Mh===void 0||e){const a=nw.find(r=>{let{test:c}=r;return c.test(i)});Mh=a?.describe(i)}return Mh}const nw=[{test:/firefox|iceweasel|fxios/i,describe(n){return{name:"Firefox",version:yl(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Dh(n)}}},{test:/chrom|crios|crmo/i,describe(n){return{name:"Chrome",version:yl(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n),os:n.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Dh(n)}}},{test:/safari|applewebkit/i,describe(n){return{name:"Safari",version:yl(tw,n),os:n.includes("mobile/")?"iOS":"macOS",osVersion:Dh(n)}}}];function yl(n,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const a=e.match(n);return a&&a.length>=i&&a[i]||""}function Dh(n){return n.includes("mac os")?yl(/\(.+?(\d+_\d+(:?_\d+)?)/,n,1).replace(/_/g,"."):void 0}var iw="2.16.0";const aw=iw,sw=16;class xt{}xt.setTimeout=function(){return setTimeout(...arguments)};xt.setInterval=function(){return setInterval(...arguments)};xt.clearTimeout=function(){return clearTimeout(...arguments)};xt.clearInterval=function(){return clearInterval(...arguments)};const rw=5e3,to=[];var dn;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH"})(dn||(dn={}));class X extends Wn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=X.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Te,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),rw):this.handleAppVisibilityChanged()},this.log=Ei((r=a.loggerName)!==null&&r!==void 0?r:jn.Track),this.loggerContextCb=a.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=X.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Re(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let i="audio";this.kind===X.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===X.Kind.Video&&this.addAppVisibilityListener(),e||(i==="audio"&&(to.forEach(c=>{c.parentElement===null&&!e&&(e=c)}),e&&to.splice(to.indexOf(e),1)),e||(e=document.createElement(i))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ns(this.mediaStreamTrack,e);const a=e.srcObject.getTracks(),r=a.some(c=>c.kind==="audio");return e.play().then(()=>{this.emit(r?ee.AudioPlaybackStarted:ee.VideoPlaybackStarted)}).catch(c=>{c.name==="NotAllowedError"?this.emit(r?ee.AudioPlaybackFailed:ee.VideoPlaybackFailed,c):c.name==="AbortError"?Te.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Te.warn("could not playback ".concat(r?"audio":"video"),c),r&&e&&a.some(u=>u.kind==="video")&&c.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ee.ElementAttached,e),e}detach(e){try{if(e){Hs(this.mediaStreamTrack,e);const a=this.attachedElements.indexOf(e);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(e),this.emit(ee.ElementDetached,e)),e}const i=[];return this.attachedElements.forEach(a=>{Hs(this.mediaStreamTrack,a),i.push(a),this.recycleElement(a),this.emit(ee.ElementDetached,a)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Ei(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let i=!0;e.pause(),to.forEach(a=>{a.parentElement||(i=!1)}),i&&to.push(e)}}handleAppVisibilityChanged(){return k(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===X.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Wt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Wt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ns(n,e){let i;e.srcObject instanceof MediaStream?i=e.srcObject:i=new MediaStream;let a;n.kind==="audio"?a=i.getAudioTracks():a=i.getVideoTracks(),a.includes(n)||(a.forEach(r=>{i.removeTrack(r)}),i.addTrack(n)),(!Ga()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=i.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==i&&(e.srcObject=i,(Ga()||Ha())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=i,e.play().catch(()=>{})},0))}function Hs(n,e){if(e.srcObject instanceof MediaStream){const i=e.srcObject;i.removeTrack(n),i.getTracks().length>0?e.srcObject=i:e.srcObject=null}}(function(n){let e;(function(f){f.Audio="audio",f.Video="video",f.Unknown="unknown"})(e=n.Kind||(n.Kind={}));let i;(function(f){f.Camera="camera",f.Microphone="microphone",f.ScreenShare="screen_share",f.ScreenShareAudio="screen_share_audio",f.Unknown="unknown"})(i=n.Source||(n.Source={}));let a;(function(f){f.Active="active",f.Paused="paused",f.Unknown="unknown"})(a=n.StreamState||(n.StreamState={}));function r(f){switch(f){case e.Audio:return Ln.AUDIO;case e.Video:return Ln.VIDEO;default:return Ln.DATA}}n.kindToProto=r;function c(f){switch(f){case Ln.AUDIO:return e.Audio;case Ln.VIDEO:return e.Video;default:return e.Unknown}}n.kindFromProto=c;function u(f){switch(f){case i.Camera:return yt.CAMERA;case i.Microphone:return yt.MICROPHONE;case i.ScreenShare:return yt.SCREEN_SHARE;case i.ScreenShareAudio:return yt.SCREEN_SHARE_AUDIO;default:return yt.UNKNOWN}}n.sourceToProto=u;function d(f){switch(f){case yt.CAMERA:return i.Camera;case yt.MICROPHONE:return i.Microphone;case yt.SCREEN_SHARE:return i.ScreenShare;case yt.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}n.sourceFromProto=d;function h(f){switch(f){case lf.ACTIVE:return a.Active;case lf.PAUSED:return a.Paused;default:return a.Unknown}}n.streamStateFromProto=h})(X||(X={}));class He{constructor(e,i,a,r,c){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(i!==void 0&&a!==void 0)this.width=e,this.height=i,this.aspectRatio=e/i,this.encoding={maxBitrate:a,maxFramerate:r,priority:c};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const ow=["vp8","h264"],cw=["vp8","h264","vp9","av1","h265"];function lw(n){return!!ow.find(e=>e===n)}const uw=lw;var Z0;(function(n){n[n.PREFER_REGRESSION=0]="PREFER_REGRESSION",n[n.SIMULCAST=1]="SIMULCAST",n[n.REGRESSION=2]="REGRESSION"})(Z0||(Z0={}));var Tf;(function(n){n.telephone={maxBitrate:12e3},n.speech={maxBitrate:24e3},n.music={maxBitrate:48e3},n.musicStereo={maxBitrate:64e3},n.musicHighQuality={maxBitrate:96e3},n.musicHighQualityStereo={maxBitrate:128e3}})(Tf||(Tf={}));const Co={h90:new He(160,90,9e4,20),h180:new He(320,180,16e4,20),h216:new He(384,216,18e4,20),h360:new He(640,360,45e4,20),h540:new He(960,540,8e5,25),h720:new He(1280,720,17e5,30),h1080:new He(1920,1080,3e6,30),h1440:new He(2560,1440,5e6,30),h2160:new He(3840,2160,8e6,30)},Sf={h120:new He(160,120,7e4,20),h180:new He(240,180,125e3,20),h240:new He(320,240,14e4,20),h360:new He(480,360,33e4,20),h480:new He(640,480,5e5,20),h540:new He(720,540,6e5,25),h720:new He(960,720,13e5,30),h1080:new He(1440,1080,23e5,30),h1440:new He(1920,1440,38e5,30)},ym={h360fps3:new He(640,360,2e5,3,"medium"),h360fps15:new He(640,360,4e5,15,"medium"),h720fps5:new He(1280,720,8e5,5,"medium"),h720fps15:new He(1280,720,15e5,15,"medium"),h720fps30:new He(1280,720,2e6,30,"medium"),h1080fps15:new He(1920,1080,25e5,15,"medium"),h1080fps30:new He(1920,1080,5e6,30,"medium"),original:new He(0,0,7e6,30,"medium")},dw="|",$0="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function hw(n){const e=n.split(dw);return e.length>1?[e[0],n.substr(e[0].length+1)]:[n,""]}function Pt(n){return k(this,void 0,void 0,function*(){return new Promise(e=>xt.setTimeout(e,n))})}function Cf(){return"addTransceiver"in RTCPeerConnection.prototype}function kf(){return"addTrack"in RTCPeerConnection.prototype}function fw(){if(!("getCapabilities"in RTCRtpSender)||Ga()||Ha())return!1;const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const i of n.codecs)if(i.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function mw(){if(!("getCapabilities"in RTCRtpSender)||Ha())return!1;if(Ga()){const i=$t();if(i?.version&&Jn(i.version,"16")<0||i?.os==="iOS"&&i?.osVersion&&Jn(i.osVersion,"16")<0)return!1}const n=RTCRtpSender.getCapabilities("video");let e=!1;if(n){for(const i of n.codecs)if(i.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Un(n){return n==="av1"||n==="vp9"}function Ef(n){return!document||ko()?!1:(n||(n=document.createElement("audio")),"setSinkId"in n)}function pw(){return typeof RTCPeerConnection>"u"?!1:Cf()||kf()}function Ha(){var n;return((n=$t())===null||n===void 0?void 0:n.name)==="Firefox"}function eb(){const n=$t();return!!n&&n.name==="Chrome"&&n.os!=="iOS"}function Ga(){var n;return((n=$t())===null||n===void 0?void 0:n.name)==="Safari"}function ko(){const n=$t();return n?.name==="Safari"||n?.os==="iOS"}function gw(){const n=$t();return n?.name==="Safari"&&n.version.startsWith("17.")||n?.os==="iOS"&&!!n?.osVersion&&Jn(n.osVersion,"17")>=0}function vw(n){return n||(n=$t()),n?.name==="Safari"&&Jn(n.version,"18.3")>0||n?.os==="iOS"&&!!n?.osVersion&&Jn(n.osVersion,"18.3")>0}function dC(){var n,e;return Wt()?(e=(n=navigator.userAgentData)===null||n===void 0?void 0:n.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function yw(){const n=$t(),e="17.2";if(n)return n.name!=="Safari"&&n.os!=="iOS"||n.os==="iOS"&&n.osVersion&&Jn(n.osVersion,e)>=0?!0:n.name==="Safari"&&Jn(n.version,e)>=0}function Wt(){return typeof document<"u"}function Qn(){return navigator.product=="ReactNative"}function xl(n){return n.hostname.endsWith(".livekit.cloud")||n.hostname.endsWith(".livekit.run")}function Oh(n){return xl(n)?n.hostname.split(".")[0]:null}function hC(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function fC(){if(!Qn())return;let n=hC();if(n)return n.platform}function tb(){if(Wt())return window.devicePixelRatio;if(Qn()){let n=hC();if(n)return n.devicePixelRatio}return 1}function Jn(n,e){const i=n.split("."),a=e.split("."),r=Math.min(i.length,a.length);for(let c=0;c<r;++c){const u=parseInt(i[c],10),d=parseInt(a[c],10);if(u>d)return 1;if(u<d)return-1;if(c===r-1&&u===d)return 0}return n===""&&e!==""?-1:e===""?1:i.length==a.length?0:i.length<a.length?-1:1}function bw(n){for(const e of n)e.target.handleResize(e)}function Tw(n){for(const e of n)e.target.handleVisibilityChanged(e)}let xh=null;const nb=()=>(xh||(xh=new ResizeObserver(bw)),xh);let Ph=null;const ib=()=>(Ph||(Ph=new IntersectionObserver(Tw,{root:null,rootMargin:"0px"})),Ph);function Sw(){var n;const e=new vS({sdk:yS.JS,protocol:sw,version:aw});return Qn()&&(e.os=(n=fC())!==null&&n!==void 0?n:""),e}function ab(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=n,r.height=e;const c=r.getContext("2d");c?.fillRect(0,0,r.width,r.height),a&&c&&(c.beginPath(),c.arc(n/2,e/2,50,0,Math.PI*2,!0),c.closePath(),c.fillStyle="grey",c.fill());const u=r.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=i,d}let no;function Nh(){if(!no){const n=new AudioContext,e=n.createOscillator(),i=n.createGain();i.gain.setValueAtTime(0,0);const a=n.createMediaStreamDestination();if(e.connect(i),i.connect(a),e.start(),[no]=a.stream.getAudioTracks(),!no)throw Error("Could not get empty media stream audio track");no.enabled=!1}return no.clone()}class Rn{get isResolved(){return this._isResolved}constructor(e,i){this._isResolved=!1,this.onFinally=i,this.promise=new Promise((a,r)=>k(this,void 0,void 0,function*(){this.resolve=a,this.reject=r,e&&(yield e(a,r))})).finally(()=>{var a;this._isResolved=!0,(a=this.onFinally)===null||a===void 0||a.call(this)})}}function Cw(n){return cw.includes(n)}function oa(n){if(typeof n=="string"||typeof n=="number")return n;if(Array.isArray(n))return n[0];if(n.exact!==void 0)return Array.isArray(n.exact)?n.exact[0]:n.exact;if(n.ideal!==void 0)return Array.isArray(n.ideal)?n.ideal[0]:n.ideal;throw Error("could not unwrap constraint")}function kw(n){return n.startsWith("http")?n.replace(/^(http)/,"ws"):n}function Eo(n){return n.startsWith("ws")?n.replace(/^(ws)/,"http"):n}function Ew(n,e){return n.segments.map(i=>{let{id:a,text:r,language:c,startTime:u,endTime:d,final:h}=i;var f;const g=(f=e.get(a))!==null&&f!==void 0?f:Date.now(),v=Date.now();return h?e.delete(a):e.set(a,g),{id:a,text:r,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(d.toString()),final:h,language:c,firstReceivedTime:g,lastReceivedTime:v}})}function _w(n){const{id:e,timestamp:i,message:a,editTimestamp:r}=n;return{id:e,timestamp:Number.parseInt(i.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:a}}function sb(n){switch(n.reason){case ge.LeaveRequest:return n.context;case ge.Cancelled:return Bn.CLIENT_INITIATED;case ge.NotAllowed:return Bn.USER_REJECTED;case ge.ServerUnreachable:return Bn.JOIN_FAILURE;default:return Bn.UNKNOWN_REASON}}function bl(n){return n!==void 0?Number(n):void 0}function Ia(n){return n!==void 0?BigInt(n):void 0}function Gs(n){return!!n&&!(n instanceof MediaStreamTrack)&&n.isLocal}function Kn(n){return!!n&&n.kind==X.Kind.Audio}function ha(n){return!!n&&n.kind==X.Kind.Video}function ea(n){return Gs(n)&&ha(n)}function gi(n){return Gs(n)&&Kn(n)}function _f(n){return!!n&&!n.isLocal}function Rw(n){return!!n&&!n.isLocal}function Lh(n){return _f(n)&&ha(n)}function Aw(n){return n.isLocal}function ww(n,e){const i=[];let a=new TextEncoder().encode(n);for(;a.length>e;){let r=e;for(;r>0;){const c=a[r];if(c!==void 0&&(c&192)!==128)break;r--}i.push(a.slice(0,r)),a=a.slice(r)}return a.length>0&&i.push(a),i}function Mw(n){var e;const i=n.get("Cache-Control");if(i){const a=(e=i.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(a)return parseInt(a,10)}}function mC(n,e,i){var a,r,c,u;const{optionsWithoutProcessor:d,audioProcessor:h,videoProcessor:f}=vC(n??{}),g=e?.processor,v=i?.processor,b=d??{};return b.audio===!0&&(b.audio={}),b.video===!0&&(b.video={}),b.audio&&(Rf(b.audio,e),(a=(c=b.audio).deviceId)!==null&&a!==void 0||(c.deviceId={ideal:"default"}),(h||g)&&(b.audio.processor=h??g)),b.video&&(Rf(b.video,i),(r=(u=b.video).deviceId)!==null&&r!==void 0||(u.deviceId={ideal:"default"}),(f||v)&&(b.video.processor=f??v)),b}function Rf(n,e){return Object.keys(e).forEach(i=>{n[i]===void 0&&(n[i]=e[i])}),n}function bm(n){var e,i,a,r;const c={};if(n.video)if(typeof n.video=="object"){const u={},d=u,h=n.video;Object.keys(h).forEach(f=>{switch(f){case"resolution":Rf(d,h.resolution);break;default:d[f]=h[f]}}),c.video=u,(e=(a=c.video).deviceId)!==null&&e!==void 0||(a.deviceId={ideal:"default"})}else c.video=n.video?{deviceId:{ideal:"default"}}:!1;else c.video=!1;return n.audio?typeof n.audio=="object"?(c.audio=n.audio,(i=(r=c.audio).deviceId)!==null&&i!==void 0||(r.deviceId={ideal:"default"})):c.audio={deviceId:{ideal:"default"}}:c.audio=!1,c}function pC(n){return k(this,arguments,void 0,function(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const a=gC();if(a){const r=a.createAnalyser();r.fftSize=2048;const c=r.frequencyBinCount,u=new Uint8Array(c);a.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Pt(i),r.getByteTimeDomainData(u);const h=u.some(f=>f!==128&&f!==0);return a.close(),!h}return!1})()})}function gC(){var n;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const i=new e({latencyHint:"interactive"});if(i.state==="suspended"&&typeof window<"u"&&(!((n=window.document)===null||n===void 0)&&n.body)){const a=()=>k(this,void 0,void 0,function*(){var r;try{i.state==="suspended"&&(yield i.resume())}catch(c){console.warn("Error trying to auto-resume audio context",c)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",a)}});i.addEventListener("statechange",()=>{var r;i.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",a))}),window.document.body.addEventListener("click",a)}return i}}function Dw(n){return n==="audioinput"?X.Source.Microphone:n==="videoinput"?X.Source.Camera:X.Source.Unknown}function Af(n){return n===X.Source.Microphone?"audioinput":n===X.Source.Camera?"videoinput":void 0}function Ow(n){var e,i;let a=(e=n.video)!==null&&e!==void 0?e:!0;return n.resolution&&n.resolution.width>0&&n.resolution.height>0&&(a=typeof a=="boolean"?{}:a,Ga()?a=Object.assign(Object.assign({},a),{width:{max:n.resolution.width},height:{max:n.resolution.height},frameRate:n.resolution.frameRate}):a=Object.assign(Object.assign({},a),{width:{ideal:n.resolution.width},height:{ideal:n.resolution.height},frameRate:n.resolution.frameRate})),{audio:(i=n.audio)!==null&&i!==void 0?i:!1,video:a,controller:n.controller,selfBrowserSurface:n.selfBrowserSurface,surfaceSwitching:n.surfaceSwitching,systemAudio:n.systemAudio,preferCurrentTab:n.preferCurrentTab}}function uo(n){return n.split("/")[1].toLowerCase()}function xw(n){const e=[];return n.forEach(i=>{i.track!==void 0&&e.push(new um({cid:i.track.mediaStreamID,track:i.trackInfo}))}),e}function Re(n){return"mediaStreamTrack"in n?{trackID:n.sid,source:n.source,muted:n.isMuted,enabled:n.mediaStreamTrack.enabled,kind:n.kind,streamID:n.mediaStreamID,streamTrackID:n.mediaStreamTrack.id}:{trackID:n.trackSid,enabled:n.isEnabled,muted:n.isMuted,trackInfo:Object.assign({mimeType:n.mimeType,name:n.trackName,encrypted:n.isEncrypted,kind:n.kind,source:n.source},n.track?Re(n.track):{})}}function Pw(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Nw(n,e){var i;n===void 0&&(n={}),e===void 0&&(e={});const a=[...Object.keys(e),...Object.keys(n)],r={};for(const c of a)n[c]!==e[c]&&(r[c]=(i=e[c])!==null&&i!==void 0?i:"");return r}function vC(n){const e=Object.assign({},n);let i,a;return typeof e.audio=="object"&&e.audio.processor&&(i=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(a=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:ew(e)}}function Lw(n){switch(n){case yt.CAMERA:return X.Source.Camera;case yt.MICROPHONE:return X.Source.Microphone;case yt.SCREEN_SHARE:return X.Source.ScreenShare;case yt.SCREEN_SHARE_AUDIO:return X.Source.ScreenShareAudio;default:return X.Source.Unknown}}function rb(n,e){return n.width*n.height<e.width*e.height}function Iw(n,e){var i;return(i=n.layers)===null||i===void 0?void 0:i.find(a=>a.quality===e)}class Uw extends Wn.EventEmitter{constructor(e,i){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=a=>{var r,c;const{kind:u,data:d}=a.data;switch(u){case"error":if(Te.error(d.error.message),d.uuid){const g=this.decryptDataRequests.get(d.uuid);if(g?.reject){g.reject(d.error);break}const v=this.encryptDataRequests.get(d.uuid);if(v?.reject){v.reject(d.error);break}}this.emit(aa.EncryptionError,d.error,d.participantIdentity);break;case"initAck":d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==d.enabled&&d.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(aa.ParticipantEncryptionStatusChanged,d.enabled,this.room.localParticipant),this.encryptionEnabled=d.enabled;else if(d.participantIdentity){const g=(c=this.room)===null||c===void 0?void 0:c.getParticipantByIdentity(d.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(d.participantIdentity));this.emit(aa.ParticipantEncryptionStatusChanged,d.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(ra.KeyRatcheted,d.ratchetResult,d.participantIdentity,d.keyIndex);break;case"decryptDataResponse":const h=this.decryptDataRequests.get(d.uuid);h?.resolve&&h.resolve(d);break;case"encryptDataResponse":const f=this.encryptDataRequests.get(d.uuid);f?.resolve&&f.resolve(d);break}},this.onWorkerError=a=>{Te.error("e2ee worker encountered an error:",{error:a.error}),this.emit(aa.EncryptionError,a.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=i}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!JA())throw new vm("tried to setup end-to-end encryption on an unsupported browser");if(Te.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:NA.getLevel()}};this.worker&&(Te.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(e,i){Te.debug("set e2ee to ".concat(e," for participant ").concat(i)),this.postEnable(e,i)}setSifTrailer(e){!e||e.length===0?Te.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(te.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(e,i){e.on(J.TrackPublished,(a,r)=>this.setParticipantCryptorEnabled(a.trackInfo.encryption!==St.NONE,r.identity)),e.on(J.ConnectionStateChanged,a=>{a===Le.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(c=>{this.setParticipantCryptorEnabled(c.trackInfo.encryption!==St.NONE,r.identity)})})}).on(J.TrackUnsubscribed,(a,r,c)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:c.identity,trackId:a.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(J.TrackSubscribed,(a,r,c)=>{this.setupE2EEReceiver(a,c.identity,r.trackInfo)}).on(J.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");i.getKeys().forEach(a=>{this.postKey(a)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ne.LocalSenderCreated,(a,r)=>k(this,void 0,void 0,function*(){this.setupE2EESender(r,a)})),e.localParticipant.on(ne.LocalTrackPublished,a=>{if(!ha(a.track)||!ko())return;const r={kind:"updateCodec",data:{trackId:a.track.mediaStreamID,codec:uo(a.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),i.on(ra.SetKey,a=>this.postKey(a)).on(ra.RatchetRequest,(a,r)=>this.postRatchetRequest(a,r))}encryptData(e){return k(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const i=crypto.randomUUID(),a={kind:"encryptDataRequest",data:{uuid:i,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Rn;return r.onFinally=()=>{this.encryptDataRequests.delete(i)},this.encryptDataRequests.set(i,r),this.worker.postMessage(a),r.promise})}handleEncryptedData(e,i,a,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const c=crypto.randomUUID(),u={kind:"decryptDataRequest",data:{uuid:c,payload:e,iv:i,participantIdentity:a,keyIndex:r}},d=new Rn;return d.onFinally=()=>{this.decryptDataRequests.delete(c)},this.decryptDataRequests.set(c,d),this.worker.postMessage(u),d.promise}postRatchetRequest(e,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const a={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:i}};this.worker.postMessage(a)}postKey(e){let{key:i,participantIdentity:a,keyIndex:r}=e;var c;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((c=this.room)===null||c===void 0?void 0:c.localParticipant.identity),key:i,keyIndex:r}};this.worker.postMessage(u)}postEnable(e,i){if(this.worker){const a={kind:"enable",data:{enabled:e,participantIdentity:i}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const a={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(i)}setupE2EEReceiver(e,i,a){if(e.receiver){if(!a?.mimeType||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,i,e.kind==="video"?uo(a.mimeType):void 0)}}setupE2EESender(e,i){if(!Gs(e)||!i){i||Te.warn("early return because sender is not ready");return}this.handleSender(i,e.mediaStreamID,void 0)}handleReceiver(e,i,a,r){return k(this,void 0,void 0,function*(){if(this.worker){if(yf()&&!eb()){const c={kind:"decode",participantIdentity:a,trackId:i,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{if(eo in e&&r){const h={kind:"updateCodec",data:{trackId:i,codec:r,participantIdentity:a}};this.worker.postMessage(h);return}let c=e.writableStream,u=e.readableStream;if(!c||!u){const h=e.createEncodedStreams();e.writableStream=h.writable,c=h.writable,e.readableStream=h.readable,u=h.readable}const d={kind:"decode",data:{readableStream:u,writableStream:c,trackId:i,codec:r,participantIdentity:a,isReuse:eo in e}};this.worker.postMessage(d,[u,c])}e[eo]=!0}})}handleSender(e,i,a){var r;if(!(eo in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(yf()&&!eb()){Te.info("initialize script transform");const c={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,c)}else{Te.info("initialize encoded streams");const c=e.createEncodedStreams(),u={kind:"encode",data:{readableStream:c.readable,writableStream:c.writable,codec:a,trackId:i,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(u,[c.readable,c.writable])}e[eo]=!0}}}const Bw=500,jw=15e3;class Ks{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Ks),this._instance}addFailedConnectionAttempt(e){var i;const a=new URL(e),r=Oh(a);if(!r)return;let c=(i=this.failedConnectionAttempts.get(r))!==null&&i!==void 0?i:0;this.failedConnectionAttempts.set(r,c+1),this.backOffPromises.set(r,Pt(Math.min(Bw*Math.pow(2,c),jw)))}getBackOffPromise(e){const i=new URL(e),a=i&&Oh(i);return a&&this.backOffPromises.get(a)||Promise.resolve()}resetFailedConnectionAttempts(e){const i=new URL(e),a=i&&Oh(i);a&&(this.failedConnectionAttempts.set(a,0),this.backOffPromises.set(a,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Ks._instance=null;const Ih="default";class _t{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new _t),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c;if(((c=_t.userMediaPromiseMap)===null||c===void 0?void 0:c.size)>0){Te.debug("awaiting getUserMedia promise");try{i?yield _t.userMediaPromiseMap.get(i):yield Promise.all(_t.userMediaPromiseMap.values())}catch{Te.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ga()&&a.hasDeviceInUse(i))&&(u.filter(h=>h.kind===i).length===0||u.some(h=>{const f=h.label==="",g=i?h.kind===i:!0;return f&&g}))){const h={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"&&{deviceId:{ideal:"default"}}},f=yield navigator.mediaDevices.getUserMedia(h);u=yield navigator.mediaDevices.enumerateDevices(),f.getTracks().forEach(g=>{g.stop()})}return a._previousDevices=u,i&&(u=u.filter(d=>d.kind===i)),u})()})}normalizeDeviceId(e,i,a){return k(this,void 0,void 0,function*(){if(i!==Ih)return i;const r=yield this.getDevices(e),c=r.find(d=>d.deviceId===Ih);if(!c){Te.warn("could not reliably determine default device");return}const u=r.find(d=>d.deviceId!==Ih&&d.groupId===(a??c.groupId));if(!u){Te.warn("could not reliably determine default device");return}return u?.deviceId})}hasDeviceInUse(e){return e?_t.userMediaPromiseMap.has(e):_t.userMediaPromiseMap.size>0}}_t.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];_t.userMediaPromiseMap=new Map;var ho;(function(n){n[n.WAITING=0]="WAITING",n[n.RUNNING=1]="RUNNING",n[n.COMPLETED=2]="COMPLETED"})(ho||(ho={}));class Vw{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ft,this.nextTaskIndex=0}run(e){return k(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ho.WAITING};this.pendingTasks.set(i.id,i);const a=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=ho.RUNNING,yield e()}finally{i.status=ho.COMPLETED,this.pendingTasks.delete(i.id),a()}})}flush(){return k(this,void 0,void 0,function*(){return this.run(()=>k(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class Fw{get readyState(){return this.ws.readyState}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a,r;if(!((a=i.signal)===null||a===void 0)&&a.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const c=new WebSocket(e,(r=i.protocols)!==null&&r!==void 0?r:[]);c.binaryType="arraybuffer",this.ws=c;const u=function(){let{closeCode:d,reason:h}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return c.close(d,h)};this.opened=new Promise((d,h)=>{c.onopen=()=>{d({readable:new ReadableStream({start(f){c.onmessage=g=>{let{data:v}=g;return f.enqueue(v)},c.onerror=g=>f.error(g)},cancel:u}),writable:new WritableStream({write(f){c.send(f)},abort(){c.close()},close:u}),protocol:c.protocol,extensions:c.extensions}),c.removeEventListener("error",h)},c.addEventListener("error",h)}),this.closed=new Promise((d,h)=>{const f=()=>k(this,void 0,void 0,function*(){const g=new Promise(b=>{c.readyState!==WebSocket.CLOSED&&c.addEventListener("close",T=>{b(T)},{once:!0})}),v=yield Promise.race([Pt(250),g]);v?d(v):h(new Error("Encountered unspecified websocket error without a timely close event"))});c.onclose=g=>{let{code:v,reason:b}=g;d({closeCode:v,reason:b}),c.removeEventListener("error",f)},c.addEventListener("error",f)}),i.signal&&(i.signal.onabort=()=>c.close()),this.close=u}}function zw(n,e){const i=new URL(kw(n));return e.forEach((a,r)=>{i.searchParams.set(r,a)}),yC(i,"rtc")}function qw(n){const e=new URL(Eo(n));return yC(e,"validate")}function Hw(n){return n.endsWith("/")?n:"".concat(n,"/")}function yC(n,e){return n.pathname="".concat(Hw(n.pathname)).concat(e),n.toString()}function ob(n){if(typeof n=="string")return I0.fromJson(JSON.parse(n),{ignoreUnknownFields:!0});if(n instanceof ArrayBuffer)return I0.fromBinary(new Uint8Array(n));throw new Error("could not decode websocket message: ".concat(typeof n))}function Gw(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(n instanceof AbortSignal))return e;const i=n.reason;switch(typeof i){case"string":return i;case"object":return i instanceof Error?i.message:e;default:return"toString"in i?i.toString():e}}const Kw=["syncState","trickle","offer","answer","simulate","leave"];function Yw(n){const e=Kw.indexOf(n.case)>=0;return Te.trace("request allowed to bypass queue:",{canPass:e,req:n}),e}var Ke;(function(n){n[n.CONNECTING=0]="CONNECTING",n[n.CONNECTED=1]="CONNECTED",n[n.RECONNECTING=2]="RECONNECTING",n[n.DISCONNECTING=3]="DISCONNECTING",n[n.DISCONNECTED=4]="DISCONNECTED"})(Ke||(Ke={}));const Xw=250;class Tm{get currentState(){return this.state}get isDisconnected(){return this.state===Ke.DISCONNECTING||this.state===Ke.DISCONNECTED}get isEstablishingConnection(){return this.state===Ke.CONNECTING||this.state===Ke.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;this.rtt=0,this.state=Ke.DISCONNECTED,this.log=Te,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Ei((a=i.loggerName)!==null&&a!==void 0?a:jn.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=e,this.requestQueue=new Vw,this.queuedRequests=[],this.closingLock=new Ft,this.connectionLock=new Ft,this.state=Ke.DISCONNECTED}get logContext(){var e,i;return(i=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&i!==void 0?i:{}}join(e,i,a,r){return k(this,void 0,void 0,function*(){return this.state=Ke.CONNECTING,this.options=a,yield this.connect(e,i,a,r)})}reconnect(e,i,a,r){return k(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ke.RECONNECTING,this.clearPingInterval(),yield this.connect(e,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:a,reconnectReason:r}))})}connect(e,i,a,r){return k(this,void 0,void 0,function*(){const c=yield this.connectionLock.lock();this.connectOptions=a;const u=Sw(),d=a.singlePeerConnection?Jw(i,u,a):Qw(i,u,a),h=zw(e,d),f=qw(h);return new Promise((g,v)=>k(this,void 0,void 0,function*(){var b,T;try{let C=!1;const E=A=>k(this,void 0,void 0,function*(){if(C)return;C=!0;const R=A instanceof Event?A.currentTarget:A,B=Gw(R,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(B)).catch(F=>{this.log.error(F),this.close()}):this.close(),x(),v(R instanceof AbortSignal?R.reason:R)});r?.addEventListener("abort",E);const x=()=>{clearTimeout(w),r?.removeEventListener("abort",E)},w=setTimeout(()=>{E(new Oe("room connection has timed out (signal)",ge.ServerUnreachable))},a.websocketTimeout),V=(A,R)=>{this.handleSignalConnected(A,w,R)},I=new URL(h);I.searchParams.has("access_token")&&I.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(I),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new Fw(h);try{this.ws.closed.then(Z=>{var ae;this.isEstablishingConnection&&v(new Oe("Websocket got closed during a (re)connection attempt: ".concat(Z.reason),ge.InternalError)),Z.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:Z.reason,code:Z.closeCode,wasClean:Z.closeCode===1e3,state:this.state})),this.state===Ke.CONNECTED&&this.handleOnClose((ae=Z.reason)!==null&&ae!==void 0?ae:"Unexpected WS error"))}).catch(Z=>{this.isEstablishingConnection&&v(new Oe("Websocket error during a (re)connection attempt: ".concat(Z),ge.InternalError))});const A=yield this.ws.opened.catch(Z=>k(this,void 0,void 0,function*(){if(this.state!==Ke.CONNECTED){this.state=Ke.DISCONNECTED,clearTimeout(w);const ae=yield this.handleConnectionError(Z,f);v(ae);return}this.handleWSError(Z),v(Z)}));if(clearTimeout(w),!A)return;const R=A.readable.getReader();this.streamWriter=A.writable.getWriter();const B=yield R.read();if(R.releaseLock(),!B.value)throw new Oe("no message received as first message",ge.InternalError);const F=ob(B.value),G=this.validateFirstMessage(F,(b=a.reconnect)!==null&&b!==void 0?b:!1);if(!G.isValid){v(G.error);return}((T=F.message)===null||T===void 0?void 0:T.case)==="join"&&(this.pingTimeoutDuration=F.message.value.pingTimeout,this.pingIntervalDuration=F.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const $=G.shouldProcessFirstMessage?F:void 0;V(A,$),g(G.response)}catch(A){v(A)}finally{x()}}finally{c()}}))})}startReadingLoop(e,i){return k(this,void 0,void 0,function*(){for(i&&this.handleSignalResponse(i);;){this.signalLatency&&(yield Pt(this.signalLatency));const{done:a,value:r}=yield e.read();if(a)break;const c=ob(r);this.handleSignalResponse(c)}})}close(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Ke.DISCONNECTING||Ke.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),i&&(e.state=Ke.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:a});const c=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([c,Pt(Xw)])}}catch(c){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:c}))}finally{i&&(e.state=Ke.DISCONNECTED),r()}})()})}sendOffer(e,i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ls(e,i)})}sendAnswer(e,i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ls(e,i)})}sendIceCandidate(e,i){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Gl({candidateInit:JSON.stringify(e),target:i})})}sendMuteTrack(e,i){return this.sendRequest({case:"mute",value:new Kl({sid:e,muted:i})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,i){return k(this,arguments,void 0,function(a,r){var c=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const d=c.getNextRequestId();return yield c.sendRequest({case:"updateMetadata",value:new hm({requestId:d,metadata:a,name:r,attributes:u})}),d})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,i){return this.sendRequest({case:"updateLayers",value:new _S({trackSid:e,layers:i})})}sendUpdateSubscriptionPermissions(e,i){return this.sendRequest({case:"subscriptionPermission",value:new wS({allParticipants:e,trackPermissions:i})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:We.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new OS({timestamp:We.parse(Date.now()),rtt:We.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,i){return this.sendRequest({case:"updateAudioTrack",value:new dm({trackSid:e,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new Xl({reason:Bn.CLIENT_INITIATED,action:zs.DISCONNECT})})}sendRequest(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!Yw(i)&&a.state===Ke.RECONNECTING){a.queuedRequests.push(()=>k(a,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(r||(yield a.requestQueue.flush()),a.signalLatency&&(yield Pt(a.signalLatency)),a.isDisconnected){a.log.debug("skipping signal request (type: ".concat(i.case,") - SignalClient disconnected"));return}if(!a.streamWriter){a.log.error("cannot send signal request before connected, type: ".concat(i?.case),a.logContext);return}const u=new sA({message:i});try{a.useJSON?yield a.streamWriter.write(u.toJsonString()):yield a.streamWriter.write(u.toBinary())}catch(d){a.log.error("error sending signal message",Object.assign(Object.assign({},a.logContext),{error:d}))}})()})}handleSignalResponse(e){var i,a;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let c=!1;if(r.case==="answer"){const u=cb(r.value);this.onAnswer&&this.onAnswer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const u=cb(r.value);this.onOffer&&this.onOffer(u,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const u=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(u,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=r.value.participants)!==null&&i!==void 0?i:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=r.value.speakers)!==null&&a!==void 0?a:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),c=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));c||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return k(this,void 0,void 0,function*(){if(this.state===Ke.DISCONNECTED)return;const i=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),i&&i(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=xt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&xt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=xt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&xt.clearInterval(this.pingInterval)}handleSignalConnected(e,i,a){this.state=Ke.CONNECTED,clearTimeout(i),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),a)}validateFirstMessage(e,i){var a,r,c,u,d;return((a=e.message)===null||a===void 0?void 0:a.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Ke.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((c=e.message)===null||c===void 0?void 0:c.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((u=e.message)===null||u===void 0?void 0:u.case)==="leave"?{isValid:!1,error:new Oe("Received leave request while trying to (re)connect",ge.LeaveRequest,void 0,e.message.value.reason)}:i?{isValid:!1,error:new Oe("Unexpected first message",ge.InternalError)}:{isValid:!1,error:new Oe("did not receive join response, got ".concat((d=e.message)===null||d===void 0?void 0:d.case," instead"),ge.InternalError)}}handleConnectionError(e,i){return k(this,void 0,void 0,function*(){try{const a=yield fetch(i);if(a.status.toFixed(0).startsWith("4")){const r=yield a.text();return new Oe(r,ge.NotAllowed,a.status)}else return e instanceof Oe?e:new Oe("Encountered unknown websocket error during connection: ".concat(e),ge.InternalError,a.status)}catch(a){return a instanceof Oe?a:new Oe(a instanceof Error?a.message:"server was not reachable",ge.ServerUnreachable)}})}}function cb(n){const e={type:"offer",sdp:n.sdp};switch(n.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=n.type;break}return e}function Ls(n,e){return new la({sdp:n.sdp,type:n.type,id:e})}function Qw(n,e,i){var a;const r=new URLSearchParams;return r.set("access_token",n),i.reconnect&&(r.set("reconnect","1"),i.sid&&r.set("sid",i.sid)),r.set("auto_subscribe",i.autoSubscribe?"1":"0"),r.set("sdk",Qn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),i.adaptiveStream&&r.set("adaptive_stream","1"),i.reconnectReason&&r.set("reconnect_reason",i.reconnectReason.toString()),!((a=navigator.connection)===null||a===void 0)&&a.type&&r.set("network",navigator.connection.type),r}function Jw(n,e,i){const a=new URLSearchParams;a.set("access_token",n);const r=new AA({clientInfo:e,connectionSettings:new xS({autoSubscribe:!!i.autoSubscribe,adaptiveStream:!!i.adaptiveStream}),reconnect:!!i.reconnect,participantSid:i.sid?i.sid:void 0});i.reconnectReason&&(r.reconnectReason=i.reconnectReason);const c=new wA({joinRequest:r.toBinary()});return a.set("join_request",btoa(new TextDecoder("utf-8").decode(c.toBinary()))),a}class lb{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const i=this.buffer[0];if(this._totalSize-i.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Ww{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,i){const a=Date.now();a-this._lastCleanup>this.ttl/2&&this.cleanup();const r=a+this.ttl;return this._map.set(e,{value:i,expiresAt:r}),this}get(e){const i=this._map.get(e);if(i){if(i.expiresAt<Date.now()){this._map.delete(e);return}return i.value}}has(e){const i=this._map.get(e);return i?i.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[i,a]of this._map.entries())a.expiresAt<e&&this._map.delete(i);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&e(a.value,i,this.asValueMap())}map(e){this.cleanup();const i=[],a=this.asValueMap();for(const[r,c]of a.entries())i.push(e(c,r,a));return i}asValueMap(){const e=new Map;for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&e.set(i,a.value);return e}}var xn={},Uh={},Bh={exports:{}},ub;function Sm(){if(ub)return Bh.exports;ub=1;var n=Bh.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var i="candidate:%s %d %s %d %s %d typ %s";return i+=e.raddr!=null?" raddr %s rport %d":"%v%v",i+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(i+=" generation %d"),i+=e["network-id"]!=null?" network-id %d":"%v",i+=e["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var i="ssrc:%d";return e.attribute!=null&&(i+=" %s",e.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var i="mediaclk:";return i+=e.id!=null?"id=%s %s":"%v%s",i+=e.mediaClockValue!=null?"=%s":"",i+=e.rateNumerator!=null?" rate=%s":"",i+=e.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var i=n[e];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})}),Bh.exports}var db;function Zw(){return db||(db=1,(function(n){var e=function(d){return String(Number(d))===d?Number(d):d},i=function(d,h,f,g){if(g&&!f)h[g]=e(d[1]);else for(var v=0;v<f.length;v+=1)d[v+1]!=null&&(h[f[v]]=e(d[v+1]))},a=function(d,h,f){var g=d.name&&d.names;d.push&&!h[d.push]?h[d.push]=[]:g&&!h[d.name]&&(h[d.name]={});var v=d.push?{}:g?h[d.name]:h;i(f.match(d.reg),v,d.names,d.name),d.push&&h[d.push].push(v)},r=Sm(),c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(d){var h={},f=[],g=h;return d.split(/(\r\n|\r|\n)/).filter(c).forEach(function(v){var b=v[0],T=v.slice(2);b==="m"&&(f.push({rtp:[],fmtp:[]}),g=f[f.length-1]);for(var C=0;C<(r[b]||[]).length;C+=1){var E=r[b][C];if(E.reg.test(T))return a(E,g,T)}}),h.media=f,h};var u=function(d,h){var f=h.split(/=(.+)/,2);return f.length===2?d[f[0]]=e(f[1]):f.length===1&&h.length>1&&(d[f[0]]=void 0),d};n.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(d){return d.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(d){for(var h=[],f=d.split(" ").map(e),g=0;g<f.length;g+=3)h.push({component:f[g],ip:f[g+1],port:f[g+2]});return h},n.parseImageAttributes=function(d){return d.split(" ").map(function(h){return h.substring(1,h.length-1).split(",").reduce(u,{})})},n.parseSimulcastStreamList=function(d){return d.split(";").map(function(h){return h.split(",").map(function(f){var g,v=!1;return f[0]!=="~"?g=e(f):(g=e(f.substring(1,f.length)),v=!0),{scid:g,paused:v}})})}})(Uh)),Uh}var jh,hb;function $w(){if(hb)return jh;hb=1;var n=Sm(),e=/%[sdv%]/g,i=function(u){var d=1,h=arguments,f=h.length;return u.replace(e,function(g){if(d>=f)return g;var v=h[d];switch(d+=1,g){case"%%":return"%";case"%s":return String(v);case"%d":return Number(v);case"%v":return""}})},a=function(u,d,h){var f=d.format instanceof Function?d.format(d.push?h:h[d.name]):d.format,g=[u+"="+f];if(d.names)for(var v=0;v<d.names.length;v+=1){var b=d.names[v];d.name?g.push(h[d.name][b]):g.push(h[d.names[v]])}else g.push(h[d.name]);return i.apply(null,g)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];return jh=function(u,d){d=d||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(v){v.payloads==null&&(v.payloads="")});var h=d.outerOrder||r,f=d.innerOrder||c,g=[];return h.forEach(function(v){n[v].forEach(function(b){b.name in u&&u[b.name]!=null?g.push(a(v,b,u)):b.push in u&&u[b.push]!=null&&u[b.push].forEach(function(T){g.push(a(v,b,T))})})}),u.media.forEach(function(v){g.push(a("m",n.m[0],v)),f.forEach(function(b){n[b].forEach(function(T){T.name in v&&v[T.name]!=null?g.push(a(b,T,v)):T.push in v&&v[T.push]!=null&&v[T.push].forEach(function(C){g.push(a(b,T,C))})})})}),g.join(`\r
`)+`\r
`},jh}var fb;function eM(){if(fb)return xn;fb=1;var n=Zw(),e=$w(),i=Sm();return xn.grammar=i,xn.write=e,xn.parse=n.parse,xn.parseParams=n.parseParams,xn.parseFmtpConfig=n.parseFmtpConfig,xn.parsePayloads=n.parsePayloads,xn.parseRemoteCandidates=n.parseRemoteCandidates,xn.parseImageAttributes=n.parseImageAttributes,xn.parseSimulcastStreamList=n.parseSimulcastStreamList,xn}var ta=eM();function Cm(n,e,i){var a,r,c;e===void 0&&(e=50),i===void 0&&(i={});var u=(a=i.isImmediate)!=null&&a,d=(r=i.callback)!=null&&r,h=i.maxWait,f=Date.now(),g=[];function v(){if(h!==void 0){var T=Date.now()-f;if(T+e>=h)return h-T}return e}var b=function(){var T=[].slice.call(arguments),C=this;return new Promise(function(E,x){var w=u&&c===void 0;if(c!==void 0&&clearTimeout(c),c=setTimeout(function(){if(c=void 0,f=Date.now(),!u){var I=n.apply(C,T);d&&d(I),g.forEach(function(A){return(0,A.resolve)(I)}),g=[]}},v()),w){var V=n.apply(C,T);return d&&d(V),E(V)}g.push({resolve:E,reject:x})})};return b.cancel=function(T){c!==void 0&&clearTimeout(c),g.forEach(function(C){return(0,C.reject)(T)}),g=[]},b}const tM=.7,nM=20,Ys={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class mb extends Wn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;super(),this.log=Te,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Cm(r=>k(this,void 0,void 0,function*(){this.emit(Ys.NegotiationStarted);try{yield this.createAndSendOffer()}catch(c){if(r)r(c);else throw c}}),nM),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ei((a=i.loggerName)!==null&&a!==void 0?a:jn.PCTransport),this.loggerOptions=i,this.config=e,this._pc=this.createPC(),this.offerLock=new Ft}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=i=>{var a;i.candidate&&((a=this.onIceCandidate)===null||a===void 0||a.call(this,i.candidate))},e.onicecandidateerror=i=>{var a;(a=this.onIceCandidateError)===null||a===void 0||a.call(this,i)},e.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,e.connectionState)},e.ondatachannel=i=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,i)},e.ontrack=i=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,i)},e}get logContext(){var e,i;return Object.assign({},(i=(e=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return k(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,i){return k(this,void 0,void 0,function*(){var a;if(e.type==="answer"&&this.latestOfferId>0&&i>0&&i!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:i,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:c,nackMids:u}=iM(e);this.remoteStereoMids=c,this.remoteNackMids=u}else if(e.type==="answer"){const c=ta.parse((a=e.sdp)!==null&&a!==void 0?a:"");c.media.forEach(u=>{const d=km(u.mid);u.type==="audio"&&this.trackBitrates.some(h=>{if(!h.transceiver||d!=h.transceiver.mid)return!1;let f=0;if(u.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0)return!0;let g=!1;for(const v of u.fmtp)if(v.payload===f){v.config=v.config.split(";").filter(b=>!b.includes("maxaveragebitrate")).join(";"),h.maxbr>0&&(v.config+=";maxaveragebitrate=".concat(h.maxbr*1e3)),g=!0;break}return g||h.maxbr>0&&u.fmtp.push({payload:f,config:"maxaveragebitrate=".concat(h.maxbr*1e3)}),!0})}),r=ta.write(c)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(c=>{this.pc.addIceCandidate(c)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Ys.NegotiationComplete),e.sdp&&ta.parse(e.sdp).media.forEach(u=>{u.type==="video"&&this.emit(Ys.RTPVideoPayloadTypes,u.rtp)})),!0})}createAndSendOffer(e){return k(this,void 0,void 0,function*(){var i;const a=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const d=this._pc.remoteDescription;if(e?.iceRestart&&d)yield this._pc.setRemoteDescription(d);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const c=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:c.sdp},this.logContext));const u=ta.parse((i=c.sdp)!==null&&i!==void 0?i:"");if(u.media.forEach(d=>{gb(d),d.type==="audio"?pb(d,["all"],[]):d.type==="video"&&this.trackBitrates.some(h=>{if(!d.msid||!h.cid||!d.msid.includes(h.cid))return!1;let f=0;if(d.rtp.some(v=>v.codec.toUpperCase()===h.codec.toUpperCase()?(f=v.payload,!0):!1),f===0||(Un(h.codec)&&!Ga()&&this.ensureVideoDDExtensionForSVC(d,u),!Un(h.codec)))return!0;const g=Math.round(h.maxbr*tM);for(const v of d.fmtp)if(v.payload===f){v.config.includes("x-google-start-bitrate")||(v.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(c,ta.write(u)),this.onOffer(c,this.latestOfferId)}finally{a()}})}createAndSetAnswer(){return k(this,void 0,void 0,function*(){var e;const i=yield this.pc.createAnswer(),a=ta.parse((e=i.sdp)!==null&&e!==void 0?e:"");return a.media.forEach(r=>{gb(r),r.type==="audio"&&pb(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,ta.write(a)),i})}createDataChannel(e,i){return this.pc.createDataChannel(e,i)}addTransceiver(e,i){return this.pc.addTransceiver(e,i)}addTransceiverOfKind(e,i){return this.pc.addTransceiver(e,i)}addTrack(e){if(!this._pc)throw new Tt("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var i;if(!this._pc)throw new Tt("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(e)}getConnectionState(){var e,i;return(i=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var e,i;return(i=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var e,i;return(i=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var e,i;return(i=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var e,i;return(i=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return k(this,void 0,void 0,function*(){var e;if(!this._pc)return;let i="";const a=new Map,r=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":i=d.selectedCandidatePairId;break;case"candidate-pair":i===""&&d.selected&&(i=d.id),a.set(d.id,d);break;case"remote-candidate":r.set(d.id,"".concat(d.address,":").concat(d.port));break}}),i==="")return;const u=(e=a.get(i))===null||e===void 0?void 0:e.remoteCandidateId;if(u!==void 0)return r.get(u)})}setMungedSDP(e,i,a){return k(this,void 0,void 0,function*(){if(i){const r=e.sdp;e.sdp=i;try{this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),a?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(c){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:c,sdp:i})),e.sdp=r}}try{a?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let c="unknown error";r instanceof Error?c=r.message:typeof r=="string"&&(c=r);const u={error:c,sdp:e.sdp};throw!a&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new bf(c)}})}ensureVideoDDExtensionForSVC(e,i){var a,r;if(!((a=e.ext)===null||a===void 0?void 0:a.some(u=>u.uri===$0))){if(this.ddExtID===0){let u=0;i.media.forEach(d=>{var h;d.type==="video"&&((h=d.ext)===null||h===void 0||h.forEach(f=>{f.value>u&&(u=f.value)}))}),this.ddExtID=u+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:$0})}}}function pb(n,e,i){const a=km(n.mid);let r=0;n.rtp.some(c=>c.codec==="opus"?(r=c.payload,!0):!1),r>0&&(n.rtcpFb||(n.rtcpFb=[]),i.includes(a)&&!n.rtcpFb.some(c=>c.payload===r&&c.type==="nack")&&n.rtcpFb.push({payload:r,type:"nack"}),(e.includes(a)||e.length===1&&e[0]==="all")&&n.fmtp.some(c=>c.payload===r?(c.config.includes("stereo=1")||(c.config+=";stereo=1"),!0):!1))}function iM(n){var e;const i=[],a=[],r=ta.parse((e=n.sdp)!==null&&e!==void 0?e:"");let c=0;return r.media.forEach(u=>{var d;const h=km(u.mid);u.type==="audio"&&(u.rtp.some(f=>f.codec==="opus"?(c=f.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(f=>f.payload===c&&f.type==="nack")&&a.push(h),u.fmtp.some(f=>f.payload===c?(f.config.includes("sprop-stereo=1")&&i.push(h),!0):!1))}),{stereoMids:i,nackMids:a}}function gb(n){if(n.connection){const e=n.connection.ip.indexOf(":")>=0;(n.connection.version===4&&e||n.connection.version===6&&!e)&&(n.connection.ip="0.0.0.0",n.connection.version=4)}}function km(n){return typeof n=="number"?n.toFixed(0):n}const wf="vp8",aM={audioPreset:Tf.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ym.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:wf,backupCodec:!0,preConnectBuffer:!1},bC={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},TC={deviceId:{ideal:"default"},resolution:Co.h720.resolution},sM={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new IA,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Em={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var nt;(function(n){n[n.NEW=0]="NEW",n[n.CONNECTING=1]="CONNECTING",n[n.CONNECTED=2]="CONNECTED",n[n.FAILED=3]="FAILED",n[n.CLOSING=4]="CLOSING",n[n.CLOSED=5]="CLOSED"})(nt||(nt={}));class rM{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,i,a){var r;this.peerConnectionTimeout=Em.peerConnectionTimeout,this.log=Te,this.updateState=()=>{var c,u;const d=this.state,h=this.requiredTransports.map(f=>f.getConnectionState());h.every(f=>f==="connected")?this.state=nt.CONNECTED:h.some(f=>f==="failed")?this.state=nt.FAILED:h.some(f=>f==="connecting")?this.state=nt.CONNECTING:h.every(f=>f==="closed")?this.state=nt.CLOSED:h.some(f=>f==="closed")?this.state=nt.CLOSING:h.every(f=>f==="new")&&(this.state=nt.NEW),d!==this.state&&(this.log.debug("pc state change: from ".concat(nt[d]," to ").concat(nt[this.state]),this.logContext),(c=this.onStateChange)===null||c===void 0||c.call(this,this.state,this.publisher.getConnectionState(),(u=this.subscriber)===null||u===void 0?void 0:u.getConnectionState()))},this.log=Ei((r=a.loggerName)!==null&&r!==void 0?r:jn.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=i!=="subscriber-primary",this.isSubscriberConnectionRequired=i==="subscriber-primary",this.publisher=new mb(e,a),i!=="publisher-only"&&(this.subscriber=new mb(e,a),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=c=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,c,In.SUBSCRIBER)},this.subscriber.onDataChannel=c=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,c)},this.subscriber.onTrack=c=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,c)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=c=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,c,In.PUBLISHER)},this.publisher.onTrack=c=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,c)},this.publisher.onOffer=(c,u)=>{var d;(d=this.onPublisherOffer)===null||d===void 0||d.call(this,c,u)},this.state=nt.NEW,this.connectionLock=new Ft,this.remoteOfferLock=new Ft}get logContext(){var e,i;return Object.assign({},(i=(e=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,i){return this.publisher.setRemoteDescription(e,i)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return k(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const i=this.publisher;for(const a of i.getSenders())try{i.canRemoveTrack()&&i.removeTrack(a)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return k(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,i){return k(this,void 0,void 0,function*(){var a;i===In.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(a=this.subscriber)===null||a===void 0?void 0:a.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,i){return k(this,void 0,void 0,function*(){var a,r,c;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(a=this.subscriber)===null||a===void 0?void 0:a.getSignallingState().toString()}));const u=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,i))?yield(c=this.subscriber)===null||c===void 0?void 0:c.createAndSetAnswer():void 0}finally{u()}})}updateConfiguration(e,i){var a;this.publisher.setConfiguration(e),(a=this.subscriber)===null||a===void 0||a.setConfiguration(e),i&&this.triggerIceRestart()}ensurePCTransportConnection(e,i){return k(this,void 0,void 0,function*(){var a;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((a=this.requiredTransports)===null||a===void 0?void 0:a.map(c=>this.ensureTransportConnected(c,e,i)))}finally{r()}})}negotiate(e){return k(this,void 0,void 0,function*(){return new Promise((i,a)=>k(this,void 0,void 0,function*(){const r=setTimeout(()=>{a("negotiation timed out")},this.peerConnectionTimeout),c=()=>{clearTimeout(r),a("negotiation aborted")};e.signal.addEventListener("abort",c),this.publisher.once(Ys.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Ys.NegotiationComplete,()=>{clearTimeout(r),i()})}),yield this.publisher.negotiate(u=>{clearTimeout(r),a(u)})}))})}addPublisherTransceiver(e,i){return this.publisher.addTransceiver(e,i)}addPublisherTransceiverOfKind(e,i){return this.publisher.addTransceiverOfKind(e,i)}getMidForReceiver(e){const a=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return a?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,i){return this.publisher.createDataChannel(e,i)}getConnectedAddress(e){return e===In.PUBLISHER?this.publisher.getConnectedAddress():e===In.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,i){return k(this,arguments,void 0,function(a,r){var c=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(a.getConnectionState()!=="connected")return new Promise((h,f)=>k(c,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),xt.clearTimeout(v),f(new Oe("room connection has been cancelled",ge.Cancelled))};r?.signal.aborted&&g(),r?.signal.addEventListener("abort",g);const v=xt.setTimeout(()=>{r?.signal.removeEventListener("abort",g),f(new Oe("could not establish pc connection",ge.InternalError))},u);for(;this.state!==nt.CONNECTED;)if(yield Pt(50),r?.signal.aborted){f(new Oe("room connection has been cancelled",ge.Cancelled));return}xt.clearTimeout(v),r?.signal.removeEventListener("abort",g),h()}))})()})}}const SC=5e3,oM=3e4;class Ue{static fetchRegionSettings(e,i,a){return k(this,void 0,void 0,function*(){const r=yield Ue.fetchLock.lock();try{const c=yield fetch("".concat(cM(e),"/regions"),{headers:{authorization:"Bearer ".concat(i)},signal:a});if(c.ok){const u=Mw(c.headers),d=u?u*1e3:SC;return{regionSettings:yield c.json(),updatedAtInMs:Date.now(),maxAgeInMs:d}}else throw new Oe("Could not fetch region settings: ".concat(c.statusText),c.status===401?ge.NotAllowed:ge.InternalError,c.status)}catch(c){throw c instanceof Oe?c:a?.aborted?new Oe("Region fetching was aborted",ge.Cancelled):new Oe("Could not fetch region settings, ".concat(c instanceof Error?"".concat(c.name,": ").concat(c.message):c),ge.ServerUnreachable,500)}finally{r()}})}static scheduleRefetch(e,i,a){return k(this,void 0,void 0,function*(){const r=Ue.settingsTimeouts.get(e.hostname);clearTimeout(r),Ue.settingsTimeouts.set(e.hostname,setTimeout(()=>k(this,void 0,void 0,function*(){try{const c=yield Ue.fetchRegionSettings(e,i);Ue.updateCachedRegionSettings(e,i,c)}catch(c){if(c instanceof Oe&&c.reason===ge.NotAllowed){Te.debug("token is not valid, cancelling auto region refresh");return}Te.debug("auto refetching of region settings failed",{error:c}),Ue.scheduleRefetch(e,i,a)}}),a))})}static updateCachedRegionSettings(e,i,a){Ue.cache.set(e.hostname,a),Ue.scheduleRefetch(e,i,a.maxAgeInMs)}static stopRefetch(e){const i=Ue.settingsTimeouts.get(e);i&&(clearTimeout(i),Ue.settingsTimeouts.delete(e))}static scheduleCleanup(e){let i=Ue.connectionTrackers.get(e);i&&(i.cleanupTimeout&&clearTimeout(i.cleanupTimeout),i.cleanupTimeout=setTimeout(()=>{const a=Ue.connectionTrackers.get(e);a&&a.connectionCount===0&&(Te.debug("stopping region refetch after disconnect delay",{hostname:e}),Ue.stopRefetch(e)),a&&(a.cleanupTimeout=void 0)},oM))}static cancelCleanup(e){const i=Ue.connectionTrackers.get(e);i?.cleanupTimeout&&(clearTimeout(i.cleanupTimeout),i.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let i=Ue.connectionTrackers.get(e);i||(i={connectionCount:0},Ue.connectionTrackers.set(e,i)),i.connectionCount++,Ue.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,i=Ue.connectionTrackers.get(e);i&&(i.connectionCount=Math.max(0,i.connectionCount-1),i.connectionCount===0&&Ue.scheduleCleanup(e))}constructor(e,i){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=i}updateToken(e){this.token=e}isCloud(){return xl(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return k(this,void 0,void 0,function*(){return Ue.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return k(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let i=Ue.cache.get(this.serverUrl.hostname);(!i||Date.now()-i.updatedAtInMs>i.maxAgeInMs)&&(i=yield this.fetchRegionSettings(e),Ue.updateCachedRegionSettings(this.serverUrl,this.token,i));const a=i.regionSettings.regions.filter(r=>!this.attemptedRegions.find(c=>c.url===r.url));if(a.length>0){const r=a[0];return this.attemptedRegions.push(r),Te.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Ue.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Ue.cache=new Map;Ue.settingsTimeouts=new Map;Ue.connectionTrackers=new Map;Ue.fetchLock=new Ft;function cM(n){return"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")}class st extends Error{constructor(e,i,a){super(i),this.code=e,this.message=vb(i,st.MAX_MESSAGE_BYTES),this.data=a?vb(a,st.MAX_DATA_BYTES):void 0}static fromProto(e){return new st(e.code,e.message,e.data)}toProto(){return new fS({code:this.code,message:this.message,data:this.data})}static builtIn(e,i){return new st(st.ErrorCode[e],st.ErrorMessage[e],i)}}st.MAX_MESSAGE_BYTES=256;st.MAX_DATA_BYTES=15360;st.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};st.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const CC=15360;function _m(n){return new TextEncoder().encode(n).length}function vb(n,e){if(_m(n)<=e)return n;let i=0,a=n.length;const r=new TextEncoder;for(;i<a;){const c=Math.floor((i+a+1)/2);r.encode(n.slice(0,c)).length<=e?i=c:a=c-1}return n.slice(0,i)}const Rm=2e3;function Jl(n,e){if(!e)return 0;let i,a;return"bytesReceived"in n?(i=n.bytesReceived,a=e.bytesReceived):"bytesSent"in n&&(i=n.bytesSent,a=e.bytesSent),i===void 0||a===void 0||n.timestamp===void 0||e.timestamp===void 0?0:(i-a)*8*1e3/(n.timestamp-e.timestamp)}const Am=typeof MediaRecorder<"u";class lM{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const uM=Am?MediaRecorder:lM;class dM extends uM{constructor(e,i){if(!Am)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),i);let a,r;const c=()=>r===void 0,u=()=>{this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),r?.close(),r=void 0},d=h=>{r?.error(h),this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),r=void 0};this.byteStream=new ReadableStream({start:h=>{r=h,a=f=>k(this,void 0,void 0,function*(){let g;if(f.data.arrayBuffer){const v=yield f.data.arrayBuffer();g=new Uint8Array(v)}else if(f.data.byteArray)g=f.data.byteArray;else throw new Error("no data available!");c()||h.enqueue(g)}),this.addEventListener("dataavailable",a)},cancel:()=>{u()}}),this.addEventListener("stop",u),this.addEventListener("error",d)}}function hM(){return Am}const fM=1e3,mM=1e4;class kC extends X{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,i,a){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=arguments.length>4?arguments[4]:void 0;super(e,i,c),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Cm(()=>k(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>k(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ee.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ft,this.pauseUpstreamLock=new Ft,this.trackChangeLock=new Ft,this.trackChangeLock.lock().then(u=>k(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{u()}})),this._constraints=e.getConstraints(),a&&(this._constraints=a)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==X.Kind.Video)return;const{width:e,height:i}=this._mediaStreamTrack.getSettings();if(e&&i)return{width:e,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,i;return(i=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,i){return k(this,void 0,void 0,function*(){var a;if(e===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(c=>{Hs(this._mediaStreamTrack,c)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ns(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((a=this.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(c=>{Ns(r??e,c)}))})}waitForDimensions(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fM;return(function*(){var a;if(e.kind===X.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((a=$t())===null||a===void 0?void 0:a.os)==="iOS"&&(yield Pt(10));const r=Date.now();for(;Date.now()-r<i;){const c=e.dimensions;if(c)return c;yield Pt(50)}throw new Ci("unable to get track dimensions after timeout")})()})}setDeviceId(e){return k(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===oa(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),oa(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===X.Source.ScreenShare)return;const{deviceId:a,groupId:r}=e._mediaStreamTrack.getSettings(),c=e.kind===X.Kind.Audio?"audioinput":"videoinput";return i?_t.getInstance().normalizeDeviceId(c,a,r):a})()})}mute(){return k(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return k(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,i){return k(this,void 0,void 0,function*(){const a=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ci("unable to replace an unpublished track");let r,c;return typeof i=="boolean"?r=i:i!==void 0&&(r=i.userProvidedTrack,c=i.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),c&&this.processor&&(yield this.internalStopProcessor()),this}finally{a()}})}restart(e){return k(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:a,facingMode:r}=e,c=UA(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const u={audio:!1,video:!1};this.kind===X.Kind.Video?u.video=a||r?{deviceId:a,facingMode:r}:!0:u.audio=a?Object.assign({deviceId:a},c):!0,this.attachedElements.forEach(f=>{Hs(this.mediaStreamTrack,f)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const h=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return this.kind===X.Kind.Video&&(yield h.applyConstraints(c)),h.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(h),this._constraints=e,this.emit(ee.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ee.Muted:ee.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return k(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),dC()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return k(this,void 0,void 0,function*(){var e;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ee.UpstreamPaused,this);const a=$t();if(a?.name==="Safari"&&Jn(a.version,"12.0")<0)throw new vm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{i()}})}resumeUpstream(){return k(this,void 0,void 0,function*(){var e;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ee.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{i()}})}getRTCStatsReport(){return k(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var c;const u=yield a.trackChangeLock.lock();try{a.log.debug("setting up processor",a.logContext);const d=document.createElement(a.kind),h={kind:a.kind,track:a._mediaStreamTrack,element:d,audioContext:a.audioContext};if(yield i.init(h),a.log.debug("processor initialized",a.logContext),a.processor&&(yield a.internalStopProcessor()),a.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ns(a._mediaStreamTrack,d),d.muted=!0,d.play().catch(f=>{f instanceof DOMException&&f.name==="AbortError"?(a.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},a.logContext),{error:f})),setTimeout(()=>{d.play().catch(g=>{a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{err:g}))})},100)):a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:f}))}),a.processor=i,a.processorElement=d,a.processor.processedTrack){for(const f of a.attachedElements)f!==a.processorElement&&r&&(Hs(a._mediaStreamTrack,f),Ns(a.processor.processedTrack,f));yield(c=a.sender)===null||c===void 0?void 0:c.replaceTrack(a.processor.processedTrack)}a.emit(ee.TrackProcessorUpdate,a.processor)}finally{u()}})()})}getProcessor(){return this.processor}stopProcessor(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const a=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(i)}finally{a()}})()})}internalStopProcessor(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var a,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(a=e.processor.processedTrack)===null||a===void 0||a.stop(),yield e.processor.destroy(),e.processor=void 0,i||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(ee.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!hM()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let i="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(i)||(i="video/mp4"),this.localTrackRecorder=new dM(this,{mimeType:i})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},mM)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Pl extends kC{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;super(e,X.Kind.Audio,i,a,c),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>k(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=Jl(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(ee.AudioTrackFeatureUpdate,this,Et.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(ee.AudioTrackFeatureUpdate,this,Et.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return k(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===X.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{i()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return k(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const a=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==oa(this._constraints.deviceId);return this.source===X.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||a)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{i()}})}restartTrack(e){return k(this,void 0,void 0,function*(){let i;if(e){const a=bm({audio:e});typeof a.audio!="boolean"&&(i=a.audio)}yield this.restart(i)})}restart(e){const i=Object.create(null,{restart:{get:()=>super.restart}});return k(this,void 0,void 0,function*(){const a=yield i.restart.call(this,e);return this.checkForSilence(),a})}startMonitor(){Wt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Rm)))}setProcessor(e){return k(this,void 0,void 0,function*(){var i;const a=yield this.trackChangeLock.lock();try{if(!Qn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(ee.TrackProcessorUpdate,this.processor)}finally{a()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return k(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const i=yield this.sender.getStats();let a;return i.forEach(r=>{r.type==="outbound-rtp"&&(a={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),a})}checkForSilence(){return k(this,void 0,void 0,function*(){const e=yield pC(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(ee.AudioSilenceDetected)),e})}}function pM(n,e,i){switch(n.kind){case"audio":return new Pl(n,e,!1,void 0,i);case"video":return new Nl(n,e,!1,i);default:throw new Ci("unsupported track type: ".concat(n.kind))}}const gM=Object.values(Co),vM=Object.values(Sf),yM=Object.values(ym),bM=[Co.h180,Co.h360],TM=[Sf.h180,Sf.h360],SM=n=>[{scaleResolutionDownBy:2,fps:n.encoding.maxFramerate}].map(i=>{var a,r;return new He(Math.floor(n.width/i.scaleResolutionDownBy),Math.floor(n.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((a=n.encoding.maxFramerate)!==null&&a!==void 0?a:30)/((r=i.fps)!==null&&r!==void 0?r:30))))),i.fps,n.encoding.priority)}),Mf=["q","h","f"];function Df(n,e,i,a){var r,c;let u=a?.videoEncoding;n&&(u=a?.screenShareEncoding);const d=a?.simulcast,h=a?.scalabilityMode,f=a?.videoCodec;if(!u&&!d&&!h||!e||!i)return[{}];u||(u=kM(n,e,i,f),Te.debug("using video encoding",u));const g=u.maxFramerate,v=new He(e,i,u.maxBitrate,u.maxFramerate,u.priority);if(h&&Un(f)){const C=new EC(h),E=[];if(C.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(h));const x=$t();if(ko()||Qn()||x?.name==="Chrome"&&Jn(x?.version,"113")<0){const w=C.suffix=="h"?2:3,V=vw(x);for(let I=0;I<C.spatial;I+=1)E.push({rid:Mf[2-I],maxBitrate:u.maxBitrate/Math.pow(w,I),maxFramerate:v.encoding.maxFramerate,scaleResolutionDownBy:V?Math.pow(2,I):void 0});E[0].scalabilityMode=h}else E.push({maxBitrate:u.maxBitrate,maxFramerate:v.encoding.maxFramerate,scalabilityMode:h});return v.encoding.priority&&(E[0].priority=v.encoding.priority,E[0].networkPriority=v.encoding.priority),Te.debug("using svc encoding",{encodings:E}),E}if(!d)return[u];let b=[];n?b=(r=bb(a?.screenShareSimulcastLayers))!==null&&r!==void 0?r:yb(n,v):b=(c=bb(a?.videoSimulcastLayers))!==null&&c!==void 0?c:yb(n,v);let T;if(b.length>0){const C=b[0];b.length>1&&([,T]=b);const E=Math.max(e,i);if(E>=960&&T)return Vh(e,i,[C,T,v],g);if(E>=480)return Vh(e,i,[C,v],g)}return Vh(e,i,[v])}function CM(n,e,i){var a,r,c,u;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;e!==i.backupCodec.codec&&Te.warn("requested a different codec than specified as backup",{serverRequested:e,backup:i.backupCodec.codec}),i.videoCodec=e,i.videoEncoding=i.backupCodec.encoding;const d=n.mediaStreamTrack.getSettings(),h=(a=d.width)!==null&&a!==void 0?a:(r=n.dimensions)===null||r===void 0?void 0:r.width,f=(c=d.height)!==null&&c!==void 0?c:(u=n.dimensions)===null||u===void 0?void 0:u.height;return n.source===X.Source.ScreenShare&&i.simulcast&&(i.simulcast=!1),Df(n.source===X.Source.ScreenShare,h,f,i)}function kM(n,e,i,a){const r=EM(n,e,i);let{encoding:c}=r[0];const u=Math.max(e,i);for(let d=0;d<r.length;d+=1){const h=r[d];if(c=h.encoding,h.width>=u)break}if(a)switch(a){case"av1":case"h265":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.7;break;case"vp9":c=Object.assign({},c),c.maxBitrate=c.maxBitrate*.85;break}return c}function EM(n,e,i){if(n)return yM;const a=e>i?e/i:i/e;return Math.abs(a-16/9)<Math.abs(a-4/3)?gM:vM}function yb(n,e){if(n)return SM(e);const{width:i,height:a}=e,r=i>a?i/a:a/i;return Math.abs(r-16/9)<Math.abs(r-4/3)?bM:TM}function Vh(n,e,i,a){const r=[];if(i.forEach((c,u)=>{if(u>=Mf.length)return;const d=Math.min(n,e),f={rid:Mf[u],scaleResolutionDownBy:Math.max(1,d/Math.min(c.width,c.height)),maxBitrate:c.encoding.maxBitrate},g=a&&c.encoding.maxFramerate?Math.min(a,c.encoding.maxFramerate):c.encoding.maxFramerate;g&&(f.maxFramerate=g);const v=Ha()||u===0;c.encoding.priority&&v&&(f.priority=c.encoding.priority,f.networkPriority=c.encoding.priority),r.push(f)}),Qn()&&fC()==="ios"){let c;r.forEach(d=>{c?d.maxFramerate&&d.maxFramerate>c&&(c=d.maxFramerate):c=d.maxFramerate});let u=!0;r.forEach(d=>{var h;d.maxFramerate!=c&&(u&&(u=!1,Te.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Te.info('Setting framerate of encoding "'.concat((h=d.rid)!==null&&h!==void 0?h:"",'" to ').concat(c)),d.maxFramerate=c)})}return r}function bb(n){if(n)return n.sort((e,i)=>{const{encoding:a}=e,{encoding:r}=i;return a.maxBitrate>r.maxBitrate?1:a.maxBitrate<r.maxBitrate?-1:a.maxBitrate===r.maxBitrate&&a.maxFramerate&&r.maxFramerate?a.maxFramerate>r.maxFramerate?1:-1:0})}class EC{constructor(e){const i=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function _M(n){return n.source===X.Source.ScreenShare||n.constraints.height&&oa(n.constraints.height)>=1080?"maintain-resolution":"balanced"}const RM=5e3;class Nl extends kC{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,X.Kind.Video,i,a,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>k(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let c;try{c=yield this.getSenderStats()}catch(h){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:h}));return}const u=new Map(c.map(h=>[h.rid,h])),d=c.some(h=>h.qualityLimitationReason==="cpu");if(d!==this.isCpuConstrained&&(this.isCpuConstrained=d,this.isCpuConstrained&&this.emit(ee.CpuConstrained)),this.prevStats){let h=0;u.forEach((f,g)=>{var v;const b=(v=this.prevStats)===null||v===void 0?void 0:v.get(g);h+=Jl(f,b)}),this._currentBitrate=h}this.prevStats=u}),this.senderLock=new Ft}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var i;if(this.signalClient=e,!Wt())return;const a=(i=this.sender)===null||i===void 0?void 0:i.getParameters();a&&(this.encodings=a.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Rm))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return k(this,void 0,void 0,function*(){var i,a,r,c,u;yield e.pauseUpstream.call(this);try{for(var d=!0,h=Si(this.simulcastCodecs.values()),f;f=yield h.next(),i=f.done,!i;d=!0)c=f.value,d=!1,yield(u=c.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(g){a={error:g}}finally{try{!d&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(a)throw a.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return k(this,void 0,void 0,function*(){var i,a,r,c,u;yield e.resumeUpstream.call(this);try{for(var d=!0,h=Si(this.simulcastCodecs.values()),f;f=yield h.next(),i=f.done,!i;d=!0){c=f.value,d=!1;const g=c;yield(u=g.sender)===null||u===void 0?void 0:u.replaceTrack(g.mediaStreamTrack)}}catch(g){a={error:g}}finally{try{!d&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(a)throw a.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return k(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===X.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{i()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return k(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===X.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(e){super.setTrackMuted(e);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!e}getSenderStats(){return k(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const i=[],a=yield this.sender.getStats();return a.forEach(r=>{var c;if(r.type==="outbound-rtp"){const u={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(c=r.rid)!==null&&c!==void 0?c:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},d=a.get(r.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),i.push(u)}}),i.sort((r,c)=>{var u,d;return((u=c.frameWidth)!==null&&u!==void 0?u:0)-((d=r.frameWidth)!==null&&d!==void 0?d:0)}),i})}setPublishingQuality(e){const i=[];for(let a=dn.LOW;a<=dn.HIGH;a+=1)i.push(new fm({quality:a,enabled:a<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Un(this.codec),i)}restartTrack(e){return k(this,void 0,void 0,function*(){var i,a,r,c,u;let d;if(e){const v=bm({video:e});typeof v.video!="boolean"&&(d=v.video)}yield this.restart(d),this.isCpuConstrained=!1;try{for(var h=!0,f=Si(this.simulcastCodecs.values()),g;g=yield f.next(),i=g.done,!i;h=!0){c=g.value,h=!1;const v=c;v.sender&&((u=v.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(v.mediaStreamTrack=this.mediaStreamTrack.clone(),yield v.sender.replaceTrack(v.mediaStreamTrack))}}catch(v){a={error:v}}finally{try{!h&&!i&&(r=f.return)&&(yield r.call(f))}finally{if(a)throw a.error}}})}setProcessor(e){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return k(this,arguments,void 0,function(a){var r=this;let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var u,d,h,f,g,v;if(yield i.setProcessor.call(r,a,c),!((g=r.processor)===null||g===void 0)&&g.processedTrack)try{for(var b=!0,T=Si(r.simulcastCodecs.values()),C;C=yield T.next(),u=C.done,!u;b=!0)f=C.value,b=!1,yield(v=f.sender)===null||v===void 0?void 0:v.replaceTrack(r.processor.processedTrack)}catch(E){d={error:E}}finally{try{!b&&!u&&(h=T.return)&&(yield h.call(T))}finally{if(d)throw d.error}}})()})}setDegradationPreference(e){return k(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const i=this.sender.getParameters();i.degradationPreference=e,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(e,i){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const a={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(e,a),a}setSimulcastTrackSender(e,i){const a=this.simulcastCodecs.get(e);a&&(a.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},RM))}setPublishingCodecs(e){return k(this,void 0,void 0,function*(){var i,a,r,c,u,d,h;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Un(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const f=[];try{for(i=!0,a=Si(e);r=yield a.next(),c=r.done,!c;i=!0){h=r.value,i=!1;const g=h;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(Un(g.codec),g.qualities);else{const v=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:v})),!v||!v.sender){for(const b of g.qualities)if(b.enabled){f.push(g.codec);break}}else v.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield Tb(v.sender,v.encodings,g.qualities,this.senderLock,Un(g.codec),this.log,this.logContext))}}}catch(g){u={error:g}}finally{try{!i&&!c&&(d=a.return)&&(yield d.call(a))}finally{if(u)throw u.error}}return f})}setPublishingLayers(e,i){return k(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:i}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:i})),!(!this.sender||!this.encodings)&&(yield Tb(this.sender,this.encodings,i,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return k(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const i=this.sender.getParameters();i.encodings=i.encodings.map((a,r)=>{var c;return Object.assign(Object.assign({},a),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((c=this.mediaStreamTrack.getSettings().height)!==null&&c!==void 0?c:360)/360)),scalabilityMode:r===0&&Un(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?a.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:i.encodings})),this.encodings=i.encodings,yield this.sender.setParameters(i)}catch(i){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:i})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return k(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),dC()&&this.isInBackground&&this.source===X.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Tb(n,e,i,a,r,c,u){return k(this,void 0,void 0,function*(){const d=yield a.lock();c.debug("setPublishingLayersForSender",Object.assign(Object.assign({},u),{sender:n,qualities:i,senderEncodings:e}));try{const h=n.getParameters(),{encodings:f}=h;if(!f)return;if(f.length!==e.length){c.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},u),{encodings:f,senderEncodings:e}));return}let g=!1;!1&&f[0].scalabilityMode||(r&&i.some(T=>T.enabled)&&i.forEach(T=>T.enabled=!0),f.forEach((b,T)=>{var C;let E=(C=b.rid)!==null&&C!==void 0?C:"";E===""&&(E="q");const x=_C(E),w=i.find(V=>V.quality===x);w&&b.active!==w.enabled&&(g=!0,b.active=w.enabled,c.debug("setting layer ".concat(w.quality," to ").concat(b.active?"enabled":"disabled"),u),Ha()&&(w.enabled?(b.scaleResolutionDownBy=e[T].scaleResolutionDownBy,b.maxBitrate=e[T].maxBitrate,b.maxFrameRate=e[T].maxFrameRate):(b.scaleResolutionDownBy=4,b.maxBitrate=10,b.maxFrameRate=2)))})),g&&(h.encodings=f,c.debug("setting encodings",Object.assign(Object.assign({},u),{encodings:h.encodings})),yield n.setParameters(h))}finally{d()}})}function _C(n){switch(n){case"f":return dn.HIGH;case"h":return dn.MEDIUM;case"q":return dn.LOW;default:return dn.HIGH}}function Sb(n,e,i,a){if(!i)return[new sa({quality:dn.HIGH,width:n,height:e,bitrate:0,ssrc:0})];if(a){const r=i[0].scalabilityMode,c=new EC(r),u=[],d=c.suffix=="h"?1.5:2,h=c.suffix=="h"?2:3;for(let f=0;f<c.spatial;f+=1)u.push(new sa({quality:Math.min(dn.HIGH,c.spatial-1)-f,width:Math.ceil(n/Math.pow(d,f)),height:Math.ceil(e/Math.pow(d,f)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(h,f)):0,ssrc:0}));return u}return i.map(r=>{var c,u,d;const h=(c=r.scaleResolutionDownBy)!==null&&c!==void 0?c:1;let f=_C((u=r.rid)!==null&&u!==void 0?u:"");return new sa({quality:f,width:Math.ceil(n/h),height:Math.ceil(e/h),bitrate:(d=r.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}const Cb="_lossy",kb="_reliable",AM=2*1e3,Fh="leave-reconnect",wM=3e4;var kn;(function(n){n[n.New=0]="New",n[n.Connected=1]="Connected",n[n.Disconnected=2]="Disconnected",n[n.Reconnecting=3]="Reconnecting",n[n.Closed=4]="Closed"})(kn||(kn={}));class MM extends Wn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var i;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Em.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=kn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Te,this.reliableDataSequence=1,this.reliableMessageBuffer=new lb,this.reliableReceivedState=new Ww(wM),this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=a=>k(this,[a],void 0,function(r){var c=this;let{channel:u}=r;return(function*(){if(u){if(u.label===kb)c.reliableDCSub=u;else if(u.label===Cb)c.lossyDCSub=u;else return;c.log.debug("on data channel ".concat(u.id,", ").concat(u.label),c.logContext),u.onmessage=c.handleDataMessage}})()}),this.handleDataMessage=a=>k(this,void 0,void 0,function*(){var r,c,u,d,h;const f=yield this.dataProcessLock.lock();try{let g;if(a.data instanceof ArrayBuffer)g=a.data;else if(a.data instanceof Blob)g=yield a.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data}));return}const v=jt.fromBinary(new Uint8Array(g));if(v.sequence>0&&v.participantSid!==""){const b=this.reliableReceivedState.get(v.participantSid);if(b&&v.sequence<=b)return;this.reliableReceivedState.set(v.participantSid,v.sequence)}if(((r=v.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(te.ActiveSpeakersUpdate,v.value.value.speakers);else if(((c=v.value)===null||c===void 0?void 0:c.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const b=yield(u=this.e2eeManager)===null||u===void 0?void 0:u.handleEncryptedData(v.value.value.encryptedValue,v.value.value.iv,v.participantIdentity,v.value.value.keyIndex),T=uS.fromBinary(b.payload),C=new jt({value:T.value,participantIdentity:v.participantIdentity,participantSid:v.participantSid});((d=C.value)===null||d===void 0?void 0:d.case)==="user"&&Eb(C,C.value.value),this.emit(te.DataPacketReceived,C,v.value.value.encryptionType)}else((h=v.value)===null||h===void 0?void 0:h.case)==="user"&&Eb(v,v.value.value),this.emit(te.DataPacketReceived,v,St.NONE)}finally{f()}}),this.handleDataError=a=>{const c=a.currentTarget.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){const{error:u}=a.error;this.log.error("DataChannel error on ".concat(c,": ").concat(a.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(c),Object.assign(Object.assign({},this.logContext),{event:a}))},this.handleBufferedAmountLow=a=>{const c=a.currentTarget.maxRetransmits===0?Ae.LOSSY:Ae.RELIABLE;this.updateAndEmitDCBufferStatus(c)},this.handleDisconnect=(a,r)=>{if(this._isClosed)return;this.log.warn("".concat(a," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const c=h=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(h,"ms. giving up"),this.logContext),this.emit(te.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){c(u);return}a===Fh&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=xt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),d)},this.waitForRestarted=()=>new Promise((a,r)=>{this.pcState===kn.Connected&&a();const c=()=>{this.off(te.Disconnected,u),a()},u=()=>{this.off(te.Restarted,c),r()};this.once(te.Restarted,c),this.once(te.Disconnected,u)}),this.updateAndEmitDCBufferStatus=a=>{if(a===Ae.RELIABLE){const c=this.dataChannelForKind(a);c&&this.reliableMessageBuffer.alignBufferedAmount(c.bufferedAmount)}const r=this.isBufferStatusLow(a);typeof r<"u"&&r!==this.dcBufferStatus.get(a)&&(this.dcBufferStatus.set(a,r),this.emit(te.DCBufferStatusChanged,r,a))},this.isBufferStatusLow=a=>{const r=this.dataChannelForKind(a);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>k(this,void 0,void 0,function*(){!this.url||!(yield fetch(Eo(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ke.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ke.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(La.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>k(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Eo(this.url),{method:"HEAD"}),Pt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Ei((i=e.loggerName)!==null&&i!==void 0?i:jn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Tm(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Ft,this.dataProcessLock=new Ft,this.dcBufferStatus=new Map([[Ae.LOSSY,!0],[Ae.RELIABLE,!0]]),this.client.onParticipantUpdate=a=>this.emit(te.ParticipantUpdate,a),this.client.onConnectionQuality=a=>this.emit(te.ConnectionQualityUpdate,a),this.client.onRoomUpdate=a=>this.emit(te.RoomUpdate,a),this.client.onSubscriptionError=a=>this.emit(te.SubscriptionError,a),this.client.onSubscriptionPermissionUpdate=a=>this.emit(te.SubscriptionPermissionUpdate,a),this.client.onSpeakersChanged=a=>this.emit(te.SpeakersChanged,a),this.client.onStreamStateUpdate=a=>this.emit(te.StreamStateChanged,a),this.client.onRequestResponse=a=>this.emit(te.SignalRequestResponse,a)}get logContext(){var e,i,a,r,c,u;return{room:(i=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||i===void 0?void 0:i.name,roomID:(r=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||r===void 0?void 0:r.sid,participant:(u=(c=this.latestJoinResponse)===null||c===void 0?void 0:c.participant)===null||u===void 0?void 0:u.identity,pID:this.participantSid}}join(e,i,a,r){return k(this,void 0,void 0,function*(){this.url=e,this.token=i,this.signalOpts=a,this.maxJoinAttempts=a.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const c=yield this.client.join(e,i,a,r);return this._isClosed=!1,this.latestJoinResponse=c,this.subscriberPrimary=c.subscriberPrimary,this.pcManager||(yield this.configure(c)),(!this.subscriberPrimary||c.fastPublish)&&this.negotiate().catch(u=>{Te.error(u,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=c.clientConfiguration,this.emit(te.SignalConnected,c),c}catch(c){if(c instanceof Oe&&c.reason===ge.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,i,a,r);throw c}})}close(){return k(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(te.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return k(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const i=a=>{a&&(a.close(),a.onbufferedamountlow=null,a.onclose=null,a.onclosing=null,a.onerror=null,a.onmessage=null,a.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new lb,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return k(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ci("a track with the same ID has already been published");return new Promise((i,a)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],a(new Oe("publication of local track timed out, no response from server",ge.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:c=>{clearTimeout(r),i(c)},reject:()=>{clearTimeout(r),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:i}=this.pendingTrackResolvers[e.track.id];i&&i(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(e,i){this.client.sendMuteTrack(e,i)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return k(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return k(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==nt.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new rM(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(te.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(c,u)=>{this.client.sendIceCandidate(c,u)},this.pcManager.onPublisherOffer=(c,u)=>{this.client.sendOffer(c,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(c,u,d)=>k(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(c),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),c===nt.CONNECTED){const g=this.pcState===kn.New;this.pcState=kn.Connected,g&&this.emit(te.Connected,e)}else c===nt.FAILED&&(this.pcState===kn.Connected||this.pcState===kn.Reconnecting)&&(this.pcState=kn.Disconnected,this.handleDisconnect("peerconnection failed",d==="failed"?La.RR_SUBSCRIBER_FAILED:La.RR_PUBLISHER_FAILED));const h=this.client.isDisconnected||this.client.currentState===Ke.RECONNECTING,f=[nt.FAILED,nt.CLOSING,nt.CLOSED].includes(c);h&&f&&!this._isClosed&&this.emit(te.Offline)}),this.pcManager.onTrack=c=>{c.streams.length!==0&&this.emit(te.MediaTrackAdded,c.track,c.streams[0],c.receiver)},DM((a=e.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,i,a)=>k(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:a})),this.midToTrackId=a,yield this.pcManager.setPublisherAnswer(e,i))}),this.client.onTrickle=(e,i)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:i})),this.pcManager.addIceCandidate(e,i))},this.client.onOffer=(e,i,a)=>k(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=i,!this.pcManager)return;this.midToTrackId=a;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,i);r&&this.client.sendAnswer(r,i)}),this.client.onLocalTrackPublished=e=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(i=e.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:a}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],a(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(te.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(te.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var i;this.token=e,(i=this.regionUrlProvider)===null||i===void 0||i.updateToken(e)},this.client.onRemoteMuteChanged=(e,i)=>{this.emit(te.RemoteMute,e,i)},this.client.onSubscribedQualityUpdate=e=>{this.emit(te.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var i;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(te.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var i,a;const r={direction:"recvonly"};for(let c=0;c<e.numAudios;c++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("audio",r);for(let c=0;c<e.numVideos;c++)(a=this.pcManager)===null||a===void 0||a.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",La.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:SC,regionSettings:e.regions})),e.action){case zs.DISCONNECT:this.emit(te.Disconnected,e?.reason),this.close();break;case zs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Fh);break;case zs.RESUME:this.handleDisconnect(Fh)}}}makeRTCConfiguration(e){var i;const a=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),e.iceServers&&!a.iceServers){const r=[];e.iceServers.forEach(c=>{const u={urls:c.urls};c.username&&(u.username=c.username),c.credential&&(u.credential=c.credential),r.push(u)}),a.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===bo.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Cb,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(kb,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,i,a){return k(this,void 0,void 0,function*(){if(Cf())return yield this.createTransceiverRTCRtpSender(e,i,a);if(kf())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Tt("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,i,a,r){return k(this,void 0,void 0,function*(){if(Cf())return this.createSimulcastTransceiverSender(e,i,a,r);if(kf())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Tt("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,i,a){return k(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),ha(e)&&(e.codec=i.videoCodec);const c={direction:"sendonly",streams:r};return a&&(c.sendEncodings=a),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,c)).sender})}createSimulcastTransceiverSender(e,i,a,r){return k(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");const c={direction:"sendonly"};r&&(c.sendEncodings=r);const u=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,c);if(a.videoCodec)return e.setSimulcastTrackSender(a.videoCodec,u.sender),u.sender})}createRTCRtpSender(e){return k(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return k(this,void 0,void 0,function*(){var i,a,r;if(!this._isClosed){if(this.attemptingReconnect){Te.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===bo.DISABLED||((r=(a=this.pcManager)===null||a===void 0?void 0:a.currentState)!==null&&r!==void 0?r:nt.NEW)===nt.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(c){this.reconnectAttempts+=1;let u=!0;c instanceof Tt?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:c})),u=!1):c instanceof xs||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",La.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(te.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(e){return k(this,void 0,void 0,function*(){var i,a,r;try{if(!this.url||!this.token)throw new Tt("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let c;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new xs;c=yield this.join(e??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof Oe&&u.reason===ge.NotAllowed?new Tt("could not reconnect, token might be expired"):new xs}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(te.SignalRestarted,c),yield this.waitForPCReconnected(),this.client.currentState!==Ke.CONNECTED)throw new xs("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit(te.Restarted)}catch(c){const u=yield(a=this.regionUrlProvider)===null||a===void 0?void 0:a.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),c}})}resumeConnection(e){return k(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new Tt("could not reconnect, url or token not saved");if(!this.pcManager)throw new Tt("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Resuming);let a;try{this.setupSignalClientCallbacks(),a=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let c="";throw r instanceof Error&&(c=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof Oe&&r.reason===ge.NotAllowed?new Tt("could not reconnect, token might be expired"):r instanceof Oe&&r.reason===ge.LeaveRequest?r:new xs(c)}if(this.emit(te.SignalResumed),a){const r=this.makeRTCConfiguration(a);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=a.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ke.CONNECTED)throw new xs("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),a?.lastMessageSeq&&this.resendReliableMessagesForResume(a.lastMessageSeq),this.emit(te.Resumed)})}waitForPCInitialConnection(e,i){return k(this,void 0,void 0,function*(){if(!this.pcManager)throw new Tt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,e)})}waitForPCReconnected(){return k(this,void 0,void 0,function*(){this.pcState=kn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Pt(AM),!this.pcManager)throw new Tt("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=kn.Connected}catch(e){throw this.pcState=kn.Disconnected,new Oe("could not establish PC connection, ".concat(e.message),ge.InternalError)}})}publishRpcResponse(e,i,a,r){return k(this,void 0,void 0,function*(){const c=new jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcResponse",value:new lm({requestId:i,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:a??""}})}});yield this.sendDataPacket(c,Ae.RELIABLE)})}publishRpcAck(e,i){return k(this,void 0,void 0,function*(){const a=new jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcAck",value:new cm({requestId:i})}});yield this.sendDataPacket(a,Ae.RELIABLE)})}sendDataPacket(e,i){return k(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(i),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const c=ZA(e);if(c){const u=yield this.e2eeManager.encryptData(c.toBinary());e.value={case:"encryptedPacket",value:new lS({encryptedValue:u.payload,iv:u.iv,keyIndex:u.keyIndex})}}}i===Ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const a=e.toBinary();yield this.waitForBufferStatusLow(i);const r=this.dataChannelForKind(i);if(r){if(i===Ae.RELIABLE&&this.reliableMessageBuffer.push({data:a,sequence:e.sequence}),this.attemptingReconnect)return;r.send(a)}this.updateAndEmitDCBufferStatus(i)})}resendReliableMessagesForResume(e){return k(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ae.RELIABLE);const i=this.dataChannelForKind(Ae.RELIABLE);i&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(a=>{i.send(a.data)})),this.updateAndEmitDCBufferStatus(Ae.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((i,a)=>k(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))i();else{const r=()=>a("Engine closed");for(this.once(te.Closing,r);!this.dcBufferStatus.get(e);)yield Pt(10);this.off(te.Closing,r),i()}}))}ensureDataTransportConnected(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var c;if(!a.pcManager)throw new Tt("PC manager is closed");const u=r?a.pcManager.subscriber:a.pcManager.publisher,d=r?"Subscriber":"Publisher";if(!u)throw new Oe("".concat(d," connection not set"),ge.InternalError);let h=!1;!r&&!a.dataChannelForKind(i,r)&&(a.createDataChannels(),h=!0),!h&&!r&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(h=!0),h&&a.negotiate().catch(v=>{Te.error(v,a.logContext)});const f=a.dataChannelForKind(i,r);if(f?.readyState==="open")return;const g=new Date().getTime()+a.peerConnectionTimeout;for(;new Date().getTime()<g;){if(u.isICEConnected&&((c=a.dataChannelForKind(i,r))===null||c===void 0?void 0:c.readyState)==="open")return;yield Pt(50)}throw new Oe("could not establish ".concat(d," connection, state: ").concat(u.getICEConnectionState()),ge.InternalError)})()})}ensurePublisherConnected(e){return k(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==nt.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return k(this,void 0,void 0,function*(){return new Promise((e,i)=>k(this,void 0,void 0,function*(){if(!this.pcManager){i(new bf("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const a=new AbortController,r=()=>{a.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&i("cannot negotiate on closed engine"),this.on(te.Closing,r),this.pcManager.publisher.once(Ys.RTPVideoPayloadTypes,c=>{const u=new Map;c.forEach(d=>{const h=d.codec.toLowerCase();Cw(h)&&u.set(d.payload,h)}),this.emit(te.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(a),e()}catch(c){c instanceof bf&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",La.RR_UNKNOWN),i(c)}finally{this.off(te.Closing,r)}}))})}dataChannelForKind(e,i){if(i){if(e===Ae.LOSSY)return this.lossyDCSub;if(e===Ae.RELIABLE)return this.reliableDCSub}else{if(e===Ae.LOSSY)return this.lossyDC;if(e===Ae.RELIABLE)return this.reliableDC}}sendSyncState(e,i){var a,r,c,u;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const d=this.pcManager.publisher.getLocalDescription(),h=this.pcManager.publisher.getRemoteDescription(),f=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getRemoteDescription(),g=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),v=(u=(c=this.signalOpts)===null||c===void 0?void 0:c.autoSubscribe)!==null&&u!==void 0?u:!0,b=new Array,T=new Array;e.forEach(C=>{C.isDesired!==v&&b.push(C.trackSid),C.isEnabled||T.push(C.trackSid)}),this.client.sendSyncState(new mm({answer:this.options.singlePeerConnection?h?Ls({sdp:h.sdp,type:h.type}):void 0:g?Ls({sdp:g.sdp,type:g.type}):void 0,offer:this.options.singlePeerConnection?d?Ls({sdp:d.sdp,type:d.type}):void 0:f?Ls({sdp:f.sdp,type:f.type}):void 0,subscription:new Yl({trackSids:b,subscribe:!v,participantTracks:[]}),publishTracks:xw(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:T,datachannelReceiveStates:this.reliableReceivedState.map((C,E)=>new MS({publisherSid:E,lastSeq:C}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],i=(a,r)=>{a?.id!==void 0&&a.id!==null&&e.push(new DS({label:a.label,id:a.id,target:r}))};return i(this.dataChannelForKind(Ae.LOSSY),In.PUBLISHER),i(this.dataChannelForKind(Ae.RELIABLE),In.PUBLISHER),i(this.dataChannelForKind(Ae.LOSSY,!0),In.SUBSCRIBER),i(this.dataChannelForKind(Ae.RELIABLE,!0),In.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&xt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Wt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Wt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var i;const a=(i=this.pcManager)===null||i===void 0?void 0:i.getMidForReceiver(e);if(a){const r=Object.entries(this.midToTrackId).find(c=>{let[u]=c;return u===a});if(r)return r[1]}}}class xs extends Error{}function DM(n){return n!==void 0&&n>13}function Eb(n,e){const i=n.participantIdentity?n.participantIdentity:e.participantIdentity;n.participantIdentity=i,e.participantIdentity=i;const a=n.destinationIdentities.length!==0?n.destinationIdentities:e.destinationIdentities;n.destinationIdentities=a,e.destinationIdentities=a}class RC{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new _n("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Bt.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new _n("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Bt.LengthExceeded)}}constructor(e,i,a,r){this.reader=i,this.totalByteSize=a,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class OM extends RC{handleChunkReceived(e){var i;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,a)}[Symbol.asyncIterator](){const e=this.reader.getReader();let i=new Rn,a=null,r=null;if(this.signal){const u=this.signal;r=()=>{var d;(d=i.reject)===null||d===void 0||d.call(i,u.reason)},u.addEventListener("abort",r),a=u}const c=()=>{e.releaseLock(),a&&r&&a.removeEventListener("abort",r),this.signal=void 0};return{next:()=>k(this,void 0,void 0,function*(){var u,d;try{const{done:h,value:f}=yield Promise.race([e.read(),i.promise,(d=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&d!==void 0?d:new Promise(()=>{})]);return h?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(f),{done:!1,value:f.content})}catch(h){throw c(),h}}),return(){return k(this,void 0,void 0,function*(){return c(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,r,c,u;let d=new Set;const h=i.signal?e.withAbortSignal(i.signal):e;try{for(var f=!0,g=Si(h),v;v=yield g.next(),a=v.done,!a;f=!0){u=v.value,f=!1;const b=u;d.add(b)}}catch(b){r={error:b}}finally{try{!f&&!a&&(c=g.return)&&(yield c.call(g))}finally{if(r)throw r.error}}return Array.from(d)})()})}}class xM extends RC{constructor(e,i,a,r){super(e,i,a,r),this.receivedChunks=new Map}handleChunkReceived(e){var i;const a=bl(e.chunkIndex),r=this.receivedChunks.get(a);if(r&&r.version>e.version)return;this.receivedChunks.set(a,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const c=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,c)}[Symbol.asyncIterator](){const e=this.reader.getReader(),i=new TextDecoder("utf-8",{fatal:!0});let a=new Rn,r=null,c=null;if(this.signal){const d=this.signal;c=()=>{var h;(h=a.reject)===null||h===void 0||h.call(a,d.reason)},d.addEventListener("abort",c),r=d}const u=()=>{e.releaseLock(),r&&c&&r.removeEventListener("abort",c),this.signal=void 0};return{next:()=>k(this,void 0,void 0,function*(){var d,h;try{const{done:f,value:g}=yield Promise.race([e.read(),a.promise,(h=(d=this.outOfBandFailureRejectingFuture)===null||d===void 0?void 0:d.promise)!==null&&h!==void 0?h:new Promise(()=>{})]);if(f)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let v;try{v=i.decode(g.content)}catch(b){throw new _n("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(b),Bt.DecodeFailed)}return{done:!1,value:v}}}catch(f){throw u(),f}}),return(){return k(this,void 0,void 0,function*(){return u(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return k(this,arguments,void 0,function(){var e=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,r,c,u;let d="";const h=i.signal?e.withAbortSignal(i.signal):e;try{for(var f=!0,g=Si(h),v;v=yield g.next(),a=v.done,!a;f=!0)u=v.value,f=!1,d+=u}catch(b){r={error:b}}finally{try{!f&&!a&&(c=g.return)&&(yield c.call(g))}finally{if(r)throw r.error}}return d})()})}}class PM{constructor(){this.log=Te,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,i){if(this.textStreamHandlers.has(e))throw new _n('A text stream handler for topic "'.concat(e,'" has already been set.'),Bt.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,i)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,i){if(this.byteStreamHandlers.has(e))throw new _n('A byte stream handler for topic "'.concat(e,'" has already been set.'),Bt.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,i)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var i,a,r,c;const u=Array.from(this.textStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e),d=Array.from(this.byteStreamControllers.entries()).filter(h=>h[1].sendingParticipantIdentity===e);if(u.length>0||d.length>0){const h=new _n("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Bt.AbnormalEnd);for(const[f,g]of d)(a=(i=g.outOfBandFailureRejectingFuture).reject)===null||a===void 0||a.call(i,h),this.byteStreamControllers.delete(f);for(const[f,g]of u)(c=(r=g.outOfBandFailureRejectingFuture).reject)===null||c===void 0||c.call(r,h),this.textStreamControllers.delete(f)}}handleDataStreamPacket(e,i){return k(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,i);case"streamChunk":return this.handleStreamChunk(e.value.value,i);case"streamTrailer":return this.handleStreamTrailer(e.value.value,i);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,i,a){return k(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const c=this.byteStreamHandlers.get(e.topic);if(!c){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let u;const d=new Rn;d.promise.catch(g=>{this.log.error(g)});const h={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:bl(e.timestamp),attributes:e.attributes,encryptionType:a},f=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(e.streamId))throw new _n("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Bt.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:h,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});c(new OM(h,f,bl(e.totalLength),d),{identity:i})}else if(e.contentHeader.case==="textHeader"){const c=this.textStreamHandlers.get(e.topic);if(!c){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let u;const d=new Rn;d.promise.catch(g=>{this.log.error(g)});const h={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:a},f=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(e.streamId))throw new _n("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Bt.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:h,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});c(new xM(h,f,bl(e.totalLength),d),{identity:i})}})}handleStreamChunk(e,i){const a=this.byteStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==i?(a.controller.error(new _n("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Bt.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&a.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==i?(r.controller.error(new _n("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(i,", got ").concat(r.info.encryptionType),Bt.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,i){const a=this.textStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==i?a.controller.error(new _n("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),Bt.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),e.attributes),a.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==i?r.controller.error(new _n("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(i,", got ").concat(r.info.encryptionType),Bt.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class AC{constructor(e,i,a){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=a,this.info=i}write(e){return this.defaultWriter.write(e)}close(){return k(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class NM extends AC{}class LM extends AC{}const _b=15e3;class IM{constructor(e,i){this.engine=e,this.log=i}setupEngine(e){this.engine=e}sendText(e,i){return k(this,void 0,void 0,function*(){var a;const r=crypto.randomUUID(),u=new TextEncoder().encode(e).byteLength,d=(a=i?.attachments)===null||a===void 0?void 0:a.map(()=>crypto.randomUUID()),h=new Array(d?d.length+1:1).fill(0),f=(v,b)=>{var T;h[b]=v;const C=h.reduce((E,x)=>E+x,0);(T=i?.onProgress)===null||T===void 0||T.call(i,C)},g=yield this.streamText({streamId:r,totalSize:u,destinationIdentities:i?.destinationIdentities,topic:i?.topic,attachedStreamIds:d,attributes:i?.attributes});return yield g.write(e),f(1,0),yield g.close(),i?.attachments&&d&&(yield Promise.all(i.attachments.map((v,b)=>k(this,void 0,void 0,function*(){return this._sendFile(d[b],v,{topic:i.topic,mimeType:v.type,onProgress:T=>{f(T,b+1)}})})))),g.info})}streamText(e){return k(this,void 0,void 0,function*(){var i,a,r;const c=(i=e?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),u={id:c,mimeType:"text/plain",timestamp:Date.now(),topic:(a=e?.topic)!==null&&a!==void 0?a:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?St.GCM:St.NONE},d=new wl({streamId:c,mimeType:u.mimeType,topic:u.topic,timestamp:Ia(u.timestamp),totalLength:Ia(e?.totalSize),attributes:u.attributes,contentHeader:{case:"textHeader",value:new SS({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?cf.UPDATE:cf.CREATE})}}),h=e?.destinationIdentities,f=new jt({destinationIdentities:h,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(f,Ae.RELIABLE);let g=0;const v=this.engine,b=new WritableStream({write(E){return k(this,void 0,void 0,function*(){for(const x of ww(E,_b)){const w=new Ml({content:x,streamId:c,chunkIndex:Ia(g)}),V=new jt({destinationIdentities:h,value:{case:"streamChunk",value:w}});yield v.sendDataPacket(V,Ae.RELIABLE),g+=1}})},close(){return k(this,void 0,void 0,function*(){const E=new Dl({streamId:c}),x=new jt({destinationIdentities:h,value:{case:"streamTrailer",value:E}});yield v.sendDataPacket(x,Ae.RELIABLE)})},abort(E){console.log("Sink error:",E)}});let T=()=>k(this,void 0,void 0,function*(){yield C.close()});v.once(te.Closing,T);const C=new NM(b,u,()=>this.engine.off(te.Closing,T));return C})}sendFile(e,i){return k(this,void 0,void 0,function*(){const a=crypto.randomUUID();return yield this._sendFile(a,e,i),{id:a}})}_sendFile(e,i,a){return k(this,void 0,void 0,function*(){var r;const c=yield this.streamBytes({streamId:e,totalSize:i.size,name:i.name,mimeType:(r=a?.mimeType)!==null&&r!==void 0?r:i.type,topic:a?.topic,destinationIdentities:a?.destinationIdentities}),u=i.stream().getReader();for(;;){const{done:d,value:h}=yield u.read();if(d)break;yield c.write(h)}return yield c.close(),c.info})}streamBytes(e){return k(this,void 0,void 0,function*(){var i,a,r,c,u,d;const h=(i=e?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),f=e?.destinationIdentities,g={id:h,mimeType:(a=e?.mimeType)!==null&&a!==void 0?a:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(c=e?.name)!==null&&c!==void 0?c:"unknown",encryptionType:!((u=this.engine.e2eeManager)===null||u===void 0)&&u.isDataChannelEncryptionEnabled?St.GCM:St.NONE},v=new wl({totalLength:Ia((d=g.size)!==null&&d!==void 0?d:0),mimeType:g.mimeType,streamId:h,topic:g.topic,timestamp:Ia(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new CS({name:g.name})}}),b=new jt({destinationIdentities:f,value:{case:"streamHeader",value:v}});yield this.engine.sendDataPacket(b,Ae.RELIABLE);let T=0;const C=new Ft,E=this.engine,x=this.log,w=new WritableStream({write(I){return k(this,void 0,void 0,function*(){const A=yield C.lock();let R=0;try{for(;R<I.byteLength;){const B=I.slice(R,R+_b),F=new jt({destinationIdentities:f,value:{case:"streamChunk",value:new Ml({content:B,streamId:h,chunkIndex:Ia(T)})}});yield E.sendDataPacket(F,Ae.RELIABLE),T+=1,R+=B.byteLength}}finally{A()}})},close(){return k(this,void 0,void 0,function*(){const I=new Dl({streamId:h}),A=new jt({destinationIdentities:f,value:{case:"streamTrailer",value:I}});yield E.sendDataPacket(A,Ae.RELIABLE)})},abort(I){x.error("Sink error:",I)}});return new LM(w,g)})}}class wC extends X{constructor(e,i,a,r,c){super(e,a,c),this.sid=i,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ee.Muted:ee.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const i=a=>{a.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(ee.Ended,this))};e.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return k(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Rm)),Pw()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>e());const a=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(a){const{timestamp:r,rtpTimestamp:c}=a;c&&this.rtpTimestamp!==c&&(this.emit(ee.TimeSyncUpdate,{timestamp:r,rtpTimestamp:c}),this.rtpTimestamp=c)}};e()}}class UM extends wC{constructor(e,i,a,r,c,u){super(e,i,X.Kind.Audio,a,u),this.monitorReceiver=()=>k(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=Jl(d,this.prevStats)),this.prevStats=d}),this.audioContext=r,this.webAudioPluginNodes=[],c&&(this.sinkId=c.deviceId)}setVolume(e){var i;for(const a of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(e,0,.1):a.volume=e;Qn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Qn())return 1;let e=0;return this.attachedElements.forEach(i=>{i.volume>e&&(e=i.volume)}),e}setSinkId(e){return k(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(i=>{if(Ef(i))return i.setSinkId(e)}))})}attach(e){const i=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Ef(e)&&e.setSinkId(this.sinkId).catch(a=>{this.log.error("Failed to set sink id on remote audio track",a,this.logContext)}),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let i;return e?(i=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,i){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(i.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{a.connect(r),a=r}),this.gainNode=e.createGain(),a.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ee.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(ee.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,i;(e=this.gainNode)===null||e===void 0||e.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return k(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let i;return e.forEach(a=>{a.type==="inbound-rtp"&&(i={type:"audio",streamId:a.id,timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),i})}}const zh=100;class BM extends wC{constructor(e,i,a,r,c){super(e,i,X.Kind.Video,a,c),this.elementInfos=[],this.monitorReceiver=()=>k(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=Jl(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=Cm(()=>{this.updateDimensions()},zh),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===X.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(i=>{e?Hs(this._mediaStreamTrack,i):Ns(this._mediaStreamTrack,i)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===e)===void 0){const i=new jM(e);this.observeElementInfo(i)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(a=>a===e);for(const a of i)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let i=[];if(e)return this.stopObservingElement(e),super.detach(e);i=super.detach();for(const a of i)this.stopObservingElement(a);return i}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return k(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let i,a="",r=new Map;return e.forEach(c=>{c.type==="inbound-rtp"?(a=c.codecId,i={type:"video",streamId:c.id,framesDecoded:c.framesDecoded,framesDropped:c.framesDropped,framesReceived:c.framesReceived,packetsReceived:c.packetsReceived,packetsLost:c.packetsLost,frameWidth:c.frameWidth,frameHeight:c.frameHeight,pliCount:c.pliCount,firCount:c.firCount,nackCount:c.nackCount,jitter:c.jitter,timestamp:c.timestamp,bytesReceived:c.bytesReceived,decoderImplementation:c.decoderImplementation}):c.type==="codec"&&r.set(c.id,c)}),i&&a!==""&&r.get(a)&&(i.mimeType=r.get(a).mimeType),i})}stopObservingElement(e){const i=this.elementInfos.filter(a=>a.element===e);for(const a of i)this.stopObservingElementInfo(a)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return k(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var i,a;const r=this.elementInfos.reduce((h,f)=>Math.max(h,f.visibilityChangedAt||0),0),c=!((a=(i=this.adaptiveStreamSettings)===null||i===void 0?void 0:i.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,u=this.elementInfos.some(h=>h.pictureInPicture),d=this.elementInfos.some(h=>h.visible)&&!c||u;if(!(this.lastVisible===d&&!e)){if(!d&&Date.now()-r<zh){xt.setTimeout(()=>{this.updateVisibility()},zh);return}this.lastVisible=d,this.emit(ee.VisibilityChanged,d,this)}}updateDimensions(){var e,i;let a=0,r=0;const c=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*c,h=u.height()*c;d+h>a+r&&(a=d,r=h)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===a&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===r||(this.lastDimensions={width:a,height:r},this.emit(ee.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const i=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return i==="screen"?tb():i||(tb()>2?2:1)}}class jM{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,i){this.onVisibilityChanged=a=>{var r;const{target:c,isIntersecting:u}=a;c===this.element&&(this.isIntersecting=u,this.isPiP=io(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var a,r,c;(r=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=io(this.element),(c=this.handleVisibilityChanged)===null||c===void 0||c.call(this)},this.onLeavePiP=()=>{var a;this.isPiP=io(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.element=e,this.isIntersecting=i??Of(e),this.isPiP=Wt()&&io(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,i,a;this.isIntersecting=Of(this.element),this.isPiP=io(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,ib().observe(this.element),nb().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,i,a,r,c;(e=ib())===null||e===void 0||e.unobserve(this.element),(i=nb())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(a=window.documentPictureInPicture)===null||a===void 0||a.removeEventListener("enter",this.onEnterPiP),(c=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||c===void 0||c.removeEventListener("pagehide",this.onLeavePiP)}}function io(n){var e,i;return document.pictureInPictureElement===n?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Of(n,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Of(n,e){const i=e||window;let a=n.offsetTop,r=n.offsetLeft;const c=n.offsetWidth,u=n.offsetHeight,{hidden:d}=n,{display:h}=getComputedStyle(n);for(;n.offsetParent;)n=n.offsetParent,a+=n.offsetTop,r+=n.offsetLeft;return a<i.pageYOffset+i.innerHeight&&r<i.pageXOffset+i.innerWidth&&a+u>i.pageYOffset&&r+c>i.pageXOffset&&!d&&h!=="none"}class vi extends Wn.EventEmitter{constructor(e,i,a,r){var c;super(),this.metadataMuted=!1,this.encryption=St.NONE,this.log=Te,this.handleMuted=()=>{this.emit(ee.Muted)},this.handleUnmuted=()=>{this.emit(ee.Unmuted)},this.log=Ei((c=r?.loggerName)!==null&&c!==void 0?c:jn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=i,this.trackName=a,this.source=X.Source.Unknown}setTrack(e){this.track&&(this.track.off(ee.Muted,this.handleMuted),this.track.off(ee.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ee.Muted,this.handleMuted),e.on(ee.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Re(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==St.NONE}get audioTrack(){if(Kn(this.track))return this.track}get videoTrack(){if(ha(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=X.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===X.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(n){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(n.SubscriptionStatus||(n.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(n.PermissionStatus||(n.PermissionStatus={}))})(vi||(vi={}));class xf extends vi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,i,a,r){super(e,i.sid,i.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ee.Ended)},this.handleCpuConstrained=()=>{this.track&&ha(this.track)&&this.emit(ee.CpuConstrained,this.track)},this.updateInfo(i),this.setTrack(a)}setTrack(e){this.track&&(this.track.off(ee.Ended,this.handleTrackEnded),this.track.off(ee.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(ee.Ended,this.handleTrackEnded),e.on(ee.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return k(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return k(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return k(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return k(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Kn(this.track)){const i=this.track.getSourceTrackSettings(),a=new Set;return i.autoGainControl&&a.add(Et.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&a.add(Et.TF_ECHO_CANCELLATION),i.noiseSuppression&&a.add(Et.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&a.add(Et.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||a.add(Et.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(Et.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}function Wl(n,e){return k(this,void 0,void 0,function*(){n??(n={});let i=!1;const{audioProcessor:a,videoProcessor:r,optionsWithoutProcessor:c}=vC(n);let u=c.audio,d=c.video;if(a&&typeof c.audio=="object"&&(c.audio.processor=a),r&&typeof c.video=="object"&&(c.video.processor=r),n.audio&&typeof c.audio=="object"&&typeof c.audio.deviceId=="string"){const v=c.audio.deviceId;c.audio.deviceId={exact:v},i=!0,u=Object.assign(Object.assign({},c.audio),{deviceId:{ideal:v}})}if(c.video&&typeof c.video=="object"&&typeof c.video.deviceId=="string"){const v=c.video.deviceId;c.video.deviceId={exact:v},i=!0,d=Object.assign(Object.assign({},c.video),{deviceId:{ideal:v}})}c.audio===!0?c.audio={deviceId:"default"}:typeof c.audio=="object"&&c.audio!==null&&(c.audio=Object.assign(Object.assign({},c.audio),{deviceId:c.audio.deviceId||"default"})),c.video===!0?c.video={deviceId:"default"}:typeof c.video=="object"&&!c.video.deviceId&&(c.video.deviceId="default");const h=mC(c,bC,TC),f=bm(h),g=navigator.mediaDevices.getUserMedia(f);c.audio&&(_t.userMediaPromiseMap.set("audioinput",g),g.catch(()=>_t.userMediaPromiseMap.delete("audioinput"))),c.video&&(_t.userMediaPromiseMap.set("videoinput",g),g.catch(()=>_t.userMediaPromiseMap.delete("videoinput")));try{const v=yield g;return yield Promise.all(v.getTracks().map(b=>k(this,void 0,void 0,function*(){const T=b.kind==="audio";let C=T?h.audio:h.video;(typeof C=="boolean"||!C)&&(C={});let E;const x=T?f.audio:f.video;typeof x!="boolean"&&(E=x);const w=b.getSettings().deviceId;E?.deviceId&&oa(E.deviceId)!==w?E.deviceId=w:E||(E={deviceId:w});const V=pM(b,E,e);return V.kind===X.Kind.Video?V.source=X.Source.Camera:V.kind===X.Kind.Audio&&(V.source=X.Source.Microphone),V.mediaStream=v,Kn(V)&&a?yield V.setProcessor(a):ha(V)&&r&&(yield V.setProcessor(r)),V})))}catch(v){if(!i)throw v;return Wl(Object.assign(Object.assign({},n),{audio:u,video:d}),e)}})}function VM(n){return k(this,void 0,void 0,function*(){return(yield Wl({audio:!1,video:!0}))[0]})}function MC(n){return k(this,void 0,void 0,function*(){return(yield Wl({audio:n??!0,video:!1}))[0]})}var ia;(function(n){n.Excellent="excellent",n.Good="good",n.Poor="poor",n.Lost="lost",n.Unknown="unknown"})(ia||(ia={}));function FM(n){switch(n){case so.EXCELLENT:return ia.Excellent;case so.GOOD:return ia.Good;case so.POOR:return ia.Poor;case so.LOST:return ia.Lost;default:return ia.Unknown}}class DC extends Wn.EventEmitter{get logContext(){var e,i;return Object.assign({},(i=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||i===void 0?void 0:i.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===To.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Fs.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,i,a,r,c,u){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:To.STANDARD;var h;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ia.Unknown,this.log=Te,this.log=Ei((h=u?.loggerName)!==null&&h!==void 0?h:jn.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=e,this.identity=i,this.name=a,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=d,this._attributes=c??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,i]of this.trackPublications)if(i.source===e)return i}getTrackPublicationByName(e){for(const[,i]of this.trackPublications)if(i.trackName===e)return i}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Rn,this.once(ne.Active,()=>{var e,i;(i=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||i===void 0||i.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const i=this.getTrackPublication(X.Source.Camera);return!(!((e=i?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const i=this.getTrackPublication(X.Source.Microphone);return!(!((e=i?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(X.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var i;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Fs.ACTIVE&&((i=this.participantInfo)===null||i===void 0?void 0:i.state)!==Fs.ACTIVE&&this.emit(ne.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const i=this.metadata!==e,a=this.metadata;this.metadata=e,i&&this.emit(ne.ParticipantMetadataChanged,a)}_setName(e){const i=this.name!==e;this.name=e,i&&this.emit(ne.ParticipantNameChanged,e)}_setAttributes(e){const i=Nw(this.attributes,e);this._attributes=e,Object.keys(i).length>0&&this.emit(ne.AttributesChanged,i)}setPermissions(e){var i,a,r,c,u,d;const h=this.permissions,f=e.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||e.canSubscribe!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((c=this.permissions)===null||c===void 0?void 0:c.hidden)||e.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((g,v)=>{var b;return g!==((b=this.permissions)===null||b===void 0?void 0:b.canPublishSources[v])})||e.canSubscribeMetrics!==((d=this.permissions)===null||d===void 0?void 0:d.canSubscribeMetrics);return this.permissions=e,f&&this.emit(ne.ParticipantPermissionsChanged,h),f}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ne.IsSpeakingChanged,e))}setConnectionQuality(e){const i=this._connectionQuality;this._connectionQuality=FM(e),i!==this._connectionQuality&&this.emit(ne.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,i;this.activeFuture&&((i=(e=this.activeFuture).reject)===null||i===void 0||i.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(i=>Kn(i.track)&&i.track.setAudioContext(e))}addTrackPublication(e){e.on(ee.Muted,()=>{this.emit(ne.TrackMuted,e)}),e.on(ee.Unmuted,()=>{this.emit(ne.TrackUnmuted,e)});const i=e;switch(i.track&&(i.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case X.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case X.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function zM(n){var e,i,a;if(!n.participantSid&&!n.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new AS({participantIdentity:(e=n.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(i=n.participantSid)!==null&&i!==void 0?i:"",allTracks:(a=n.allowAll)!==null&&a!==void 0?a:!1,trackSids:n.allowedTrackSids||[]})}class qM extends DC{constructor(e,i,a,r,c,u){super(e,i,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=St.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Rn)},this.handleReconnected=()=>{var d,h;(h=(d=this.reconnectFuture)===null||d===void 0?void 0:d.resolve)===null||h===void 0||h.call(d),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var d,h,f,g,v,b;this.reconnectFuture&&(this.reconnectFuture.promise.catch(T=>this.log.warn(T.message,this.logContext)),(h=(d=this.reconnectFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(f=this.signalConnectedFuture).reject)===null||g===void 0||g.call(f,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(b=(v=this.activeAgentFuture)===null||v===void 0?void 0:v.reject)===null||b===void 0||b.call(v,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=d=>{var h,f;d.participant&&this.updateInfo(d.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Rn),(f=(h=this.signalConnectedFuture).resolve)===null||f===void 0||f.call(h)},this.handleSignalRequestResponse=d=>{const{requestId:h,reason:f,message:g}=d,v=this.pendingSignalRequests.get(h);v&&(f!==pm.OK&&v.reject(new J0(g,f)),this.pendingSignalRequests.delete(h))},this.handleDataPacket=d=>{switch(d.value.case){case"rpcResponse":let h=d.value.value,f=null,g=null;h.value.case==="payload"?f=h.value.value:h.value.case==="error"&&(g=st.fromProto(h.value.value)),this.handleIncomingRpcResponse(h.requestId,f,g);break;case"rpcAck":let v=d.value.value;this.handleIncomingRpcAck(v.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(d=>zM(d)))},this.onTrackUnmuted=d=>{this.onTrackMuted(d,d.isUpstreamPaused)},this.onTrackMuted=(d,h)=>{if(h===void 0&&(h=!0),!d.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Re(d)));return}this.engine.updateMuteStatus(d.sid,h)},this.onTrackUpstreamPaused=d=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Re(d))),this.onTrackMuted(d,!0)},this.onTrackUpstreamResumed=d=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Re(d))),this.onTrackMuted(d,d.isMuted)},this.onTrackFeatureUpdate=d=>{const h=this.audioTrackPublications.get(d.sid);if(!h){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(d.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(h.trackSid,h.getTrackFeatures())},this.onTrackCpuConstrained=(d,h)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Re(h))),this.emit(ne.LocalTrackCpuConstrained,d,h)},this.handleSubscribedQualityUpdate=d=>k(this,void 0,void 0,function*(){var h,f,g,v,b;if(!(!((b=this.roomOptions)===null||b===void 0)&&b.dynacast))return;const T=this.videoTrackPublications.get(d.trackSid);if(!T){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}if(!T.videoTrack)return;const C=yield T.videoTrack.setPublishingCodecs(d.subscribedCodecs);try{for(var E=!0,x=Si(C),w;w=yield x.next(),h=w.done,!h;E=!0){v=w.value,E=!1;const V=v;uw(V)&&(this.log.debug("publish ".concat(V," for ").concat(T.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Re(T))),yield this.publishAdditionalCodecForTrack(T.videoTrack,V,T.options))}}catch(V){f={error:V}}finally{try{!E&&!h&&(g=x.return)&&(yield g.call(x))}finally{if(f)throw f.error}}}),this.handleLocalTrackUnpublished=d=>{const h=this.trackPublications.get(d.trackSid);if(!h){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}this.unpublishTrack(h.track)},this.handleTrackEnded=d=>k(this,void 0,void 0,function*(){if(d.source===X.Source.ScreenShare||d.source===X.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Re(d))),this.unpublishTrack(d);else if(d.isUserProvided)yield d.mute();else if(gi(d)||ea(d))try{if(Wt())try{const h=yield navigator?.permissions.query({name:d.source===X.Source.Camera?"camera":"microphone"});if(h&&h.state==="denied")throw this.log.warn("user has revoked access to ".concat(d.source),Object.assign(Object.assign({},this.logContext),Re(d))),h.onchange=()=>{h.state!=="denied"&&(d.isMuted||d.restartTrack(),h.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}d.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Re(d))),gi(d)?yield d.restartTrack({deviceId:"default"}):yield d.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Re(d))),yield d.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=a,this.roomOptions=r,this.setupEngine(a),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=c,this.roomOutgoingDataStreamManager=u}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==St.NONE}getTrackPublication(e){const i=super.getTrackPublication(e);if(i)return i}getTrackPublicationByName(e){const i=super.getTrackPublicationByName(e);if(i)return i}setupEngine(e){var i;this.engine=e,this.engine.on(te.RemoteMute,(a,r)=>{const c=this.trackPublications.get(a);!c||!c.track||(r?c.mute():c.unmute())}),!((i=this.signalConnectedFuture)===null||i===void 0)&&i.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(te.Connected,this.handleReconnected).on(te.SignalConnected,this.handleSignalConnected).on(te.SignalRestarted,this.handleReconnected).on(te.SignalResumed,this.handleReconnected).on(te.Restarting,this.handleReconnecting).on(te.Resuming,this.handleReconnecting).on(te.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(te.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(te.Closing,this.handleClosing).on(te.SignalRequestResponse,this.handleSignalRequestResponse).on(te.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return k(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return k(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return k(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return k(this,arguments,void 0,function(i){var a=this;let{metadata:r,name:c,attributes:u}=i;return(function*(){return new Promise((d,h)=>k(a,void 0,void 0,function*(){var f,g;try{let v=!1;const b=yield this.engine.client.sendUpdateLocalMetadata((f=r??this.metadata)!==null&&f!==void 0?f:"",(g=c??this.name)!==null&&g!==void 0?g:"",u),T=performance.now();for(this.pendingSignalRequests.set(b,{resolve:d,reject:C=>{h(C),v=!0},values:{name:c,metadata:r,attributes:u}});performance.now()-T<5e3&&!v;){if((!c||this.name===c)&&(!r||this.metadata===r)&&(!u||Object.entries(u).every(C=>{let[E,x]=C;return this.attributes[E]===x||x===""&&!this.attributes[E]}))){this.pendingSignalRequests.delete(b),d();return}yield Pt(50)}h(new J0("Request to update local metadata timed out","TimeoutError"))}catch(v){v instanceof Error&&h(v)}}))})()})}setCameraEnabled(e,i,a){return this.setTrackEnabled(X.Source.Camera,e,i,a)}setMicrophoneEnabled(e,i,a){return this.setTrackEnabled(X.Source.Microphone,e,i,a)}setScreenShareEnabled(e,i,a){return this.setTrackEnabled(X.Source.ScreenShare,e,i,a)}setE2EEEnabled(e){return k(this,void 0,void 0,function*(){this.encryptionType=e?St.GCM:St.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,i,a,r){return k(this,void 0,void 0,function*(){var c,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:i})),this.republishPromise&&(yield this.republishPromise);let d=this.getTrackPublication(e);if(i)if(d)yield d.unmute();else{let h;if(this.pendingPublishing.has(e)){const f=yield this.waitForPendingPublicationOfSource(e);return f||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield f?.unmute(),f}this.pendingPublishing.add(e);try{switch(e){case X.Source.Camera:h=yield this.createTracks({video:(c=a)!==null&&c!==void 0?c:!0});break;case X.Source.Microphone:h=yield this.createTracks({audio:(u=a)!==null&&u!==void 0?u:!0});break;case X.Source.ScreenShare:h=yield this.createScreenTracks(Object.assign({},a));break;default:throw new Ci(e)}}catch(f){throw h?.forEach(g=>{g.stop()}),f instanceof Error&&this.emit(ne.MediaDevicesError,f,Af(e)),this.pendingPublishing.delete(e),f}for(const f of h){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),a);e===X.Source.Microphone&&Kn(f)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),f.startPreConnectBuffer())}try{const f=[];for(const v of h)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Re(v))),f.push(this.publishTrack(v,r));[d]=yield Promise.all(f)}catch(f){throw h?.forEach(g=>{g.stop()}),f}finally{this.pendingPublishing.delete(e)}}else if(!d?.track&&this.pendingPublishing.has(e)&&(d=yield this.waitForPendingPublicationOfSource(e),d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),d&&d.track)if(e===X.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const h=this.getTrackPublication(X.Source.ScreenShareAudio);h&&h.track&&this.unpublishTrack(h.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return k(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(X.Source.Camera)||this.pendingPublishing.has(X.Source.Microphone))){this.pendingPublishing.add(X.Source.Camera),this.pendingPublishing.add(X.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(X.Source.Camera),this.pendingPublishing.delete(X.Source.Microphone)}}})}createTracks(e){return k(this,void 0,void 0,function*(){var i,a;e??(e={});const r=mC(e,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(a=this.roomOptions)===null||a===void 0?void 0:a.videoCaptureDefaults);try{return(yield Wl(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(d=>(Kn(d)&&(this.microphoneError=void 0,d.setAudioContext(this.audioContext),d.source=X.Source.Microphone,this.emit(ne.AudioStreamAcquired)),ha(d)&&(this.cameraError=void 0,d.source=X.Source.Camera),d))}catch(c){throw c instanceof Error&&(e.audio&&(this.microphoneError=c),e.video&&(this.cameraError=c)),c}})}createScreenTracks(e){return k(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new vm("getDisplayMedia not supported");e.resolution===void 0&&!gw()&&(e.resolution=ym.h1080fps30.resolution);const i=Ow(e),a=yield navigator.mediaDevices.getDisplayMedia(i),r=a.getVideoTracks();if(r.length===0)throw new Ci("no video track found");const c=new Nl(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});c.source=X.Source.ScreenShare,e.contentHint&&(c.mediaStreamTrack.contentHint=e.contentHint);const u=[c];if(a.getAudioTracks().length>0){this.emit(ne.AudioStreamAcquired);const d=new Pl(a.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=X.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(e,i){return k(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,i)})}publishOrRepublishTrack(e,i){return k(this,arguments,void 0,function(a,r){var c=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var d,h,f,g;gi(a)&&a.setAudioContext(c.audioContext),yield(d=c.reconnectFuture)===null||d===void 0?void 0:d.promise,c.republishPromise&&!u&&(yield c.republishPromise),Gs(a)&&c.pendingPublishPromises.has(a)&&(yield c.pendingPublishPromises.get(a));let v;if(a instanceof MediaStreamTrack)v=a.getConstraints();else{v=a.constraints;let w;switch(a.source){case X.Source.Microphone:w="audioinput";break;case X.Source.Camera:w="videoinput"}w&&c.activeDeviceMap.has(w)&&(v=Object.assign(Object.assign({},v),{deviceId:c.activeDeviceMap.get(w)}))}if(a instanceof MediaStreamTrack)switch(a.kind){case"audio":a=new Pl(a,v,!0,c.audioContext,{loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});break;case"video":a=new Nl(a,v,!0,{loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});break;default:throw new Ci("unsupported MediaStreamTrack kind ".concat(a.kind))}else a.updateLoggerOptions({loggerName:c.roomOptions.loggerName,loggerContextCb:()=>c.logContext});let b;if(c.trackPublications.forEach(w=>{w.track&&w.track===a&&(b=w)}),b)return c.log.warn("track has already been published, skipping",Object.assign(Object.assign({},c.logContext),Re(b))),b;const T=Object.assign(Object.assign({},c.roomOptions.publishDefaults),r),C="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,E=(h=T.forceStereo)!==null&&h!==void 0?h:C;E&&(T.dtx===void 0&&c.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},c.logContext),Re(a))),T.red===void 0&&c.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(f=T.dtx)!==null&&f!==void 0||(T.dtx=!1),(g=T.red)!==null&&g!==void 0||(T.red=!1)),!yw()&&c.roomOptions.e2ee&&(c.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},c.logContext)),T.simulcast=!1),T.source&&(a.source=T.source);const x=new Promise((w,V)=>k(c,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ke.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Re(a)}));let I=!1;const A=setTimeout(()=>{I=!0,a.stop(),V(new Q0("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(A),I)return;const R=yield this.publish(a,T,E);w(R)}else try{const I=yield this.publish(a,T,E);w(I)}catch(I){V(I)}}catch(I){V(I)}}));c.pendingPublishPromises.set(a,x);try{return yield x}catch(w){throw w}finally{c.pendingPublishPromises.delete(a)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Rn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Re(e))),!1;const{canPublish:i,canPublishSources:a}=this.permissions;return i&&(a.length===0||a.map(r=>Lw(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Re(e))),!1)}publish(e,i,a){return k(this,void 0,void 0,function*(){var r,c,u,d,h,f,g,v,b,T;if(!this.hasPermissionsToPublish(e))throw new Q0("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find($=>Gs(e)&&$.source===e.source)&&e.source!==X.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Re(e))),i.stopMicTrackOnMute&&Kn(e)&&(e.stopOnMute=!0),e.source===X.Source.ScreenShare&&Ha()&&(i.simulcast=!1),i.videoCodec==="av1"&&!fw()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!mw()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=wf),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some($=>i.videoCodec===uo($.mime))||(i.videoCodec=uo(this.enabledPublishVideoCodecs[0].mime)));const E=i.videoCodec;e.on(ee.Muted,this.onTrackMuted),e.on(ee.Unmuted,this.onTrackUnmuted),e.on(ee.Ended,this.handleTrackEnded),e.on(ee.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ee.UpstreamResumed,this.onTrackUpstreamResumed),e.on(ee.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const x=[],w=!(!((r=i.dtx)!==null&&r!==void 0)||r),V=e.getSourceTrackSettings();V.autoGainControl&&x.push(Et.TF_AUTO_GAIN_CONTROL),V.echoCancellation&&x.push(Et.TF_ECHO_CANCELLATION),V.noiseSuppression&&x.push(Et.TF_NOISE_SUPPRESSION),V.channelCount&&V.channelCount>1&&x.push(Et.TF_STEREO),w&&x.push(Et.TF_NO_DTX),gi(e)&&e.hasPreConnectBuffer&&x.push(Et.TF_PRECONNECT_BUFFER);const I=new So({cid:e.mediaStreamTrack.id,name:i.name,type:X.kindToProto(e.kind),muted:e.isMuted,source:X.sourceToProto(e.source),disableDtx:w,encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((c=i.red)!==null&&c!==void 0)||c),stream:i?.stream,backupCodecPolicy:i?.backupCodecPolicy,audioFeatures:x});let A;if(e.kind===X.Kind.Video){let $={width:0,height:0};try{$=yield e.waitForDimensions()}catch{const ae=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:Co.h720.resolution;$={width:ae.width,height:ae.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Re(e)),{dims:$}))}I.width=$.width,I.height=$.height,ea(e)&&(Un(E)&&(e.source===X.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Re(e))))),i.scalabilityMode=(h=i.scalabilityMode)!==null&&h!==void 0?h:"L3T3_KEY"),I.simulcastCodecs=[new uf({codec:E,cid:e.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:wf}),i.backupCodec&&E!==i.backupCodec.codec&&I.encryption===St.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),I.simulcastCodecs.push(new uf({codec:i.backupCodec.codec,cid:""})))),A=Df(e.source===X.Source.ScreenShare,I.width,I.height,i),I.layers=Sb(I.width,I.height,A,Un(i.videoCodec))}else e.kind===X.Kind.Audio&&(A=[{maxBitrate:(f=i.audioPreset)===null||f===void 0?void 0:f.maxBitrate,priority:(v=(g=i.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&v!==void 0?v:"high",networkPriority:(T=(b=i.audioPreset)===null||b===void 0?void 0:b.priority)!==null&&T!==void 0?T:"high"}]);if(!this.engine||this.engine.isClosed)throw new Tt("cannot publish track when not connected");const R=()=>k(this,void 0,void 0,function*(){var $,Z,ae;if(!this.engine.pcManager)throw new Tt("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,i,A),this.emit(ne.LocalSenderCreated,e.sender,e),ea(e)&&(($=i.degradationPreference)!==null&&$!==void 0||(i.degradationPreference=_M(e)),e.setDegradationPreference(i.degradationPreference)),A)if(Ha()&&e.kind===X.Kind.Audio){let he;for(const Ye of this.engine.pcManager.publisher.getTransceivers())if(Ye.sender===e.sender){he=Ye;break}he&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:he,codec:"opus",maxbr:!((Z=A[0])===null||Z===void 0)&&Z.maxBitrate?A[0].maxBitrate/1e3:0})}else e.codec&&Un(e.codec)&&(!((ae=A[0])===null||ae===void 0)&&ae.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:I.cid,codec:e.codec,maxbr:A[0].maxBitrate/1e3});yield this.engine.negotiate()});let B;const F=new Promise(($,Z)=>k(this,void 0,void 0,function*(){var ae;try{B=yield this.engine.addTrack(I),$(B)}catch(he){e.sender&&(!((ae=this.engine.pcManager)===null||ae===void 0)&&ae.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Ye=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Re(e)),{error:Ye}))})),Z(he)}}));if(this.enabledPublishVideoCodecs.length>0)B=(yield Promise.all([F,R()]))[0];else{B=yield F;let $;if(B.codecs.forEach(Z=>{$===void 0&&($=Z.mimeType)}),$&&e.kind===X.Kind.Video){const Z=uo($);Z!==E&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Re(e)),{codec:Z})),i.videoCodec=Z,A=Df(e.source===X.Source.ScreenShare,I.width,I.height,i))}yield R()}const G=new xf(e.kind,B,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(G.on(ee.CpuConstrained,$=>this.onTrackCpuConstrained($,G)),G.options=i,e.sid=B.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:A,trackInfo:B})),ea(e)?e.startMonitor(this.engine.client):gi(e)&&e.startMonitor(),this.addTrackPublication(G),this.emit(ne.LocalTrackPublished,G),gi(e)&&B.audioFeatures.includes(Et.TF_PRECONNECT_BUFFER)){const $=e.getPreConnectBuffer(),Z=e.getPreConnectBufferMimeType();this.on(ne.LocalTrackSubscribed,ae=>{if(ae.trackSid===B.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Re(e))),e.stopPreConnectBuffer()}}),$&&new Promise((he,Ye)=>k(this,void 0,void 0,function*(){var rt,ht,z,W,se,Se;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Re(e)));const ie=setTimeout(()=>{Ye(new Error("agent not active within 10 seconds"))},1e4),oe=yield this.waitUntilActiveAgentPresent();clearTimeout(ie),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Re(e)));const me=yield this.streamBytes({name:"preconnect-buffer",mimeType:Z,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[oe.identity],attributes:{trackId:G.trackSid,sampleRate:String((se=V.sampleRate)!==null&&se!==void 0?se:"48000"),channels:String((Se=V.channelCount)!==null&&Se!==void 0?Se:"1")}});try{for(var ke=!0,D=Si($),K;K=yield D.next(),rt=K.done,!rt;ke=!0){W=K.value,ke=!1;const ye=W;yield me.write(ye)}}catch(ye){ht={error:ye}}finally{try{!ke&&!rt&&(z=D.return)&&(yield z.call(D))}finally{if(ht)throw ht.error}}yield me.close(),he()}catch(ie){Ye(ie)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Re(e)))}).catch(he=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Re(e)),{error:he}))})}return G})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,i,a){return k(this,void 0,void 0,function*(){var r;if(this.encryptionType!==St.NONE)return;let c;if(this.trackPublications.forEach(T=>{T.track&&T.track===e&&(c=T)}),!c)throw new Ci("track is not published");if(!ea(e))throw new Ci("track is not a video track");const u=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),a),d=CM(e,i,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Re(e)));return}const h=e.addSimulcastTrack(i,d);if(!h)return;const f=new So({cid:h.mediaStreamTrack.id,type:X.kindToProto(e.kind),muted:e.isMuted,source:X.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:u.videoCodec,cid:h.mediaStreamTrack.id}]});if(f.layers=Sb(f.width,f.height,d),!this.engine||this.engine.isClosed)throw new Tt("cannot publish track when not connected");const g=()=>k(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,h,u,d),yield this.engine.negotiate()}),b=(yield Promise.all([this.engine.addTrack(f),g()]))[0];this.log.debug("published ".concat(i," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:b}))})}unpublishTrack(e,i){return k(this,void 0,void 0,function*(){var a,r;if(Gs(e)){const f=this.pendingPublishPromises.get(e);f&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Re(e))),yield f)}const c=this.getPublicationForTrack(e),u=c?Re(c):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!c||!c.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}e=c.track,e.off(ee.Muted,this.onTrackMuted),e.off(ee.Unmuted,this.onTrackUnmuted),e.off(ee.Ended,this.handleTrackEnded),e.off(ee.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ee.UpstreamResumed,this.onTrackUpstreamResumed),e.off(ee.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(r=(a=this.roomOptions)===null||a===void 0?void 0:a.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),i?e.stop():e.stopMonitor();let d=!1;const h=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<nt.FAILED&&h)try{for(const f of this.engine.pcManager.publisher.getTransceivers())f.sender===h&&(f.direction="inactive",d=!0);if(this.engine.removeTrack(h)&&(d=!0),ea(e)){for(const[,f]of e.simulcastCodecs)f.sender&&(this.engine.removeTrack(f.sender)&&(d=!0),f.sender=void 0);e.simulcastCodecs.clear()}}catch(f){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:f}))}switch(this.trackPublications.delete(c.trackSid),c.kind){case X.Kind.Audio:this.audioTrackPublications.delete(c.trackSid);break;case X.Kind.Video:this.videoTrackPublications.delete(c.trackSid);break}return this.emit(ne.LocalTrackUnpublished,c),c.setTrack(void 0),d&&(yield this.engine.negotiate()),c})}unpublishTracks(e){return k(this,void 0,void 0,function*(){return(yield Promise.all(e.map(a=>this.unpublishTrack(a)))).filter(a=>!!a)})}republishAllTracks(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){a.republishPromise&&(yield a.republishPromise),a.republishPromise=new Promise((c,u)=>k(a,void 0,void 0,function*(){try{const d=[];this.trackPublications.forEach(h=>{h.track&&(i&&(h.options=Object.assign(Object.assign({},h.options),i)),d.push(h))}),yield Promise.all(d.map(h=>k(this,void 0,void 0,function*(){const f=h.track;yield this.unpublishTrack(f,!1),r&&!f.isMuted&&f.source!==X.Source.ScreenShare&&f.source!==X.Source.ScreenShareAudio&&(gi(f)||ea(f))&&!f.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:h.trackSid})),yield f.restartTrack()),yield this.publishOrRepublishTrack(f,h.options,!0)}))),c()}catch(d){u(d)}finally{this.republishPromise=void 0}})),yield a.republishPromise})()})}publishData(e){return k(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const c=r.reliable?Ae.RELIABLE:Ae.LOSSY,u=r.destinationIdentities,d=r.topic;let h=new rm({participantIdentity:a.identity,payload:i,destinationIdentities:u,topic:d});const f=new jt({kind:c,value:{case:"user",value:h}});yield a.engine.sendDataPacket(f,c)})()})}publishDtmf(e,i){return k(this,void 0,void 0,function*(){const a=new jt({kind:Ae.RELIABLE,value:{case:"sipDtmf",value:new hS({code:e,digit:i})}});yield this.engine.sendDataPacket(a,Ae.RELIABLE)})}sendChatMessage(e,i){return k(this,void 0,void 0,function*(){const a={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:i?.attachments},r=new jt({value:{case:"chatMessage",value:new Al(Object.assign(Object.assign({},a),{timestamp:We.parse(a.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(ne.ChatMessage,a),a})}editChatMessage(e,i){return k(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},i),{message:e,editTimestamp:Date.now()}),r=new jt({value:{case:"chatMessage",value:new Al(Object.assign(Object.assign({},a),{timestamp:We.parse(a.timestamp),editTimestamp:We.parse(a.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ae.RELIABLE),this.emit(ne.ChatMessage,a),a})}sendText(e,i){return k(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,i)})}streamText(e){return k(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,i){return k(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,i)})}streamBytes(e){return k(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return k(this,arguments,void 0,function(i){var a=this;let{destinationIdentity:r,method:c,payload:u,responseTimeout:d=15e3}=i;return(function*(){return new Promise((g,v)=>k(a,void 0,void 0,function*(){var b,T,C,E;if(_m(u)>CC){v(st.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((T=(b=this.engine.latestJoinResponse)===null||b===void 0?void 0:b.serverInfo)===null||T===void 0)&&T.version&&Jn((E=(C=this.engine.latestJoinResponse)===null||C===void 0?void 0:C.serverInfo)===null||E===void 0?void 0:E.version,"1.8.0")<0){v(st.builtIn("UNSUPPORTED_SERVER"));return}const x=Math.max(d,8e3),w=crypto.randomUUID();yield this.publishRpcRequest(r,w,c,u,x);const V=setTimeout(()=>{this.pendingAcks.delete(w),v(st.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(w),clearTimeout(I)},7e3);this.pendingAcks.set(w,{resolve:()=>{clearTimeout(V)},participantIdentity:r});const I=setTimeout(()=>{this.pendingResponses.delete(w),v(st.builtIn("RESPONSE_TIMEOUT"))},d);this.pendingResponses.set(w,{resolve:(A,R)=>{clearTimeout(I),this.pendingAcks.has(w)&&(console.warn("RPC response received before ack",w),this.pendingAcks.delete(w),clearTimeout(V)),R?v(R):g(A??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,i){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,i)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const i=this.pendingAcks.get(e);i?(i.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,i,a){const r=this.pendingResponses.get(e);r?(r.resolve(i,a),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,i,a,r,c){return k(this,void 0,void 0,function*(){const u=new jt({destinationIdentities:[e],kind:Ae.RELIABLE,value:{case:"rpcRequest",value:new om({id:i,method:a,payload:r,responseTimeoutMs:c,version:1})}});yield this.engine.sendDataPacket(u,Ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[i,{participantIdentity:a}]of this.pendingAcks)a===e&&this.pendingAcks.delete(i);for(const[i,{participantIdentity:a,resolve:r}]of this.pendingResponses)a===e&&(r(null,st.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(i))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(i=>i.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(i=>{var a,r;const c=this.trackPublications.get(i.sid);if(c){const u=c.isMuted||((r=(a=c.track)===null||a===void 0?void 0:a.isUpstreamPaused)!==null&&r!==void 0?r:!1);u!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Re(c)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(i.sid,u))}}),!0):!1}setActiveAgent(e){var i,a,r,c;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(a=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.resolve)===null||a===void 0||a.call(i,e):(c=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||c===void 0||c.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Rn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let i;return this.trackPublications.forEach(a=>{const r=a.track;r&&(e instanceof MediaStreamTrack?(gi(r)||ea(r))&&r.mediaStreamTrack===e&&(i=a):e===r&&(i=a))}),i}waitForPendingPublicationOfSource(e){return k(this,void 0,void 0,function*(){const a=Date.now();for(;Date.now()<a+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(c=>{let[u]=c;return u.source===e});if(r)return r[1];yield Pt(20)}})}}class HM extends vi{constructor(e,i,a,r){super(e,i.sid,i.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=c=>{this.setTrack(void 0),this.emit(ee.Ended,c)},this.handleVisibilityChange=c=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(c),this.logContext),this.visible=c,this.emitTrackUpdate()},this.handleVideoDimensionsChange=c=>{this.log.debug("adaptivestream video dimensions ".concat(c.width,"x").concat(c.height),this.logContext),this.videoDimensionsAdaptiveStream=c,this.emitTrackUpdate()},this.subscribed=a,this.updateInfo(i)}setSubscribed(e){const i=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Yl({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new mS({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ee.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?vi.SubscriptionStatus.Unsubscribed:super.isSubscribed?vi.SubscriptionStatus.Subscribed:vi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?vi.PermissionStatus.Allowed:vi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var i,a;this.isManualOperationAllowed()&&(((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.width)===e.width&&((a=this.requestedVideoDimensions)===null||a===void 0?void 0:a.height)===e.height||(Lh(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Lh(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:dn.HIGH}setTrack(e){const i=this.subscriptionStatus,a=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(ee.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(ee.VisibilityChanged,this.handleVisibilityChange),r.off(ee.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(ee.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ee.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ee.VisibilityChanged,this.handleVisibilityChange),e.on(ee.Ended,this.handleEnded),this.emit(ee.Subscribed,e)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(e){const i=this.subscriptionStatus,a=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(e){this.emit(ee.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const i=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):i!==e.muted&&this.emit(e.muted?ee.Muted:ee.Unmuted)}emitSubscriptionUpdateIfChanged(e){const i=this.subscriptionStatus;e!==i&&this.emit(ee.SubscriptionStatusChanged,i,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ee.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Lh(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new kS({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===X.Kind.Video){let i=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(i)rb(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const a=Iw(this.trackInfo,this.requestedMaxQuality);a&&rb(this.videoDimensionsAdaptiveStream,a)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream;i?(e.width=Math.ceil(i.width),e.height=Math.ceil(i.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:dn.HIGH})),e.quality=dn.HIGH)}this.emit(ee.UpdateSettings,e)}}class Ll extends DC{static fromParticipantInfo(e,i,a){return new Ll(e,i.sid,i.identity,i.name,i.metadata,i.attributes,a,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,i,a,r,c,u,d){let h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:To.STANDARD;super(i,a||"",r,c,u,d,h),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ee.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Re(e)),{settings:i})),this.signalClient.sendUpdateTrackSettings(i)}),e.on(ee.UpdateSubscription,i=>{i.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),e.on(ee.SubscriptionPermissionChanged,i=>{this.emit(ne.TrackSubscriptionPermissionChanged,e,i)}),e.on(ee.SubscriptionStatusChanged,i=>{this.emit(ne.TrackSubscriptionStatusChanged,e,i)}),e.on(ee.Subscribed,i=>{this.emit(ne.TrackSubscribed,i,e)}),e.on(ee.Unsubscribed,i=>{this.emit(ne.TrackUnsubscribed,i,e)}),e.on(ee.SubscriptionFailed,i=>{this.emit(ne.TrackSubscriptionFailed,e.trackSid,i)})}getTrackPublication(e){const i=super.getTrackPublication(e);if(i)return i}getTrackPublicationByName(e){const i=super.getTrackPublicationByName(e);if(i)return i}setVolume(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:X.Source.Microphone;this.volumeMap.set(i,e);const a=this.getTrackPublication(i);a&&a.track&&a.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:X.Source.Microphone;const i=this.getTrackPublication(e);return i&&i.track?i.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,i,a,r,c,u){let d=this.getTrackPublicationBySid(i);if(d||i.startsWith("TR")||this.trackPublications.forEach(g=>{!d&&e.kind===g.kind.toString()&&(d=g)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(ne.TrackSubscriptionFailed,i);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,i,a,r,c,u-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Re(d))),this.emit(ne.TrackSubscriptionFailed,i);return}const h=e.kind==="video";let f;return h?f=new BM(e,i,r,c):f=new UM(e,i,r,this.audioContext,this.audioOutput),f.source=d.source,f.isMuted=d.isMuted,f.setMediaStream(a),f.start(),d.setTrack(f),this.volumeMap.has(d.source)&&_f(f)&&Kn(f)&&f.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const i=new Map,a=new Map;return e.tracks.forEach(r=>{var c,u;let d=this.getTrackPublicationBySid(r.sid);if(d)d.updateInfo(r);else{const h=X.kindFromProto(r.type);if(!h)return;d=new HM(h,r,(c=this.signalClient.connectOptions)===null||c===void 0?void 0:c.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(r),a.set(r.sid,d);const f=Array.from(this.trackPublications.values()).find(g=>g.source===d?.source);f&&d.source!==X.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Re(f),newTrack:Re(d)})),this.addTrackPublication(d)}i.set(r.sid,d)}),this.trackPublications.forEach(r=>{i.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Re(r))),this.unpublishTrack(r.trackSid,!0))}),a.forEach(r=>{this.emit(ne.TrackPublished,r)}),!0}unpublishTrack(e,i){const a=this.trackPublications.get(e);if(!a)return;const{track:r}=a;switch(r&&(r.stop(),a.setTrack(void 0)),this.trackPublications.delete(e),a.kind){case X.Kind.Audio:this.audioTrackPublications.delete(e);break;case X.Kind.Video:this.videoTrackPublications.delete(e);break}i&&this.emit(ne.TrackUnpublished,a)}setAudioOutput(e){return k(this,void 0,void 0,function*(){this.audioOutput=e;const i=[];this.audioTrackPublications.forEach(a=>{var r;Kn(a.track)&&_f(a.track)&&i.push(a.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(i)})}emit(e){for(var i=arguments.length,a=new Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:a})),super.emit(e,...a)}}var Le;(function(n){n.Disconnected="disconnected",n.Connecting="connecting",n.Connected="connected",n.Reconnecting="reconnecting",n.SignalReconnecting="signalReconnecting"})(Le||(Le={}));const GM=4*1e3;class Ws extends Wn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var i,a,r,c;if(super(),i=this,this.state=Le.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Te,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,d,h)=>k(this,void 0,void 0,function*(){var f;if(!pw())throw Qn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===Le.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(Le.Connecting),((f=this.regionUrlProvider)===null||f===void 0?void 0:f.getServerUrl().toString())!==u&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),xl(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ue(u,d):this.regionUrlProvider.updateToken(d),this.regionUrlProvider.fetchRegionSettings().then(T=>{var C;(C=this.regionUrlProvider)===null||C===void 0||C.setServerReportedRegions(T)}).catch(T=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:T}))}));const v=(T,C,E)=>k(this,void 0,void 0,function*(){var x,w;this.abortController&&this.abortController.abort();const V=new AbortController;this.abortController=V,g?.();try{if(yield Ks.getInstance().getBackOffPromise(u),V.signal.aborted)throw new Oe("Connection attempt aborted",ge.Cancelled);yield this.attemptConnection(E??u,d,h,V),this.abortController=void 0,T()}catch(I){if(this.regionUrlProvider&&I instanceof Oe&&I.reason!==ge.Cancelled&&I.reason!==ge.NotAllowed){let A=null;try{this.log.debug("Fetching next region"),A=yield this.regionUrlProvider.getNextBestRegionUrl((x=this.abortController)===null||x===void 0?void 0:x.signal)}catch(R){if(R instanceof Oe&&(R.status===401||R.reason===ge.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),C(R);return}}[ge.InternalError,ge.ServerUnreachable,ge.Timeout].includes(I.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Ks.getInstance().addFailedConnectionAttempt(u)),A&&!(!((w=this.abortController)===null||w===void 0)&&w.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(I.message,". Retrying with another region: ").concat(A),this.logContext),this.recreateEngine(),yield v(T,C,A)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,sb(I)),C(I))}else{let A=Bn.UNKNOWN_REASON;I instanceof Oe&&(A=sb(I)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,A),C(I)}}}),b=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Rn((T,C)=>{v(T,C,b)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,d,h,f,g,v)=>k(this,void 0,void 0,function*(){var b,T,C;const E=yield h.join(u,d,{autoSubscribe:f.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:f.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:f.websocketTimeout,singlePeerConnection:g.singlePeerConnection},v.signal);let x=E.serverInfo;if(x||(x={version:E.serverVersion,region:E.serverRegion}),this.serverInfo=x,this.log.debug("connected to Livekit Server ".concat(Object.entries(x).map(w=>{let[V,I]=w;return"".concat(V,": ").concat(I)}).join(", ")),{room:(b=E.room)===null||b===void 0?void 0:b.name,roomSid:(T=E.room)===null||T===void 0?void 0:T.sid,identity:(C=E.participant)===null||C===void 0?void 0:C.identity}),!x.version)throw new $A("unknown server version");return x.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),E}),this.applyJoinResponse=u=>{const d=u.participant;if(this.localParticipant.sid=d.sid,this.localParticipant.identity=d.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(h){this.log.error(h instanceof Error?h.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:h}))}this.handleParticipantUpdates([d,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,d,h,f)=>k(this,void 0,void 0,function*(){var g,v;this.state===Le.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((v=this.regionUrlProvider)===null||v===void 0)&&v.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Em),h),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const b=yield this.connectSignal(u,d,this.engine,this.connOptions,this.options,f);this.applyJoinResponse(b),this.setupLocalParticipantEvents(),this.emit(J.SignalConnected)}catch(b){yield this.engine.close(),this.recreateEngine();const T=new Oe("could not establish signal connection",f.signal.aborted?ge.Cancelled:ge.ServerUnreachable);throw b instanceof Error&&(T.message="".concat(T.message,": ").concat(b.message)),b instanceof Oe&&(T.reason=b.reason,T.status=b.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:b})),T}if(f.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Oe("Connection attempt aborted",ge.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,f)}catch(b){throw yield this.engine.close(),this.recreateEngine(),b}Wt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Wt()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Le.Connected),this.emit(J.Connected),Ks.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,d=new Array(u),h=0;h<u;h++)d[h]=arguments[h];return k(i,[...d],void 0,function(){var f=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var v,b,T;const C=yield f.disconnectLock.lock();try{if(f.state===Le.Disconnected){f.log.debug("already disconnected",f.logContext);return}if(f.log.info("disconnect from room",Object.assign({},f.logContext)),f.state===Le.Connecting||f.state===Le.Reconnecting||f.isResuming){const E="Abort connection attempt due to user initiated disconnect";f.log.warn(E,f.logContext),(v=f.abortController)===null||v===void 0||v.abort(E),(T=(b=f.connectFuture)===null||b===void 0?void 0:b.reject)===null||T===void 0||T.call(b,new Oe("Client initiated disconnect",ge.Cancelled)),f.connectFuture=void 0}f.engine&&(f.engine.client.isDisconnected||(yield f.engine.client.sendLeave()),yield f.engine.close()),f.handleDisconnect(g,Bn.CLIENT_INITIATED),f.engine=void 0}finally{C()}})()})},this.onPageLeave=()=>k(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>k(this,void 0,void 0,function*(){const u=[],d=$t();if(d&&d.os==="iOS"){const h="livekit-dummy-audio-el";let f=document.getElementById(h);if(!f){f=document.createElement("audio"),f.id=h,f.autoplay=!0,f.hidden=!0;const g=Nh();g.enabled=!0;const v=new MediaStream([g]);f.srcObject=v,document.addEventListener("visibilitychange",()=>{f&&(f.srcObject=document.hidden?null:v,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(f),this.once(J.Disconnected,()=>{f?.remove(),f=null})}u.push(f)}this.remoteParticipants.forEach(h=>{h.audioTrackPublications.forEach(f=>{f.track&&f.track.attachedElements.forEach(g=>{u.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(h=>(h.muted=!1,h.play()))]),this.handleAudioPlaybackStarted()}catch(h){throw this.handleAudioPlaybackFailed(h),h}}),this.startVideo=()=>k(this,void 0,void 0,function*(){const u=[];for(const d of this.remoteParticipants.values())d.videoTrackPublications.forEach(h=>{var f;(f=h.track)===null||f===void 0||f.attachedElements.forEach(g=>{u.includes(g)||u.push(g)})});yield Promise.all(u.map(d=>d.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(d=>{d.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Le.Reconnecting)&&this.emit(J.Reconnecting)},this.handleSignalRestarted=u=>k(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(d){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:d}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Le.Connected),this.emit(J.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(d=>{var h;if(d.identity===this.localParticipant.identity){this.localParticipant.updateInfo(d);return}d.identity===""&&(d.identity=(h=this.sidToIdentity.get(d.sid))!==null&&h!==void 0?h:"");let f=this.remoteParticipants.get(d.identity);d.state===Fs.DISCONNECTED?this.handleParticipantDisconnected(d.identity,f):f=this.getOrCreateParticipant(d.identity,d)})},this.handleActiveSpeakersUpdate=u=>{const d=[],h={};u.forEach(f=>{if(h[f.sid]=!0,f.sid===this.localParticipant.sid)this.localParticipant.audioLevel=f.level,this.localParticipant.setIsSpeaking(!0),d.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(f.sid);g&&(g.audioLevel=f.level,g.setIsSpeaking(!0),d.push(g))}}),h[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(f=>{h[f.sid]||(f.audioLevel=0,f.setIsSpeaking(!1))}),this.activeSpeakers=d,this.emitWhenConnected(J.ActiveSpeakersChanged,d)},this.handleSpeakersChanged=u=>{const d=new Map;this.activeSpeakers.forEach(f=>{const g=this.remoteParticipants.get(f.identity);g&&g.sid!==f.sid||d.set(f.sid,f)}),u.forEach(f=>{let g=this.getRemoteParticipantBySid(f.sid);f.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=f.level,g.setIsSpeaking(f.active),f.active?d.set(f.sid,g):d.delete(f.sid))});const h=Array.from(d.values());h.sort((f,g)=>g.audioLevel-f.audioLevel),this.activeSpeakers=h,this.emitWhenConnected(J.ActiveSpeakersChanged,h)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(d=>{const h=this.getRemoteParticipantBySid(d.participantSid);if(!h)return;const f=h.getTrackPublicationBySid(d.trackSid);if(!f||!f.track)return;const g=X.streamStateFromProto(d.state);f.track.setStreamState(g),g!==f.track.streamState&&(h.emit(ne.TrackStreamStateChanged,f,f.track.streamState),this.emitWhenConnected(J.TrackStreamStateChanged,f,f.track.streamState,h))})},this.handleSubscriptionPermissionUpdate=u=>{const d=this.getRemoteParticipantBySid(u.participantSid);if(!d)return;const h=d.getTrackPublicationBySid(u.trackSid);h&&h.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const d=Array.from(this.remoteParticipants.values()).find(f=>f.trackPublications.has(u.trackSid));if(!d)return;const h=d.getTrackPublicationBySid(u.trackSid);h&&h.setSubscriptionError(u.err)},this.handleDataPacket=(u,d)=>{const h=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(h,u.value.value,u.kind,d);else if(u.value.case==="transcription")this.handleTranscription(h,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(h,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(h,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,h);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,d);else if(u.value.case==="rpcRequest"){const f=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,f.id,f.method,f.payload,f.responseTimeoutMs,f.version)}},this.handleUserPacket=(u,d,h,f)=>{this.emit(J.DataReceived,d.payload,u,h,d.topic,f),u?.emit(ne.DataReceived,d.payload,h,f)},this.handleSipDtmf=(u,d)=>{this.emit(J.SipDTMFReceived,d,u),u?.emit(ne.SipDTMFReceived,d)},this.handleTranscription=(u,d)=>{const h=d.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(d.transcribedParticipantIdentity),f=h?.trackPublications.get(d.trackId),g=Ew(d,this.transcriptionReceivedTimes);f?.emit(ee.TranscriptionReceived,g),h?.emit(ne.TranscriptionReceived,g,f),this.emit(J.TranscriptionReceived,g,h,f)},this.handleChatMessage=(u,d)=>{const h=_w(d);this.emit(J.ChatMessage,h,u)},this.handleMetrics=(u,d)=>{this.emit(J.MetricsReceived,u,d)},this.handleDataStream=(u,d)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,d)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(J.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(J.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(J.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(J.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>k(this,void 0,void 0,function*(){var u;((u=$t())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(J.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const d=this.roomInfo;this.roomInfo=u,d&&d.metadata!==u.metadata&&this.emitWhenConnected(J.RoomMetadataChanged,u.metadata),d?.activeRecording!==u.activeRecording&&this.emitWhenConnected(J.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(d=>{if(d.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(d.quality);return}const h=this.getRemoteParticipantBySid(d.participantSid);h&&h.setConnectionQuality(d.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(J.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(J.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(J.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(J.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(J.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var d;(d=u?.onPublish)===null||d===void 0||d.call(u,this)},this.onLocalTrackPublished=u=>k(this,void 0,void 0,function*(){var d,h,f,g,v,b;(d=u.track)===null||d===void 0||d.on(ee.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=u.track)===null||h===void 0||h.on(ee.Restarted,this.onLocalTrackRestarted),(v=(g=(f=u.track)===null||f===void 0?void 0:f.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||v===void 0||v.call(g,this),this.emit(J.LocalTrackPublished,u,this.localParticipant),gi(u.track)&&(yield u.track.checkForSilence())&&this.emit(J.LocalAudioSilenceDetected,u);const T=yield(b=u.track)===null||b===void 0?void 0:b.getDeviceId(!1),C=Af(u.source);C&&T&&T!==this.localParticipant.activeDeviceMap.get(C)&&(this.localParticipant.activeDeviceMap.set(C,T),this.emit(J.ActiveDeviceChanged,C,T))}),this.onLocalTrackUnpublished=u=>{var d,h;(d=u.track)===null||d===void 0||d.off(ee.TrackProcessorUpdate,this.onTrackProcessorUpdate),(h=u.track)===null||h===void 0||h.off(ee.Restarted,this.onLocalTrackRestarted),this.emit(J.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>k(this,void 0,void 0,function*(){const d=yield u.getDeviceId(!1),h=Af(u.source);h&&d&&d!==this.localParticipant.activeDeviceMap.get(h)&&(this.log.debug("local track restarted, setting ".concat(h," ").concat(d," active"),this.logContext),this.localParticipant.activeDeviceMap.set(h,d),this.emit(J.ActiveDeviceChanged,h,d))}),this.onLocalConnectionQualityChanged=u=>{this.emit(J.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,d)=>{this.emit(J.MediaDevicesError,u,d)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(J.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(J.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},sM),e),this.log=Ei((a=this.options.loggerName)!==null&&a!==void 0?a:jn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},bC),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},TC),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},aM),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new PM,this.outgoingDataStreamManager=new IM(this.engine,this.log),this.disconnectLock=new Ft,this.localParticipant=new qM("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",oa(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",oa(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",oa(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Wt()){const u=new AbortController;(c=navigator.mediaDevices)===null||c===void 0||c.addEventListener("devicechange",this.handleDeviceChange,{signal:u.signal}),Ws.cleanupRegistry&&Ws.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(e,i){return this.incomingDataStreamManager.registerTextStreamHandler(e,i)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,i){return this.incomingDataStreamManager.registerByteStreamHandler(e,i)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,i){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,i)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return k(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const i=!!this.options.encryption,a=this.options.encryption||this.options.e2ee;a&&("e2eeManager"in a?(this.e2eeManager=a.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=i):this.e2eeManager=new Uw(a,i),this.e2eeManager.on(aa.ParticipantEncryptionStatusChanged,(r,c)=>{Aw(c)&&(this.isE2EEEnabled=r),this.emit(J.ParticipantEncryptionStatusChanged,r,c)}),this.e2eeManager.on(aa.EncryptionError,(r,c)=>{const u=c?this.getParticipantByIdentity(c):void 0;this.emit(J.EncryptionError,r,u)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,i;return(i=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return k(this,void 0,void 0,function*(){return this.state===Le.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,i)=>{const a=r=>{r.sid!==""&&(this.engine.off(te.RoomUpdate,a),e(r.sid))};this.engine.on(te.RoomUpdate,a),this.once(J.Disconnected,()=>{this.engine.off(te.RoomUpdate,a),i("Room disconnected before room server id was available")})})})}get name(){var e,i;return(i=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&i!==void 0?i:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,i;return(i=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var e,i;return(i=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new MM(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(te.ParticipantUpdate,this.handleParticipantUpdates).on(te.RoomUpdate,this.handleRoomUpdate).on(te.SpeakersChanged,this.handleSpeakersChanged).on(te.StreamStateChanged,this.handleStreamStateUpdate).on(te.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(te.SubscriptionError,this.handleSubscriptionError).on(te.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(te.MediaTrackAdded,(e,i,a)=>{this.onTrackAdded(e,i,a)}).on(te.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(te.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(te.DataPacketReceived,this.handleDataPacket).on(te.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Le.SignalReconnecting)&&this.emit(J.SignalReconnecting)}).on(te.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Le.Connected)&&this.emit(J.Reconnected)}).on(te.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Le.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(te.Restarting,this.handleRestarting).on(te.SignalRestarted,this.handleSignalRestarted).on(te.Offline,()=>{this.setAndEmitConnectionState(Le.Reconnecting)&&this.emit(J.Reconnecting)}).on(te.DCBufferStatusChanged,(e,i)=>{this.emit(J.DCBufferStatusChanged,e,i)}).on(te.LocalTrackSubscribed,e=>{const i=this.localParticipant.getTrackPublications().find(a=>{let{trackSid:r}=a;return r===e});if(!i){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ne.LocalTrackSubscribed,i),this.emitWhenConnected(J.LocalTrackSubscribed,i,this.localParticipant)}).on(te.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((i,a)=>{this.handleParticipantDisconnected(a,i)}),this.emit(J.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return _t.getInstance().getDevices(e,i)}prepareConnection(e,i){return k(this,void 0,void 0,function*(){if(this.state===Le.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(xl(new URL(e))&&i){this.regionUrlProvider=new Ue(e,i);const a=yield this.regionUrlProvider.getNextBestRegionUrl();a&&this.state===Le.Disconnected&&(this.regionUrl=a,yield fetch(Eo(a),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(a),this.logContext))}else yield fetch(Eo(e),{method:"HEAD"})}catch(a){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,i){return k(this,void 0,void 0,function*(){let a=()=>k(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Hn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Hn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Hn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Hn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":a=()=>k(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Hn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":a=()=>k(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Hn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Hn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),a=()=>k(this,void 0,void 0,function*(){const c=this.engine.client.onLeave;c&&c(new Xl({reason:Bn.CLIENT_INITIATED,action:zs.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Hn({scenario:{case:"subscriberBandwidth",value:Ia(i)}});break;case"leave-full-reconnect":r=new Hn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield a())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,i){return k(this,arguments,void 0,function(a,r){var c=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var d,h,f,g,v,b,T;let C=!0,E=!1;const x=u?{exact:r}:r;if(a==="audioinput"){E=c.localParticipant.audioTrackPublications.size===0;const w=(d=c.getActiveDevice(a))!==null&&d!==void 0?d:c.options.audioCaptureDefaults.deviceId;c.options.audioCaptureDefaults.deviceId=x;const V=Array.from(c.localParticipant.audioTrackPublications.values()).filter(A=>A.source===X.Source.Microphone);try{C=(yield Promise.all(V.map(A=>{var R;return(R=A.audioTrack)===null||R===void 0?void 0:R.setDeviceId(x)}))).every(A=>A===!0)}catch(A){throw c.options.audioCaptureDefaults.deviceId=w,A}const I=V.some(A=>{var R,B;return(B=(R=A.track)===null||R===void 0?void 0:R.isMuted)!==null&&B!==void 0?B:!1});C&&I&&(E=!0)}else if(a==="videoinput"){E=c.localParticipant.videoTrackPublications.size===0;const w=(h=c.getActiveDevice(a))!==null&&h!==void 0?h:c.options.videoCaptureDefaults.deviceId;c.options.videoCaptureDefaults.deviceId=x;const V=Array.from(c.localParticipant.videoTrackPublications.values()).filter(A=>A.source===X.Source.Camera);try{C=(yield Promise.all(V.map(A=>{var R;return(R=A.videoTrack)===null||R===void 0?void 0:R.setDeviceId(x)}))).every(A=>A===!0)}catch(A){throw c.options.videoCaptureDefaults.deviceId=w,A}const I=V.some(A=>{var R,B;return(B=(R=A.track)===null||R===void 0?void 0:R.isMuted)!==null&&B!==void 0?B:!1});C&&I&&(E=!0)}else if(a==="audiooutput"){if(E=!0,!Ef()&&!c.options.webAudioMix||c.options.webAudioMix&&c.audioContext&&!("setSinkId"in c.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");c.options.webAudioMix&&(r=(f=yield _t.getInstance().normalizeDeviceId("audiooutput",r))!==null&&f!==void 0?f:""),(g=(T=c.options).audioOutput)!==null&&g!==void 0||(T.audioOutput={});const w=(v=c.getActiveDevice(a))!==null&&v!==void 0?v:c.options.audioOutput.deviceId;c.options.audioOutput.deviceId=r;try{c.options.webAudioMix&&((b=c.audioContext)===null||b===void 0||b.setSinkId(r)),yield Promise.all(Array.from(c.remoteParticipants.values()).map(V=>V.setAudioOutput({deviceId:r})))}catch(V){throw c.options.audioOutput.deviceId=w,V}}return E&&(c.localParticipant.activeDeviceMap.set(a,r),c.emit(J.ActiveDeviceChanged,a,r)),C})()})}setupLocalParticipantEvents(){this.localParticipant.on(ne.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ne.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ne.AttributesChanged,this.onLocalAttributesChanged).on(ne.TrackMuted,this.onLocalTrackMuted).on(ne.TrackUnmuted,this.onLocalTrackUnmuted).on(ne.LocalTrackPublished,this.onLocalTrackPublished).on(ne.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ne.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ne.MediaDevicesError,this.onMediaDevicesError).on(ne.AudioStreamAcquired,this.startAudio).on(ne.ChatMessage,this.onLocalChatMessageSent).on(ne.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,i,a){if(this.state===Le.Connecting||this.state===Le.Reconnecting){const v=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:i.id,tracksInStream:i.getTracks().map(T=>T.id)}),this.onTrackAdded(e,i,a),b()},b=()=>{this.off(J.Reconnected,v),this.off(J.Connected,v),this.off(J.Disconnected,b)};this.once(J.Reconnected,v),this.once(J.Connected,v),this.once(J.Disconnected,b);return}if(this.state===Le.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=hw(i.id),c=r[0];let u=r[1],d=e.id;if(u&&u.startsWith("TR")&&(d=u),c===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const h=Array.from(this.remoteParticipants.values()).find(v=>v.sid===c);if(!h){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(c),this.logContext);return}if(!d.startsWith("TR")){const v=this.engine.getTrackIdForReceiver(a);if(!v){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(c),this.logContext);return}d=v}d.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(c,", streamId: ").concat(u,", trackId: ").concat(d),Object.assign(Object.assign({},this.logContext),{rpID:c,streamId:u,trackId:d}));let f;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?f=this.options.adaptiveStream:f={});const g=h.addSubscribedMediaTrack(e,d,i,a,f);g?.isEncrypted&&!this.e2eeManager&&this.emit(J.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(h.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Le.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(c=>{r.unpublishTrack(c.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var c,u,d;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((c=r.track)===null||c===void 0||c.detach(),(u=r.track)===null||u===void 0||u.stop()):(d=r.track)===null||d===void 0||d.stopMonitor()}),this.localParticipant.off(ne.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ne.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ne.AttributesChanged,this.onLocalAttributesChanged).off(ne.TrackMuted,this.onLocalTrackMuted).off(ne.TrackUnmuted,this.onLocalTrackUnmuted).off(ne.LocalTrackPublished,this.onLocalTrackPublished).off(ne.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ne.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ne.MediaDevicesError,this.onMediaDevicesError).off(ne.AudioStreamAcquired,this.startAudio).off(ne.ChatMessage,this.onLocalChatMessageSent).off(ne.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Wt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=navigator.mediaDevices)===null||a===void 0||a.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Le.Disconnected),this.emit(J.Disconnected,i)}}}handleParticipantDisconnected(e,i){var a;this.remoteParticipants.delete(e),i&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),i.trackPublications.forEach(r=>{i.unpublishTrack(r.trackSid,!0)}),this.emit(J.ParticipantDisconnected,i),i.setDisconnected(),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(i.identity))}handleIncomingRpcRequest(e,i,a,r,c,u){return k(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,i),u!==1){yield this.engine.publishRpcResponse(e,i,null,st.builtIn("UNSUPPORTED_VERSION"));return}const d=this.rpcHandlers.get(a);if(!d){yield this.engine.publishRpcResponse(e,i,null,st.builtIn("UNSUPPORTED_METHOD"));return}let h=null,f=null;try{const g=yield d({requestId:i,callerIdentity:e,payload:r,responseTimeout:c});_m(g)>CC?(h=st.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(a))):f=g}catch(g){g instanceof st?h=g:(console.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),g),h=st.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,i,f,h)})}selectDefaultDevices(){return k(this,void 0,void 0,function*(){var e,i,a;const r=_t.getInstance().previousDevices,c=yield _t.getInstance().getDevices(void 0,!1),u=$t();if(u?.name==="Chrome"&&u.os!=="iOS")for(let h of c){const f=r.find(g=>g.deviceId===h.deviceId);f&&f.label!==""&&f.kind===h.kind&&f.label!==h.label&&this.getActiveDevice(h.kind)==="default"&&this.emit(J.ActiveDeviceChanged,h.kind,h.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let h of d){const f=Dw(h),g=this.localParticipant.getTrackPublication(f);if(g&&(!((e=g.track)===null||e===void 0)&&e.isUserProvided))continue;const v=c.filter(T=>T.kind===h),b=this.getActiveDevice(h);if(b===((i=r.filter(T=>T.kind===h)[0])===null||i===void 0?void 0:i.deviceId)&&v.length>0&&((a=v[0])===null||a===void 0?void 0:a.deviceId)!==b){yield this.switchActiveDevice(h,v[0].deviceId);continue}h==="audioinput"&&!ko()||h==="videoinput"||v.length>0&&!v.find(T=>T.deviceId===this.getActiveDevice(h))&&(h!=="audiooutput"||!ko())&&(yield this.switchActiveDevice(h,v[0].deviceId))}})}acquireAudioContext(){return k(this,void 0,void 0,function*(){var e,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=gC())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Pt(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const a=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";a!==this.canPlaybackAudio&&(this.audioEnabled=a,this.emit(J.AudioPlaybackStatusChanged,a))})}createParticipant(e,i){var a;let r;return i?r=Ll.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ll(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(c=>this.log.warn("Could not set audio output: ".concat(c.message),this.logContext)),r}getOrCreateParticipant(e,i){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return i&&r.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),r}const a=this.createParticipant(e,i);return this.remoteParticipants.set(e,a),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(J.ParticipantConnected,a),a.on(ne.TrackPublished,r=>{this.emitWhenConnected(J.TrackPublished,r,a)}).on(ne.TrackSubscribed,(r,c)=>{r.kind===X.Kind.Audio?(r.on(ee.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(ee.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===X.Kind.Video&&(r.on(ee.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(ee.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(J.TrackSubscribed,r,c,a)}).on(ne.TrackUnpublished,r=>{this.emit(J.TrackUnpublished,r,a)}).on(ne.TrackUnsubscribed,(r,c)=>{this.emit(J.TrackUnsubscribed,r,c,a)}).on(ne.TrackMuted,r=>{this.emitWhenConnected(J.TrackMuted,r,a)}).on(ne.TrackUnmuted,r=>{this.emitWhenConnected(J.TrackUnmuted,r,a)}).on(ne.ParticipantMetadataChanged,r=>{this.emitWhenConnected(J.ParticipantMetadataChanged,r,a)}).on(ne.ParticipantNameChanged,r=>{this.emitWhenConnected(J.ParticipantNameChanged,r,a)}).on(ne.AttributesChanged,r=>{this.emitWhenConnected(J.ParticipantAttributesChanged,r,a)}).on(ne.ConnectionQualityChanged,r=>{this.emitWhenConnected(J.ConnectionQualityChanged,r,a)}).on(ne.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(J.ParticipantPermissionsChanged,r,a)}).on(ne.TrackSubscriptionStatusChanged,(r,c)=>{this.emitWhenConnected(J.TrackSubscriptionStatusChanged,r,c,a)}).on(ne.TrackSubscriptionFailed,(r,c)=>{this.emit(J.TrackSubscriptionFailed,r,a,c)}).on(ne.TrackSubscriptionPermissionChanged,(r,c)=>{this.emitWhenConnected(J.TrackSubscriptionPermissionChanged,r,c,a)}).on(ne.Active,()=>{this.emitWhenConnected(J.ParticipantActive,a),a.kind===To.AGENT&&this.localParticipant.setActiveAgent(a)}),i&&a.updateInfo(i),a}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((a,r)=>(a.push(...r.getTrackPublications()),a),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,i)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const i of e.videoTrackPublications.values())i.isSubscribed&&Rw(i)&&i.emitTrackUpdate()}getRemoteParticipantBySid(e){const i=this.sidToIdentity.get(e);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=xt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Bn.STATE_MISMATCH))):e=0},GM)}clearConnectionReconcile(){this.connectionReconcileInterval&&xt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(J.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[i,a]=e;this.emit(i,...a)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var i=arguments.length,a=new Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];if(this.state===Le.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,a]);else if(this.state===Le.Connected)return this.emit(e,...a);return!1}simulateParticipants(e){return k(this,void 0,void 0,function*(){var i,a;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),c=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Hl({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:We.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new qa({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(J.SignalConnected),this.emit(J.Connected),this.setAndEmitConnectionState(Le.Connected),r.video){const u=new xf(X.Kind.Video,new Ps({source:yt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO,name:"video-dummy"}),new Nl(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ab(160*((i=c.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(ne.LocalTrackPublished,u)}if(r.audio){const u=new xf(X.Kind.Audio,new Ps({source:yt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO}),new Pl(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Nh(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(ne.LocalTrackPublished,u)}for(let u=0;u<c.count-1;u+=1){let d=new qa({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:Fs.ACTIVE,tracks:[],joinedAt:We.parse(Date.now())});const h=this.getOrCreateParticipant(d.identity,d);if(c.video){const f=ab(160*((a=c.aspectRatios[u%c.aspectRatios.length])!==null&&a!==void 0?a:1),160,!1,!0),g=new Ps({source:yt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO});h.addSubscribedMediaTrack(f,g.sid,new MediaStream([f]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}if(c.audio){const f=Nh(),g=new Ps({source:yt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO});h.addSubscribedMediaTrack(f,g.sid,new MediaStream([f]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}h.updateInfo(d)}})}emit(e){for(var i=arguments.length,a=new Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];if(e!==J.ActiveSpeakersChanged&&e!==J.TranscriptionReceived){const c=OC(a).filter(u=>u!==void 0);(e===J.TrackSubscribed||e===J.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:c})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:c}))}return super.emit(e,...a)}}Ws.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(n=>{n()});function OC(n){return n.map(e=>{if(e)return Array.isArray(e)?OC(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Nn;(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.SKIPPED=2]="SKIPPED",n[n.SUCCESS=3]="SUCCESS",n[n.FAILED=4]="FAILED"})(Nn||(Nn={}));class fa extends Wn.EventEmitter{constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Nn.IDLE,this.logs=[],this.options={},this.url=e,this.token=i,this.name=this.constructor.name,this.room=new Ws(a.roomOptions),this.connectOptions=a.connectOptions,this.options=a}run(e){return k(this,void 0,void 0,function*(){if(this.status!==Nn.IDLE)throw Error("check is running already");this.setStatus(Nn.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==Nn.SKIPPED&&this.setStatus(this.isSuccess()?Nn.SUCCESS:Nn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return k(this,void 0,void 0,function*(){return this.room.state===Le.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return k(this,void 0,void 0,function*(){this.room&&this.room.state!==Le.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Nn.SKIPPED)}switchProtocol(e){return k(this,void 0,void 0,function*(){let i=!1,a=!1;if(this.room.on(J.Reconnecting,()=>{i=!0}),this.room.once(J.Reconnected,()=>{a=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(c=>setTimeout(c,1e3)),!i)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(a)return;yield Pt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class KM extends fa{get description(){return"Cloud regions"}perform(){return k(this,void 0,void 0,function*(){const e=new Ue(this.url,this.token);if(!e.isCloud()){this.skip();return}const i=[],a=new Set;for(let c=0;c<3;c++){const u=yield e.getNextBestRegionUrl();if(!u)break;if(a.has(u))continue;a.add(u);const d=yield this.checkCloudRegion(u);this.appendMessage("".concat(d.region," RTT: ").concat(d.rtt,"ms, duration: ").concat(d.duration,"ms")),i.push(d)}i.sort((c,u)=>(c.duration-u.duration)*.5+(c.rtt-u.rtt)*.5);const r=i[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return k(this,void 0,void 0,function*(){var i,a;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(i=this.room.serverInfo)===null||i===void 0?void 0:i.region;if(!r)throw new Error("Region not found");const c=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,h=1e6/u,f="A".repeat(u),g=Date.now();for(let C=0;C<h;C++)yield c.write(f);yield c.close();const v=Date.now(),b=yield(a=this.room.engine.pcManager)===null||a===void 0?void 0:a.publisher.getStats(),T={region:r,rtt:1e4,duration:v-g};return b?.forEach(C=>{C.type==="candidate-pair"&&C.nominated&&(T.rtt=C.currentRoundTripTime*1e3)}),yield this.disconnect(),T})}}const qh=1e4;class YM extends fa{get description(){return"Connection via UDP vs TCP"}perform(){return k(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),i=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-i.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-i.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=i):this.appendMessage("best connection quality via udp");const a=this.bestStats;this.appendMessage("upstream bitrate: ".concat((a.bitrateTotal/a.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((a.rttTotal/a.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((a.jitterTotal/a.count*1e3).toFixed(2)," ms")),a.packetsLost>0&&this.appendWarning("packets lost: ".concat((a.packetsLost/a.packetsSent*100).toFixed(2),"%")),a.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((a.qualityLimitationDurations.bandwidth/(qh/1e3)*100).toFixed(2),"%")),a.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((a.qualityLimitationDurations.cpu/(qh/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return k(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const i=document.createElement("canvas");i.width=1280,i.height=720;const a=i.getContext("2d");if(!a)throw new Error("Could not get canvas context");let r=0;const c=()=>{r=(r+1)%360,a.fillStyle="hsl(".concat(r,", 100%, 50%)"),a.fillRect(0,0,i.width,i.height),requestAnimationFrame(c)};c();const d=i.captureStream(30).getVideoTracks()[0],f=(yield this.room.localParticipant.publishTrack(d,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},v=setInterval(()=>k(this,void 0,void 0,function*(){const b=yield f.getRTCStatsReport();b?.forEach(T=>{T.type==="outbound-rtp"?(g.packetsSent=T.packetsSent,g.qualityLimitationDurations=T.qualityLimitationDurations,g.bitrateTotal+=T.targetBitrate,g.count++):T.type==="remote-inbound-rtp"&&(g.packetsLost=T.packetsLost,g.rttTotal+=T.roundTripTime,g.jitterTotal+=T.jitter)})}),1e3);return yield new Promise(b=>setTimeout(b,qh)),clearInterval(v),d.stop(),i.remove(),yield this.disconnect(),g})}}class XM extends fa{get description(){return"Can publish audio"}perform(){return k(this,void 0,void 0,function*(){var e;const i=yield this.connect(),a=yield MC();if(yield pC(a,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),i.localParticipant.publishTrack(a),yield new Promise(d=>setTimeout(d,3e3));const c=yield(e=a.sender)===null||e===void 0?void 0:e.getStats();if(!c)throw new Error("Could not get RTCStats");let u=0;if(c.forEach(d=>{d.type==="outbound-rtp"&&(d.kind==="audio"||!d.kind&&d.mediaType==="audio")&&(u=d.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class QM extends fa{get description(){return"Can publish video"}perform(){return k(this,void 0,void 0,function*(){var e;const i=yield this.connect(),a=yield VM();yield this.checkForVideo(a.mediaStreamTrack),i.localParticipant.publishTrack(a),yield new Promise(u=>setTimeout(u,5e3));const r=yield(e=a.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let c=0;if(r.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(c+=u.packetsSent)}),c===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(c," video packets"))})}checkForVideo(e){return k(this,void 0,void 0,function*(){const i=new MediaStream;i.addTrack(e.clone());const a=document.createElement("video");a.srcObject=i,a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.setAttribute("playsinline","true"),document.body.appendChild(a),yield new Promise(r=>{a.onplay=()=>{setTimeout(()=>{var c,u,d,h;const f=document.createElement("canvas"),g=e.getSettings(),v=(u=(c=g.width)!==null&&c!==void 0?c:a.videoWidth)!==null&&u!==void 0?u:1280,b=(h=(d=g.height)!==null&&d!==void 0?d:a.videoHeight)!==null&&h!==void 0?h:720;f.width=v,f.height=b;const T=f.getContext("2d");T.drawImage(a,0,0);const E=T.getImageData(0,0,f.width,f.height).data;let x=!0;for(let w=0;w<E.length;w+=4)if(E[w]!==0||E[w+1]!==0||E[w+2]!==0){x=!1;break}x?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},a.play()}),i.getTracks().forEach(r=>r.stop()),a.remove()})}}class JM extends fa{get description(){return"Resuming connection after interruption"}perform(){return k(this,void 0,void 0,function*(){var e;const i=yield this.connect();let a=!1,r=!1,c;const u=new Promise(f=>{setTimeout(f,5e3),c=f}),d=()=>{a=!0};i.on(J.SignalReconnecting,d).on(J.Reconnecting,d).on(J.Reconnected,()=>{r=!0,c(!0)}),(e=i.engine.client.ws)===null||e===void 0||e.close();const h=i.engine.client.onClose;if(h&&h(""),yield u,a){if(!r||i.state!==Le.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class WM extends fa{get description(){return"Can connect via TURN"}perform(){return k(this,void 0,void 0,function*(){var e,i;const a=new Tm,r=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let c=!1,u=!1,d=!1;for(let h of r.iceServers)for(let f of h.urls)f.startsWith("turn:")?(u=!0,d=!0):f.startsWith("turns:")&&(u=!0,d=!0,c=!0),f.startsWith("stun:")&&(d=!0);d?u&&!c&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||i===void 0)&&i.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class ZM extends fa{get description(){return"Establishing WebRTC connection"}perform(){return k(this,void 0,void 0,function*(){let e=!1,i=!1;this.room.on(J.SignalConnected,()=>{var a;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(c,u)=>{if(c.candidate){const d=new RTCIceCandidate(c);let h="".concat(d.protocol," ").concat(d.address,":").concat(d.port," ").concat(d.type);d.address&&($M(d.address)?h+=" (private)":d.protocol==="tcp"&&d.tcpType==="passive"?(e=!0,h+=" (passive)"):d.protocol==="udp"&&(i=!0)),this.appendMessage(h)}r&&r(c,u)},!((a=this.room.engine.pcManager)===null||a===void 0)&&a.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=c=>{c instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(c.errorCode," ").concat(c.errorText," ").concat(c.url))})});try{yield this.connect(),Te.info("now the room is connected")}catch(a){throw this.appendWarning("ports need to be open on firewall in order to connect."),a}e||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function $M(n){const e=n.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const i=parseInt(e[1],10);if(i>=16&&i<=31)return!0}}return!1}class eD extends fa{get description(){return"Connecting to signal connection via WebSocket"}perform(){return k(this,void 0,void 0,function*(){var e,i,a;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Tm;const c=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(c.serverVersion,".")),((e=c.serverInfo)===null||e===void 0?void 0:e.edition)===gS.Cloud&&(!((i=c.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((a=c.serverInfo)===null||a===void 0?void 0:a.region)),yield r.close()})}}class vL extends Wn.EventEmitter{constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=i,this.options=a}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Nn.IDLE,name:"",description:""}),e}updateCheck(e,i){this.checkResults.set(e,i),this.emit("checkUpdate",e,i)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Nn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return k(this,void 0,void 0,function*(){const i=this.getNextCheckId(),a=new e(this.url,this.token,this.options),r=u=>{this.updateCheck(i,u)};a.on("update",r);const c=yield a.run();return a.off("update",r),c})}checkWebsocket(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(eD)})}checkWebRTC(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(ZM)})}checkTURN(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(WM)})}checkReconnect(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(JM)})}checkPublishAudio(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(XM)})}checkPublishVideo(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(QM)})}checkConnectionProtocol(){return k(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(YM);if(e.data&&"protocol"in e.data){const i=e.data;this.options.protocol=i.protocol}return e})}checkCloudRegion(){return k(this,void 0,void 0,function*(){return this.createAndRunCheck(KM)})}}function we(n,e,i){return(e=nD(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function tD(n,e){if(typeof n!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function nD(n){var e=tD(n,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class zt extends Error{constructor(e,i){var a;super(e,i),we(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(a=Error.captureStackTrace)===null||a===void 0||a.call(Error,this,this.constructor)}}we(zt,"code","ERR_JOSE_GENERIC");class iD extends zt{constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:a,reason:r,payload:i}}),we(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=a,this.reason=r,this.payload=i}}we(iD,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class aD extends zt{constructor(e,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:a,reason:r,payload:i}}),we(this,"code","ERR_JWT_EXPIRED"),we(this,"claim",void 0),we(this,"reason",void 0),we(this,"payload",void 0),this.claim=a,this.reason=r,this.payload=i}}we(aD,"code","ERR_JWT_EXPIRED");class sD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}we(sD,"code","ERR_JOSE_ALG_NOT_ALLOWED");class rD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JOSE_NOT_SUPPORTED")}}we(rD,"code","ERR_JOSE_NOT_SUPPORTED");class oD extends zt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",i=arguments.length>1?arguments[1]:void 0;super(e,i),we(this,"code","ERR_JWE_DECRYPTION_FAILED")}}we(oD,"code","ERR_JWE_DECRYPTION_FAILED");class cD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JWE_INVALID")}}we(cD,"code","ERR_JWE_INVALID");class lD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JWS_INVALID")}}we(lD,"code","ERR_JWS_INVALID");class uD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JWT_INVALID")}}we(uD,"code","ERR_JWT_INVALID");class dD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JWK_INVALID")}}we(dD,"code","ERR_JWK_INVALID");class hD extends zt{constructor(){super(...arguments),we(this,"code","ERR_JWKS_INVALID")}}we(hD,"code","ERR_JWKS_INVALID");class fD extends zt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(e,i),we(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}we(fD,"code","ERR_JWKS_NO_MATCHING_KEY");class mD extends zt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(e,i),we(this,Symbol.asyncIterator,void 0),we(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}we(mD,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class pD extends zt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",i=arguments.length>1?arguments[1]:void 0;super(e,i),we(this,"code","ERR_JWKS_TIMEOUT")}}we(pD,"code","ERR_JWKS_TIMEOUT");class gD extends zt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",i=arguments.length>1?arguments[1]:void 0;super(e,i),we(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}we(gD,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function ki(){return ki=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},ki.apply(null,arguments)}const Rb=new Uint8Array(0);class _o{static getFullOptions(e){return ki({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,i){var a=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){a.status!=="connected"&&a.status!=="connecting"||(a.updateStatus("disconnecting"),await a.handleEndSession(),a.updateStatus("disconnected"),a.options.onDisconnect&&a.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void a.handleInterruption(r);case"agent_response":return void a.handleAgentResponse(r);case"user_transcript":return void a.handleUserTranscript(r);case"internal_tentative_agent_response":return void a.handleTentativeAgentResponse(r);case"client_tool_call":try{await a.handleClientToolCall(r)}catch(c){a.onError(`Unexpected error in client tool call handling: ${c instanceof Error?c.message:String(c)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void a.handleAudio(r);case"vad_score":return void a.handleVadScore(r);case"ping":return void a.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void a.handleMCPToolCall(r);case"mcp_connection_status":return void a.handleMCPConnectionStatus(r);case"agent_tool_request":return void a.handleAgentToolRequest(r);case"agent_tool_response":return void a.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void a.handleConversationMetadata(r);case"asr_initiation_metadata":return void a.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void a.handleAgentChatResponsePart(r);case"error":return void a.handleErrorEvent(r);default:return void(a.options.onDebug&&a.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=i,this.options.onConnect&&this.options.onConnect({conversationId:i.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var i;const a=(i=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?i:"Client tool execution successful.",r=typeof a=="object"?JSON.stringify(a):String(a);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(a){this.onError(`Client tool execution failed with following error: ${a?.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${a?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const i=e.error_event.error_type,a=e.error_event.message||e.error_event.reason||"Unknown error";i!=="max_duration_exceeded"?this.onError(`Server error: ${a}`,{errorType:i,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:a,context:new Event("max_duration_exceeded")})}onError(e,i){console.error(e,i),this.options.onError&&this.options.onError(e,i)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Rb}getOutputByteFrequencyData(){return Rb}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,i){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:i})}}class xC{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const i=this.queue;this.queue=[],i.length>0&&queueMicrotask(()=>{i.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const i=this.disconnectionDetails;i&&queueMicrotask(()=>{e(i)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var i;(i=this.onModeChangeCallback)==null||i.call(this,e)}disconnect(e){var i;this.disconnectionDetails||(this.disconnectionDetails=e,(i=this.onDisconnectCallback)==null||i.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Il(n){const[e,i]=n.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${n}`);const a=Number.parseInt(i);if(Number.isNaN(a))throw new Error(`Invalid sample rate: ${i}`);return{format:e,sampleRate:a}}const PC="0.12.0";function Pf(n){return!!n.type}const NC="conversation_initiation_client_data";function LC(n){var e;const i={type:NC};var a,r,c,u,d;return n.overrides&&(i.conversation_config_override={agent:{prompt:(a=n.overrides.agent)==null?void 0:a.prompt,first_message:(r=n.overrides.agent)==null?void 0:r.firstMessage,language:(c=n.overrides.agent)==null?void 0:c.language},tts:{voice_id:(u=n.overrides.tts)==null?void 0:u.voiceId},conversation:{text_only:(d=n.overrides.conversation)==null?void 0:d.textOnly}}),n.customLlmExtraBody&&(i.custom_llm_extra_body=n.customLlmExtraBody),n.dynamicVariables&&(i.dynamic_variables=n.dynamicVariables),n.userId&&(i.user_id=n.userId),(e=n.overrides)!=null&&e.client&&(i.source_info={source:n.overrides.client.source,version:n.overrides.client.version}),i}class Ro extends xC{constructor(e,i,a,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=i,this.inputFormat=a,this.outputFormat=r,this.socket.addEventListener("error",c=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:c}),0)}),this.socket.addEventListener("close",c=>{this.disconnect(c.code===1e3?{reason:"agent",context:c}:{reason:"error",message:c.reason||"The connection was closed by the server.",context:c})}),this.socket.addEventListener("message",c=>{try{const u=JSON.parse(c.data);if(!Pf(u))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:c.data});this.handleMessage(u)}catch(u){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:u instanceof Error?u.message:String(u),data:c.data})}})}static async create(e){let i=null;try{var a,r,c;const d=(a=e.origin)!=null?a:"wss://api.elevenlabs.io";let h;const f=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||PC,g=((c=e.overrides)==null||(c=c.client)==null?void 0:c.source)||"js_sdk";if(e.signedUrl){const V=e.signedUrl.includes("?")?"&":"?";h=`${e.signedUrl}${V}source=${g}&version=${f}`}else h=`${d}/v1/convai/conversation?agent_id=${e.agentId}&source=${g}&version=${f}`;const v=["convai"];e.authorization&&v.push(`bearer.${e.authorization}`),i=new WebSocket(h,v);const b=await new Promise((V,I)=>{i.addEventListener("open",()=>{var A;const R=LC(e);(A=i)==null||A.send(JSON.stringify(R))},{once:!0}),i.addEventListener("error",A=>{setTimeout(()=>I(A),0)}),i.addEventListener("close",I),i.addEventListener("message",A=>{const R=JSON.parse(A.data);Pf(R)&&(R.type==="conversation_initiation_metadata"?V(R.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:T,agent_output_audio_format:C,user_input_audio_format:E}=b,x=Il(E??"pcm_16000"),w=Il(C);return new Ro(i,T,x,w)}catch(d){var u;throw(u=i)==null||u.close(),d}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}}function IC(n){const e=new Uint8Array(n);return window.btoa(String.fromCharCode(...e))}function vD(n){const e=window.atob(n),i=e.length,a=new Uint8Array(i);for(let r=0;r<i;r++)a[r]=e.charCodeAt(r);return a.buffer}const il=new Map;function UC(n,e){return async(i,a)=>{const r=il.get(n);if(r)return i.addModule(r);if(a)try{return await i.addModule(a),void il.set(n,a)}catch(d){throw new Error(`Failed to load the ${n} worklet module from path: ${a}. Error: ${d}`)}const c=new Blob([e],{type:"application/javascript"}),u=URL.createObjectURL(c);try{return await i.addModule(u),void il.set(n,u)}catch{URL.revokeObjectURL(u)}try{const d=`data:application/javascript;base64,${btoa(e)}`;await i.addModule(d),il.set(n,d)}catch{throw new Error(`Failed to load the ${n} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const BC=UC("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class yi extends xC{constructor(e,i,a,r,c={}){super(c),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=i,this.inputFormat=a,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let i;if("conversationToken"in e&&e.conversationToken)i=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var a,r,c;const f=((a=e.overrides)==null||(a=a.client)==null?void 0:a.version)||PC,g=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",v=`${u=(c=e.origin)!=null?c:"https://api.elevenlabs.io",u.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${g}&version=${f}`,b=await fetch(v);if(!b.ok)throw new Error(`ElevenLabs API returned ${b.status} ${b.statusText}`);if(i=(await b.json()).token,!i)throw new Error("No conversation token received from API")}catch(f){let g=f instanceof Error?f.message:String(f);throw f instanceof Error&&f.message.includes("401")&&(g="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${g}`)}}var u;const d=new Ws;try{const f=`room_${Date.now()}`,g=Il("pcm_48000"),v=Il("pcm_48000"),b=new yi(d,f,g,v,e),T=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var h;await d.connect(T,i),await new Promise(E=>{if(b.isConnected)E();else{const x=()=>{d.off(J.Connected,x),E()};d.on(J.Connected,x)}}),d.name&&(b.conversationId=((h=d.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:h[0])||d.name),await d.localParticipant.setMicrophoneEnabled(!0);const C=LC(e);return b.debug({type:NC,message:C}),await b.sendMessage(C),b}catch(f){throw await d.disconnect(),f}}setupRoomEventListeners(){var e=this;this.room.on(J.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(J.Disconnected,i=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:i?.toString()})})}),this.room.on(J.ConnectionStateChanged,i=>{i===Le.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${i}`,context:new Event("connection_state_changed")}))}),this.room.on(J.DataReceived,(i,a)=>{try{const r=JSON.parse(new TextDecoder().decode(i));if(r.type==="audio")return;Pf(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(i))}}),this.room.on(J.TrackSubscribed,async function(i,a,r){if(i.kind===X.Kind.Audio&&r.identity.includes("agent")){const c=i,u=c.attach();if(u.autoplay=!0,u.controls=!1,e.outputDeviceId&&u.setSinkId)try{await u.setSinkId(e.outputDeviceId)}catch(d){console.warn("Failed to set output device for new audio element:",d)}u.style.display="none",document.body.appendChild(u),e.audioElements.push(u),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(c)}}),this.room.on(J.ActiveSpeakersChanged,async function(i){e.updateMode(i.length>0&&i[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(J.ParticipantDisconnected,i=>{var a;(a=i.identity)!=null&&a.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const i=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(i,{reliable:!0})}catch(i){this.debug({type:"send_message_error",message:{message:e,error:i}}),console.error("Failed to send message via WebRTC:",i)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const i=this.room.localParticipant.getTrackPublication(X.Source.Microphone);if(i!=null&&i.track)try{e?await i.track.mute():await i.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const i=new AudioContext;this.audioCaptureContext=i,this.outputAnalyser=i.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const a=new MediaStream([e.mediaStreamTrack]),r=i.createMediaStreamSource(a);r.connect(this.outputAnalyser),await BC(i.audioWorklet);const c=new AudioWorkletNode(i,"rawAudioProcessor");this.outputAnalyser.connect(c),c.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),c.port.onmessage=u=>{const[d,h]=u.data;if(h>.01){const f=IC(d.buffer),g=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:f,event_id:g}})}},r.connect(c)}catch(i){console.warn("Failed to set up audio capture:",i)}}setAudioVolume(e){this.audioElements.forEach(i=>{i.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const i=this.audioElements.map(async function(a){try{await a.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(i),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const i=this.room.localParticipant.getTrackPublication(X.Source.Microphone);i!=null&&i.track&&(await i.track.stop(),await this.room.localParticipant.unpublishTrack(i.track));const a={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await MC(a);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:X.Source.Microphone})}catch(i){console.error("Failed to change input device:",i);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(a){console.error("Failed to recover microphone after device switch error:",a)}throw i}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function jC(n){const e=(function(i){return i.connectionType?i.connectionType:"conversationToken"in i&&i.conversationToken?"webrtc":"websocket"})(n);switch(e){case"websocket":return Ro.create(n);case"webrtc":return yi.create(n);default:throw new Error(`Unknown connection type: ${e}`)}}function Nf(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function VC(n={default:0,android:3e3}){let e=n.default;var i;if(/android/i.test(navigator.userAgent))e=(i=n.android)!=null?i:e;else if(Nf()){var a;e=(a=n.ios)!=null?a:e}e>0&&await new Promise(r=>setTimeout(r,e))}class wm extends _o{static async startSession(e){const i=_o.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1}),i.onModeChange&&i.onModeChange({mode:"listening"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let a=null;try{return await VC(i.connectionDelay),a=await jC(e),new wm(i,a)}catch(c){var r;throw i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(r=a)==null||r.close(),c}}}const Ab={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class Xs{static async create({sampleRate:e,format:i,preferHeadphonesForIosDevices:a,inputDeviceId:r,workletPaths:c,libsampleratePath:u}){let d=null,h=null;try{const v=ki({sampleRate:{ideal:e}},Ab);if(Nf()&&a){const w=(await window.navigator.mediaDevices.enumerateDevices()).find(V=>V.kind==="audioinput"&&["airpod","headphone","earphone"].find(I=>V.label.toLowerCase().includes(I)));w&&(v.deviceId={ideal:w.deviceId})}r&&(v.deviceId=Xs.getDeviceIdConstraint(r));const b=navigator.mediaDevices.getSupportedConstraints().sampleRate;d=new window.AudioContext(b?{sampleRate:e}:{});const T=d.createAnalyser();if(!b){const w=u||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await d.audioWorklet.addModule(w)}await BC(d.audioWorklet,c?.rawAudioProcessor);const C=ki({voiceIsolation:!0},v);h=await navigator.mediaDevices.getUserMedia({audio:C});const E=d.createMediaStreamSource(h),x=new AudioWorkletNode(d,"rawAudioProcessor");return x.port.postMessage({type:"setFormat",format:i,sampleRate:e}),E.connect(T),T.connect(x),await d.resume(),new Xs(d,T,x,h,E)}catch(v){var f,g;throw(f=h)==null||f.getTracks().forEach(b=>{b.stop()}),(g=d)==null||g.close(),v}}static getDeviceIdConstraint(e){if(e)return Nf()?{ideal:e}:{exact:e}}constructor(e,i,a,r,c){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=i,this.worklet=a,this.inputStream=r,this.mediaStreamSource=c}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const i=ki({},Ab);e&&(i.deviceId=Xs.getDeviceIdConstraint(e));const a=ki({voiceIsolation:!0},i),r=await navigator.mediaDevices.getUserMedia({audio:a});this.inputStream.getTracks().forEach(c=>{c.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(i){throw console.error("Failed to switch input device:",i),i}}}const yD=UC("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class Ul{static async create({sampleRate:e,format:i,outputDeviceId:a,workletPaths:r}){let c=null,u=null;try{c=new AudioContext({sampleRate:e});const f=c.createAnalyser(),g=c.createGain();u=new Audio,u.src="",u.load(),u.autoplay=!0,u.style.display="none",document.body.appendChild(u);const v=c.createMediaStreamDestination();u.srcObject=v.stream,g.connect(f),f.connect(v),await yD(c.audioWorklet,r?.audioConcatProcessor);const b=new AudioWorkletNode(c,"audioConcatProcessor");return b.port.postMessage({type:"setFormat",format:i}),b.connect(g),await c.resume(),a&&u.setSinkId&&await u.setSinkId(a),new Ul(c,f,g,b,u)}catch(f){var d,h;throw(d=u)!=null&&d.parentNode&&u.parentNode.removeChild(u),(h=u)==null||h.pause(),c&&c.state!=="closed"&&await c.close(),f}}constructor(e,i,a,r,c){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=i,this.gain=a,this.worklet=r,this.audioElement=c}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Mm extends _o{static async startSession(e){var i;const a=_o.getFullOptions(e);a.onStatusChange&&a.onStatusChange({status:"connecting"}),a.onCanSendFeedbackChange&&a.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,c=null,u=null,d=null,h=null;if((i=e.useWakeLock)==null||i)try{h=await navigator.wakeLock.request("screen")}catch{}try{var f;return d=await navigator.mediaDevices.getUserMedia({audio:!0}),await VC(a.connectionDelay),c=await jC(e),[r,u]=await Promise.all([Xs.create(ki({},c.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Ul.create(ki({},c.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(f=d)==null||f.getTracks().forEach(E=>{E.stop()}),d=null,new Mm(a,c,r,u,h)}catch(E){var g,v,b,T;a.onStatusChange&&a.onStatusChange({status:"disconnected"}),(g=d)==null||g.getTracks().forEach(x=>{x.stop()}),(v=c)==null||v.close(),await((b=r)==null?void 0:b.close()),await((T=u)==null?void 0:T.close());try{var C;await((C=h)==null?void 0:C.release()),h=null}catch{}throw E}}constructor(e,i,a,r,c){super(e,i),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=u=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:IC(u.data[0].buffer)})},this.onOutputWorkletMessage=({data:u})=>{u.type==="process"&&this.updateMode(u.finished?"listening":"speaking")},this.addAudioBase64Chunk=u=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:vD(u)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=u=>{if(u.length===0)return 0;let d=0;for(let h=0;h<u.length;h++)d+=u[h]/255;return d/=u.length,d<0?0:d>1?1:d},this.setVolume=({volume:u})=>{const d=Number.isFinite(u)?Math.min(1,Math.max(0,u)):1;this.volume=d,this.connection instanceof yi?this.connection.setAudioVolume(d):this.output.gain.gain.value=d},this.input=a,this.output=r,this.wakeLock=c,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var i,a;this.lastInterruptTimestamp<=e.audio_event.event_id&&((i=(a=this.options).onAudio)==null||i.call(a,e.audio_event.audio_base_64),this.connection instanceof yi||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof yi?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof yi?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:i,preferHeadphonesForIosDevices:a,inputDeviceId:r}){try{if(this.connection instanceof Ro)try{return await this.input.setInputDevice(r),this.input}catch(u){console.warn("Failed to change device on existing input, recreating:",u)}this.connection instanceof yi&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const c=await Xs.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:i??this.connection.inputFormat.format,preferHeadphonesForIosDevices:a,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=c,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(c){throw console.error("Error changing input device",c),c}}async changeOutputDevice({sampleRate:e,format:i,outputDeviceId:a}){try{if(this.connection instanceof Ro)try{return await this.output.setOutputDevice(a),this.output}catch(c){console.warn("Failed to change device on existing output, recreating:",c)}this.connection instanceof yi&&await this.connection.setAudioOutputDevice(a||""),await this.output.close();const r=await Ul.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:i??this.connection.outputFormat.format,outputDeviceId:a,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var wb;(function(n){n.SESSION_STARTED="session_started",n.PARTIAL_TRANSCRIPT="partial_transcript",n.COMMITTED_TRANSCRIPT="committed_transcript",n.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",n.AUTH_ERROR="auth_error",n.ERROR="error",n.OPEN="open",n.CLOSE="close",n.QUOTA_EXCEEDED="quota_exceeded",n.COMMIT_THROTTLED="commit_throttled",n.TRANSCRIBER_ERROR="transcriber_error",n.UNACCEPTED_TERMS="unaccepted_terms",n.RATE_LIMITED="rate_limited",n.INPUT_ERROR="input_error",n.QUEUE_OVERFLOW="queue_overflow",n.RESOURCE_EXHAUSTED="resource_exhausted",n.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",n.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",n.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(wb||(wb={}));var Mb,Db;(function(n){n.PCM_8000="pcm_8000",n.PCM_16000="pcm_16000",n.PCM_22050="pcm_22050",n.PCM_24000="pcm_24000",n.PCM_44100="pcm_44100",n.PCM_48000="pcm_48000",n.ULAW_8000="ulaw_8000"})(Mb||(Mb={})),(function(n){n.MANUAL="manual",n.VAD="vad"})(Db||(Db={}));class bD extends _o{static startSession(e){return e.textOnly?wm.startSession(e):Mm.startSession(e)}}function fo(){return fo=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},fo.apply(null,arguments)}const TD=["micMuted","volume","serverLocation"];function SD(n="us"){switch(n){case"eu-residency":case"in-residency":case"us":case"global":return n;default:return console.warn(`[ConversationalAI] Invalid server-location: ${n}. Defaulting to "us"`),"us"}}function CD(n){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[n]}function kD(n={}){const{micMuted:e,volume:i,serverLocation:a}=n,r=(function(T,C){if(T==null)return{};var E={};for(var x in T)if({}.hasOwnProperty.call(T,x)){if(C.indexOf(x)!==-1)continue;E[x]=T[x]}return E})(n,TD),c=le.useRef(null),u=le.useRef(null),[d,h]=le.useState("disconnected"),[f,g]=le.useState(!1),[v,b]=le.useState("listening");return le.useEffect(()=>{var T;e!==void 0&&(c==null||(T=c.current)==null||T.setMicMuted(e))},[e]),le.useEffect(()=>{var T;i!==void 0&&(c==null||(T=c.current)==null||T.setVolume({volume:i}))},[i]),le.useEffect(()=>()=>{var T;(T=c.current)==null||T.endSession()},[]),{startSession:async T=>{var C;if((C=c.current)!=null&&C.isOpen())return c.current.getId();if(u.current)return(await u.current).getId();try{var E,x,w,V,I,A,R,B,F,G;const $=CD(SD(T?.serverLocation||a));return u.current=bD.startSession(fo({},r??{},T??{},{origin:$,overrides:fo({},(E=r?.overrides)!=null?E:{},(x=T?.overrides)!=null?x:{},{client:fo({},(w=r==null||(V=r.overrides)==null?void 0:V.client)!=null?w:{},(I=T==null||(A=T.overrides)==null?void 0:A.client)!=null?I:{},{source:(T==null||(R=T.overrides)==null||(R=R.client)==null?void 0:R.source)||(r==null||(B=r.overrides)==null||(B=B.client)==null?void 0:B.source)||"react_sdk",version:(T==null||(F=T.overrides)==null||(F=F.client)==null?void 0:F.version)||(r==null||(G=r.overrides)==null||(G=G.client)==null?void 0:G.version)||"0.4.3"})}),onConnect:T?.onConnect||r?.onConnect,onDisconnect:T?.onDisconnect||r?.onDisconnect,onError:T?.onError||r?.onError,onMessage:T?.onMessage||r?.onMessage,onAudio:T?.onAudio||r?.onAudio,onDebug:T?.onDebug||r?.onDebug,onUnhandledClientToolCall:T?.onUnhandledClientToolCall||r?.onUnhandledClientToolCall,onModeChange:({mode:Z})=>{b(Z)},onStatusChange:({status:Z})=>{h(Z)},onCanSendFeedbackChange:({canSendFeedback:Z})=>{g(Z)}})),c.current=await u.current,e!==void 0&&c.current.setMicMuted(e),i!==void 0&&c.current.setVolume({volume:i}),c.current.getId()}finally{u.current=null}},endSession:async()=>{const T=c.current;c.current=null,await T?.endSession()},setVolume:({volume:T})=>{var C;(C=c.current)==null||C.setVolume({volume:T})},getInputByteFrequencyData:()=>{var T;return(T=c.current)==null?void 0:T.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var T;return(T=c.current)==null?void 0:T.getOutputByteFrequencyData()},getInputVolume:()=>{var T,C;return(T=(C=c.current)==null?void 0:C.getInputVolume())!=null?T:0},getOutputVolume:()=>{var T,C;return(T=(C=c.current)==null?void 0:C.getOutputVolume())!=null?T:0},sendFeedback:T=>{var C;(C=c.current)==null||C.sendFeedback(T)},getId:()=>{var T;return(T=c.current)==null?void 0:T.getId()},sendContextualUpdate:T=>{var C;(C=c.current)==null||C.sendContextualUpdate(T)},sendUserMessage:T=>{var C;(C=c.current)==null||C.sendUserMessage(T)},sendUserActivity:()=>{var T;(T=c.current)==null||T.sendUserActivity()},sendMCPToolApprovalResult:(T,C)=>{var E;(E=c.current)==null||E.sendMCPToolApprovalResult(T,C)},status:d,canSendFeedback:f,micMuted:e,isSpeaking:v==="speaking"}}const FC=le.createContext({});function ED(n){const e=le.useRef(null);return e.current===null&&(e.current=n()),e.current}const Dm=typeof window<"u",_D=Dm?le.useLayoutEffect:le.useEffect,Om=le.createContext(null);function xm(n,e){n.indexOf(e)===-1&&n.push(e)}function Pm(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}const _i=(n,e,i)=>i>e?e:i<n?n:i;let Nm=()=>{};const Ri={},zC=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function qC(n){return typeof n=="object"&&n!==null}const HC=n=>/^0[^.\s]+$/u.test(n);function Lm(n){let e;return()=>(e===void 0&&(e=n()),e)}const wn=n=>n,RD=(n,e)=>i=>e(n(i)),Po=(...n)=>n.reduce(RD),Ao=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a};class Im{constructor(){this.subscriptions=[]}add(e){return xm(this.subscriptions,e),()=>Pm(this.subscriptions,e)}notify(e,i,a){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,i,a);else for(let c=0;c<r;c++){const u=this.subscriptions[c];u&&u(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Yn=n=>n*1e3,An=n=>n/1e3;function GC(n,e){return e?n*(1e3/e):0}const KC=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,AD=1e-7,wD=12;function MD(n,e,i,a,r){let c,u,d=0;do u=e+(i-e)/2,c=KC(u,a,r)-n,c>0?i=u:e=u;while(Math.abs(c)>AD&&++d<wD);return u}function No(n,e,i,a){if(n===e&&i===a)return wn;const r=c=>MD(c,0,1,n,i);return c=>c===0||c===1?c:KC(r(c),e,a)}const YC=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,XC=n=>e=>1-n(1-e),QC=No(.33,1.53,.69,.99),Um=XC(QC),JC=YC(Um),WC=n=>(n*=2)<1?.5*Um(n):.5*(2-Math.pow(2,-10*(n-1))),Bm=n=>1-Math.sin(Math.acos(n)),ZC=XC(Bm),$C=YC(Bm),DD=No(.42,0,1,1),OD=No(0,0,.58,1),ek=No(.42,0,.58,1),xD=n=>Array.isArray(n)&&typeof n[0]!="number",tk=n=>Array.isArray(n)&&typeof n[0]=="number",PD={linear:wn,easeIn:DD,easeInOut:ek,easeOut:OD,circIn:Bm,circInOut:$C,circOut:ZC,backIn:Um,backInOut:JC,backOut:QC,anticipate:WC},ND=n=>typeof n=="string",Ob=n=>{if(tk(n)){Nm(n.length===4);const[e,i,a,r]=n;return No(e,i,a,r)}else if(ND(n))return PD[n];return n},al=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function LD(n,e){let i=new Set,a=new Set,r=!1,c=!1;const u=new WeakSet;let d={delta:0,timestamp:0,isProcessing:!1};function h(g){u.has(g)&&(f.schedule(g),n()),g(d)}const f={schedule:(g,v=!1,b=!1)=>{const C=b&&r?i:a;return v&&u.add(g),C.has(g)||C.add(g),g},cancel:g=>{a.delete(g),u.delete(g)},process:g=>{if(d=g,r){c=!0;return}r=!0,[i,a]=[a,i],i.forEach(h),i.clear(),r=!1,c&&(c=!1,f.process(g))}};return f}const ID=40;function nk(n,e){let i=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},c=()=>i=!0,u=al.reduce((I,A)=>(I[A]=LD(c),I),{}),{setup:d,read:h,resolveKeyframes:f,preUpdate:g,update:v,preRender:b,render:T,postRender:C}=u,E=()=>{const I=Ri.useManualTiming?r.timestamp:performance.now();i=!1,Ri.useManualTiming||(r.delta=a?1e3/60:Math.max(Math.min(I-r.timestamp,ID),1)),r.timestamp=I,r.isProcessing=!0,d.process(r),h.process(r),f.process(r),g.process(r),v.process(r),b.process(r),T.process(r),C.process(r),r.isProcessing=!1,i&&e&&(a=!1,n(E))},x=()=>{i=!0,a=!0,r.isProcessing||n(E)};return{schedule:al.reduce((I,A)=>{const R=u[A];return I[A]=(B,F=!1,G=!1)=>(i||x(),R.schedule(B,F,G)),I},{}),cancel:I=>{for(let A=0;A<al.length;A++)u[al[A]].cancel(I)},state:r,steps:u}}const{schedule:Ze,cancel:ua,state:Ot,steps:Hh}=nk(typeof requestAnimationFrame<"u"?requestAnimationFrame:wn,!0);let Tl;function UD(){Tl=void 0}const Zt={now:()=>(Tl===void 0&&Zt.set(Ot.isProcessing||Ri.useManualTiming?Ot.timestamp:performance.now()),Tl),set:n=>{Tl=n,queueMicrotask(UD)}},ik=n=>e=>typeof e=="string"&&e.startsWith(n),jm=ik("--"),BD=ik("var(--"),Vm=n=>BD(n)?jD.test(n.split("/*")[0].trim()):!1,jD=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,er={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},wo={...er,transform:n=>_i(0,1,n)},sl={...er,default:1},mo=n=>Math.round(n*1e5)/1e5,Fm=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function VD(n){return n==null}const FD=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zm=(n,e)=>i=>!!(typeof i=="string"&&FD.test(i)&&i.startsWith(n)||e&&!VD(i)&&Object.prototype.hasOwnProperty.call(i,e)),ak=(n,e,i)=>a=>{if(typeof a!="string")return a;const[r,c,u,d]=a.match(Fm);return{[n]:parseFloat(r),[e]:parseFloat(c),[i]:parseFloat(u),alpha:d!==void 0?parseFloat(d):1}},zD=n=>_i(0,255,n),Gh={...er,transform:n=>Math.round(zD(n))},Ba={test:zm("rgb","red"),parse:ak("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+Gh.transform(n)+", "+Gh.transform(e)+", "+Gh.transform(i)+", "+mo(wo.transform(a))+")"};function qD(n){let e="",i="",a="",r="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),r=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),r=n.substring(4,5),e+=e,i+=i,a+=a,r+=r),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:r?parseInt(r,16)/255:1}}const Lf={test:zm("#"),parse:qD,transform:Ba.transform},Lo=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),na=Lo("deg"),Xn=Lo("%"),fe=Lo("px"),HD=Lo("vh"),GD=Lo("vw"),xb={...Xn,parse:n=>Xn.parse(n)/100,transform:n=>Xn.transform(n*100)},Is={test:zm("hsl","hue"),parse:ak("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+Xn.transform(mo(e))+", "+Xn.transform(mo(i))+", "+mo(wo.transform(a))+")"},vt={test:n=>Ba.test(n)||Lf.test(n)||Is.test(n),parse:n=>Ba.test(n)?Ba.parse(n):Is.test(n)?Is.parse(n):Lf.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Ba.transform(n):Is.transform(n),getAnimatableNone:n=>{const e=vt.parse(n);return e.alpha=0,vt.transform(e)}},KD=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function YD(n){return isNaN(n)&&typeof n=="string"&&(n.match(Fm)?.length||0)+(n.match(KD)?.length||0)>0}const sk="number",rk="color",XD="var",QD="var(",Pb="${}",JD=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Mo(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},r=[];let c=0;const d=e.replace(JD,h=>(vt.test(h)?(a.color.push(c),r.push(rk),i.push(vt.parse(h))):h.startsWith(QD)?(a.var.push(c),r.push(XD),i.push(h)):(a.number.push(c),r.push(sk),i.push(parseFloat(h))),++c,Pb)).split(Pb);return{values:i,split:d,indexes:a,types:r}}function ok(n){return Mo(n).values}function ck(n){const{split:e,types:i}=Mo(n),a=e.length;return r=>{let c="";for(let u=0;u<a;u++)if(c+=e[u],r[u]!==void 0){const d=i[u];d===sk?c+=mo(r[u]):d===rk?c+=vt.transform(r[u]):c+=r[u]}return c}}const WD=n=>typeof n=="number"?0:vt.test(n)?vt.getAnimatableNone(n):n;function ZD(n){const e=ok(n);return ck(n)(e.map(WD))}const da={test:YD,parse:ok,createTransformer:ck,getAnimatableNone:ZD};function Kh(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function $D({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let r=0,c=0,u=0;if(!e)r=c=u=i;else{const d=i<.5?i*(1+e):i+e-i*e,h=2*i-d;r=Kh(h,d,n+1/3),c=Kh(h,d,n),u=Kh(h,d,n-1/3)}return{red:Math.round(r*255),green:Math.round(c*255),blue:Math.round(u*255),alpha:a}}function Bl(n,e){return i=>i>0?e:n}const $e=(n,e,i)=>n+(e-n)*i,Yh=(n,e,i)=>{const a=n*n,r=i*(e*e-a)+a;return r<0?0:Math.sqrt(r)},eO=[Lf,Ba,Is],tO=n=>eO.find(e=>e.test(n));function Nb(n){const e=tO(n);if(!e)return!1;let i=e.parse(n);return e===Is&&(i=$D(i)),i}const Lb=(n,e)=>{const i=Nb(n),a=Nb(e);if(!i||!a)return Bl(n,e);const r={...i};return c=>(r.red=Yh(i.red,a.red,c),r.green=Yh(i.green,a.green,c),r.blue=Yh(i.blue,a.blue,c),r.alpha=$e(i.alpha,a.alpha,c),Ba.transform(r))},If=new Set(["none","hidden"]);function nO(n,e){return If.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function iO(n,e){return i=>$e(n,e,i)}function qm(n){return typeof n=="number"?iO:typeof n=="string"?Vm(n)?Bl:vt.test(n)?Lb:rO:Array.isArray(n)?lk:typeof n=="object"?vt.test(n)?Lb:aO:Bl}function lk(n,e){const i=[...n],a=i.length,r=n.map((c,u)=>qm(c)(c,e[u]));return c=>{for(let u=0;u<a;u++)i[u]=r[u](c);return i}}function aO(n,e){const i={...n,...e},a={};for(const r in i)n[r]!==void 0&&e[r]!==void 0&&(a[r]=qm(n[r])(n[r],e[r]));return r=>{for(const c in a)i[c]=a[c](r);return i}}function sO(n,e){const i=[],a={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const c=e.types[r],u=n.indexes[c][a[c]],d=n.values[u]??0;i[r]=d,a[c]++}return i}const rO=(n,e)=>{const i=da.createTransformer(e),a=Mo(n),r=Mo(e);return a.indexes.var.length===r.indexes.var.length&&a.indexes.color.length===r.indexes.color.length&&a.indexes.number.length>=r.indexes.number.length?If.has(n)&&!r.values.length||If.has(e)&&!a.values.length?nO(n,e):Po(lk(sO(a,r),r.values),i):Bl(n,e)};function uk(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?$e(n,e,i):qm(n)(n,e)}const oO=n=>{const e=({timestamp:i})=>n(i);return{start:(i=!0)=>Ze.update(e,i),stop:()=>ua(e),now:()=>Ot.isProcessing?Ot.timestamp:Zt.now()}},dk=(n,e,i=10)=>{let a="";const r=Math.max(Math.round(e/i),2);for(let c=0;c<r;c++)a+=Math.round(n(c/(r-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},jl=2e4;function Hm(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<jl;)e+=i,a=n.next(e);return e>=jl?1/0:e}function cO(n,e=100,i){const a=i({...n,keyframes:[0,e]}),r=Math.min(Hm(a),jl);return{type:"keyframes",ease:c=>a.next(r*c).value/e,duration:An(r)}}const lO=5;function hk(n,e,i){const a=Math.max(e-lO,0);return GC(i-n(a),e-a)}const it={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Xh=.001;function uO({duration:n=it.duration,bounce:e=it.bounce,velocity:i=it.velocity,mass:a=it.mass}){let r,c,u=1-e;u=_i(it.minDamping,it.maxDamping,u),n=_i(it.minDuration,it.maxDuration,An(n)),u<1?(r=f=>{const g=f*u,v=g*n,b=g-i,T=Uf(f,u),C=Math.exp(-v);return Xh-b/T*C},c=f=>{const v=f*u*n,b=v*i+i,T=Math.pow(u,2)*Math.pow(f,2)*n,C=Math.exp(-v),E=Uf(Math.pow(f,2),u);return(-r(f)+Xh>0?-1:1)*((b-T)*C)/E}):(r=f=>{const g=Math.exp(-f*n),v=(f-i)*n+1;return-Xh+g*v},c=f=>{const g=Math.exp(-f*n),v=(i-f)*(n*n);return g*v});const d=5/n,h=hO(r,c,d);if(n=Yn(n),isNaN(h))return{stiffness:it.stiffness,damping:it.damping,duration:n};{const f=Math.pow(h,2)*a;return{stiffness:f,damping:u*2*Math.sqrt(a*f),duration:n}}}const dO=12;function hO(n,e,i){let a=i;for(let r=1;r<dO;r++)a=a-n(a)/e(a);return a}function Uf(n,e){return n*Math.sqrt(1-e*e)}const fO=["duration","bounce"],mO=["stiffness","damping","mass"];function Ib(n,e){return e.some(i=>n[i]!==void 0)}function pO(n){let e={velocity:it.velocity,stiffness:it.stiffness,damping:it.damping,mass:it.mass,isResolvedFromDuration:!1,...n};if(!Ib(n,mO)&&Ib(n,fO))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),r=a*a,c=2*_i(.05,1,1-(n.bounce||0))*Math.sqrt(r);e={...e,mass:it.mass,stiffness:r,damping:c}}else{const i=uO(n);e={...e,...i,mass:it.mass},e.isResolvedFromDuration=!0}return e}function Vl(n=it.visualDuration,e=it.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:r}=i;const c=i.keyframes[0],u=i.keyframes[i.keyframes.length-1],d={done:!1,value:c},{stiffness:h,damping:f,mass:g,duration:v,velocity:b,isResolvedFromDuration:T}=pO({...i,velocity:-An(i.velocity||0)}),C=b||0,E=f/(2*Math.sqrt(h*g)),x=u-c,w=An(Math.sqrt(h/g)),V=Math.abs(x)<5;a||(a=V?it.restSpeed.granular:it.restSpeed.default),r||(r=V?it.restDelta.granular:it.restDelta.default);let I;if(E<1){const R=Uf(w,E);I=B=>{const F=Math.exp(-E*w*B);return u-F*((C+E*w*x)/R*Math.sin(R*B)+x*Math.cos(R*B))}}else if(E===1)I=R=>u-Math.exp(-w*R)*(x+(C+w*x)*R);else{const R=w*Math.sqrt(E*E-1);I=B=>{const F=Math.exp(-E*w*B),G=Math.min(R*B,300);return u-F*((C+E*w*x)*Math.sinh(G)+R*x*Math.cosh(G))/R}}const A={calculatedDuration:T&&v||null,next:R=>{const B=I(R);if(T)d.done=R>=v;else{let F=R===0?C:0;E<1&&(F=R===0?Yn(C):hk(I,R,B));const G=Math.abs(F)<=a,$=Math.abs(u-B)<=r;d.done=G&&$}return d.value=d.done?u:B,d},toString:()=>{const R=Math.min(Hm(A),jl),B=dk(F=>A.next(R*F).value,R,30);return R+"ms "+B},toTransition:()=>{}};return A}Vl.applyToOptions=n=>{const e=cO(n,100,Vl);return n.ease=e.ease,n.duration=Yn(e.duration),n.type="keyframes",n};function Bf({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:r=10,bounceStiffness:c=500,modifyTarget:u,min:d,max:h,restDelta:f=.5,restSpeed:g}){const v=n[0],b={done:!1,value:v},T=G=>d!==void 0&&G<d||h!==void 0&&G>h,C=G=>d===void 0?h:h===void 0||Math.abs(d-G)<Math.abs(h-G)?d:h;let E=i*e;const x=v+E,w=u===void 0?x:u(x);w!==x&&(E=w-v);const V=G=>-E*Math.exp(-G/a),I=G=>w+V(G),A=G=>{const $=V(G),Z=I(G);b.done=Math.abs($)<=f,b.value=b.done?w:Z};let R,B;const F=G=>{T(b.value)&&(R=G,B=Vl({keyframes:[b.value,C(b.value)],velocity:hk(I,G,b.value),damping:r,stiffness:c,restDelta:f,restSpeed:g}))};return F(0),{calculatedDuration:null,next:G=>{let $=!1;return!B&&R===void 0&&($=!0,A(G),F(G)),R!==void 0&&G>=R?B.next(G-R):(!$&&A(G),b)}}}function gO(n,e,i){const a=[],r=i||Ri.mix||uk,c=n.length-1;for(let u=0;u<c;u++){let d=r(n[u],n[u+1]);if(e){const h=Array.isArray(e)?e[u]||wn:e;d=Po(h,d)}a.push(d)}return a}function vO(n,e,{clamp:i=!0,ease:a,mixer:r}={}){const c=n.length;if(Nm(c===e.length),c===1)return()=>e[0];if(c===2&&e[0]===e[1])return()=>e[1];const u=n[0]===n[1];n[0]>n[c-1]&&(n=[...n].reverse(),e=[...e].reverse());const d=gO(e,a,r),h=d.length,f=g=>{if(u&&g<n[0])return e[0];let v=0;if(h>1)for(;v<n.length-2&&!(g<n[v+1]);v++);const b=Ao(n[v],n[v+1],g);return d[v](b)};return i?g=>f(_i(n[0],n[c-1],g)):f}function yO(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const r=Ao(0,e,a);n.push($e(i,1,r))}}function bO(n){const e=[0];return yO(e,n.length-1),e}function TO(n,e){return n.map(i=>i*e)}function SO(n,e){return n.map(()=>e||ek).splice(0,n.length-1)}function po({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const r=xD(a)?a.map(Ob):Ob(a),c={done:!1,value:e[0]},u=TO(i&&i.length===e.length?i:bO(e),n),d=vO(u,e,{ease:Array.isArray(r)?r:SO(e,r)});return{calculatedDuration:n,next:h=>(c.value=d(h),c.done=h>=n,c)}}const CO=n=>n!==null;function Gm(n,{repeat:e,repeatType:i="loop"},a,r=1){const c=n.filter(CO),d=r<0||e&&i!=="loop"&&e%2===1?0:c.length-1;return!d||a===void 0?c[d]:a}const kO={decay:Bf,inertia:Bf,tween:po,keyframes:po,spring:Vl};function fk(n){typeof n.type=="string"&&(n.type=kO[n.type])}class Km{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,i){return this.finished.then(e,i)}}const EO=n=>n/100;class Ym extends Km{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:i}=this.options;i&&i.updatedAt!==Zt.now()&&this.tick(Zt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;fk(e);const{type:i=po,repeat:a=0,repeatDelay:r=0,repeatType:c,velocity:u=0}=e;let{keyframes:d}=e;const h=i||po;h!==po&&typeof d[0]!="number"&&(this.mixKeyframes=Po(EO,uk(d[0],d[1])),d=[0,100]);const f=h({...e,keyframes:d});c==="mirror"&&(this.mirroredGenerator=h({...e,keyframes:[...d].reverse(),velocity:-u})),f.calculatedDuration===null&&(f.calculatedDuration=Hm(f));const{calculatedDuration:g}=f;this.calculatedDuration=g,this.resolvedDuration=g+r,this.totalDuration=this.resolvedDuration*(a+1)-r,this.generator=f}updateTime(e){const i=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(e,i=!1){const{generator:a,totalDuration:r,mixKeyframes:c,mirroredGenerator:u,resolvedDuration:d,calculatedDuration:h}=this;if(this.startTime===null)return a.next(0);const{delay:f=0,keyframes:g,repeat:v,repeatType:b,repeatDelay:T,type:C,onUpdate:E,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),i?this.currentTime=e:this.updateTime(e);const w=this.currentTime-f*(this.playbackSpeed>=0?1:-1),V=this.playbackSpeed>=0?w<0:w>r;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let I=this.currentTime,A=a;if(v){const G=Math.min(this.currentTime,r)/d;let $=Math.floor(G),Z=G%1;!Z&&G>=1&&(Z=1),Z===1&&$--,$=Math.min($,v+1),!!($%2)&&(b==="reverse"?(Z=1-Z,T&&(Z-=T/d)):b==="mirror"&&(A=u)),I=_i(0,1,Z)*d}const R=V?{done:!1,value:g[0]}:A.next(I);c&&(R.value=c(R.value));let{done:B}=R;!V&&h!==null&&(B=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const F=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&B);return F&&C!==Bf&&(R.value=Gm(g,this.options,x,this.speed)),E&&E(R.value),F&&this.finish(),R}then(e,i){return this.finished.then(e,i)}get duration(){return An(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+An(e)}get time(){return An(this.currentTime)}set time(e){e=Yn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Zt.now());const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=An(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=oO,startTime:i}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),this.options.onPlay?.();const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=i??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Zt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function _O(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const ja=n=>n*180/Math.PI,jf=n=>{const e=ja(Math.atan2(n[1],n[0]));return Vf(e)},RO={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:jf,rotateZ:jf,skewX:n=>ja(Math.atan(n[1])),skewY:n=>ja(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},Vf=n=>(n=n%360,n<0&&(n+=360),n),Ub=jf,Bb=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),jb=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),AO={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Bb,scaleY:jb,scale:n=>(Bb(n)+jb(n))/2,rotateX:n=>Vf(ja(Math.atan2(n[6],n[5]))),rotateY:n=>Vf(ja(Math.atan2(-n[2],n[0]))),rotateZ:Ub,rotate:Ub,skewX:n=>ja(Math.atan(n[4])),skewY:n=>ja(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function Ff(n){return n.includes("scale")?1:0}function zf(n,e){if(!n||n==="none")return Ff(e);const i=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,r;if(i)a=AO,r=i;else{const d=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=RO,r=d}if(!r)return Ff(e);const c=a[e],u=r[1].split(",").map(MO);return typeof c=="function"?c(u):u[c]}const wO=(n,e)=>{const{transform:i="none"}=getComputedStyle(n);return zf(i,e)};function MO(n){return parseFloat(n.trim())}const tr=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],nr=new Set(tr),Vb=n=>n===er||n===fe,DO=new Set(["x","y","z"]),OO=tr.filter(n=>!DO.has(n));function xO(n){const e=[];return OO.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const Va={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>zf(e,"x"),y:(n,{transform:e})=>zf(e,"y")};Va.translateX=Va.x;Va.translateY=Va.y;const Fa=new Set;let qf=!1,Hf=!1,Gf=!1;function mk(){if(Hf){const n=Array.from(Fa).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const r=xO(a);r.length&&(i.set(a,r),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const r=i.get(a);r&&r.forEach(([c,u])=>{a.getValue(c)?.set(u)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}Hf=!1,qf=!1,Fa.forEach(n=>n.complete(Gf)),Fa.clear()}function pk(){Fa.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(Hf=!0)})}function PO(){Gf=!0,pk(),mk(),Gf=!1}class Xm{constructor(e,i,a,r,c,u=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=r,this.element=c,this.isAsync=u}scheduleResolve(){this.state="scheduled",this.isAsync?(Fa.add(this),qf||(qf=!0,Ze.read(pk),Ze.resolveKeyframes(mk))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:r}=this;if(e[0]===null){const c=r?.get(),u=e[e.length-1];if(c!==void 0)e[0]=c;else if(a&&i){const d=a.readValue(i,u);d!=null&&(e[0]=d)}e[0]===void 0&&(e[0]=u),r&&c===void 0&&r.set(e[0])}_O(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Fa.delete(this)}cancel(){this.state==="scheduled"&&(Fa.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const NO=n=>n.startsWith("--");function LO(n,e,i){NO(e)?n.style.setProperty(e,i):n.style[e]=i}const IO=Lm(()=>window.ScrollTimeline!==void 0),UO={};function BO(n,e){const i=Lm(n);return()=>UO[e]??i()}const gk=BO(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),oo=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,Fb={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:oo([0,.65,.55,1]),circOut:oo([.55,0,1,.45]),backIn:oo([.31,.01,.66,-.59]),backOut:oo([.33,1.53,.69,.99])};function vk(n,e){if(n)return typeof n=="function"?gk()?dk(n,e):"ease-out":tk(n)?oo(n):Array.isArray(n)?n.map(i=>vk(i,e)||Fb.easeOut):Fb[n]}function jO(n,e,i,{delay:a=0,duration:r=300,repeat:c=0,repeatType:u="loop",ease:d="easeOut",times:h}={},f=void 0){const g={[e]:i};h&&(g.offset=h);const v=vk(d,r);Array.isArray(v)&&(g.easing=v);const b={delay:a,duration:r,easing:Array.isArray(v)?"linear":v,fill:"both",iterations:c+1,direction:u==="reverse"?"alternate":"normal"};return f&&(b.pseudoElement=f),n.animate(g,b)}function yk(n){return typeof n=="function"&&"applyToOptions"in n}function VO({type:n,...e}){return yk(n)&&gk()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class FO extends Km{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:i,name:a,keyframes:r,pseudoElement:c,allowFlatten:u=!1,finalKeyframe:d,onComplete:h}=e;this.isPseudoElement=!!c,this.allowFlatten=u,this.options=e,Nm(typeof e.type!="string");const f=VO(e);this.animation=jO(i,a,r,f,c),f.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!c){const g=Gm(r,this.options,d,this.speed);this.updateMotionValue?this.updateMotionValue(g):LO(i,a,g),this.animation.cancel()}h?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return An(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+An(e)}get time(){return An(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Yn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:i}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&IO()?(this.animation.timeline=e,wn):i(this)}}const bk={anticipate:WC,backInOut:JC,circInOut:$C};function zO(n){return n in bk}function qO(n){typeof n.ease=="string"&&zO(n.ease)&&(n.ease=bk[n.ease])}const zb=10;class HO extends FO{constructor(e){qO(e),fk(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:i,onUpdate:a,onComplete:r,element:c,...u}=this.options;if(!i)return;if(e!==void 0){i.set(e);return}const d=new Ym({...u,autoplay:!1}),h=Yn(this.finishedTime??this.time);i.setWithVelocity(d.sample(h-zb).value,d.sample(h).value,zb),d.stop()}}const qb=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(da.test(n)||n==="0")&&!n.startsWith("url("));function GO(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function KO(n,e,i,a){const r=n[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const c=n[n.length-1],u=qb(r,e),d=qb(c,e);return!u||!d?!1:GO(n)||(i==="spring"||yk(i))&&a}function Kf(n){n.duration=0,n.type="keyframes"}const YO=new Set(["opacity","clipPath","filter","transform"]),XO=Lm(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function QO(n){const{motionValue:e,name:i,repeatDelay:a,repeatType:r,damping:c,type:u}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:h,transformTemplate:f}=e.owner.getProps();return XO()&&i&&YO.has(i)&&(i!=="transform"||!f)&&!h&&!a&&r!=="mirror"&&c!==0&&u!=="inertia"}const JO=40;class WO extends Km{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:r=0,repeatDelay:c=0,repeatType:u="loop",keyframes:d,name:h,motionValue:f,element:g,...v}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Zt.now();const b={autoplay:e,delay:i,type:a,repeat:r,repeatDelay:c,repeatType:u,name:h,motionValue:f,element:g,...v},T=g?.KeyframeResolver||Xm;this.keyframeResolver=new T(d,(C,E,x)=>this.onKeyframesResolved(C,E,b,!x),h,f,g),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,i,a,r){this.keyframeResolver=void 0;const{name:c,type:u,velocity:d,delay:h,isHandoff:f,onUpdate:g}=a;this.resolvedAt=Zt.now(),KO(e,c,u,d)||((Ri.instantAnimations||!h)&&g?.(Gm(e,a,i)),e[0]=e[e.length-1],Kf(a),a.repeat=0);const b={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>JO?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...a,keyframes:e},T=!f&&QO(b)?new HO({...b,element:b.motionValue.owner.current}):new Ym(b);T.finished.then(()=>this.notifyFinished()).catch(wn),this.pendingTimeline&&(this.stopTimeline=T.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=T}get finished(){return this._animation?this.animation.finished:this._finished}then(e,i){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),PO()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const ZO=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function $O(n){const e=ZO.exec(n);if(!e)return[,];const[,i,a,r]=e;return[`--${i??a}`,r]}function Tk(n,e,i=1){const[a,r]=$O(n);if(!a)return;const c=window.getComputedStyle(e).getPropertyValue(a);if(c){const u=c.trim();return zC(u)?parseFloat(u):u}return Vm(r)?Tk(r,e,i+1):r}function Qm(n,e){return n?.[e]??n?.default??n}const Sk=new Set(["width","height","top","left","right","bottom",...tr]),ex={test:n=>n==="auto",parse:n=>n},Ck=n=>e=>e.test(n),kk=[er,fe,Xn,na,GD,HD,ex],Hb=n=>kk.find(Ck(n));function tx(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||HC(n):!0}const nx=new Set(["brightness","contrast","saturate","opacity"]);function ix(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(Fm)||[];if(!a)return n;const r=i.replace(a,"");let c=nx.has(e)?1:0;return a!==i&&(c*=100),e+"("+c+r+")"}const ax=/\b([a-z-]*)\(.*?\)/gu,Yf={...da,getAnimatableNone:n=>{const e=n.match(ax);return e?e.map(ix).join(" "):n}},Gb={...er,transform:Math.round},sx={rotate:na,rotateX:na,rotateY:na,rotateZ:na,scale:sl,scaleX:sl,scaleY:sl,scaleZ:sl,skew:na,skewX:na,skewY:na,distance:fe,translateX:fe,translateY:fe,translateZ:fe,x:fe,y:fe,z:fe,perspective:fe,transformPerspective:fe,opacity:wo,originX:xb,originY:xb,originZ:fe},Jm={borderWidth:fe,borderTopWidth:fe,borderRightWidth:fe,borderBottomWidth:fe,borderLeftWidth:fe,borderRadius:fe,radius:fe,borderTopLeftRadius:fe,borderTopRightRadius:fe,borderBottomRightRadius:fe,borderBottomLeftRadius:fe,width:fe,maxWidth:fe,height:fe,maxHeight:fe,top:fe,right:fe,bottom:fe,left:fe,padding:fe,paddingTop:fe,paddingRight:fe,paddingBottom:fe,paddingLeft:fe,margin:fe,marginTop:fe,marginRight:fe,marginBottom:fe,marginLeft:fe,backgroundPositionX:fe,backgroundPositionY:fe,...sx,zIndex:Gb,fillOpacity:wo,strokeOpacity:wo,numOctaves:Gb},rx={...Jm,color:vt,backgroundColor:vt,outlineColor:vt,fill:vt,stroke:vt,borderColor:vt,borderTopColor:vt,borderRightColor:vt,borderBottomColor:vt,borderLeftColor:vt,filter:Yf,WebkitFilter:Yf},Ek=n=>rx[n];function _k(n,e){let i=Ek(n);return i!==Yf&&(i=da),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const ox=new Set(["auto","none","0"]);function cx(n,e,i){let a=0,r;for(;a<n.length&&!r;){const c=n[a];typeof c=="string"&&!ox.has(c)&&Mo(c).values.length&&(r=n[a]),a++}if(r&&i)for(const c of e)n[c]=_k(i,r)}class lx extends Xm{constructor(e,i,a,r,c){super(e,i,a,r,c,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let h=0;h<e.length;h++){let f=e[h];if(typeof f=="string"&&(f=f.trim(),Vm(f))){const g=Tk(f,i.current);g!==void 0&&(e[h]=g),h===e.length-1&&(this.finalKeyframe=f)}}if(this.resolveNoneKeyframes(),!Sk.has(a)||e.length!==2)return;const[r,c]=e,u=Hb(r),d=Hb(c);if(u!==d)if(Vb(u)&&Vb(d))for(let h=0;h<e.length;h++){const f=e[h];typeof f=="string"&&(e[h]=parseFloat(f))}else Va[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let r=0;r<e.length;r++)(e[r]===null||tx(e[r]))&&a.push(r);a.length&&cx(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Va[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const r=i[i.length-1];r!==void 0&&e.getValue(a,r).jump(r,!1)}measureEndState(){const{element:e,name:i,unresolvedKeyframes:a}=this;if(!e||!e.current)return;const r=e.getValue(i);r&&r.jump(this.measuredOrigin,!1);const c=a.length-1,u=a[c];a[c]=Va[i](e.measureViewportBox(),window.getComputedStyle(e.current)),u!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=u),this.removedTransforms?.length&&this.removedTransforms.forEach(([d,h])=>{e.getValue(d).set(h)}),this.resolveNoneKeyframes()}}function ux(n,e,i){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let a=document;const r=i?.[n]??a.querySelectorAll(n);return r?Array.from(r):[]}return Array.from(n)}const Rk=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function dx(n){return qC(n)&&"offsetHeight"in n}const Kb=30,hx=n=>!isNaN(parseFloat(n));class fx{constructor(e,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{const r=Zt.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const c of this.dependents)c.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Zt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=hx(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Im);const a=this.events[e].add(i);return e==="change"?()=>{a(),Ze.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Zt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Kb)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Kb);return GC(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Zs(n,e){return new fx(n,e)}const{schedule:Wm}=nk(queueMicrotask,!1),Pn={x:!1,y:!1};function Ak(){return Pn.x||Pn.y}function mx(n){return n==="x"||n==="y"?Pn[n]?null:(Pn[n]=!0,()=>{Pn[n]=!1}):Pn.x||Pn.y?null:(Pn.x=Pn.y=!0,()=>{Pn.x=Pn.y=!1})}function wk(n,e){const i=ux(n),a=new AbortController,r={passive:!0,...e,signal:a.signal};return[i,r,()=>a.abort()]}function Yb(n){return!(n.pointerType==="touch"||Ak())}function px(n,e,i={}){const[a,r,c]=wk(n,i),u=d=>{if(!Yb(d))return;const{target:h}=d,f=e(h,d);if(typeof f!="function"||!h)return;const g=v=>{Yb(v)&&(f(v),h.removeEventListener("pointerleave",g))};h.addEventListener("pointerleave",g,r)};return a.forEach(d=>{d.addEventListener("pointerenter",u,r)}),c}const Mk=(n,e)=>e?n===e?!0:Mk(n,e.parentElement):!1,Zm=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,gx=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function vx(n){return gx.has(n.tagName)||n.tabIndex!==-1}const Sl=new WeakSet;function Xb(n){return e=>{e.key==="Enter"&&n(e)}}function Qh(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const yx=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=Xb(()=>{if(Sl.has(i))return;Qh(i,"down");const r=Xb(()=>{Qh(i,"up")}),c=()=>Qh(i,"cancel");i.addEventListener("keyup",r,e),i.addEventListener("blur",c,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function Qb(n){return Zm(n)&&!Ak()}function bx(n,e,i={}){const[a,r,c]=wk(n,i),u=d=>{const h=d.currentTarget;if(!Qb(d))return;Sl.add(h);const f=e(h,d),g=(T,C)=>{window.removeEventListener("pointerup",v),window.removeEventListener("pointercancel",b),Sl.has(h)&&Sl.delete(h),Qb(T)&&typeof f=="function"&&f(T,{success:C})},v=T=>{g(T,h===window||h===document||i.useGlobalTarget||Mk(h,T.target))},b=T=>{g(T,!1)};window.addEventListener("pointerup",v,r),window.addEventListener("pointercancel",b,r)};return a.forEach(d=>{(i.useGlobalTarget?window:d).addEventListener("pointerdown",u,r),dx(d)&&(d.addEventListener("focus",f=>yx(f,r)),!vx(d)&&!d.hasAttribute("tabindex")&&(d.tabIndex=0))}),c}function Dk(n){return qC(n)&&"ownerSVGElement"in n}function Tx(n){return Dk(n)&&n.tagName==="svg"}const Lt=n=>!!(n&&n.getVelocity),Sx=[...kk,vt,da],Cx=n=>Sx.find(Ck(n)),Ok=le.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function kx(n=!0){const e=le.useContext(Om);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:r}=e,c=le.useId();le.useEffect(()=>{if(n)return r(c)},[n]);const u=le.useCallback(()=>n&&a&&a(c),[c,a,n]);return!i&&a?[!1,u]:[!0]}const xk=le.createContext({strict:!1}),Jb={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$s={};for(const n in Jb)$s[n]={isEnabled:e=>Jb[n].some(i=>!!e[i])};function Ex(n){for(const e in n)$s[e]={...$s[e],...n[e]}}const _x=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Fl(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||_x.has(n)}let Pk=n=>!Fl(n);function Rx(n){typeof n=="function"&&(Pk=e=>e.startsWith("on")?!Fl(e):n(e))}try{Rx(require("@emotion/is-prop-valid").default)}catch{}function Ax(n,e,i){const a={};for(const r in n)r==="values"&&typeof n.values=="object"||(Pk(r)||i===!0&&Fl(r)||!e&&!Fl(r)||n.draggable&&r.startsWith("onDrag"))&&(a[r]=n[r]);return a}const Zl=le.createContext({});function $l(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Do(n){return typeof n=="string"||Array.isArray(n)}const $m=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ep=["initial",...$m];function eu(n){return $l(n.animate)||ep.some(e=>Do(n[e]))}function Nk(n){return!!(eu(n)||n.variants)}function wx(n,e){if(eu(n)){const{initial:i,animate:a}=n;return{initial:i===!1||Do(i)?i:void 0,animate:Do(a)?a:void 0}}return n.inherit!==!1?e:{}}function Mx(n){const{initial:e,animate:i}=wx(n,le.useContext(Zl));return le.useMemo(()=>({initial:e,animate:i}),[Wb(e),Wb(i)])}function Wb(n){return Array.isArray(n)?n.join(" "):n}const Oo={};function Dx(n){for(const e in n)Oo[e]=n[e],jm(e)&&(Oo[e].isCSSVariable=!0)}function Lk(n,{layout:e,layoutId:i}){return nr.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Oo[n]||n==="opacity")}const Ox={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},xx=tr.length;function Px(n,e,i){let a="",r=!0;for(let c=0;c<xx;c++){const u=tr[c],d=n[u];if(d===void 0)continue;let h=!0;if(typeof d=="number"?h=d===(u.startsWith("scale")?1:0):h=parseFloat(d)===0,!h||i){const f=Rk(d,Jm[u]);if(!h){r=!1;const g=Ox[u]||u;a+=`${g}(${f}) `}i&&(e[u]=f)}}return a=a.trim(),i?a=i(e,r?"":a):r&&(a="none"),a}function tp(n,e,i){const{style:a,vars:r,transformOrigin:c}=n;let u=!1,d=!1;for(const h in e){const f=e[h];if(nr.has(h)){u=!0;continue}else if(jm(h)){r[h]=f;continue}else{const g=Rk(f,Jm[h]);h.startsWith("origin")?(d=!0,c[h]=g):a[h]=g}}if(e.transform||(u||i?a.transform=Px(e,n.transform,i):a.transform&&(a.transform="none")),d){const{originX:h="50%",originY:f="50%",originZ:g=0}=c;a.transformOrigin=`${h} ${f} ${g}`}}const np=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Ik(n,e,i){for(const a in e)!Lt(e[a])&&!Lk(a,i)&&(n[a]=e[a])}function Nx({transformTemplate:n},e){return le.useMemo(()=>{const i=np();return tp(i,e,n),Object.assign({},i.vars,i.style)},[e])}function Lx(n,e){const i=n.style||{},a={};return Ik(a,i,n),Object.assign(a,Nx(n,e)),a}function Ix(n,e){const i={},a=Lx(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}const Ux={offset:"stroke-dashoffset",array:"stroke-dasharray"},Bx={offset:"strokeDashoffset",array:"strokeDasharray"};function jx(n,e,i=1,a=0,r=!0){n.pathLength=1;const c=r?Ux:Bx;n[c.offset]=fe.transform(-a);const u=fe.transform(e),d=fe.transform(i);n[c.array]=`${u} ${d}`}function Uk(n,{attrX:e,attrY:i,attrScale:a,pathLength:r,pathSpacing:c=1,pathOffset:u=0,...d},h,f,g){if(tp(n,d,f),h){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:v,style:b}=n;v.transform&&(b.transform=v.transform,delete v.transform),(b.transform||v.transformOrigin)&&(b.transformOrigin=v.transformOrigin??"50% 50%",delete v.transformOrigin),b.transform&&(b.transformBox=g?.transformBox??"fill-box",delete v.transformBox),e!==void 0&&(v.x=e),i!==void 0&&(v.y=i),a!==void 0&&(v.scale=a),r!==void 0&&jx(v,r,c,u,!1)}const Bk=()=>({...np(),attrs:{}}),jk=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Vx(n,e,i,a){const r=le.useMemo(()=>{const c=Bk();return Uk(c,e,jk(a),n.transformTemplate,n.style),{...c.attrs,style:{...c.style}}},[e]);if(n.style){const c={};Ik(c,n.style,n),r.style={...c,...r.style}}return r}const Fx=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ip(n){return typeof n!="string"||n.includes("-")?!1:!!(Fx.indexOf(n)>-1||/[A-Z]/u.test(n))}function zx(n,e,i,{latestValues:a},r,c=!1){const d=(ip(n)?Vx:Ix)(e,a,r,n),h=Ax(e,typeof n=="string",c),f=n!==le.Fragment?{...h,...d,ref:i}:{},{children:g}=e,v=le.useMemo(()=>Lt(g)?g.get():g,[g]);return le.createElement(n,{...f,children:v})}function Zb(n){const e=[{},{}];return n?.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function ap(n,e,i,a){if(typeof e=="function"){const[r,c]=Zb(a);e=e(i!==void 0?i:n.custom,r,c)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[r,c]=Zb(a);e=e(i!==void 0?i:n.custom,r,c)}return e}function Cl(n){return Lt(n)?n.get():n}function qx({scrapeMotionValuesFromProps:n,createRenderState:e},i,a,r){return{latestValues:Hx(i,a,r,n),renderState:e()}}function Hx(n,e,i,a){const r={},c=a(n,{});for(const b in c)r[b]=Cl(c[b]);let{initial:u,animate:d}=n;const h=eu(n),f=Nk(n);e&&f&&!h&&n.inherit!==!1&&(u===void 0&&(u=e.initial),d===void 0&&(d=e.animate));let g=i?i.initial===!1:!1;g=g||u===!1;const v=g?d:u;if(v&&typeof v!="boolean"&&!$l(v)){const b=Array.isArray(v)?v:[v];for(let T=0;T<b.length;T++){const C=ap(n,b[T]);if(C){const{transitionEnd:E,transition:x,...w}=C;for(const V in w){let I=w[V];if(Array.isArray(I)){const A=g?I.length-1:0;I=I[A]}I!==null&&(r[V]=I)}for(const V in E)r[V]=E[V]}}}return r}const Vk=n=>(e,i)=>{const a=le.useContext(Zl),r=le.useContext(Om),c=()=>qx(n,e,a,r);return i?c():ED(c)};function sp(n,e,i){const{style:a}=n,r={};for(const c in a)(Lt(a[c])||e.style&&Lt(e.style[c])||Lk(c,n)||i?.getValue(c)?.liveStyle!==void 0)&&(r[c]=a[c]);return r}const Gx=Vk({scrapeMotionValuesFromProps:sp,createRenderState:np});function Fk(n,e,i){const a=sp(n,e,i);for(const r in n)if(Lt(n[r])||Lt(e[r])){const c=tr.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;a[c]=n[r]}return a}const Kx=Vk({scrapeMotionValuesFromProps:Fk,createRenderState:Bk}),Yx=Symbol.for("motionComponentSymbol");function Us(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function Xx(n,e,i){return le.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):Us(i)&&(i.current=a))},[e])}const rp=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Qx="framerAppearId",zk="data-"+rp(Qx),qk=le.createContext({});function Jx(n,e,i,a,r){const{visualElement:c}=le.useContext(Zl),u=le.useContext(xk),d=le.useContext(Om),h=le.useContext(Ok).reducedMotion,f=le.useRef(null);a=a||u.renderer,!f.current&&a&&(f.current=a(n,{visualState:e,parent:c,props:i,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:h}));const g=f.current,v=le.useContext(qk);g&&!g.projection&&r&&(g.type==="html"||g.type==="svg")&&Wx(f.current,i,r,v);const b=le.useRef(!1);le.useInsertionEffect(()=>{g&&b.current&&g.update(i,d)});const T=i[zk],C=le.useRef(!!T&&!window.MotionHandoffIsComplete?.(T)&&window.MotionHasOptimisedAnimation?.(T));return _D(()=>{g&&(b.current=!0,window.MotionIsMounted=!0,g.updateFeatures(),g.scheduleRenderMicrotask(),C.current&&g.animationState&&g.animationState.animateChanges())}),le.useEffect(()=>{g&&(!C.current&&g.animationState&&g.animationState.animateChanges(),C.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(T)}),C.current=!1),g.enteringChildren=void 0)}),g}function Wx(n,e,i,a){const{layoutId:r,layout:c,drag:u,dragConstraints:d,layoutScroll:h,layoutRoot:f,layoutCrossfade:g}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Hk(n.parent)),n.projection.setOptions({layoutId:r,layout:c,alwaysMeasureLayout:!!u||d&&Us(d),visualElement:n,animationType:typeof c=="string"?c:"both",initialPromotionConfig:a,crossfade:g,layoutScroll:h,layoutRoot:f})}function Hk(n){if(n)return n.options.allowProjection!==!1?n.projection:Hk(n.parent)}function Jh(n,{forwardMotionProps:e=!1}={},i,a){i&&Ex(i);const r=ip(n)?Kx:Gx;function c(d,h){let f;const g={...le.useContext(Ok),...d,layoutId:Zx(d)},{isStatic:v}=g,b=Mx(d),T=r(d,v);if(!v&&Dm){$x();const C=eP(g);f=C.MeasureLayout,b.visualElement=Jx(n,T,g,a,C.ProjectionNode)}return Ce.jsxs(Zl.Provider,{value:b,children:[f&&b.visualElement?Ce.jsx(f,{visualElement:b.visualElement,...g}):null,zx(n,d,Xx(T,b.visualElement,h),T,v,e)]})}c.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const u=le.forwardRef(c);return u[Yx]=n,u}function Zx({layoutId:n}){const e=le.useContext(FC).id;return e&&n!==void 0?e+"-"+n:n}function $x(n,e){le.useContext(xk).strict}function eP(n){const{drag:e,layout:i}=$s;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e?.isEnabled(n)||i?.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function tP(n,e){if(typeof Proxy>"u")return Jh;const i=new Map,a=(c,u)=>Jh(c,u,n,e),r=(c,u)=>a(c,u);return new Proxy(r,{get:(c,u)=>u==="create"?a:(i.has(u)||i.set(u,Jh(u,void 0,n,e)),i.get(u))})}function Gk({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function nP({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function iP(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function Wh(n){return n===void 0||n===1}function Xf({scale:n,scaleX:e,scaleY:i}){return!Wh(n)||!Wh(e)||!Wh(i)}function Ua(n){return Xf(n)||Kk(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Kk(n){return $b(n.x)||$b(n.y)}function $b(n){return n&&n!=="0%"}function zl(n,e,i){const a=n-i,r=e*a;return i+r}function eT(n,e,i,a,r){return r!==void 0&&(n=zl(n,r,a)),zl(n,i,a)+e}function Qf(n,e=0,i=1,a,r){n.min=eT(n.min,e,i,a,r),n.max=eT(n.max,e,i,a,r)}function Yk(n,{x:e,y:i}){Qf(n.x,e.translate,e.scale,e.originPoint),Qf(n.y,i.translate,i.scale,i.originPoint)}const tT=.999999999999,nT=1.0000000000001;function aP(n,e,i,a=!1){const r=i.length;if(!r)return;e.x=e.y=1;let c,u;for(let d=0;d<r;d++){c=i[d],u=c.projectionDelta;const{visualElement:h}=c.options;h&&h.props.style&&h.props.style.display==="contents"||(a&&c.options.layoutScroll&&c.scroll&&c!==c.root&&js(n,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),u&&(e.x*=u.x.scale,e.y*=u.y.scale,Yk(n,u)),a&&Ua(c.latestValues)&&js(n,c.latestValues))}e.x<nT&&e.x>tT&&(e.x=1),e.y<nT&&e.y>tT&&(e.y=1)}function Bs(n,e){n.min=n.min+e,n.max=n.max+e}function iT(n,e,i,a,r=.5){const c=$e(n.min,n.max,r);Qf(n,e,i,c,a)}function js(n,e){iT(n.x,e.x,e.scaleX,e.scale,e.originX),iT(n.y,e.y,e.scaleY,e.scale,e.originY)}function Xk(n,e){return Gk(iP(n.getBoundingClientRect(),e))}function sP(n,e,i){const a=Xk(n,i),{scroll:r}=e;return r&&(Bs(a.x,r.offset.x),Bs(a.y,r.offset.y)),a}const aT=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vs=()=>({x:aT(),y:aT()}),sT=()=>({min:0,max:0}),ut=()=>({x:sT(),y:sT()}),Jf={current:null},Qk={current:!1};function rP(){if(Qk.current=!0,!!Dm)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>Jf.current=n.matches;n.addEventListener("change",e),e()}else Jf.current=!1}const oP=new WeakMap;function cP(n,e,i){for(const a in e){const r=e[a],c=i[a];if(Lt(r))n.addValue(a,r);else if(Lt(c))n.addValue(a,Zs(r,{owner:n}));else if(c!==r)if(n.hasValue(a)){const u=n.getValue(a);u.liveStyle===!0?u.jump(r):u.hasAnimated||u.set(r)}else{const u=n.getStaticValue(a);n.addValue(a,Zs(u!==void 0?u:r,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const rT=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class lP{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:r,blockInitialAnimation:c,visualState:u},d={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Xm,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const b=Zt.now();this.renderScheduledAt<b&&(this.renderScheduledAt=b,Ze.render(this.render,!1,!0))};const{latestValues:h,renderState:f}=u;this.latestValues=h,this.baseTarget={...h},this.initialValues=i.initial?{...h}:{},this.renderState=f,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=d,this.blockInitialAnimation=!!c,this.isControllingVariants=eu(i),this.isVariantNode=Nk(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:g,...v}=this.scrapeMotionValuesFromProps(i,{},this);for(const b in v){const T=v[b];h[b]!==void 0&&Lt(T)&&T.set(h[b])}}mount(e){this.current=e,oP.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),Qk.current||rP(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Jf.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ua(this.notifyUpdate),ua(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=nr.has(e);a&&this.onBindTransform&&this.onBindTransform();const r=i.on("change",u=>{this.latestValues[e]=u,this.props.onUpdate&&Ze.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let c;window.MotionCheckAppearSync&&(c=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{r(),c&&c(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in $s){const i=$s[e];if(!i)continue;const{isEnabled:a,Feature:r}=i;if(!this.features[e]&&r&&a(this.props)&&(this.features[e]=new r(this)),this.features[e]){const c=this.features[e];c.isMounted?c.update():(c.mount(),c.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ut()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<rT.length;a++){const r=rT[a];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const c="on"+r,u=e[c];u&&(this.propEventSubscriptions[r]=this.on(r,u))}this.prevMotionValues=cP(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=Zs(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){let a=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return a!=null&&(typeof a=="string"&&(zC(a)||HC(a))?a=parseFloat(a):!Cx(a)&&da.test(i)&&(a=_k(e,i)),this.setBaseTarget(e,Lt(a)?a.get():a)),Lt(a)?a.get():a}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){const{initial:i}=this.props;let a;if(typeof i=="string"||typeof i=="object"){const c=ap(this.props,i,this.presenceContext?.custom);c&&(a=c[e])}if(i&&a!==void 0)return a;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Lt(r)?r:this.initialValues[e]!==void 0&&a===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Im),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}scheduleRenderMicrotask(){Wm.render(this.render)}}class Jk extends lP{constructor(){super(...arguments),this.KeyframeResolver=lx}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Lt(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Wk(n,{style:e,vars:i},a,r){const c=n.style;let u;for(u in e)c[u]=e[u];r?.applyProjectionStyles(c,a);for(u in i)c.setProperty(u,i[u])}function uP(n){return window.getComputedStyle(n)}class dP extends Jk{constructor(){super(...arguments),this.type="html",this.renderInstance=Wk}readValueFromInstance(e,i){if(nr.has(i))return this.projection?.isProjecting?Ff(i):wO(e,i);{const a=uP(e),r=(jm(i)?a.getPropertyValue(i):a[i])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Xk(e,i)}build(e,i,a){tp(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return sp(e,i,a)}}const Zk=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function hP(n,e,i,a){Wk(n,e,void 0,a);for(const r in e.attrs)n.setAttribute(Zk.has(r)?r:rp(r),e.attrs[r])}class fP extends Jk{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ut}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(nr.has(i)){const a=Ek(i);return a&&a.default||0}return i=Zk.has(i)?i:rp(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return Fk(e,i,a)}build(e,i,a){Uk(e,i,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(e,i,a,r){hP(e,i,a,r)}mount(e){this.isSVGTag=jk(e.tagName),super.mount(e)}}const mP=(n,e)=>ip(n)?new fP(e):new dP(e,{allowProjection:n!==le.Fragment});function Qs(n,e,i){const a=n.getProps();return ap(a,e,i!==void 0?i:a.custom,n)}const Wf=n=>Array.isArray(n);function pP(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,Zs(i))}function gP(n){return Wf(n)?n[n.length-1]||0:n}function vP(n,e){const i=Qs(n,e);let{transitionEnd:a={},transition:r={},...c}=i||{};c={...c,...a};for(const u in c){const d=gP(c[u]);pP(n,u,d)}}function yP(n){return!!(Lt(n)&&n.add)}function Zf(n,e){const i=n.getValue("willChange");if(yP(i))return i.add(e);if(!i&&Ri.WillChange){const a=new Ri.WillChange("auto");n.addValue("willChange",a),a.add(e)}}function $k(n){return n.props[zk]}const bP=n=>n!==null;function TP(n,{repeat:e,repeatType:i="loop"},a){const r=n.filter(bP),c=e&&i!=="loop"&&e%2===1?0:r.length-1;return r[c]}const SP={type:"spring",stiffness:500,damping:25,restSpeed:10},CP=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),kP={type:"keyframes",duration:.8},EP={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_P=(n,{keyframes:e})=>e.length>2?kP:nr.has(n)?n.startsWith("scale")?CP(e[1]):SP:EP;function RP({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:r,repeat:c,repeatType:u,repeatDelay:d,from:h,elapsed:f,...g}){return!!Object.keys(g).length}const op=(n,e,i,a={},r,c)=>u=>{const d=Qm(a,n)||{},h=d.delay||a.delay||0;let{elapsed:f=0}=a;f=f-Yn(h);const g={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...d,delay:-f,onUpdate:b=>{e.set(b),d.onUpdate&&d.onUpdate(b)},onComplete:()=>{u(),d.onComplete&&d.onComplete()},name:n,motionValue:e,element:c?void 0:r};RP(d)||Object.assign(g,_P(n,g)),g.duration&&(g.duration=Yn(g.duration)),g.repeatDelay&&(g.repeatDelay=Yn(g.repeatDelay)),g.from!==void 0&&(g.keyframes[0]=g.from);let v=!1;if((g.type===!1||g.duration===0&&!g.repeatDelay)&&(Kf(g),g.delay===0&&(v=!0)),(Ri.instantAnimations||Ri.skipAnimations)&&(v=!0,Kf(g),g.delay=0),g.allowFlatten=!d.type&&!d.ease,v&&!c&&e.get()!==void 0){const b=TP(g.keyframes,d);if(b!==void 0){Ze.update(()=>{g.onUpdate(b),g.onComplete()});return}}return d.isSync?new Ym(g):new WO(g)};function AP({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function eE(n,e,{delay:i=0,transitionOverride:a,type:r}={}){let{transition:c=n.getDefaultTransition(),transitionEnd:u,...d}=e;a&&(c=a);const h=[],f=r&&n.animationState&&n.animationState.getState()[r];for(const g in d){const v=n.getValue(g,n.latestValues[g]??null),b=d[g];if(b===void 0||f&&AP(f,g))continue;const T={delay:i,...Qm(c||{},g)},C=v.get();if(C!==void 0&&!v.isAnimating&&!Array.isArray(b)&&b===C&&!T.velocity)continue;let E=!1;if(window.MotionHandoffAnimation){const w=$k(n);if(w){const V=window.MotionHandoffAnimation(w,g,Ze);V!==null&&(T.startTime=V,E=!0)}}Zf(n,g),v.start(op(g,v,b,n.shouldReduceMotion&&Sk.has(g)?{type:!1}:T,n,E));const x=v.animation;x&&h.push(x)}return u&&Promise.all(h).then(()=>{Ze.update(()=>{u&&vP(n,u)})}),h}function tE(n,e,i,a=0,r=1){const c=Array.from(n).sort((f,g)=>f.sortNodePosition(g)).indexOf(e),u=n.size,d=(u-1)*a;return typeof i=="function"?i(c,u):r===1?c*a:d-c*a}function $f(n,e,i={}){const a=Qs(n,e,i.type==="exit"?n.presenceContext?.custom:void 0);let{transition:r=n.getDefaultTransition()||{}}=a||{};i.transitionOverride&&(r=i.transitionOverride);const c=a?()=>Promise.all(eE(n,a,i)):()=>Promise.resolve(),u=n.variantChildren&&n.variantChildren.size?(h=0)=>{const{delayChildren:f=0,staggerChildren:g,staggerDirection:v}=r;return wP(n,e,h,f,g,v,i)}:()=>Promise.resolve(),{when:d}=r;if(d){const[h,f]=d==="beforeChildren"?[c,u]:[u,c];return h().then(()=>f())}else return Promise.all([c(),u(i.delay)])}function wP(n,e,i=0,a=0,r=0,c=1,u){const d=[];for(const h of n.variantChildren)h.notify("AnimationStart",e),d.push($f(h,e,{...u,delay:i+(typeof a=="function"?0:a)+tE(n.variantChildren,h,a,r,c)}).then(()=>h.notify("AnimationComplete",e)));return Promise.all(d)}function MP(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const r=e.map(c=>$f(n,c,i));a=Promise.all(r)}else if(typeof e=="string")a=$f(n,e,i);else{const r=typeof e=="function"?Qs(n,e,i.custom):e;a=Promise.all(eE(n,r,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}function nE(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}const DP=ep.length;function iE(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?iE(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<DP;i++){const a=ep[i],r=n.props[a];(Do(r)||r===!1)&&(e[a]=r)}return e}const OP=[...$m].reverse(),xP=$m.length;function PP(n){return e=>Promise.all(e.map(({animation:i,options:a})=>MP(n,i,a)))}function NP(n){let e=PP(n),i=oT(),a=!0;const r=h=>(f,g)=>{const v=Qs(n,g,h==="exit"?n.presenceContext?.custom:void 0);if(v){const{transition:b,transitionEnd:T,...C}=v;f={...f,...C,...T}}return f};function c(h){e=h(n)}function u(h){const{props:f}=n,g=iE(n.parent)||{},v=[],b=new Set;let T={},C=1/0;for(let x=0;x<xP;x++){const w=OP[x],V=i[w],I=f[w]!==void 0?f[w]:g[w],A=Do(I),R=w===h?V.isActive:null;R===!1&&(C=x);let B=I===g[w]&&I!==f[w]&&A;if(B&&a&&n.manuallyAnimateOnMount&&(B=!1),V.protectedKeys={...T},!V.isActive&&R===null||!I&&!V.prevProp||$l(I)||typeof I=="boolean")continue;const F=LP(V.prevProp,I);let G=F||w===h&&V.isActive&&!B&&A||x>C&&A,$=!1;const Z=Array.isArray(I)?I:[I];let ae=Z.reduce(r(w),{});R===!1&&(ae={});const{prevResolvedValues:he={}}=V,Ye={...he,...ae},rt=W=>{G=!0,b.has(W)&&($=!0,b.delete(W)),V.needsAnimating[W]=!0;const se=n.getValue(W);se&&(se.liveStyle=!1)};for(const W in Ye){const se=ae[W],Se=he[W];if(T.hasOwnProperty(W))continue;let ke=!1;Wf(se)&&Wf(Se)?ke=!nE(se,Se):ke=se!==Se,ke?se!=null?rt(W):b.add(W):se!==void 0&&b.has(W)?rt(W):V.protectedKeys[W]=!0}V.prevProp=I,V.prevResolvedValues=ae,V.isActive&&(T={...T,...ae}),a&&n.blockInitialAnimation&&(G=!1);const ht=B&&F;G&&(!ht||$)&&v.push(...Z.map(W=>{const se={type:w};if(typeof W=="string"&&a&&!ht&&n.manuallyAnimateOnMount&&n.parent){const{parent:Se}=n,ke=Qs(Se,W);if(Se.enteringChildren&&ke){const{delayChildren:D}=ke.transition||{};se.delay=tE(Se.enteringChildren,n,D)}}return{animation:W,options:se}}))}if(b.size){const x={};if(typeof f.initial!="boolean"){const w=Qs(n,Array.isArray(f.initial)?f.initial[0]:f.initial);w&&w.transition&&(x.transition=w.transition)}b.forEach(w=>{const V=n.getBaseTarget(w),I=n.getValue(w);I&&(I.liveStyle=!0),x[w]=V??null}),v.push({animation:x})}let E=!!v.length;return a&&(f.initial===!1||f.initial===f.animate)&&!n.manuallyAnimateOnMount&&(E=!1),a=!1,E?e(v):Promise.resolve()}function d(h,f){if(i[h].isActive===f)return Promise.resolve();n.variantChildren?.forEach(v=>v.animationState?.setActive(h,f)),i[h].isActive=f;const g=u(h);for(const v in i)i[v].protectedKeys={};return g}return{animateChanges:u,setActive:d,setAnimateFunction:c,getState:()=>i,reset:()=>{i=oT()}}}function LP(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!nE(e,n):!1}function Na(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function oT(){return{animate:Na(!0),whileInView:Na(),whileHover:Na(),whileTap:Na(),whileDrag:Na(),whileFocus:Na(),exit:Na()}}class ma{constructor(e){this.isMounted=!1,this.node=e}update(){}}class IP extends ma{constructor(e){super(e),e.animationState||(e.animationState=NP(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();$l(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let UP=0;class BP extends ma{constructor(){super(...arguments),this.id=UP++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const r=this.node.animationState.setActive("exit",!e);i&&!e&&r.then(()=>{i(this.id)})}mount(){const{register:e,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const jP={animation:{Feature:IP},exit:{Feature:BP}};function xo(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function Io(n){return{point:{x:n.pageX,y:n.pageY}}}const VP=n=>e=>Zm(e)&&n(e,Io(e));function go(n,e,i,a){return xo(n,e,VP(i),a)}const aE=1e-4,FP=1-aE,zP=1+aE,sE=.01,qP=0-sE,HP=0+sE;function Vt(n){return n.max-n.min}function GP(n,e,i){return Math.abs(n-e)<=i}function cT(n,e,i,a=.5){n.origin=a,n.originPoint=$e(e.min,e.max,n.origin),n.scale=Vt(i)/Vt(e),n.translate=$e(i.min,i.max,n.origin)-n.originPoint,(n.scale>=FP&&n.scale<=zP||isNaN(n.scale))&&(n.scale=1),(n.translate>=qP&&n.translate<=HP||isNaN(n.translate))&&(n.translate=0)}function vo(n,e,i,a){cT(n.x,e.x,i.x,a?a.originX:void 0),cT(n.y,e.y,i.y,a?a.originY:void 0)}function lT(n,e,i){n.min=i.min+e.min,n.max=n.min+Vt(e)}function KP(n,e,i){lT(n.x,e.x,i.x),lT(n.y,e.y,i.y)}function uT(n,e,i){n.min=e.min-i.min,n.max=n.min+Vt(e)}function yo(n,e,i){uT(n.x,e.x,i.x),uT(n.y,e.y,i.y)}function En(n){return[n("x"),n("y")]}const rE=({current:n})=>n?n.ownerDocument.defaultView:null,dT=(n,e)=>Math.abs(n-e);function YP(n,e){const i=dT(n.x,e.x),a=dT(n.y,e.y);return Math.sqrt(i**2+a**2)}class oE{constructor(e,i,{transformPagePoint:a,contextWindow:r=window,dragSnapToOrigin:c=!1,distanceThreshold:u=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=$h(this.lastMoveEventInfo,this.history),T=this.startEvent!==null,C=YP(b.offset,{x:0,y:0})>=this.distanceThreshold;if(!T&&!C)return;const{point:E}=b,{timestamp:x}=Ot;this.history.push({...E,timestamp:x});const{onStart:w,onMove:V}=this.handlers;T||(w&&w(this.lastMoveEvent,b),this.startEvent=this.lastMoveEvent),V&&V(this.lastMoveEvent,b)},this.handlePointerMove=(b,T)=>{this.lastMoveEvent=b,this.lastMoveEventInfo=Zh(T,this.transformPagePoint),Ze.update(this.updatePoint,!0)},this.handlePointerUp=(b,T)=>{this.end();const{onEnd:C,onSessionEnd:E,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=$h(b.type==="pointercancel"?this.lastMoveEventInfo:Zh(T,this.transformPagePoint),this.history);this.startEvent&&C&&C(b,w),E&&E(b,w)},!Zm(e))return;this.dragSnapToOrigin=c,this.handlers=i,this.transformPagePoint=a,this.distanceThreshold=u,this.contextWindow=r||window;const d=Io(e),h=Zh(d,this.transformPagePoint),{point:f}=h,{timestamp:g}=Ot;this.history=[{...f,timestamp:g}];const{onSessionStart:v}=i;v&&v(e,$h(h,this.history)),this.removeListeners=Po(go(this.contextWindow,"pointermove",this.handlePointerMove),go(this.contextWindow,"pointerup",this.handlePointerUp),go(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ua(this.updatePoint)}}function Zh(n,e){return e?{point:e(n.point)}:n}function hT(n,e){return{x:n.x-e.x,y:n.y-e.y}}function $h({point:n},e){return{point:n,delta:hT(n,cE(e)),offset:hT(n,XP(e)),velocity:QP(e,.1)}}function XP(n){return n[0]}function cE(n){return n[n.length-1]}function QP(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const r=cE(n);for(;i>=0&&(a=n[i],!(r.timestamp-a.timestamp>Yn(e)));)i--;if(!a)return{x:0,y:0};const c=An(r.timestamp-a.timestamp);if(c===0)return{x:0,y:0};const u={x:(r.x-a.x)/c,y:(r.y-a.y)/c};return u.x===1/0&&(u.x=0),u.y===1/0&&(u.y=0),u}function JP(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?$e(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?$e(i,n,a.max):Math.min(n,i)),n}function fT(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function WP(n,{top:e,left:i,bottom:a,right:r}){return{x:fT(n.x,i,r),y:fT(n.y,e,a)}}function mT(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function ZP(n,e){return{x:mT(n.x,e.x),y:mT(n.y,e.y)}}function $P(n,e){let i=.5;const a=Vt(n),r=Vt(e);return r>a?i=Ao(e.min,e.max-a,n.min):a>r&&(i=Ao(n.min,n.max-r,e.min)),_i(0,1,i)}function eN(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const em=.35;function tN(n=em){return n===!1?n=0:n===!0&&(n=em),{x:pT(n,"left","right"),y:pT(n,"top","bottom")}}function pT(n,e,i){return{min:gT(n,e),max:gT(n,i)}}function gT(n,e){return typeof n=="number"?n:n[e]||0}const nN=new WeakMap;class iN{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ut(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:i=!1,distanceThreshold:a}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const c=v=>{const{dragSnapToOrigin:b}=this.getProps();b?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(Io(v).point)},u=(v,b)=>{const{drag:T,dragPropagation:C,onDragStart:E}=this.getProps();if(T&&!C&&(this.openDragLock&&this.openDragLock(),this.openDragLock=mx(T),!this.openDragLock))return;this.latestPointerEvent=v,this.latestPanInfo=b,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),En(w=>{let V=this.getAxisMotionValue(w).get()||0;if(Xn.test(V)){const{projection:I}=this.visualElement;if(I&&I.layout){const A=I.layout.layoutBox[w];A&&(V=Vt(A)*(parseFloat(V)/100))}}this.originPoint[w]=V}),E&&Ze.postRender(()=>E(v,b)),Zf(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},d=(v,b)=>{this.latestPointerEvent=v,this.latestPanInfo=b;const{dragPropagation:T,dragDirectionLock:C,onDirectionLock:E,onDrag:x}=this.getProps();if(!T&&!this.openDragLock)return;const{offset:w}=b;if(C&&this.currentDirection===null){this.currentDirection=aN(w),this.currentDirection!==null&&E&&E(this.currentDirection);return}this.updateAxis("x",b.point,w),this.updateAxis("y",b.point,w),this.visualElement.render(),x&&x(v,b)},h=(v,b)=>{this.latestPointerEvent=v,this.latestPanInfo=b,this.stop(v,b),this.latestPointerEvent=null,this.latestPanInfo=null},f=()=>En(v=>this.getAnimationState(v)==="paused"&&this.getAxisMotionValue(v).animation?.play()),{dragSnapToOrigin:g}=this.getProps();this.panSession=new oE(e,{onSessionStart:c,onStart:u,onMove:d,onSessionEnd:h,resumeAnimation:f},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:g,distanceThreshold:a,contextWindow:rE(this.visualElement)})}stop(e,i){const a=e||this.latestPointerEvent,r=i||this.latestPanInfo,c=this.isDragging;if(this.cancel(),!c||!r||!a)return;const{velocity:u}=r;this.startAnimation(u);const{onDragEnd:d}=this.getProps();d&&Ze.postRender(()=>d(a,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:r}=this.getProps();if(!a||!rl(e,r,this.currentDirection))return;const c=this.getAxisMotionValue(e);let u=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(u=JP(u,this.constraints[e],this.elastic[e])),c.set(u)}resolveConstraints(){const{dragConstraints:e,dragElastic:i}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,r=this.constraints;e&&Us(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&a?this.constraints=WP(a.layoutBox,e):this.constraints=!1,this.elastic=tN(i),r!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&En(c=>{this.constraints!==!1&&this.getAxisMotionValue(c)&&(this.constraints[c]=eN(a.layoutBox[c],this.constraints[c]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!Us(e))return!1;const a=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const c=sP(a,r.root,this.visualElement.getTransformPagePoint());let u=ZP(r.layout.layoutBox,c);if(i){const d=i(nP(u));this.hasMutatedConstraints=!!d,d&&(u=Gk(d))}return u}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:r,dragTransition:c,dragSnapToOrigin:u,onDragTransitionEnd:d}=this.getProps(),h=this.constraints||{},f=En(g=>{if(!rl(g,i,this.currentDirection))return;let v=h&&h[g]||{};u&&(v={min:0,max:0});const b=r?200:1e6,T=r?40:1e7,C={type:"inertia",velocity:a?e[g]:0,bounceStiffness:b,bounceDamping:T,timeConstant:750,restDelta:1,restSpeed:10,...c,...v};return this.startAxisValueAnimation(g,C)});return Promise.all(f).then(d)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return Zf(this.visualElement,e),a.start(op(e,a,0,i,this.visualElement,!1))}stopAnimation(){En(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){En(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),r=a[i];return r||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){En(i=>{const{drag:a}=this.getProps();if(!rl(i,a,this.currentDirection))return;const{projection:r}=this.visualElement,c=this.getAxisMotionValue(i);if(r&&r.layout){const{min:u,max:d}=r.layout.layoutBox[i];c.set(e[i]-$e(u,d,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!Us(i)||!a||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};En(u=>{const d=this.getAxisMotionValue(u);if(d&&this.constraints!==!1){const h=d.get();r[u]=$P({min:h,max:h},this.constraints[u])}});const{transformTemplate:c}=this.visualElement.getProps();this.visualElement.current.style.transform=c?c({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),En(u=>{if(!rl(u,e,null))return;const d=this.getAxisMotionValue(u),{min:h,max:f}=this.constraints[u];d.set($e(h,f,r[u]))})}addListeners(){if(!this.visualElement.current)return;nN.set(this.visualElement,this);const e=this.visualElement.current,i=go(e,"pointerdown",h=>{const{drag:f,dragListener:g=!0}=this.getProps();f&&g&&this.start(h)}),a=()=>{const{dragConstraints:h}=this.getProps();Us(h)&&h.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,c=r.addEventListener("measure",a);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Ze.read(a);const u=xo(window,"resize",()=>this.scalePositionWithinConstraints()),d=r.addEventListener("didUpdate",(({delta:h,hasLayoutChanged:f})=>{this.isDragging&&f&&(En(g=>{const v=this.getAxisMotionValue(g);v&&(this.originPoint[g]+=h[g].translate,v.set(v.get()+h[g].translate))}),this.visualElement.render())}));return()=>{u(),i(),c(),d&&d()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:r=!1,dragConstraints:c=!1,dragElastic:u=em,dragMomentum:d=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:r,dragConstraints:c,dragElastic:u,dragMomentum:d}}}function rl(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function aN(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class sN extends ma{constructor(e){super(e),this.removeGroupControls=wn,this.removeListeners=wn,this.controls=new iN(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||wn}unmount(){this.removeGroupControls(),this.removeListeners()}}const vT=n=>(e,i)=>{n&&Ze.postRender(()=>n(e,i))};class rN extends ma{constructor(){super(...arguments),this.removePointerDownListener=wn}onPointerDown(e){this.session=new oE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:rE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:r}=this.node.getProps();return{onSessionStart:vT(e),onStart:vT(i),onMove:a,onEnd:(c,u)=>{delete this.session,r&&Ze.postRender(()=>r(c,u))}}}mount(){this.removePointerDownListener=go(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const kl={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function yT(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const ao={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(fe.test(n))n=parseFloat(n);else return n;const i=yT(n,e.target.x),a=yT(n,e.target.y);return`${i}% ${a}%`}},oN={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,r=da.parse(n);if(r.length>5)return a;const c=da.createTransformer(n),u=typeof r[0]!="number"?1:0,d=i.x.scale*e.x,h=i.y.scale*e.y;r[0+u]/=d,r[1+u]/=h;const f=$e(d,h,.5);return typeof r[2+u]=="number"&&(r[2+u]/=f),typeof r[3+u]=="number"&&(r[3+u]/=f),c(r)}};let ef=!1;class cN extends le.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:r}=this.props,{projection:c}=e;Dx(lN),c&&(i.group&&i.group.add(c),a&&a.register&&r&&a.register(c),ef&&c.root.didUpdate(),c.addEventListener("animationComplete",()=>{this.safeToRemove()}),c.setOptions({...c.options,onExitComplete:()=>this.safeToRemove()})),kl.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:r,isPresent:c}=this.props,{projection:u}=a;return u&&(u.isPresent=c,ef=!0,r||e.layoutDependency!==i||i===void 0||e.isPresent!==c?u.willUpdate():this.safeToRemove(),e.isPresent!==c&&(c?u.promote():u.relegate()||Ze.postRender(()=>{const d=u.getStack();(!d||!d.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Wm.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:r}=e;ef=!0,r&&(r.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(r),a&&a.deregister&&a.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function lE(n){const[e,i]=kx(),a=le.useContext(FC);return Ce.jsx(cN,{...n,layoutGroup:a,switchLayoutGroup:le.useContext(qk),isPresent:e,safeToRemove:i})}const lN={borderRadius:{...ao,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ao,borderTopRightRadius:ao,borderBottomLeftRadius:ao,borderBottomRightRadius:ao,boxShadow:oN};function uN(n,e,i){const a=Lt(n)?n:Zs(n);return a.start(op("",a,e,i)),a.animation}const dN=(n,e)=>n.depth-e.depth;class hN{constructor(){this.children=[],this.isDirty=!1}add(e){xm(this.children,e),this.isDirty=!0}remove(e){Pm(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(dN),this.isDirty=!1,this.children.forEach(e)}}function fN(n,e){const i=Zt.now(),a=({timestamp:r})=>{const c=r-i;c>=e&&(ua(a),n(c-e))};return Ze.setup(a,!0),()=>ua(a)}const uE=["TopLeft","TopRight","BottomLeft","BottomRight"],mN=uE.length,bT=n=>typeof n=="string"?parseFloat(n):n,TT=n=>typeof n=="number"||fe.test(n);function pN(n,e,i,a,r,c){r?(n.opacity=$e(0,i.opacity??1,gN(a)),n.opacityExit=$e(e.opacity??1,0,vN(a))):c&&(n.opacity=$e(e.opacity??1,i.opacity??1,a));for(let u=0;u<mN;u++){const d=`border${uE[u]}Radius`;let h=ST(e,d),f=ST(i,d);if(h===void 0&&f===void 0)continue;h||(h=0),f||(f=0),h===0||f===0||TT(h)===TT(f)?(n[d]=Math.max($e(bT(h),bT(f),a),0),(Xn.test(f)||Xn.test(h))&&(n[d]+="%")):n[d]=f}(e.rotate||i.rotate)&&(n.rotate=$e(e.rotate||0,i.rotate||0,a))}function ST(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const gN=dE(0,.5,ZC),vN=dE(.5,.95,wn);function dE(n,e,i){return a=>a<n?0:a>e?1:i(Ao(n,e,a))}function CT(n,e){n.min=e.min,n.max=e.max}function Cn(n,e){CT(n.x,e.x),CT(n.y,e.y)}function kT(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function ET(n,e,i,a,r){return n-=e,n=zl(n,1/i,a),r!==void 0&&(n=zl(n,1/r,a)),n}function yN(n,e=0,i=1,a=.5,r,c=n,u=n){if(Xn.test(e)&&(e=parseFloat(e),e=$e(u.min,u.max,e/100)-u.min),typeof e!="number")return;let d=$e(c.min,c.max,a);n===c&&(d-=e),n.min=ET(n.min,e,i,d,r),n.max=ET(n.max,e,i,d,r)}function _T(n,e,[i,a,r],c,u){yN(n,e[i],e[a],e[r],e.scale,c,u)}const bN=["x","scaleX","originX"],TN=["y","scaleY","originY"];function RT(n,e,i,a){_T(n.x,e,bN,i?i.x:void 0,a?a.x:void 0),_T(n.y,e,TN,i?i.y:void 0,a?a.y:void 0)}function AT(n){return n.translate===0&&n.scale===1}function hE(n){return AT(n.x)&&AT(n.y)}function wT(n,e){return n.min===e.min&&n.max===e.max}function SN(n,e){return wT(n.x,e.x)&&wT(n.y,e.y)}function MT(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function fE(n,e){return MT(n.x,e.x)&&MT(n.y,e.y)}function DT(n){return Vt(n.x)/Vt(n.y)}function OT(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class CN{constructor(){this.members=[]}add(e){xm(this.members,e),e.scheduleRender()}remove(e){if(Pm(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(r=>e===r);if(i===0)return!1;let a;for(let r=i;r>=0;r--){const c=this.members[r];if(c.isPresent!==!1){a=c;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function kN(n,e,i){let a="";const r=n.x.translate/e.x,c=n.y.translate/e.y,u=i?.z||0;if((r||c||u)&&(a=`translate3d(${r}px, ${c}px, ${u}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:f,rotate:g,rotateX:v,rotateY:b,skewX:T,skewY:C}=i;f&&(a=`perspective(${f}px) ${a}`),g&&(a+=`rotate(${g}deg) `),v&&(a+=`rotateX(${v}deg) `),b&&(a+=`rotateY(${b}deg) `),T&&(a+=`skewX(${T}deg) `),C&&(a+=`skewY(${C}deg) `)}const d=n.x.scale*e.x,h=n.y.scale*e.y;return(d!==1||h!==1)&&(a+=`scale(${d}, ${h})`),a||"none"}const tf=["","X","Y","Z"],EN=1e3;let _N=0;function nf(n,e,i,a){const{latestValues:r}=e;r[n]&&(i[n]=r[n],e.setStaticValue(n,0),a&&(a[n]=0))}function mE(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=$k(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:r,layoutId:c}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Ze,!(r||c))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&mE(a)}function pE({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:r}){return class{constructor(u={},d=e?.()){this.id=_N++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(wN),this.nodes.forEach(xN),this.nodes.forEach(PN),this.nodes.forEach(MN)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=u,this.root=d?d.root||d:this,this.path=d?[...d.path,d]:[],this.parent=d,this.depth=d?d.depth+1:0;for(let h=0;h<this.path.length;h++)this.path[h].shouldResetTransform=!0;this.root===this&&(this.nodes=new hN)}addEventListener(u,d){return this.eventHandlers.has(u)||this.eventHandlers.set(u,new Im),this.eventHandlers.get(u).add(d)}notifyListeners(u,...d){const h=this.eventHandlers.get(u);h&&h.notify(...d)}hasListeners(u){return this.eventHandlers.has(u)}mount(u){if(this.instance)return;this.isSVG=Dk(u)&&!Tx(u),this.instance=u;const{layoutId:d,layout:h,visualElement:f}=this.options;if(f&&!f.current&&f.mount(u),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(h||d)&&(this.isLayoutDirty=!0),n){let g,v=0;const b=()=>this.root.updateBlockedByResize=!1;Ze.read(()=>{v=window.innerWidth}),n(u,()=>{const T=window.innerWidth;T!==v&&(v=T,this.root.updateBlockedByResize=!0,g&&g(),g=fN(b,250),kl.hasAnimatedSinceResize&&(kl.hasAnimatedSinceResize=!1,this.nodes.forEach(NT)))})}d&&this.root.registerSharedNode(d,this),this.options.animate!==!1&&f&&(d||h)&&this.addEventListener("didUpdate",({delta:g,hasLayoutChanged:v,hasRelativeLayoutChanged:b,layout:T})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const C=this.options.transition||f.getDefaultTransition()||BN,{onLayoutAnimationStart:E,onLayoutAnimationComplete:x}=f.getProps(),w=!this.targetLayout||!fE(this.targetLayout,T),V=!v&&b;if(this.options.layoutRoot||this.resumeFrom||V||v&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const I={...Qm(C,"layout"),onPlay:E,onComplete:x};(f.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I),this.setAnimationOrigin(g,V)}else v||NT(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=T})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const u=this.getStack();u&&u.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ua(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(NN),this.animationId++)}getTransformTemplate(){const{visualElement:u}=this.options;return u&&u.getProps().transformTemplate}willUpdate(u=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&mE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let g=0;g<this.path.length;g++){const v=this.path[g];v.shouldResetTransform=!0,v.updateScroll("snapshot"),v.options.layoutRoot&&v.willUpdate(!1)}const{layoutId:d,layout:h}=this.options;if(d===void 0&&!h)return;const f=this.getTransformTemplate();this.prevTransformTemplateValue=f?f(this.latestValues,""):void 0,this.updateSnapshot(),u&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(xT);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(PT);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(ON),this.nodes.forEach(RN),this.nodes.forEach(AN)):this.nodes.forEach(PT),this.clearAllSnapshots();const d=Zt.now();Ot.delta=_i(0,1e3/60,d-Ot.timestamp),Ot.timestamp=d,Ot.isProcessing=!0,Hh.update.process(Ot),Hh.preRender.process(Ot),Hh.render.process(Ot),Ot.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Wm.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(DN),this.sharedNodes.forEach(LN)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ze.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ze.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Vt(this.snapshot.measuredBox.x)&&!Vt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let h=0;h<this.path.length;h++)this.path[h].updateScroll();const u=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ut(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:d}=this.options;d&&d.notify("LayoutMeasure",this.layout.layoutBox,u?u.layoutBox:void 0)}updateScroll(u="measure"){let d=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===u&&(d=!1),d&&this.instance){const h=a(this.instance);this.scroll={animationId:this.root.animationId,phase:u,isRoot:h,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:h}}}resetTransform(){if(!r)return;const u=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,d=this.projectionDelta&&!hE(this.projectionDelta),h=this.getTransformTemplate(),f=h?h(this.latestValues,""):void 0,g=f!==this.prevTransformTemplateValue;u&&this.instance&&(d||Ua(this.latestValues)||g)&&(r(this.instance,f),this.shouldResetTransform=!1,this.scheduleRender())}measure(u=!0){const d=this.measurePageBox();let h=this.removeElementScroll(d);return u&&(h=this.removeTransform(h)),jN(h),{animationId:this.root.animationId,measuredBox:d,layoutBox:h,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:u}=this.options;if(!u)return ut();const d=u.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(VN))){const{scroll:f}=this.root;f&&(Bs(d.x,f.offset.x),Bs(d.y,f.offset.y))}return d}removeElementScroll(u){const d=ut();if(Cn(d,u),this.scroll?.wasRoot)return d;for(let h=0;h<this.path.length;h++){const f=this.path[h],{scroll:g,options:v}=f;f!==this.root&&g&&v.layoutScroll&&(g.wasRoot&&Cn(d,u),Bs(d.x,g.offset.x),Bs(d.y,g.offset.y))}return d}applyTransform(u,d=!1){const h=ut();Cn(h,u);for(let f=0;f<this.path.length;f++){const g=this.path[f];!d&&g.options.layoutScroll&&g.scroll&&g!==g.root&&js(h,{x:-g.scroll.offset.x,y:-g.scroll.offset.y}),Ua(g.latestValues)&&js(h,g.latestValues)}return Ua(this.latestValues)&&js(h,this.latestValues),h}removeTransform(u){const d=ut();Cn(d,u);for(let h=0;h<this.path.length;h++){const f=this.path[h];if(!f.instance||!Ua(f.latestValues))continue;Xf(f.latestValues)&&f.updateSnapshot();const g=ut(),v=f.measurePageBox();Cn(g,v),RT(d,f.latestValues,f.snapshot?f.snapshot.layoutBox:void 0,g)}return Ua(this.latestValues)&&RT(d,this.latestValues),d}setTargetDelta(u){this.targetDelta=u,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(u){this.options={...this.options,...u,crossfade:u.crossfade!==void 0?u.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ot.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(u=!1){const d=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=d.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=d.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=d.isSharedProjectionDirty);const h=!!this.resumingFrom||this!==d;if(!(u||h&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:g,layoutId:v}=this.options;if(!(!this.layout||!(g||v))){if(this.resolvedRelativeTargetAt=Ot.timestamp,!this.targetDelta&&!this.relativeTarget){const b=this.getClosestProjectingParent();b&&b.layout&&this.animationProgress!==1?(this.relativeParent=b,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ut(),this.relativeTargetOrigin=ut(),yo(this.relativeTargetOrigin,this.layout.layoutBox,b.layout.layoutBox),Cn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ut(),this.targetWithTransforms=ut()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),KP(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Cn(this.target,this.layout.layoutBox),Yk(this.target,this.targetDelta)):Cn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const b=this.getClosestProjectingParent();b&&!!b.resumingFrom==!!this.resumingFrom&&!b.options.layoutScroll&&b.target&&this.animationProgress!==1?(this.relativeParent=b,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ut(),this.relativeTargetOrigin=ut(),yo(this.relativeTargetOrigin,this.target,b.target),Cn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Xf(this.parent.latestValues)||Kk(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const u=this.getLead(),d=!!this.resumingFrom||this!==u;let h=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(h=!1),d&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(h=!1),this.resolvedRelativeTargetAt===Ot.timestamp&&(h=!1),h)return;const{layout:f,layoutId:g}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||g))return;Cn(this.layoutCorrected,this.layout.layoutBox);const v=this.treeScale.x,b=this.treeScale.y;aP(this.layoutCorrected,this.treeScale,this.path,d),u.layout&&!u.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(u.target=u.layout.layoutBox,u.targetWithTransforms=ut());const{target:T}=u;if(!T){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(kT(this.prevProjectionDelta.x,this.projectionDelta.x),kT(this.prevProjectionDelta.y,this.projectionDelta.y)),vo(this.projectionDelta,this.layoutCorrected,T,this.latestValues),(this.treeScale.x!==v||this.treeScale.y!==b||!OT(this.projectionDelta.x,this.prevProjectionDelta.x)||!OT(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",T))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(u=!0){if(this.options.visualElement?.scheduleRender(),u){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Vs(),this.projectionDelta=Vs(),this.projectionDeltaWithTransform=Vs()}setAnimationOrigin(u,d=!1){const h=this.snapshot,f=h?h.latestValues:{},g={...this.latestValues},v=Vs();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!d;const b=ut(),T=h?h.source:void 0,C=this.layout?this.layout.source:void 0,E=T!==C,x=this.getStack(),w=!x||x.members.length<=1,V=!!(E&&!w&&this.options.crossfade===!0&&!this.path.some(UN));this.animationProgress=0;let I;this.mixTargetDelta=A=>{const R=A/1e3;LT(v.x,u.x,R),LT(v.y,u.y,R),this.setTargetDelta(v),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(yo(b,this.layout.layoutBox,this.relativeParent.layout.layoutBox),IN(this.relativeTarget,this.relativeTargetOrigin,b,R),I&&SN(this.relativeTarget,I)&&(this.isProjectionDirty=!1),I||(I=ut()),Cn(I,this.relativeTarget)),E&&(this.animationValues=g,pN(g,f,this.latestValues,R,V,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=R},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(u){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ua(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ze.update(()=>{kl.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Zs(0)),this.currentAnimation=uN(this.motionValue,[0,1e3],{...u,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),u.onUpdate&&u.onUpdate(d)},onStop:()=>{},onComplete:()=>{u.onComplete&&u.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const u=this.getStack();u&&u.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(EN),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const u=this.getLead();let{targetWithTransforms:d,target:h,layout:f,latestValues:g}=u;if(!(!d||!h||!f)){if(this!==u&&this.layout&&f&&gE(this.options.animationType,this.layout.layoutBox,f.layoutBox)){h=this.target||ut();const v=Vt(this.layout.layoutBox.x);h.x.min=u.target.x.min,h.x.max=h.x.min+v;const b=Vt(this.layout.layoutBox.y);h.y.min=u.target.y.min,h.y.max=h.y.min+b}Cn(d,h),js(d,g),vo(this.projectionDeltaWithTransform,this.layoutCorrected,d,g)}}registerSharedNode(u,d){this.sharedNodes.has(u)||this.sharedNodes.set(u,new CN),this.sharedNodes.get(u).add(d);const f=d.options.initialPromotionConfig;d.promote({transition:f?f.transition:void 0,preserveFollowOpacity:f&&f.shouldPreserveFollowOpacity?f.shouldPreserveFollowOpacity(d):void 0})}isLead(){const u=this.getStack();return u?u.lead===this:!0}getLead(){const{layoutId:u}=this.options;return u?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:u}=this.options;return u?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:u}=this.options;if(u)return this.root.sharedNodes.get(u)}promote({needsReset:u,transition:d,preserveFollowOpacity:h}={}){const f=this.getStack();f&&f.promote(this,h),u&&(this.projectionDelta=void 0,this.needsReset=!0),d&&this.setOptions({transition:d})}relegate(){const u=this.getStack();return u?u.relegate(this):!1}resetSkewAndRotation(){const{visualElement:u}=this.options;if(!u)return;let d=!1;const{latestValues:h}=u;if((h.z||h.rotate||h.rotateX||h.rotateY||h.rotateZ||h.skewX||h.skewY)&&(d=!0),!d)return;const f={};h.z&&nf("z",u,f,this.animationValues);for(let g=0;g<tf.length;g++)nf(`rotate${tf[g]}`,u,f,this.animationValues),nf(`skew${tf[g]}`,u,f,this.animationValues);u.render();for(const g in f)u.setStaticValue(g,f[g]),this.animationValues&&(this.animationValues[g]=f[g]);u.scheduleRender()}applyProjectionStyles(u,d){if(!this.instance||this.isSVG)return;if(!this.isVisible){u.visibility="hidden";return}const h=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,u.visibility="",u.opacity="",u.pointerEvents=Cl(d?.pointerEvents)||"",u.transform=h?h(this.latestValues,""):"none";return}const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){this.options.layoutId&&(u.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,u.pointerEvents=Cl(d?.pointerEvents)||""),this.hasProjected&&!Ua(this.latestValues)&&(u.transform=h?h({},""):"none",this.hasProjected=!1);return}u.visibility="";const g=f.animationValues||f.latestValues;this.applyTransformsToTarget();let v=kN(this.projectionDeltaWithTransform,this.treeScale,g);h&&(v=h(g,v)),u.transform=v;const{x:b,y:T}=this.projectionDelta;u.transformOrigin=`${b.origin*100}% ${T.origin*100}% 0`,f.animationValues?u.opacity=f===this?g.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:g.opacityExit:u.opacity=f===this?g.opacity!==void 0?g.opacity:"":g.opacityExit!==void 0?g.opacityExit:0;for(const C in Oo){if(g[C]===void 0)continue;const{correct:E,applyTo:x,isCSSVariable:w}=Oo[C],V=v==="none"?g[C]:E(g[C],f);if(x){const I=x.length;for(let A=0;A<I;A++)u[x[A]]=V}else w?this.options.visualElement.renderState.vars[C]=V:u[C]=V}this.options.layoutId&&(u.pointerEvents=f===this?Cl(d?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(u=>u.currentAnimation?.stop()),this.root.nodes.forEach(xT),this.root.sharedNodes.clear()}}}function RN(n){n.updateLayout()}function AN(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:a}=n.layout,{animationType:r}=n.options,c=e.source!==n.layout.source;r==="size"?En(g=>{const v=c?e.measuredBox[g]:e.layoutBox[g],b=Vt(v);v.min=i[g].min,v.max=v.min+b}):gE(r,e.layoutBox,i)&&En(g=>{const v=c?e.measuredBox[g]:e.layoutBox[g],b=Vt(i[g]);v.max=v.min+b,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[g].max=n.relativeTarget[g].min+b)});const u=Vs();vo(u,i,e.layoutBox);const d=Vs();c?vo(d,n.applyTransform(a,!0),e.measuredBox):vo(d,i,e.layoutBox);const h=!hE(u);let f=!1;if(!n.resumeFrom){const g=n.getClosestProjectingParent();if(g&&!g.resumeFrom){const{snapshot:v,layout:b}=g;if(v&&b){const T=ut();yo(T,e.layoutBox,v.layoutBox);const C=ut();yo(C,i,b.layoutBox),fE(T,C)||(f=!0),g.options.layoutRoot&&(n.relativeTarget=C,n.relativeTargetOrigin=T,n.relativeParent=g)}}}n.notifyListeners("didUpdate",{layout:i,snapshot:e,delta:d,layoutDelta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:f})}else if(n.isLead()){const{onExitComplete:i}=n.options;i&&i()}n.options.transition=void 0}function wN(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function MN(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function DN(n){n.clearSnapshot()}function xT(n){n.clearMeasurements()}function PT(n){n.isLayoutDirty=!1}function ON(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function NT(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function xN(n){n.resolveTargetDelta()}function PN(n){n.calcProjection()}function NN(n){n.resetSkewAndRotation()}function LN(n){n.removeLeadSnapshot()}function LT(n,e,i){n.translate=$e(e.translate,0,i),n.scale=$e(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function IT(n,e,i,a){n.min=$e(e.min,i.min,a),n.max=$e(e.max,i.max,a)}function IN(n,e,i,a){IT(n.x,e.x,i.x,a),IT(n.y,e.y,i.y,a)}function UN(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const BN={duration:.45,ease:[.4,0,.1,1]},UT=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),BT=UT("applewebkit/")&&!UT("chrome/")?Math.round:wn;function jT(n){n.min=BT(n.min),n.max=BT(n.max)}function jN(n){jT(n.x),jT(n.y)}function gE(n,e,i){return n==="position"||n==="preserve-aspect"&&!GP(DT(e),DT(i),.2)}function VN(n){return n!==n.root&&n.scroll?.wasRoot}const FN=pE({attachResizeListener:(n,e)=>xo(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),af={current:void 0},vE=pE({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!af.current){const n=new FN({});n.mount(window),n.setOptions({layoutScroll:!0}),af.current=n}return af.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),zN={pan:{Feature:rN},drag:{Feature:sN,ProjectionNode:vE,MeasureLayout:lE}};function VT(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const r="onHover"+i,c=a[r];c&&Ze.postRender(()=>c(e,Io(e)))}class qN extends ma{mount(){const{current:e}=this.node;e&&(this.unmount=px(e,(i,a)=>(VT(this.node,a,"Start"),r=>VT(this.node,r,"End"))))}unmount(){}}class HN extends ma{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Po(xo(this.node.current,"focus",()=>this.onFocus()),xo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function FT(n,e,i){const{props:a}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const r="onTap"+(i==="End"?"":i),c=a[r];c&&Ze.postRender(()=>c(e,Io(e)))}class GN extends ma{mount(){const{current:e}=this.node;e&&(this.unmount=bx(e,(i,a)=>(FT(this.node,a,"Start"),(r,{success:c})=>FT(this.node,r,c?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const tm=new WeakMap,sf=new WeakMap,KN=n=>{const e=tm.get(n.target);e&&e(n)},YN=n=>{n.forEach(KN)};function XN({root:n,...e}){const i=n||document;sf.has(i)||sf.set(i,{});const a=sf.get(i),r=JSON.stringify(e);return a[r]||(a[r]=new IntersectionObserver(YN,{root:n,...e})),a[r]}function QN(n,e,i){const a=XN(e);return tm.set(n,i),a.observe(n),()=>{tm.delete(n),a.unobserve(n)}}const JN={some:0,all:1};class WN extends ma{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:r="some",once:c}=e,u={root:i?i.current:void 0,rootMargin:a,threshold:typeof r=="number"?r:JN[r]},d=h=>{const{isIntersecting:f}=h;if(this.isInView===f||(this.isInView=f,c&&!f&&this.hasEnteredView))return;f&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",f);const{onViewportEnter:g,onViewportLeave:v}=this.node.getProps(),b=f?g:v;b&&b(h)};return QN(this.node.current,u,d)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(ZN(e,i))&&this.startObserver()}unmount(){}}function ZN({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const $N={inView:{Feature:WN},tap:{Feature:GN},focus:{Feature:HN},hover:{Feature:qN}},eL={layout:{ProjectionNode:vE,MeasureLayout:lE}},tL={...jP,...$N,...zN,...eL},za=tP(tL,mP);const nL=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iL=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,i,a)=>a?a.toUpperCase():i.toLowerCase()),zT=n=>{const e=iL(n);return e.charAt(0).toUpperCase()+e.slice(1)},yE=(...n)=>n.filter((e,i,a)=>!!e&&e.trim()!==""&&a.indexOf(e)===i).join(" ").trim(),aL=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var sL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rL=le.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:r="",children:c,iconNode:u,...d},h)=>le.createElement("svg",{ref:h,...sL,width:e,height:e,stroke:n,strokeWidth:a?Number(i)*24/Number(e):i,className:yE("lucide",r),...!c&&!aL(d)&&{"aria-hidden":"true"},...d},[...u.map(([f,g])=>le.createElement(f,g)),...Array.isArray(c)?c:[c]]));const bE=(n,e)=>{const i=le.forwardRef(({className:a,...r},c)=>le.createElement(rL,{ref:c,iconNode:e,className:yE(`lucide-${nL(zT(n))}`,`lucide-${n}`,a),...r}));return i.displayName=zT(n),i};const oL=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],cL=bE("mic",oL);const lL=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],uL=bE("phone-off",lL),cp=({children:n,isActive:e,color:i,glowColor:a})=>Ce.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[Ce.jsx(za.div,{animate:{scale:e?[1,1.2,1]:1,opacity:e?[.5,.8,.5]:.3},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`absolute inset-0 rounded-full blur-xl ${a}`}),Ce.jsx("div",{className:`relative w-full h-full rounded-full overflow-hidden border-2 border-white/50 shadow-[inset_0_0_20px_rgba(255,255,255,0.3)] ${i}`,children:n})]}),dL=({isActive:n})=>Ce.jsx(cp,{isActive:n,color:"bg-gradient-to-br from-cyan-500 via-blue-600 to-pink-600",glowColor:"bg-cyan-400",children:Ce.jsxs("svg",{viewBox:"0 0 100 100",className:"absolute inset-0 w-full h-full opacity-60 mix-blend-overlay",children:[Ce.jsx(za.path,{d:"M0,50 Q25,30 50,50 T100,50",stroke:"white",fill:"none",strokeWidth:"0.5",animate:{d:["M0,50 Q25,30 50,50 T100,50","M0,50 Q25,70 50,50 T100,50","M0,50 Q25,30 50,50 T100,50"]},transition:{duration:5,repeat:1/0,ease:"linear"}}),Ce.jsx(za.path,{d:"M0,40 Q25,60 50,40 T100,40",stroke:"cyan",fill:"none",strokeWidth:"0.5",animate:{d:["M0,40 Q25,60 50,40 T100,40","M0,40 Q25,20 50,40 T100,40","M0,40 Q25,60 50,40 T100,40"]},transition:{duration:7,repeat:1/0,ease:"linear"}}),Ce.jsx(za.path,{d:"M0,60 Q25,40 50,60 T100,60",stroke:"pink",fill:"none",strokeWidth:"0.5",animate:{d:["M0,60 Q25,40 50,60 T100,60","M0,60 Q25,80 50,60 T100,60","M0,60 Q25,40 50,60 T100,60"]},transition:{duration:6,repeat:1/0,ease:"linear"}})]})}),hL=({isActive:n})=>Ce.jsx(cp,{isActive:n,color:"bg-gradient-to-br from-indigo-600 via-purple-700 to-blue-800",glowColor:"bg-indigo-500",children:Ce.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-80 mix-blend-overlay",children:Ce.jsx(za.div,{animate:{scaleY:n?[1,1.5,.8,1.2,1]:1},transition:{duration:.5,repeat:1/0,ease:"easeInOut"},className:"w-full h-1/3 bg-gradient-to-r from-transparent via-white to-transparent",style:{clipPath:"polygon(0 50%, 10% 40%, 20% 60%, 30% 45%, 40% 55%, 50% 30%, 60% 70%, 70% 40%, 80% 60%, 90% 50%, 100% 50%)"}})})}),fL=({isActive:n})=>Ce.jsxs(cp,{isActive:n,color:"bg-gradient-to-br from-pink-600 via-red-600 to-orange-700",glowColor:"bg-red-500",children:[Ce.jsxs(za.div,{animate:{rotate:360,scale:[1,1.1,1]},transition:{duration:10,repeat:1/0,ease:"linear"},className:"absolute inset-0 opacity-50 mix-blend-screen",children:[Ce.jsx("div",{className:"absolute top-1/4 left-1/4 w-1/2 h-1/2 bg-pink-400 rounded-full blur-md"}),Ce.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-1/2 h-1/2 bg-orange-400 rounded-full blur-md"})]}),Ce.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent via-white/30 to-transparent opacity-30"})]}),rf={boss:{id:"agent_6301kb7hbmmxe6z9njzb76g0n3yr",name:"Mr. Scrooge",role:"The Stingy Boss",component:dL},colleague:{id:"agent_8101kb7kx0qxfkfvn516vbs1yhn4",name:"Sam",role:"The Lazy Bestie",component:hL},receptionist:{id:"agent_7601kb7m12nqesca63dpjyw1b5ap",name:"Jessica",role:"The Gatekeeper",component:fL}};function mL(){const[n,e]=le.useState("boss"),i=kD(),{status:a,isSpeaking:r}=i,c=async()=>{await i.startSession({agentId:rf[n].id})},u=async()=>{await i.endSession()},d=rf[n],h=d.component;return Ce.jsxs("div",{className:"min-h-screen bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] bg-black text-white flex flex-col items-center justify-center font-sans p-4 overflow-hidden",children:[Ce.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[...Array(50)].map((f,g)=>Ce.jsx("div",{className:"absolute rounded-full bg-white",style:{top:`${Math.random()*100}%`,left:`${Math.random()*100}%`,width:`${Math.random()*2+1}px`,height:`${Math.random()*2+1}px`,opacity:Math.random()*.5+.2,animation:`twinkle ${Math.random()*5+3}s infinite`}},g))}),Ce.jsxs("div",{className:"text-center mb-10 z-10",children:[Ce.jsx("h1",{className:"text-5xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 drop-shadow-2xl",children:"Office Simulator 3000"}),Ce.jsx("p",{className:"text-slate-400 mt-4 text-xl font-light",children:"Choose your conversation partner."})]}),a!=="connected"&&Ce.jsx("div",{className:"flex gap-6 mb-12 flex-wrap justify-center z-10",children:Object.entries(rf).map(([f,g])=>{const v=g.component,b=n===f;return Ce.jsxs("button",{onClick:()=>e(f),className:`relative w-24 h-24 rounded-full transition-all duration-300 group
                  ${b?"scale-110":"opacity-70 hover:opacity-100 hover:scale-105"}`,children:[Ce.jsx(v,{isActive:b}),Ce.jsx("span",{className:`absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap font-semibold text-sm transition-colors
                  ${b?"text-white":"text-slate-400 group-hover:text-white"}`,children:g.name})]},f)})}),Ce.jsx("div",{className:"relative mb-12 z-10",children:Ce.jsx(za.div,{animate:{scale:r?1.05:1},transition:{type:"spring",stiffness:300,damping:20},className:`w-64 h-64 rounded-full transition-all duration-500
            ${a==="connected"?"shadow-[0_0_50px_rgba(255,255,255,0.3)]":""}`,children:Ce.jsx(h,{isActive:r&&a==="connected"})})}),Ce.jsx("div",{className:"flex gap-6 z-10",children:a==="connected"?Ce.jsxs("button",{onClick:u,className:"flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-pink-300 to-pink-500 hover:from-pink-500 hover:to-pink-100 rounded-full text-xl font-bold shadow-lg shadow-red-900/30 transition-all hover:scale-105 active:scale-95",children:[Ce.jsx(uL,{})," Hang Up"]}):Ce.jsxs("button",{onClick:c,className:"flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-700 hover:to-emerald-800 rounded-full text-xl font-bold shadow-lg shadow-green-900/30 transition-all hover:scale-105 active:scale-95",children:[Ce.jsx(cL,{})," Call ",d.name]})}),Ce.jsx("p",{className:"mt-8 text-slate-400 font-mono text-sm z-10",children:a==="connected"?`Interacting with: ${d.role}`:"Ready to connect..."})]})}Z_.createRoot(document.getElementById("root")).render(Ce.jsx(le.StrictMode,{children:Ce.jsx(mL,{})}));
